define.experiment.component("wysiwyg.common.components.InfoTip.RemoveStopPropogation.New",function(e,t){var n=e;n.methods({initialize:function(e,t,n){this.parent(e,t,n),this.tipNode=this.getViewNode(),this.tipNode.addEvent("click",this._handleEvent),this.tipNode.addEvent("mouseleave",this._mouseOut),this.tipNode.addEvent("mouseenter",this._mouseIn),this.tipNode.addEvent("mousedown",this._mouseDown),document.addEvent("keyup",this._mouseOut),this.setState("hidden")},_mouseDown:function(e){e.stopPropagation()}})}),define.experiment.component("wysiwyg.common.components.inputs.OptionsListInput.RichTextViewer.New",function(e){var t=e;t.methods({_onDataChange:function(e,t,n){if(t=="selected"){var r=this._getSelectedComponentByData(n[t]);this._changeSelectedItem(r)}this.parent(e,t,n)},_getSelectedComponentByData:function(e){var t=this.items.map(function(e){return e.$logic}),n=t.filter(function(t){return t.getDataItem()==e});return n&&n[0]},_prepareForRender:function(){return this._sequencer.addEvent("productionFinished",function(e){this._onSequencerFinished(e),this.fireEvent("optionListInputReady",e)}.bind(this)),this._sequencer.createComponents(this.getViewNode(),this.getDataItem().get("items")),!0},_onSequencerFinished:function(e){this.items=e.elements,this.items.forEach(function(e){var t=e.getLogic();t.addEvent("itemSelected",this._onItemSelected),t.getDataItem()===this.getDataItem().get("selected")&&(this._selectedItem=t,this._selectedItem.setSelected(!0))}.bind(this))},_onItemSelected:function(e){if(this._selectedItem&&this._selectedItem===e)return;var t=e.getDataItem();this.setValidationState(!0),this.getDataItem().set("selected",t),this.fireEvent("selectionChanged",t)},_changeSelectedItem:function(e){e&&(this._selectedItem&&this._selectedItem.setSelected(!1),this._selectedItem=e,this._selectedItem.setSelected(!0))}})}),define.experiment.Class("wysiwyg.common.components.traits.LinkableComponent.CursorBug4810.New",function(e,t){var n=e;n.methods({_linkify:function(e,t,n,r){if(!t)return;n&&n!==""?(t.set("href",n),t.setStyle("cursor","pointer"),this._setTarget(t,r),this.hasState("noLink","linkableComponent")&&this.removeState("noLink","linkableComponent")):(t.setStyle("cursor",""),t.erase("href"),t.erase("target"),this.hasState("noLink","linkableComponent")&&this.setState("noLink","linkableComponent")),this._handleSpecialCases(e,t)}})}),define.experiment.newClass("wysiwyg.common.components.traits.SelectableButton.RichText.New",function(e){var t=e;t.inherits("wysiwyg.common.components.traits.SelectableOption"),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.addEvent("click",function(){this.fireEvent(this.ITEM_SELECTED_EVENT,this)}.bind(this))},setSelected:function(e){this._isSelected=e,e?this.setState("selected"):this.setState("up")}})}),define.experiment.newDataSchema("StyledText.RichTextViewer.New",function(){return{text:"string",stylesMapId:"string"}}),define.experiment.Class("wysiwyg.common.managers.LayoutManager.MobileFixes.New",function(e,t){var n=e,r=t;n.methods({_enforceFromBottomTypeAnchor:function(e){var t=e.toComp,n=t.getPhysicalHeight(),r=this._getAnchoredH(e),i=r;e.toComp.layoutMinHeight?i=e.toComp.layoutMinHeight():!e.locked&&(!this._isPageAutoShrink()||!W.Viewer.isPageOrFooter(t.getOriginalClassName()))&&(i=e.originalValue),t.setHeight(n<r?r:this._getMaxAnchoredH(t,i));if(n!==t.getHeight()){t.$layoutDirtyFlag=this.FLAG_DIRTY_BOTTOM;if(e.type==e.ANCHOR_BOTTOM_BOTTOM)return t.$tempIndex}return Number.MAX_VALUE},_getMaxAnchoredH:function(e,t){t||(t=-Number.MAX_VALUE);var n=this._getAnchoredH,r=t;return e.getReverseAnchors().forEach(function(t){if(t.type!=t.ANCHOR_BOTTOM_PARENT&&t.type!=t.ANCHOR_BOTTOM_BOTTOM)return;var i=n(t);!t.locked&&(!this._isPageAutoShrink()||!W.Viewer.isPageOrFooter(e.getOriginalClassName()))&&(i=Math.max(i,t.originalValue)),r=Math.max(i,r)}.bind(this)),r}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.CSW.New",function(e,t){var n=e,r=t;n.methods({_updateDocWidth:function(){var e=this._siteStructureData,t=e.get("renderModifiers"),n=this.injects().Utils.getQueryParam("siteWidth");if(n){this._docWidth=parseInt(n),t.siteWidth=this._docWidth,e.markDataAsDirty();return}if(t&&t.siteWidth){this._docWidth=t.siteWidth;return}switch(window.rendererModel.applicationType){case"HtmlFacebook":this._docWidth="520";break;case"HtmlWeb":this._docWidth="980";break;default:this._docWidth=980}},getDocWidth:function(){return this._docWidth||this._updateDocWidth(),this._docWidth}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.MobileZoom.New",function(e,t){var n=e,r=t;n.methods({_getZoomCompSettings:function(){var e,t;return e="wysiwyg.viewer.skins.MobileMediaZoomSkin",t="wysiwyg.viewer.components.MediaZoom",{comp:t,skin:e}},_getZoomDisplayerCompSettings:function(){var e,t;return e="wysiwyg.viewer.skins.displayers.MobileMediaZoomDisplayerSkin",t="wysiwyg.viewer.components.MediaZoomDisplayer",{comp:t,skin:e}}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.RichTextMigrationQA.New",function(e,t){var n=e,r=t;n.utilize(["wysiwyg.managers.appdata.AppDataHandler","wysiwyg.common.utils.TextMigrationHandler"]),n.methods({_onSiteReady:r.after(function(){var e=this.resources.W.Utils.getQueryParam("textMigration");e==="true"&&this._runMigrationOnPageTextComponents()}),_runMigrationOnPageTextComponents:function(){var e=this.getCurrentPageNode(),t=e&&e.$logic;if(t){var n=new this.imports.TextMigrationHandler,r=t.getPageComponents(),i=r.filter(function(e){return e.getOriginalClassName()==="wysiwyg.viewer.components.WRichText"});i.each(function(e){n.migrateComponent(e)})}}})}),define.experiment.Class("wysiwyg.common.managers.WViewManager.WixAppsPage.New",function(e,t){var n=e,r=t;n.methods({isPageComponent:function(e){return e.match(/Page$/)},_getPageElements:function(e){return e.getElements("[comp$=Page]")},_getComponentParent:function(e){return e.getParent("[comp$=Page]")},getAppPages:function(){var e={};return Object.each(W.Viewer.getPages(),function(t,n){var r=t.getLogic();if(r.isInstanceOfClass("wixapps.integration.components.AppPage")){var i=r._data.get("appPageId");e[i]=r}}),e},getLinkablePagesData:function(){return Object.filter(this._pagesData,function(e){return e.getType()!="AppPage"})},_isPageDataType:function(e){return e==="Page"||e=="AppPage"},_onPageExtraDataChange:function(e,t,n){var r=this._getPageDataFromHash(t);switch(r.get("type")){case"Page":var i=r.get("tpaApplicationId"),s=W.TPA.getComponentRegistrar().getSection(i);if(s){W.TPA.setPageState(t,e);if(n)return;s._renderIfReady()}break;case"AppPage":W.Apps.setPageState(t,e);if(n)return;var o=W.Viewer.getPages()[t],u=o.getLogic();u.updateParams(e)}},_setUrlHashToPage:function(e){var t=this._pagesData[e];if(t){var n=W.TPA.getPageState(e),r=W.Apps.getPageState(e),i=n||r;W.Utils.hash.setHash(e,t.get("pageUriSEO"),i)}}})}),define.experiment.dataSchema("SliderGalleryProperties.SliderAutoPlay.New",function(e){var t=e;return t.merge({autoplayInterval:{type:"number","default":"0",minimum:0,maximum:30,description:"Autoplay interval"},autoplay:{type:"boolean","default":!1,description:""},showAutoplay:{type:"boolean","default":!0,description:""},transDuration:{type:"number",minimum:0,maximum:5,"default":0,description:"Duration of the transition in seconds"},autoPlayDirection:{type:"string","default":"LTR"}})}),define.experiment.newClass("wysiwyg.common.utils.TextMigrationHandler.RichTextViewer.New",function(e){var t=e;t.resources(["W.Utils","W.Data","W.Config"]),t.fields({_changeableTagList:["h1","h2","h3","h4","h5","h6","p","div"],_simpleElementsQueue:[],_deprecatedStyleClass:["font_1","font_10"],_blockElementTags:["audio","dd","dt","li","video","address","article","aside","blockquote","details","div","dl","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","menu","nav","ol","p","pre","section","table","ul","center","dir","noframes"]}),t.methods({initialize:function(){var e=this;this.resources.W.Config.isEditorMode()?this.resource.getResourceValue("W.Preview",function(t){t.getPreviewManagersAsync(function(t){e._viewer={theme:t.Theme,data:t.Data}},e)}):this._viewer={theme:this.resources.W.Theme,data:this.resources.W.Data}},migrateComponent:function(e){this._changeData(e),this._changeSkin(e);var t=e.getDataItem();return t&&t.get("text")?this.migrateText(t.get("text")):null},migrateText:function(e,t,n){if(!e)return;this._styleMap=this.resources.W.Data.getDataByQuery("#CK_EDITOR_FONT_STYLES").get("items");var r=document.createElement("div").set("html",e);return this._migrateElement(r,t,n),r.get("html")},_migrateElement:function(e,t,n){var r=[],i=this._collectionToArray(e.childNodes);i.each(function(e){if(!this._isBlockElement(e))r.push(e);else{r.length>0&&(this._applyStyleOnElements(r,t,n),r=[]);var i=!this._changeableTagList.contains(e.tagName.toLowerCase())||this._hasBlockElementChildren(e);i?this._migrateElement(e,t,n):this._applyStyleOnBlock(e,t,n)}},this),r.length>0&&this._applyStyleOnElements(r,t,n)},_applyStyleOnElements:function(e,t,n){var r=new Element("p");r.inject(e[0],"before"),r.adopt(e),this._applyStyleOnBlock(r,t,n)},_applyStyleOnBlock:function(e,t,n){if(e.childNodes.length===0)return;if(this._isBlockContainUnstyledText(e)){var r=this._replaceBlockWithDefaultTag(e,t,n),i=this._getStyledSpansRecursive(r,[]);this._removeStyleClassesReplaceWithInline(null,i)}else{var s=this._moveStyleClassToBlockParentElement(e);s&&this._moveInlineStyleFromOriginalElementToBlockParentElement(e,s)}},_isBlockContainUnstyledText:function(e){if(this._isTextNode(e))return!0;if(this._getElementStyleClass(e))return!1;var t=this._collectionToArray(e.childNodes);for(var n=0;n<t.length;n++)if(this._isBlockContainUnstyledText(t[n]))return!0;return!1},_moveStyleClassToBlockParentElement:function(e){var t=this._getStyledSpansRecursive(e,[]),n=this._getMostCommonStyle(t),r=null;if(n){var i=this._replaceDeprecatedStyleIfNeeded(n);return i!=n&&(r=n,n=i),e.addClass(n),this._removeStyleClassesReplaceWithInline(n,t),r&&this._addFontSizeOnBlockIfNeeded(e,n,r),n}return null},_replaceDeprecatedStyleIfNeeded:function(e){return this._isStyleDeprecated(e)?this.getReplacingStyle(e):e},_addFontSizeOnBlockIfNeeded:function(e,t,n){var r=this._viewer.theme.getProperty(n).getSize(),i=this._viewer.theme.getProperty(t).getSize();r<i&&e.setStyle("font-size",r)},getReplacingStyle:function(e){return"font_8"},_isStyleDeprecated:function(e){return this._deprecatedStyleClass.contains(e)},_getMostCommonStyle:function(e){var t={};return e.forEach(function(e){var n=this._getElementStyleClass(e);t[n]=t[n]||0,t[n]+=e.get("text").length},this),this._getEntryWithMaxValue(t)},_getEntryWithMaxValue:function(e){var t=0,n=null;return Object.forEach(e,function(e,r){e>t&&(t=e,n=r)}),n},_removeStyleClassesReplaceWithInline:function(e,t){t.map(function(t){if(t.childNodes.length>0){var n=this._getElementStyleClass(t);n==e?this._removeStyledSpan(t):(t.removeAttribute("class"),this._setStyleOverrides(e,n,t))}},this)},_removeStyledSpan:function(e){var t=e.childNodes,n=this._collectionToArray(t);return this._updateElementChildren(e,n),n},_setStyleOverrides:function(e,t,n){var r=this._getStyleDelta(e,t),i=n;if(this._isTextNode(n)){var s=document.createElement("span");this._updateElementChildren(n,[s]),s.appendChild(i),i=s}Object.forEach(r,function(e,t){i.setStyle(t,e)})},_getStyleDelta:function(e,t){var n=e&&this._viewer.theme.getProperty(e),r=this._viewer.theme.getProperty(t),i={},s=["color","font-family","font-size","font-style","font-variant","font-weight","line-height"];return s.each(function(e){var t=this._createStyleKeyGetter(e);if(!n||n[t]()!=r[t]())i[e]=r[t]()},this),i},_replaceBlockWithDefaultTag:function(e,t,n){if(e&&e.tagName===t&&e.hasClass(n))return;var r=this.renameNode(e,t);return r.addClass(n),r},_createStyleKeyGetter:function(e){var t=e.indexOf("-")+1;if(t>0)var n=e.split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("");else var n=e.charAt(0).toUpperCase()+e.slice(1);return n.contains("Font")&&n!=="FontFamily"&&(n=n.replace("Font","")),"get"+n},_moveInlineStyleFromOriginalElementToBlockParentElement:function(e,t){var n=this._viewer.theme.getProperty(t),r=n.getOriginalClassName()==="core.utils.css.Font";if(r)var i=n.getLineHeight();if(i){var s=this._setLineHeightValueToBlockElement(e,i);this._createWrapperSpanWithBlockLineHeight(e,s,i),e=this._setBlockElementTagAccordingToStyle(e,t)}return e},_setLineHeightValueToBlockElement:function(e,t){return e.setStyle("line-height",t),e.get("html")},_createWrapperSpanWithBlockLineHeight:function(e,t,n){var r=document.createElement("span");r.setStyle("line-height",n),r.set("html",t),e.set("html",""),e.appendChild(r)},_setBlockElementTagAccordingToStyle:function(e,t){var n=this._styleMap[t].seoTag;return this.renameNode(e,n)},_updateElementChildren:function(e,t){var n,r=e.parentNode;t.each(function(t){if(typeOf(t)==="string"&&t.indexOf("<")===0){var i=document.createElement("div");i.set("html",t),n=i.firstChild}else n=t;r.insertBefore(n,e)},this),r.removeChild(e)},_changeData:function(e){var t=e.getDataItem().get("text"),n=this._viewer.data.addDataItemWithUniqueId("",{type:"StyledText",text:t,stylesMapId:"CK_EDITOR_PARAGRAPH_STYLES"}).dataObject;e.setDataItem(n)},_changeSkin:function(e){this._viewer.theme.getStyle("txtNew",function(t){e.setStyle(t)},"wysiwyg.viewer.skins.WRichTextNewSkin")},_getStyledSpansRecursive:function(e,t){return this._isTextNode(e)||(this._getElementStyleClass(e)?t.push(e):e.getChildren().each(function(e){t.concat(this._getStyledSpansRecursive(e,t))},this)),t},_getElementStyleClass:function(e){var t=e.classList,n=[];for(var r=0;r<t.length;r++){var i=t[r];i.indexOf("font_")>-1&&n.push(i)}return n.length>0?n[0]:null},_getElementStyleClass:function(e){if(!e.classList)return null;for(var t=0;t<e.classList.length;t++){var n=e.classList[t];if(n.indexOf("font_")>-1)break;n=null}return n},_isBlockElement:function(e){var t=e.tagName&&e.tagName.toLowerCase();return this._blockElementTags.contains(t)},_isTextNode:function(e){return typeOf(e)==="textnode"},_hasBlockElementChildren:function(e){var t=e.getChildren().filter(function(e){return this._isBlockElement(e)},this);return t.length>0},_isInlineElement:function(e){return!!e.tagName},renameNode:function(e,t){if(e.tagName==t)return;var n=document.createElement(t),r=e.attributes,i=this._collectionToArray(r);return i.each(function(e){n.setAttribute(e.name,e.value)}),this.moveChildren(e,n),e.parentNode&&e.parentNode.replaceChild(n,e),n},moveChildren:function(e,t){if(e==t)return;var n;while(n=e.firstChild)t.appendChild(e.removeChild(n))},_collectionToArray:function(e){return Array.prototype.slice.call(e,0)}})});