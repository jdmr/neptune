define.oldClass({name:"wixapps.core.apprepo.AppPartDefinition",traits:["wixapps.core.apprepo.traits.AppRepoItem"],Class:{_dataSelector:null,_viewName:null,_type:null,initialize:function(e){this._appInstance=e},loadFromDefinition:function(e){this.setDataSelectorId(e.dataSelector),this.setViewName(e.viewName),this.setCustomizations(e.customizations),this.setEventHandlers(e.eventHandlers),this.setType(e.type)},getDataSelectorId:function(){return this._dataSelector},getViewName:function(){return this._viewName},getType:function(){return this._type},setDataSelectorId:function(e){this._dataSelector=e},setViewName:function(e){this._viewName=e},setType:function(e){this._type=e},setCustomizations:function(e){this._customizations=e},getCustomizations:function(){return this._customizations},setEventHandlers:function(e){this._eventHandlers=e},getEventHandlers:function(){return this._eventHandlers},getSerializableProperties:function(){return["dataSelector","viewName","type"]}}}),define.oldClass({name:"wixapps.core.apprepo.AppPartsRepository",imports:["wixapps.core.apprepo.AppPartDefinition"],Class:{Binds:[],Extends:"wixapps.core.apprepo.base.BaseRepository",_getInstanceClass:function(e){return this.imports.AppPartDefinition},createAndRegister:function(e,t,n){var r=new this.imports.AppPartDefinition(this._appInstance);r.setDataSelectorId(e),r.setViewName(t),r.setType(n);var i=this.register("apppart",r);return i}}}),define.oldClass({name:"wixapps.core.apprepo.AppRepoTransport",imports:["wixapps.core.utils.WixAppsLogger"],Class:{Extends:"wixapps.core.utils.WixServiceTransportBase",_getServiceUrl:function(){var e=window.location.origin||this._extractBasePath(window.location.href);return e+"/apps/appBuilder/"},updateInstance:function(e,t,n,r){var i=e.toObject();this.doRequest("saved/"+t,i,n,r)},getSavedInstance:function(e,t,n){this.doGetRequest("saved/"+e,null,t,n)},getPublishedInstance:function(e,t,n){this.doGetRequest("published/"+e,null,t,n)},publishInstance:function(e,t,n){this.doRequest("published/"+e,null,t,n)}}}),define.oldClass({name:"wixapps.core.apprepo.ApplicationDefinition",Class:{_appDef:{},Static:{DATA_PROVIDERS_KEY:"dataProviders",DATA_SELECTORS_KEY:"dataSelectors",PARTS_DEF_KEY:"parts",TYPES_KEY:"types",VIEWS_KEY:"views",APP_VERSION_KEY:"applicationInstanceVersion"},initialize:function(e){this._appDef=e||{}},getDataProviders:function(){return this._appDef[this.DATA_PROVIDERS_KEY]},setDataProviders:function(e){this._appDef[this.DATA_PROVIDERS_KEY]=e},getDataSelectors:function(){return this._appDef[this.DATA_SELECTORS_KEY]},setDataSelectors:function(e){this._appDef[this.DATA_SELECTORS_KEY]=e},getAppPartDefinitions:function(){return this._appDef[this.PARTS_DEF_KEY]},setAppPartDefinitions:function(e){this._appDef[this.PARTS_DEF_KEY]=e},getTypes:function(){return this._appDef[this.TYPES_KEY]},setTypes:function(e){this._appDef[this.TYPES_KEY]=e},getViewDefinitions:function(){return this._appDef[this.VIEWS_KEY]},setViewDefinitions:function(e){this._appDef[this.VIEWS_KEY]=e},setAppInstanceVersion:function(e){this._appDef[this.APP_VERSION_KEY]=e},getAppInstanceVersion:function(){return this._appDef[this.APP_VERSION_KEY]},toObject:function(){return this._appDef}}}),define.Class("wixapps.core.apprepo.ApplicationInstance2",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.binds(["resolveResourcePath"]),t.utilize(["wixapps.core.apprepo.ApplicationDefinition","wixapps.core.apprepo.DataProvidersRepository","wixapps.core.apprepo.DataSelectorsRepository","wixapps.core.apprepo.AppPartsRepository","wixapps.core.managers.TypesManager","wixapps.core.views.ViewDefinitionsRepository","wixapps.core.views.ViewsCustomizer","wixapps.core.utils.WixAppsLogger","wixapps.core.data.DataItemFactory","wixapps.core.expressions.FunctionLibrary","wixapps.integration.utils.PerformanceTracker"]),t.resources(["W.Commands"]),t.fields({_instanceId:null,_appDef:null,_basePath:null,_viewsDefRepo:null,_appInstanceVersion:1}),t.methods({initialize:function(e,t){this._instanceId=e||"<DRAFT>",this._trkr=new this.imports.PerformanceTracker,this._funcLibrary=new this.imports.FunctionLibrary,this._dataFactory=new this.imports.DataItemFactory,this._dataFactory.registerFunctionLibrary(this._funcLibrary),this._appCache=null,this._dataProvidersRepo=new this.imports.DataProvidersRepository(this),this._dataSelectorsRepo=new this.imports.DataSelectorsRepository(this),this._partsRepo=new this.imports.AppPartsRepository(this),this._typesManager=new this.imports.TypesManager,this._viewsDefRepo=new this.imports.ViewDefinitionsRepository(this._dataFactory),this._customizations=new this.imports.ViewsCustomizer,this._logger=new this.imports.WixAppsLogger;var n=Constants.WixAppsSystemTypes;for(var r=0;r<n.length;r++)this._typesManager.registerType(n[r]);var i=W.Config.getServiceTopologyProperty("scriptsLocationMap");if(!i||!i.wixapps)throw"wixapps topology path is undefined";this._basePath=i.wixapps+"/",t?(this._appDef=new this.imports.ApplicationDefinition(t),this._loadAppData()):this._appDef=new this.imports.ApplicationDefinition},toObject:function(){var e=new this.imports.ApplicationDefinition;e.setDataProviders(this._dataProvidersRepo.toObject()),e.setDataSelectors(this._dataSelectorsRepo.toArray()),e.setAppPartDefinitions(this._partsRepo.toObject());var t=this.getDataProviders().getWixDbDataProvider();e.setTypes(t.getManagedTypes());var n=this._viewsDefRepo.getAllViewDefinitions();return e.setViewDefinitions(n.invoke("getValue")),e.setAppInstanceVersion(this.getAppInstanceVersion()),e.toObject()},_loadAppData:function(){this._dataProvidersRepo.fromObject(this._appDef.getDataProviders());if(!this._dataProvidersRepo.isWixDbDataProviderDefined()){var e=this._logger;e.reportError(e.Errors.WIX_DATA_PROVIDER_DOESNT_EXIST,this.$className,"_loadAppData",e.SubCategory.APP_REPO_SERVICE,e.Severity.RECOVERABLE,e.Category.EDITOR),this._dataProvidersRepo.createWixDbDataProvider()}this._dataSelectorsRepo.fromArray(this._appDef.getDataSelectors()),this._partsRepo.fromObject(this._appDef.getAppPartDefinitions()),this.loadViews(this._appDef.getViewDefinitions()),this.setAppInstanceVersion(this._appDef.getAppInstanceVersion())},getAppDef:function(){return this._appDef},getDataProviders:function(){return this._dataProvidersRepo},getDataSelectors:function(){return this._dataSelectorsRepo},getAppPartDefinitions:function(){return this._partsRepo},getTypesManager:function(){return this._typesManager},addViewDefinition:function(e){this._customizations.applyAll(e),this._viewsDefRepo.setViewDefinition(e)},setAppInstanceVersion:function(e){this._appInstanceVersion=e},getAppInstanceVersion:function(){return this._appInstanceVersion},getViewDefinitions:function(){return this._viewsDefRepo},getLogger:function(){return this._logger},getAppCache:function(){return this._appCache},resolveResourcePath:function(e){if(e){var t=e.match(/^(http:\/\/)?(images\/.*)/);if(t)return this._basePath+t[2]}return e},getDataItemFactory:function(){return this._dataFactory},isSavedInRepo:function(){return this._isSavedInRepo},setSavedInRepo:function(e){this._isSavedInRepo=e},loadViews:function(e){if(!e)return;e.each(function(e){var t=this._viewsDefRepo.cloneAndMultiply(e);for(var n=0;n<t.length;n++)this._customizations.fillMissingIds(t[n]),this.addViewDefinition(t[n])}.bind(this)),this.setupCustomizations([])},setupCustomizations:function(e){this._customizations.addRules(e),this.applyCustomizations()},applyCustomizations:function(){this._customizations.applyToViewDefinitionsRepository(this._viewsDefRepo)},getInstanceId:function(){return this._isSavedInRepo?this._instanceId:"<DRAFT>"},setInstanceId:function(e){this._instanceId=e},setApplicationId:function(e){this._applicationId=e},getApplicationId:function(){return this._applicationId},getTrkr:function(){return this._trkr},getViewsCustomizer:function(){return this._customizations}})}),define.oldClass({name:"wixapps.core.apprepo.DataProvidersRepository",imports:["wixapps.core.data.providers.wixdb.WixDbDraftDataProvider","wixapps.core.data.providers.wixdb.WixDbPublishedDataProvider"],Class:{Extends:"wixapps.core.apprepo.base.BaseRepository",_getInstanceClass:function(e){var t=e&&e.type;if(t=="WixDb")return W.Viewer.isPublicMode()?this.imports.WixDbPublishedDataProvider:this.imports.WixDbDraftDataProvider},registerWixDbDataProvider:function(e){return this.registerWithId("wixdb",e)},getWixDbDataProvider:function(){return this.getById("wixdb")},isWixDbDataProviderDefined:function(){return this._instancesMap.wixdb!==undefined},createWixDbDataProvider:function(){var e=new this.imports.WixDbDraftDataProvider(this._appInstance);return this.registerWixDbDataProvider(e),e}}}),define.oldClass({name:"wixapps.core.apprepo.DataSelectorsRepository",imports:["wixapps.core.data.selectors.ManualSelectedItemDataSelector","wixapps.core.data.selectors.ManualSelectedListDataSelector","wixapps.core.data.selectors.SelectedItemDataSelector"],Class:{Binds:[],Extends:"wixapps.core.apprepo.base.BaseRepository",_getInstanceClass:function(e){var t=e&&e.logicalTypeName;switch(t){case"IB.ManualSelectedItem":return this.imports.ManualSelectedItemDataSelector;case"IB.ManualSelectedList":return this.imports.ManualSelectedListDataSelector;case"IB.SelectedItemInList":return this.imports.SelectedItemDataSelector}},createAndRegister:function(e,t,n,r){var i=null,s="";return e=="IB.SelectedItemInList"?(i=new this.imports.SelectedItemDataSelector(this._appInstance),i.setDataProvider(t),i.setSelectionType(n),s=this._appInstance.getDataSelectors().register("selItem_"+W.Utils.AppsUtils.getTimeBasedUniqueId(),i)):e=="IB.ManualSelectedList"&&(i=new this.imports.ManualSelectedListDataSelector(this._appInstance),i.setDataProvider(t),i.setItemIds(r.map(function(e){return e._iid})),i.setSelectionType(n),s=this._appInstance.getDataSelectors().register("dataSelector"+W.Utils.AppsUtils.getTimeBasedUniqueId(),i)),s}}}),define.oldClass({name:"wixapps.core.apprepo.base.BaseRepository",Class:{_instances:[],_instancesMap:{},_appInstance:null,initialize:function(e){this._appInstance=e},fromObject:function(e){Object.each(e,function(e,t){var n=this._createInstance(e);this.registerWithId(t,n)}.bind(this))},fromArray:function(e){e=e||[],Array.each(e,function(e,t){var n=this._createInstance(e);this.registerWithId(e.id,n)}.bind(this))},_createInstance:function(e){var t=this._getInstanceClass(e),n;if(!t)throw"No Class found for "+e;return n=new t(this._appInstance),n.loadFromDefinition(e),n},toObject:function(){var e={};for(var t=0;t<this._getInstances().length;t++){var n=this._getInstances()[t];e[n.id]=n.instance.toObject()}return e},toArray:function(){return this._getInstances().map(function(e,t){return e.instance.toObject()})},_getInstances:function(){return this._instances},_getInstanceClass:function(e){throw"Must Implement!"},register:function(e,t){var n=W.Utils.AppsUtils.getTimeBasedUniqueId(e);return this.registerWithId(n,t),n},registerWithId:function(e,t){return this._getInstances().push({id:e,instance:t}),this._instancesMap[e]=t,t.setId(e),e},remove:function(e){this._instances=this._instances.filter(function(t){return t.id!=e})},getById:function(e){var t=this._instancesMap[e];if(!t)throw"No item of id ["+e+"]";return t},getIds:function(){return this._instances.map(function(e){return e.id})}}}),define.oldTrait({name:"wixapps.core.apprepo.traits.AppRepoItem",trait:{Binds:[],fromObject:function(e){Object.each(e,function(e,t){this["_"+t]=e}.bind(this))},toObject:function(){var e=this.getSerializableProperties(),t={};return e.each(function(e){t[e]=this["_"+e]}.bind(this)),t},getId:function(){return this._id},setId:function(e){this._id=e},getSerializableProperties:function(){throw"Must implement me!"}}}),define.oldClass({name:"wixapps.core.data.ArrayDataItem",imports:[],traits:["wixapps.core.events.EventAggregator"],Class:{Binds:[],Extends:"wixapps.core.data.DataItem",_children:[],getTypeName:function(){return"Array"},addChild:function(e,t){var n;return e=e.className&&e.className.indexOf("wixapps.core.data")!=-1?e:this._context.getFactory().createDataItem(e,this),t!==undefined&&(n=typeof t=="number"?parseInt(t,10):this.getChildIndex(t)),n>-1?this._children.splice(n,0,e):(n=this._children.length,this._children.push(e)),this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD,child:e,index:n}),e._parent=this,e},deleteChild:function(e){var t=typeof e=="number"?parseInt(e,10):this.getChildIndex(e);if(t>-1&&t<this._children.length){var n=this._children.splice(t,1);return this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE,child:n[0],index:t}),n[0]}return null},replaceChild:function(e,t){var n,r;t!==undefined&&(n=typeof t=="number"?parseInt(t,10):this.getChildIndex(t));if(n>=0&&n<this._children.length){r=this._children[n];if(e.className&&e.className.contains("wixapps.core.data"))r!==e&&(this._children[n]=e,this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:e,prevChild:r,index:n}));else{var i=e;r.className===this._context.getFactory().getDataItemClassName(i)?r.setValue(i):(e=this._context.getFactory().createDataItem(i),e&&(this._children[n]=e,this._dirtyFlag=!0,e._parent=this,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:e,prevChild:r,index:n})))}return e}},getChildren:function(){return this._children.slice(0)},getValue:function(e,t){var n=[],r=this._passScope(t);return this._children.forEach(function(t){n.push(t.getValue(e,r))}),n},setValue:function(e){this.startEventAggregation(),this._applyData(e),this.releaseEventAggregation(Constants.DataItemEvents.CHANGE)},getChildIndex:function(e){return this._children.indexOf(e)},getChildByIndex:function(e){return this._children[e]},getChildValue:function(e){return this._children&&this._children[e]!==undefined?this._children[e].getValue():undefined},isDirty:function(){if(this.parent())return!0;for(var e=0;e<this._children.length;e++)if(this._children[e].isDirty())return!0;return!1},resetDirtyFlag:function(){this.parent();for(var e=0;e<this._children.length;e++)this._children[e].resetDirtyFlag()},_applyData:function(e){var t=this._children.length;for(var n=0;n<e.length;n++)n<t?this.replaceChild(e[n],n):this.addChild(e[n]);if(e.length<this._children.length)for(var r=this._children.length-1;r>=e.length;r--)this.deleteChild(r)}}}),define.oldClass({name:"wixapps.core.data.CompositeDataItem",imports:[],traits:["wixapps.core.events.EventAggregator"],Class:{Binds:[],Extends:"wixapps.core.data.DataItem",_children:{},getValue:function(e,t){var n={};for(var r in this._children){var i=this._passScope(t);n[r]=this._children[r].getValue(e,i)}return n},getTypeName:function(){var e=this.getChildByRef("_type");return e&&e.getValue()||"wix:Object"},addChild:function(e,t){var n=this._context.getFactory().createDataItem(e);return this._children[t]=n,this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD,child:n,ref:t}),n._parent=this,n},deleteChild:function(e){var t=this._children[e];return t&&(t._parent=null,delete this._children[e],this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE,child:t,ref:e})),t},replaceChild:function(e,t){t.className&&t.className.indexOf("wixapps.core.data")!=-1&&(t=this.getChildRef(t));var n=this._children[t];if(n){if(e&&e.className&&e.className.indexOf("wixapps.core.data")!=-1)n!==e&&(this._children[t]=e,this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:e,prevChild:n,ref:t}));else{var r=e;n.className===this._context.getFactory().getDataItemClassName(r)?n.setValue(r):(e=this._context.getFactory().createDataItem(r),e&&(this._children[t]=e,this._dirtyFlag=!0,e._parent=this,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE,child:e,prevChild:n,ref:t})))}return e}},getChildRef:function(e){for(var t in this._children)if(this._children[t]===e)return t},getChildren:function(){return Object.values(this._children)},getChildByRef:function(e){return this._children[e]},getChildValue:function(e){return this._children&&this._children[e]!==undefined?this._children[e].getValue():undefined},getChildrenRefs:function(){return Object.keys(this._children)},setValue:function(e){this.startEventAggregation(),this._applyData(e),this.releaseEventAggregation()},isDirty:function(){if(this.parent())return!0;var e=this.getChildrenRefs();for(var t=0;t<e.length;t++)if(this._children[e[t]].isDirty())return!0;return!1},resetDirtyFlag:function(){this.parent();var e=this.getChildrenRefs();for(var t=0;t<e.length;t++)this._children[e[t]].resetDirtyFlag()},_applyData:function(e){for(var t in e)this._children[t]===undefined?this.addChild(e[t],t):this.replaceChild(e[t],t);for(t in this._children)e[t]===undefined&&this.deleteChild(t)}}}),define.oldClass({name:"wixapps.core.data.ComputedFieldItem",imports:[],Class:{Binds:["_onDataContextChange"],Extends:"wixapps.core.data.DataItem",_type:null,initialize:function(e,t,n,r,i){this.parent(e),this._type=n,this._dataContext=i,this._getterFunc=e.getComputedFieldGetter(t,r),this._setterFunc=e.getComputedFieldSetter(t,r),this._dataContext.addEvent(Constants.DataItemEvents.CHANGE,this._onDataContextChange)},getTypeName:function(){return this._type},getValue:function(){var e,t=this._value;return this._getterFunc===undefined?this._value:(e=this._getterFunc(this._dataContext,this.passValue.bind(this)),e!==undefined&&(this._value=e,this._value!==t&&this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this})),this._value)},setValue:function(e){if(this._setterFunc===undefined)throw new Error("Computed field not writable");this._setterFunc(e,this._dataContext.setValue.bind(this._dataContext)),this.passValue(e)},passValue:function(e){var t=this._value;this._value=e,this._value!==t&&this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this})},_onDataContextChange:function(){this.fireEvent(Constants.DataItemEvents.CHANGE)}}}),define.Const("DataItem",{VOID_REF:"VOID_REF"}),define.Const("DataItemEvents",{CHANGE:"dataItemChange",VALIDATION_PERFORMED:"dataItemValidationChanged",CHANGE_EVENT_ACTION_ADD:"add",CHANGE_EVENT_ACTION_DELETE:"delete",CHANGE_EVENT_ACTION_REPLACE:"replace",CHANGE_EVENT_ACTION_MOVE:"move",CHANGE_EVENT_ACTION_VISIBILITY:"visibility",bubblingEvents:["dataItemChange"]}),define.Const("DataItemEventPhase",{ON_TARGET:"onTarget",BUBBLING:"bubbling"}),define.Class("wixapps.core.data.DataItem",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize([]),t.traits([]),t.binds([]),t.fields({_context:null,_value:undefined,_parent:undefined,_dirtyFlag:!1}),t.methods({initialize:function(e){this._context=e},getValue:function(e){return this._value},setValue:function(e){var t=this._value;this._value=e,this._value!==t&&(t!==undefined&&(this._dirtyFlag=!0),this.fireChangedEvent(this._value,t))},fireChangedEvent:function(e,t){this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this,newValue:e,oldValue:t})},getTypeName:function(){switch(typeOf(this._value)){case"string":return"String";case"number":return"Number";case"boolean":return"Boolean";default:return undefined}},isRef:function(){return!1},getParent:function(){return this._parent},fireEvent:function(e,t){t=t||{};if(t._previousTargets===undefined||!t._previousTargets.contains(this))t.currentTarget=this,t.phase=t.target===t.currentTarget?Constants.DataItemEventPhase.ON_TARGET:Constants.DataItemEventPhase.BUBBLING,this.parent(e,t),this._parent&&Constants.DataItemEvents.bubblingEvents.contains(e)&&(t._previousTargets=t._previousTargets||[],t._previousTargets.push(this),this._fireBubblingEvent(e,t))},_fireBubblingEvent:function(e,t){var n={};Object.each(t,function(e,t){n[t]=e}),this._parent.fireEvent(e,n)},isDirty:function(){return this._dirtyFlag},setDirty:function(){this._dirtyFlag=!0},resetDirtyFlag:function(){this._dirtyFlag=!1},_passScope:function(e){var t=!0;e&&e.inheritsScope&&(t=e.inheritsScope(this));if(t)return e}})}),define.Class("wixapps.core.data.DataItemBinding",function(e){var t=e;t.inherits(),t.utilize([]),t.traits([]),t.binds(["_onSourceChanged","_onTargetChanged"]),t.fields({_source:null,_target:null,_bidirectional:!1}),t.methods({initialize:function(e,t,n){this._bidirectional=n===undefined,this._source=e,this._target=t,this._source.addEvent(Constants.DataItemEvents.CHANGE,this._onSourceChanged),n&&this._target.addEvent(Constants.DataItemEvents.CHANGE,this._onTargetChanged),this._target.setValue(this._source.getValue())},_onSourceChanged:function(){this._target.setValue(this._source.getValue())},_onTargetChanged:function(){this._source.setValue(this._target.getValue())},dispose:function(){this._source.removeEvent(Constants.DataItemEvents.CHANGE,this._onSourceChanged),this._bidirectional&&this._target.removeEvent(Constants.DataItemEvents.CHANGE,this._onTargetChanged)}})}),define.oldClass({name:"wixapps.core.data.DataItemFactory",imports:["wixapps.core.data.DataItem","wixapps.core.data.DataItemProxy","wixapps.core.data.ArrayDataItem","wixapps.core.data.VirtualArrayDataItem","wixapps.core.data.CompositeDataItem","wixapps.core.data.ComputedFieldItem","wixapps.core.data.ExprDataItem"],Class:{Binds:[],_refResolver:null,_cfCtrlDict:{},_constructorMap:{},_funcLibrary:null,_debugMode:0,Static:{SANITATION_WARNING_ILLEGAL_TYPE:"Illegal type"},initialize:function(){},getDataItemClassName:function(e){var t,n=typeOf(e);return n=="object"?e._type&&e._type.substr(0,7)=="wix:Ref"?t="wixapps.core.data.DataItemProxy":e.hasOwnProperty("$expr")?t="wixapps.core.data.ExprDataItem":t="wixapps.core.data.CompositeDataItem":n=="array"?t="wixapps.core.data.ArrayDataItem":n!="function"&&(t="wixapps.core.data.DataItem"),t},createDataItem:function(e){var t,n,r;return t=this.getDataItemClassName(e),n=this._getDataItemConstructor(t),n&&(r=new n(this),r.setValue(e),r.resetDirtyFlag(),this._debugMode>0&&(window._debug_idCounter||(window._debug_idCounter=1e3,window._debug_itemDict={}),r._debug_itemID=window._debug_idCounter++,this._debugMode>1&&W&&W.Utils&&(r._debug_whodunnit=W.Utils.getStackTrace()))),r},createComputedField:function(e,t,n,r){return new this.imports.ComputedFieldItem(this,e,t,n,r)},createVirtualArray:function(){return new this.imports.VirtualArrayDataItem(this)},getFactory:function(){return this},getRefResolver:function(){return this._refResolver},registerRefResolver:function(e){if(!e.deReference||typeOf(e.deReference)!=="function")throw new Error("refResolver must provide function 'deReference()'");this._refResolver=e},registerComputedFieldController:function(e,t,n,r){e&&t&&(this._cfCtrlDict[this._getCfCtrlKey(e,t)]={getter:n,setter:r})},getComputedFieldGetter:function(e,t){var n=this._getCfCtrlKey(e,t);if(this._cfCtrlDict[n])return this._cfCtrlDict[n].getter},getComputedFieldSetter:function(e,t){var n=this._getCfCtrlKey(e,t);if(this._cfCtrlDict[n])return this._cfCtrlDict[n].setter},getFunctionLibrary:function(){return this._funcLibrary},registerFunctionLibrary:function(e){this._funcLibrary=e},_getCfCtrlKey:function(e,t){return e+"|"+t},_getDataItemConstructor:function(e){var t;if(e)return e in this._constructorMap||(t=e.match(/[^\.]+$/)[0],t&&t in this.imports&&(this._constructorMap[e]=this.imports[t])),this._constructorMap[e]},sanitizeRawData:function(e){var t=this,n=["string","boolean","number","object","array"],r=[],i=function(e,s){var o=typeOf(e);if(n.contains(o)){var u=o=="array"?Array:o=="object"?Object:undefined;if(u){var a=u.map(e,function(e,t){return i(e,s+"/"+String(t))});return u.filter(a,function(e){return e!==null})}return e}return r.push({id:t.SANITATION_WARNING_ILLEGAL_TYPE,path:s,value:typeOf(e)}),null};return{processedData:i(e,""),warnings:r}},clone:function(){var e=new this.constructor;return e.registerRefResolver(this._refResolver),e._cfCtrlDict={},Object.each(this._cfCtrlDict,function(t,n){e._cfCtrlDict[n]=t}),e}}}),define.oldClass({name:"wixapps.core.data.DataItemProxy",imports:[],Class:{Extends:"wixapps.core.data.DataItem",Binds:["_onReferencedChange"],Static:{DEFAULT_MAX_REF_DEPTH:1},_ref:null,setValue:function(e){var t=this._ref;this._ref=Object.clone(e),this._resolveReference(),t!==null&&(this._ref==null||this._ref.collectionId!=t.collectionId||this._ref.itemId!=t.itemId)&&(this._dirtyFlag=!0,this.fireEvent(Constants.DataItemEvents.CHANGE,{target:this}))},_resolveReference:function(){this._referenced&&this._referenced.removeEvent(Constants.DataItemEvents.CHANGE,this._onReferencedChange),this._referenced=this._context.getRefResolver().deReference(this._ref.collectionId,this._ref.itemId),this._referenced&&this._referenced.addEvent(Constants.DataItemEvents.CHANGE,this._onReferencedChange)},_onReferencedChange:function(e){var t={};Object.each(e,function(e,n){t[n]=e}),e._previousTargets=e._previousTargets||[],e._previousTargets.push(this),t.currentTarget=this,this.fireEvent(Constants.DataItemEvents.CHANGE,t)},_proxyCall:function(e,t){return!this._referenced&&this._ref&&this._resolveReference(),this._referenced?this._referenced[e].apply(this._referenced,t):undefined},getValue:function(e){return e=e===undefined?this.DEFAULT_MAX_REF_DEPTH:e,e--,e>=0?this._proxyCall("getValue",[e]):this._ref?Object.clone(this._ref):{}},isRef:function(){return!0},getParent:function(){return this._proxyCall("getParent",arguments)},getTypeName:function(){return this._proxyCall("getTypeName",arguments)},getChildren:function(){return this._proxyCall("getChildren",arguments)},getChildIndex:function(){return this._proxyCall("getChildIndex",arguments)},getChildByIndex:function(){return this._proxyCall("getChildByIndex",arguments)},getChildrenRefs:function(){return this._proxyCall("getChildrenRefs",arguments)},addChild:function(){return this._proxyCall("addChild",arguments)},deleteChild:function(){return this._proxyCall("deleteChild",arguments)},replaceChild:function(){return this._proxyCall("replaceChild",arguments)},getChildByRef:function(){return this._proxyCall("getChildByRef",arguments)},getChildValue:function(e){return this._proxyCall("getChildValue",arguments)},setReferencedValue:function(e){return this._proxyCall("setValue",arguments)},startEventAggregation:function(){this._proxyCall("startEventAggregation",arguments)},releaseEventAggregation:function(){this._proxyCall("releaseEventAggregation",arguments)},getChildRef:function(e){return this._proxyCall("getChildRef",arguments)},getReferencedDataItem:function(){return!this._referenced&&this._ref&&this._resolveReference(),this._referenced}}}),define.Class("wixapps.core.data.DataItemUtils",function(e){var t=e;t.methods({initialize:function(){},findExprItems:function(e){return this.findDataItems(e,"wixapps.core.data.ExprDataItem",function(e){return!e.getParent().getChildRef||e.getParent().getChildRef(e)!="templates"})},findDataItems:function(e,t,n){var r=[],i;n=n||function(){return!0};var s=typeOf(t);s=="function"?i=t:s=="string"&&(i=function(e){return e.className==t});var o=function(e){i(e)&&r.push(e),e.getChildren&&e.getChildren().each(function(e){n(e)&&o(e)})};return o(e),r},getDataItemPath:function(e,t){var n=[],r,i;e=e||null;while(t&&t!==e&&t.getParent())r=t.getParent(),r.getChildRef?i=r.getChildRef(t):r.getChildIndex&&(i=r.getChildIndex(t)),n.push(i),t=r;return n.reverse()},resolveDataItemPath:function(e,t){var n,r,i=e;while(i&&t.length)r=t.shift(),i.getChildByRef?i=i.getChildByRef(r):i.getChildByIndex&&(i=i.getChildByIndex(r));return i},createDataChangeEventList:function(e,t){var n=[],r=e.events||[{type:e.type,payload:{target:e.target}}];for(var i=0;i<r.length;i++){var s=r[i],o=s.payload.action||Constants.DataItemEvents.CHANGE,u;o==Constants.DataItemEvents.CHANGE?u=s.payload.target:s.payload.target.getChildByRef?u=s.payload.target.getChildByRef(s.payload.ref):s.payload.target.getChildByIndex&&(u=s.payload.target.getChildByIndex(s.payload.index));var a=this.getDataItemPath(t,u).reverse();o==="delete"&&(a=[s.payload.index]),n.push({type:o,item:u,path:a})}return n}})}),define.oldClass({name:"wixapps.core.data.DataMigrator",imports:[],Class:{Binds:[],_typesManager:null,initialize:function(e){this._typesManager=e},diffTypes:function(e,t){var n=this._typesManager;if(n.getTypeName(e)!=n.getTypeName(t))throw"type name change is not permitted. old name ["+n.getTypeName(e)+"] new name ["+n.getTypeName(t)+"]";var r=n.getFields(e),i=n.getFields(t),s={};for(var o=0;o<i.length;o++){var u=i[o];s[u.name]=u}var a=[],f=[];for(var l=0;l<r.length;l++){var c=r[l],h=c.name,p=s[h];if(!p)a.push({op:"FieldDeleted",fieldName:h,oldField:c});else{if(c.type!=p.type){if(p.defaultValue===undefined)throw"field ["+h+"] with new type must have defaultValue";a.push({op:"FieldTypeChanged",fieldName:h,oldField:c,newField:p})}if(!this._areEqual(c.validations,p.validations)){if(p.defaultValue===undefined)throw"field ["+h+"] with new validations must have defaultValue";a.push({op:"FieldValidationsChanged",fieldName:h,oldField:c,newField:p})}}f.push(c.name)}for(var d=0;d<i.length;d++)f.indexOf(i[d].name)==-1&&a.push({op:"FieldAdded",fieldName:i[d].name,newField:i[d]});return a},migrateItem:function(e,t){var n=Object.clone(t);for(var r=0;r<e.length;r++){var i=e[r],s=i.fieldName;switch(i.op){case"FieldDeleted":delete n[s];break;case"FieldTypeChanged":n[s]=this._convertType(n[s],i.oldField.type,i.newField.type,i.newField.defaultValue);break;case"FieldValidationsChanged":this._typesManager.validateValue(n[s],i.newField)||(n[s]=i.newField.defaultValue);break;case"FieldAdded":i.newField.defaultValue!==undefined&&(n[s]=i.newField.defaultValue)}}return n},_convertType:function(e,t,n,r){return r},_areEqual:function(e,t){var n=e!==undefined&&e!==null,r=t!==undefined&&t!==null;if(n!=r)return!1;var i=typeof e,s=typeof t;if(i!=s)return!1;switch(i){case"object":var o=Object.keys(e),u=Object.keys(t);if(o.length!=u.length)return!1;for(var a=0;a<o.length;a++){var f=o[a],l=e[f],c=t[f];if(!this._areEqual(l,c))return!1}break;case"array":if(e.length!=t.length)return!1;for(var h=0;h<e.length;h++)if(!this._areEqual(e[h],t[h]))return!1;break;default:return e===t}return!0}}}),define.oldClass({name:"wixapps.core.data.ExprDataItem",imports:["wixapps.core.expressions.Expression"],Class:{Binds:[],Extends:"wixapps.core.data.DataItem",_exprSource:null,_expr:null,setValue:function(e){this._exprSource=e,this._expr=new this.imports.Expression(this._context.getFunctionLibrary()),this._expr.parseExpression(this._exprSource.$expr),this._value=undefined},getChangeDispatchers:function(e){return this._expr.getSymbolItems(e.getSymbolResolver())},getValue:function(e,t){return e===0?this._exprSource:t?this._expr.evaluate(t.getSymbolResolver()):this._exprSource}}}),define.oldClass({name:"wixapps.core.data.PrimitiveValidations",imports:[],Class:{Binds:[],_byName:{},initialize:function(){this._byName.arrayMaxLength=this._arrayMaxLength,this._byName.email=this._isEmail,this._byName.maxLength=this._maxLength,this._byName.minLength=this._minLength,this._byName.isNotWhitespace=this._isNotWhitespace,this._byName.isInteger=this._isInteger,this._byName.isPositive=this._isPositive,this._byName.gt=this._gt,this._byName.gte=this._gte,this._byName.lt=this._lt,this._byName.lte=this._lte,this._byName.eq=this._equals,this._byName.ne=this._notEquals},validate:function(e,t,n){var r=this._byName[e];if(!r)throw"No such validation function ["+e+"]";var i=[t];if(n&&n.length>0)for(var s=0;s<n.length;s++)i.push(n[s]);return r.apply(this,i)},_arrayMaxLength:function(e,t){return e.length<=t},_isEmail:function(e){var t=function(e){if(e.length>253)return!1;var t=e.split(".");if(t.length<2)return!1;for(var n=0;n<t.length;n++){var r=t[n];if(!r.test(/^[a-zA-Z0-9-]*$/))return!1;if(r.length>63)return!1}return!0},n=function(e){return e.test(new RegExp("^[a-zA-Z0-9!$&*-=^`|~#%'+/?_\\{\\}.]*$"))},r=e.lastIndexOf("@");if(r<0)return!1;var i=e.substring(0,r),s=e.substring(r+1);return t(s)?n(i):!1},_maxLength:function(e,t){return e.length<=t},_minLength:function(e,t){return e.length>=t},_isNotWhitespace:function(e){return e.trim().length>0},_isInteger:function(e){return isFinite(e)&&parseFloat(e)==parseInt(e,10)},_isPositive:function(e){return e>0},_gt:function(e,t){return e>t},_gte:function(e,t){return e>=t},_lt:function(e,t){return e<t},_lte:function(e,t){return e<=t},_equals:function(e,t){return e==t},_notEquals:function(e,t){return e!=t}}}),define.Class("wixapps.core.data.VirtualArrayDataItem",function(e){var t=e;t.inherits("wixapps.core.data.DataItem"),t.binds(["_onVirtualItemsChange","_onRealItemsChange"]),t.fields({_vArray:null,_children:[],_ignoreChangeInReal:!1,_ignoreChangeInVirtual:!1}),t.methods({initialize:function(e){this.parent(e),this._vArray=this._context.getFactory().createDataItem([]),this._vArray.addEvent(Constants.DataItemEvents.CHANGE,this._onVirtualItemsChange)},getTypeName:function(){return"Array"},addEvent:function(e,t){this._vArray.addEvent(e,t)},addEvents:function(e){this._vArray.addEvents(e)},removeEvent:function(e,t){this._vArray.removeEvent(e,t)},removeEvents:function(e){this._vArray.removeEvents(e)},removeAllEvents:function(){this._vArray.removeAllEvents()},setChildren:function(e){for(var t=0;t<this._children.length;t++){var n=this._children[t];n.removeEvent(Constants.DataItemEvents.CHANGE,this._onRealItemsChange)}this._children=e;for(var r=0;r<this._children.length;r++){var i=this._children[r];i.addEvent(Constants.DataItemEvents.CHANGE,this._onRealItemsChange)}this._onRealItemsChange(),this._vArray.resetDirtyFlag()},_onVirtualItemsChange:function(){if(this._ignoreChangeInVirtual)return;var e=this._vArray.getChildren();for(var t=0;t<e.length;t++){var n=this._vArray.getChildByIndex(t),r=n.getValue(0);this._ignoreChangeInReal=!0,this._children[t].setValue(r),this._ignoreChangeInReal=!1}},_onRealItemsChange:function(){if(this._ignoreChangeInReal)return;var e=this._vArray.getChildren(),t=[];for(var n=0;n<this._children.length;n++){var r=this._children[n].getValue(0);t.push(r)}this._ignoreChangeInVirtual=!0;if(e.length!=t.length)this._vArray.setValue(t);else for(var i=0;i<t.length;i++)e[i].setValue(t[i]);this._ignoreChangeInVirtual=!1},addChild:function(e,t){throw"not implemented"},deleteChild:function(e){throw"not implemented"},replaceChild:function(e,t){throw"not implemented"},getChildren:function(){return this._vArray.getChildren()},getValue:function(e,t){return this._vArray.getValue(e,t)},setValue:function(e){throw"not implemented"},getChildIndex:function(e){var t=this._vArray.getChildIndex(e);return t!=-1?t:this._children.indexOf(e)},getChildByIndex:function(e){return this._vArray.getChildByIndex(e)},getChildValue:function(e){return this._vArray.getChildValue(e)},isDirty:function(){return this._vArray.isDirty()||this._children.some(function(e){return e.isDirty()})},resetDirtyFlag:function(){this._vArray.resetDirtyFlag(),this._children.forEach(function(e){e.resetDirtyFlag()})}})}),define.oldClass({name:"wixapps.core.data.providers.ItemBasedDataProvider",Class:{Extends:"wixapps.core.data.providers.base.BaseDataProvider",Binds:[],initialize:function(e){this.parent(e)},loadFromDefinition:function(e){},createItem:function(e,t,n){throw"not implemented"},updateItem:function(e,t,n){throw"not implemented"},deleteItem:function(e,t,n){throw"not implemented"},readItem:function(e,t,n){throw"not implemented"},readItems:function(e,t,n,r){throw"not implemented"},query:function(e,t,n,r,i,s,o){throw"not implemented"}}}),define.oldClass({name:"wixapps.core.data.providers.ItemsLocalStore",imports:[],Class:{Extends:"bootstrap.utils.Events",_dataItemFactory:null,_items:{},_markedDeleted:{},initialize:function(e){this._dataItemFactory=e},clear:function(){this._items={},this._markedDeleted={}},get:function(e){return this._items[e]||null},put:function(e,t){var n=this._items[e];return n?n.setValue(t):(n=this._dataItemFactory.createDataItem(t),this._items[e]=n,this.fireEvent("itemAdded",n)),n},putIfNotDirty:function(e,t){var n=!1,r=this._items[e];return r?(n=r.isDirty(),n||r.setValue(t)):(r=this._dataItemFactory.createDataItem(t),this._items[e]=r,this.fireEvent("itemAdded",r)),{wasDirty:n,item:r}},insertDataItem:function(e,t){this._items[e]=t},remove:function(e){var t=this._items[e];if(t){var n=t.getValue();return this.fireEvent("itemRemoved",t),delete this._items[e],n}},each:function(e){Object.each(this._items,e)},removeAll:function(){for(var e in this._items)this.remove(e)},markItemAsDeleted:function(e){this._markedDeleted[e]=!0},unMarkItemAsDeleted:function(e){delete this._markedDeleted[e]},isItemMarkedAsDeleted:function(e){return this._markedDeleted[e]===!0},getItemsMarkedAsDeleted:function(){return Object.keys(this._markedDeleted)}}}),define.oldClass({name:"wixapps.core.data.providers.base.BaseDataProvider",traits:["wixapps.core.apprepo.traits.AppRepoItem"],Class:{Extends:"bootstrap.utils.Events",Binds:[],_appInstance:null,_type:null,initialize:function(e){this._appInstance=e,this._loadTypes(e.getTypesManager())},loadFromDefinition:function(e){this._type=e.type},_loadTypes:function(e){throw"must implement me"},isTypeDefinitionReadOnly:function(){return!0},createType:function(e){throw this.isTypeDefinitionReadOnly?"type definition is read only":"not implemented"},updateType:function(e){throw this.isTypeDefinitionReadOnly?"type definition is read only":"not implemented"},deleteType:function(e){throw this.isTypeDefinitionReadOnly?"type definition is read only":"not implemented"},getSerializableProperties:function(){return["type"]},reportDataItemChangeEvent:function(e,t,n,r){t!==undefined&&n!==undefined&&this.fireEvent("undoAppsDataChangedEvent",[e,t,n,r])}}}),define.oldClass({name:"wixapps.core.data.providers.wixdb.WixDbBaseDataProvider",imports:["wixapps.core.data.providers.ItemsLocalStore","wixapps.core.data.providers.wixdb.WixDbTransport"],Class:{Extends:"wixapps.core.data.providers.ItemBasedDataProvider",Binds:[],_type:"WixDb",_localStore:null,_api:null,initialize:function(e){this.parent(e),this._localStore=new this.imports.ItemsLocalStore(e.getDataItemFactory()),this._logger=e.getLogger(),this._typesManager=e.getTypesManager(),this._api=new this.imports.WixDbTransport(e)},loadFromDefinition:function(e){this.parent(e)},getTransport:function(){return this._api},readItem:function(e,t,n){var r=this._localStore.get(e);if(r){t(r);return}if(this._api.isTempStore()){n(this._logger.Errors.ITEM_NOT_FOUND);return}var i=function(n){var r=this._translateLoadedItem(n.item),i=this._localStore.isItemMarkedAsDeleted(e)?undefined:this._putInCacheIfNotDirty(e,r);t(i)}.bind(this);this._api.readItem(e,i,n)},readItems:function(e,t,n,r){var i={};for(var s=0;s<t.length;s++)i[t[s]]=s;var o=function(e,t){return i[e.getChildValue("_iid")]-i[t.getChildValue("_iid")]},u=t.clone(),a=0,f=[];for(var l=0;l<t.length;l++){var c=this._localStore.get(t[l]);c&&(u.splice(l-a.length,1),a++,f.push(c))}var h=function(e){f.append(e),f.sort(o),n(f)};u.length>0?this.query(e,{_iid:{$in:u}},{},0,-1,h,r):h([])},query:function(e,t,n,r,i,s,o){var u=function(r){var i=[];r.items.forEach(function(e){e=this._translateLoadedItem(e);var t=e._iid;if(!this._localStore.isItemMarkedAsDeleted(t)){var n=this._localStore.get(t);if(!n||!n.isDirty()){var r=this._localStore.put(t,e);r.resetDirtyFlag(),i.push(r)}}}.bind(this));var o=!1;this._localStore.each(function(n,r){n.isDirty()&&this._match(e,t,n.getValue(0))&&(o=!0,i.push(n))}.bind(this)),o&&this._sortQueryResults(i,n),s(i)}.bind(this);if(this._api.isTempStore()){var a=this.queryLocalStore(e,t,n,r,i);s(a);return}this._api.query(e,t,n,r,i,u,o)},_translateLoadedItem:function(e){return e},queryLocalStore:function(e,t,n,r,i){var s=[];return this._localStore.each(function(n,r){this._match(e,t,n.getValue(0))&&s.push(n)}.bind(this)),this._sortQueryResults(s,n),this._cropQueryResults(s,r,i),s},_putInCacheIfNotDirty:function(e,t){var n=this._localStore.putIfNotDirty(e,t);return n.wasDirty||n.item.resetDirtyFlag(),n.item},_loadTypes:function(e){var t=this._appInstance.getAppDef().getTypes();if(!t)return;t.each(function(t){e.registerType(t)}.bind(this))},toObject:function(){return this.parent()},_sortQueryResults:function(e,t){e.sort(function(e,n){return this._compare(e.getValue(0),n.getValue(0),t)}.bind(this))},_cropQueryResults:function(e,t,n){t=t===undefined||t===null?0:t,n=n===undefined||n===null?-1:n,t>0&&e.splice(0,t);if(n>-1){n=Math.min(n,e.length);var r=e.length-n,i=e.length-r;e.splice(i,r)}},_match:function(e,t,n){return this._typesManager.isOf(n._type,e)?this._matchIgnoreType(t,n):!1},_matchIgnoreType:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],i=this._evaluatePath(t,n);typeof i!="array"&&(i=[i]);var s=function(e){return this._matchSingleValue(r,e)}.bind(this);if(!i.some(s))return!1}return!0},_matchSingleValue:function(e,t){return typeof e=="object"?e.hasOwnProperty("$in")?e.$in.contains(t):e.hasOwnProperty("$ne")?t!=e["$ne"]:e.hasOwnProperty("$gt")?t>e.$gt:e.hasOwnProperty("$gte")?t>=e.$gte:e.hasOwnProperty("$lt")?t<e.$lt:e.hasOwnProperty("$lte")?t<=e.$lte:e.hasOwnProperty("$size")?e["$size"]==t.length:this._matchIgnoreType(e,t):t==e},_compare:function(e,t,n){var r=0;for(var i in n)if(n.hasOwnProperty(i)){var s=this._evaluatePath(e,i),o=this._evaluatePath(t,i),u=s===undefined&&o===undefined?0:s===undefined?-1:o===undefined?1:s>o?1:s<o?-1:0;if(u!==0){r=u*n[i];break}}return r},_evaluatePath:function(e,t){var n=t.split("."),r=e;for(var i=0;i<n.length;i++){if(r===undefined||r===null)return r;var s=n[i],o=s.match(/^(.*)\[([0-9]+)\]$/);if(o){var u=o[1],a=o[2];r=r[u]&&r[u][a]}else r=r[s]}return r}}}),define.oldClass({name:"wixapps.core.data.providers.wixdb.WixDbDraftDataProvider",imports:["wixapps.core.data.DataMigrator"],Class:{Extends:"wixapps.core.data.providers.wixdb.WixDbBaseDataProvider",_dataMigrator:null,_typeDiffs:{},_managedTypes:{},_createdItemIds:[],_appInstance:null,initialize:function(e){this.parent(e),this._dataMigrator=new this.imports.DataMigrator(e.getTypesManager()),this._appInstance=e,this._localStore.addEvent("itemAdded",this._onItemAdded),this._localStore.addEvent("itemRemoved",this._onItemRemoved)},isTypeDefinitionReadOnly:function(){return!1},save:function(e,t){e=e||function(){},t=t||function(){};if(this._api.isTempStore())throw"cannot save draft to temp store";this._typeDiffs={};var n=function(n,r){var i=[],s=null,o=null;for(var u=0;u<n.results.length;u++)if(n.results[u].success){var a=n.results[u].payload,f=r[u];switch(f.name){case"CreateItem":s=Object.clone(f.params.item),s._iid=a.id,s._createdAt=a.createdAt,s._updatedAt=a.updatedAt,o=this._localStore.put(a.id,s),this._createdItemIds.erase(a.id),o.resetDirtyFlag();break;case"UpdateItem":s=Object.clone(f.params.item),s._createdAt=a.createdAt,s._updatedAt=a.updatedAt,o=this._localStore.put(s._iid,s),o.resetDirtyFlag();break;case"DeleteItem":this._localStore.unMarkItemAsDeleted(f.params.itemId)}}else i.push(n.results[u]);i.length>0?t(i):e()}.bind(this),r=this._localStore.getItemsMarkedAsDeleted(),i=[];for(var s=0;s<this._createdItemIds.length;s++){var o=this._createdItemIds[s];i.push(this._localStore.get(o))}var u=[];this._localStore.each(function(e,t){this._createdItemIds.contains(t)||u.push(e)}.bind(this)),this._api.activateBatchMode();try{for(var a=0;a<r.length;a++)this._api.deleteItem(r[a]);for(var f=0;f<i.length;f++)this._api.createItem(i[f].getValue(0));for(var l=0;l<u.length;l++)this._api.updateItem(u[l].getValue(0));this._api.sendBatchAndDeactivate(n,t)}finally{this.getTransport().discardBatch()}},createItem:function(e,t,n){t=t||function(){},n=n||function(){};var r=e.getValue(0);r._iid||(r._iid=W.Utils.getUniqueId("i"));var i=this._localStore.get(r._iid);if(i||r._updatedAt){n(this._logger.Errors.CREATE_ITEM_CALLED_FOR_NON_NEW);return}this._createdItemIds.push(r._iid);var s=this._localStore.put(r._iid,r);t(s)},updateItem:function(e,t,n){t=t||function(){},n=n||function(){};var r=e.getValue(0);if(!r._iid){n(this._logger.Errors.UPDATE_ITEM_CALLED_FOR_NEW);return}var i=this._localStore.get(r._iid);if(!i){n(this._logger.Errors.UPDATE_ITEM_CALLED_FOR_NEW);return}var s=this._localStore.put(r._iid,r);t(s)},deleteItem:function(e,t,n){t=t||function(){},n=n||function(){},this._createdItemIds.erase(e);var r=this._localStore.remove(e),i=this._appInstance.getTypesManager().getType(r._type),s=i!==undefined,o=r._createdAt;o&&s&&this._localStore.markItemAsDeleted(e),t(e,r)},createType:function(e){var t=this._appInstance.getTypesManager();t.registerType(e),this._addManagedType(t.getTypeName(e))},updateType:function(e){var t=this._appInstance.getTypesManager(),n=t.getTypeName(e),r=t.getType(n),i=this._dataMigrator.diffTypes(r,e),s=[];return i.length>0&&this._getDiffsForType(n).append(i),t.registerType(e),i.length>0&&this._appInstance.fireEvent(Constants.WixAppEvents.TYPE_CHANGE,{typeName:n,oldType:r,newType:e}),this._localStore.each(function(e){if(e.getTypeName()==n){var t=e.getValue(0),r=e.isDirty(),o=this._dataMigrator.migrateItem(i,t);e.setValue(o),r||e.resetDirtyFlag(),s.push({dataItemId:t._iid,oldValue:t,newValue:o})}}.bind(this)),s},deleteType:function(e){var t=function(){};this._appInstance.getTypesManager().removeType(e),this._localStore.each(function(n,r){n.getTypeName()==e&&this.deleteItem(r,t,t)}.bind(this)),this._removeManagedType(e)},_getDiffsForType:function(e){var t=this._typeDiffs[e];return t||(t=[],this._typeDiffs[e]=t),t},_translateLoadedItem:function(e){var t=this._getDiffsForType(e._type);return t.length>0?this._dataMigrator.migrateItem(t,e):e},_loadTypes:function(e){var t=this._appInstance.getAppDef().getTypes();if(t&&t.length>0)for(var n=0;n<t.length;n++)this._addManagedType(e.getTypeName(t[n]));this.parent(e)},_addManagedType:function(e){this._managedTypes[e]=!0},_removeManagedType:function(e){delete this._managedTypes[e]},_getManagedTypes:function(){return Object.keys(this._managedTypes)},getManagedTypes:function(){var e=[],t=this._getManagedTypes();for(var n=0;n<t.length;n++){var r=t[n],i=this._appInstance.getTypesManager().getType(r);e.push(i)}return e}}}),define.oldClass({name:"wixapps.core.data.providers.wixdb.WixDbPublishedDataProvider",Class:{Extends:"wixapps.core.data.providers.wixdb.WixDbBaseDataProvider",Binds:[],createItem:function(e,t,n){var r=e.getValue(0),i=function(n){this._localStore.insertDataItem(n.id,e),r._iid=n.id,r._createdAt=n.createdAt,r._updatedAt=n.updatedAt,e.setValue(r),e.resetDirtyFlag(),t(e)}.bind(this);this._api.createItem(r,i,n)},updateItem:function(e,t,n){var r=e.getValue(0),i=function(e){r._createdAt=e.createdAt,r._updatedAt=e.updatedAt;var n=this._localStore.put(r._iid,r);n.resetDirtyFlag(),t(n)}.bind(this);this._api.updateItem(r,i,n)},deleteItem:function(e,t,n){var r=function(){this._localStore.remove(e),this._localStore.unMarkItemAsDeleted(e),t(e)}.bind(this);this._api.deleteItem(e,r,n)}}}),define.oldClass({name:"wixapps.core.data.providers.wixdb.WixDbTransport",imports:[],Class:{Extends:"wixapps.core.utils.WixServiceTransportBase",_draftStore:"<DRAFT>",_batch:null,_getServiceUrl:function(){var e=window.location.origin||this._extractBasePath(window.location.href);return e+"/apps/appBuilder/1/"+this._savedOrPublished()+"/"},_savedOrPublished:function(){return W.Viewer.isPublicMode()?"viewer":"editor"},loadFromDefinition:function(e){this.parent(e),this._type=e.type},createItem:function(e,t,n){this.doRequest("CreateItem",{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),item:e},t,n)},updateItem:function(e,t,n){this.doRequest("UpdateItem",{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),item:e},t,n)},deleteItem:function(e,t,n){this.doRequest("DeleteItem",{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),itemId:e},t,n)},readItem:function(e,t,n){this.doRequest("ReadItem",{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),itemId:e},t,n)},query:function(e,t,n,r,i,s,o){this.doRequest("Query",{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),type:e,filter:t,sort:n,skip:r,limit:i==-1?null:i},s,o)},isTempStore:function(){return this._appInstance.getInstanceId()=="<DRAFT>"},activateBatchMode:function(){if(this._batch)throw"batch already active";this._batch=[]},discardBatch:function(){this._batch=null},sendBatchAndDeactivate:function(e,t){if(!this._batch)throw"batch mode is not active";var n={operations:this._batch};this._batch=null;var r=function(t){e(t,n.operations)};this.doRequest("Batch",n,r,t)},doRequest:function(e,t,n,r){this._batch?this._batch.push({name:e,params:t}):this.parent(e,t,n,r)}}}),define.oldClass({name:"wixapps.core.data.selectors.ItemDataSelector",Class:{Binds:[],Extends:"wixapps.core.data.selectors.base.BaseDataSelector",getItem:function(e,t){throw"not implemented"},getSerializableProperties:function(){return this.parent().concat(["itemId"])}}}),define.oldClass({name:"wixapps.core.data.selectors.ListDataSelector",Class:{Extends:"wixapps.core.data.selectors.base.BaseDataSelector",Binds:["_filterHiddenItems"],_hiddenItemIds:[],loadFromDefinition:function(e){this.parent(e),this._hiddenItemIds=e.hiddenItemIds||[]},getItems:function(e,t){throw"not implemented"},getAllItems:function(e,t){throw"not implemented"},_filterHiddenItems:function(e){var t=[];return e.each(function(e){var n=e.getChildValue("_iid");this._hiddenItemIds.contains(n)||t.push(e)}.bind(this)),t},addItem:function(e){return!1},removeItem:function(e){return!1},toggleVisibility:function(e){var t=this.isHidden(e);this.setVisibility(e,t?!0:!1)},setVisibility:function(e,t){var n=this._hiddenItemIds.contains(e);if(!t&&!n)this._hiddenItemIds.push(e),this._refresh(),t=!1;else{if(!n)return;var r=this._hiddenItemIds.indexOf(e);this._hiddenItemIds.splice(r,1),this._refresh(),t=!0}this.fireEvent(Constants.DataEvents.DATA_CHANGED,{action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_VISIBILITY,dataItemId:e,visible:t})},isHidden:function(e){return this._hiddenItemIds.contains(e)},_refresh:function(e,t){e||(e=function(){}),t||(t=function(){}),this.getItems(e,t)},getHiddenItemIds:function(){return this._hiddenItemIds},setSelectedItemByIndex:function(e){this._selectedItemIndex=e,this.getAllItems(function(t){var n=t.getChildByIndex(e);this.setSelectedItem(n)}.bind(this),function(){})},getItemIdIndex:function(e){throw"not implemented"},getSelectedItemIndex:function(){return this._selectedItemIndex},resetSelectedItem:function(){this._selectedItemIndex=-1,this._virtualSelectedItem.setValue({})},setSelectedItem:function(e){this._virtualSelectedItem=this._virtualSelectedItem||this._dataItemFactory.createDataItem({}),this._virtualSelectedItem.setValue(e.getValue(0))},getSelectedItem:function(){return this._virtualSelectedItem},handleUndo:function(e,t,n,r){e=="Hide"&&this.setVisibility(t,n)},getSerializableProperties:function(){return this.parent().concat(["hiddenItemIds"])},isListSelector:function(){return!0}}}),define.oldClass({name:"wixapps.core.data.selectors.ManualSelectedItemDataSelector",Class:{Binds:[],_itemId:null,_virtualItem:null,Extends:"wixapps.core.data.selectors.ItemDataSelector",loadFromDefinition:function(e){this.parent(e),this._itemId=e.itemId},setSelectedItem:function(e){this._itemId=e,this.getItem(function(){},function(){})},getItem:function(e,t){var n=function(t){this._virtualItem=this._virtualItem||this._dataItemFactory.createDataItem({}),this._virtualItem.setValue(t.getValue(0)),e(this._virtualArray)}.bind(this);this._dataProvider.readItem(this._itemId,n,t)},_getLogicalTypeName:function(){return"IB.ManualSelectedItem"},getSerializableProperties:function(){return this.parent().concat(["itemId"])}}}),define.oldClass({name:"wixapps.core.data.selectors.ManualSelectedListDataSelector",Class:{Extends:"wixapps.core.data.selectors.ListDataSelector",_itemIds:null,_virtualArray:null,_virtualArrayWithoutHiddens:null,loadFromDefinition:function(e){this.parent(e),this._itemIds=e.itemIds},setItemIds:function(e){this._itemIds=e,this._refresh()},getItemIds:function(){return this._itemIds},getItems:function(e,t){this._dataProvider.readItems(this.getSelectionType(),this._itemIds,function(t){var n=t;t=this._filterHiddenItems(t),this._virtualArray=this._virtualArray||this._dataItemFactory.createVirtualArray(),this._virtualArray.setChildren(t),e(this._virtualArray)}.bind(this),t)},getAllItems:function(e,t){this._dataProvider.readItems(this.getSelectionType(),this._itemIds,function(t){var n=this._dataItemFactory.createVirtualArray();n.setChildren(t),e(n)}.bind(this),t)},getItemIdIndex:function(e){if(this._hiddenItemIds.contains(e))return-1;var t=this._itemIds.filter(function(e){return!this._hiddenItemIds.contains(e)}.bind(this));return t.indexOf(e)},getItemIdRealIndex:function(e){return this._itemIds.indexOf(e)},addItem:function(e,t){var n=e.getChildValue("_iid");return t===undefined?this._itemIds.push(n):this._itemIds.splice(t,0,n),this._refresh(function(){this.fireEvent(Constants.DataEvents.DATA_CHANGED,{action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD,dataItemId:n})}.bind(this)),t},removeItem:function(e,t){return t===undefined&&(t=this._itemIds.indexOf(e)),t>=0&&(this._itemIds.splice(t,1),this._refresh(function(){this.fireEvent(Constants.DataEvents.DATA_CHANGED,{action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE,dataItemId:e})}.bind(this))),t},moveItem:function(e,t){var n=this._itemIds.splice(e,1);this._itemIds.splice(t,0,n[0]),this._refresh(function(){this.fireEvent(Constants.DataEvents.DATA_CHANGED,{action:Constants.DataItemEvents.CHANGE_EVENT_ACTION_MOVE,newIndex:t,oldIndex:e,dataItemId:n})}.bind(this))},onDelete:function(){this._itemIds=[],this.getDataProvider().deleteType(this._forType)},duplicate:function(e){var t=this._getLogicalTypeName(),n=[],r=this._dataProvider,i=this._appInstance;this._itemIds.each(function(t){r.readItem(t,function(t){var s=t.getValue();delete s._iid,delete s._updatedAt,s._type=e,t=i.getDataItemFactory().createDataItem(s),r.createItem(t,function(e){n.push(e.getValue())},function(){})})});var s=i.getTypesManager().getType(this._forType);s=Object.clone(s),s.name=e,s.displayName=s.displayName+"_1",r.createType(s);var o=this._appInstance.getDataSelectors().createAndRegister(t,this.getDataProvider(),e,n);return o},getBiInfo:function(){return{visibleItems:this._itemIds.length-this._hiddenItemIds.length,hiddenItems:this._hiddenItemIds.length}},handleUndo:function(e,t,n,r){this.parent(e,t,n,r),e=="Move"&&this.moveItem(r,n)},_getLogicalTypeName:function(){return"IB.ManualSelectedList"},getSerializableProperties:function(){return this.parent().concat(["itemIds"])}}}),define.oldClass({name:"wixapps.core.data.selectors.SelectedItemDataSelector",Class:{Binds:[],Extends:"wixapps.core.data.selectors.ItemDataSelector",setListSelectorId:function(e){this._listSelectorId=e;var t=this._appInstance.getDataSelectors().getById(this._listSelectorId);this._virtualSelectedItem=t.getSelectedItem()},loadFromDefinition:function(e){this.parent(e),this._listSelectorId=e.listSelectorId,this.setListSelectorId(this._listSelectorId)},getItem:function(e,t){e(this._virtualSelectedItem)},_getLogicalTypeName:function(){return"IB.SelectedItemInList"},getSerializableProperties:function(){return this.parent().push("listSelectorId")}}}),define.oldClass({name:"wixapps.core.data.selectors.base.BaseDataSelector",traits:["wixapps.core.apprepo.traits.AppRepoItem"],Class:{Extends:"bootstrap.utils.Events",Binds:[],_dataProvider:null,_dataProviderId:null,_appInstance:null,_dataItemFactory:null,initialize:function(e,t){this._appInstance=e,this._dataItemFactory=e.getDataItemFactory(),this._forType=t,this._logicalTypeName=this._getLogicalTypeName()},loadFromDefinition:function(e){this._forType=e.forType,this._type=e.type,this._id=e.id,this.setDataProvider(this._appInstance.getDataProviders().getById(e.dataProviderId))},setDataProvider:function(e){this._dataProviderId=e.getId(),this._dataProvider=e},getDataProvider:function(){return this._dataProvider},getFriendlyName:function(){return this._name},getSelectionType:function(){return this._forType},setSelectionType:function(e){this._forType=e},isListSelector:function(){return!1},isQueryBased:function(){return!1},reset:function(){throw"not implemented"},getBiInfo:function(){return{}},handleUndo:function(e,t,n,r){throw"not implemented"},_getLogicalTypeName:function(){throw"must implement"},getSerializableProperties:function(){return["logicalTypeName","dataProviderId","forType","id"]}}}),define.oldClass({name:"wixapps.core.dataservice.DataService",imports:["wixapps.core.dataservice.DataServiceTransport","wixapps.core.managers.TypesManager","wixapps.core.data.DataItemFactory","wixapps.core.data.DataItem"],Class:{_api:null,_dataItemFactory:null,_cache:null,initialize:function(e,t,n){this._api=e,this._dataItemFactory=t,this._cache=n,this._dataItemFactory.registerRefResolver(this)},getTransport:function(){return this._api},getDataItemFactory:function(){return this._dataItemFactory},getItemCache:function(){return this._cache},createStore:function(e,t){this._api.createStore(e,t)},createType:function(e,t,n){this._api.createType(e,t,n)},readType:function(e,t,n){this._api.readType(e,t,n)},listTypes:function(e,t){this._api.listTypes(e,t)},deleteType:function(e,t,n){this._api.deleteType(e,t,n)},createCollection:function(e,t,n,r){this._api.createCollection(e,t,n,r)},listCollections:function(e,t){this._api.listCollections(e,t)},deleteCollection:function(e,t,n){this._api.deleteCollection(e,t,n)},createItem:function(e,t,n,r){var i=t.getValue(0),s=function(r){this._cache.insertDataItem(this._cache.key(e,r.id),t),i._iid=r.id,i._hash=r.hash,t.setValue(i),n(t)}.bind(this);this._api.createItem(e,i,s,r)},updateItem:function(e,t,n,r){var i=t.getValue(0),s=function(t){i._hash=t.hash;var r=this._cache.put(this._cache.key(e,i._iid),i);n(r)}.bind(this);this._api.updateItem(e,i,s,r)},deleteItem:function(e,t,n,r){var i=function(){this._cache.remove(this._cache.key(e,t)),n(t)}.bind(this);this._api.deleteItem(e,t,i,r)},readItem:function(e,t,n,r){var i=function(t){Object.each(t.referencedItems,function(e,t){this._cache.isItemMarkedAsDeleted(t)||this._putInCacheIfNotDirty(t,e)}.bind(this));var r=this._cache.key(e,t.item._iid),i=this._cache.isItemMarkedAsDeleted(r)?null:this._putInCacheIfNotDirty(this._cache.key(e,t.item._iid),t.item);Object.each(t.unreferencedItems,function(e,t){var n=this._api.getLogger(),r={description:e.errorDescription,code:e.errorCode};n.reportError(r,this.$className,"readItem",n.SubCategory.DATA_SERVICE)}.bind(this)),n(i)}.bind(this);this._api.readItem(e,t,i,r)},query:function(e,t,n,r,i,s,o){var u=function(r){Object.each(r.referencedItems,function(e,t){this._cache.isItemMarkedAsDeleted(t)||this._putInCacheIfNotDirty(t,e)}.bind(this));var i=[],o=[];r.items.forEach(function(t){var n=this._cache.key(e,t._iid);if(!this._cache.isItemMarkedAsDeleted(n)){var r=this._cache.get(n);if(!r||!r.isDirty()){var s=this._cache.put(n,t);s.resetDirtyFlag(),i.push(s),o.push({_type:"wix:Ref<"+t._type+">",collectionId:e,itemId:t._iid})}}}.bind(this));var u=!1;this._cache.each(function(n,r){if(n.isDirty()){var s=this._cache.idsFromKey(r);s.collectionId==e&&this._match(t,n.getValue(0))&&(u=!0,i.push(n),o.push({_type:"wix:Ref<"+n.getTypeName()+">",collectionId:e,itemId:s.itemId}))}}.bind(this)),Object.each(r.unreferencedItems,function(e,t){var n=this._api.getLogger(),r={description:e.errorDescription,code:e.errorCode};n.reportError(r,this.$className,"readItem",n.SubCategory.DATA_SERVICE)}.bind(this)),u&&this._sortQueryResults(i,o,n),s(i,o)}.bind(this);this._api.query(e,t,n,r,i,u,o)},queryCache:function(e,t,n,r,i){var s=[],o=[];return this._cache.each(function(n,r){var i=this._cache.idsFromKey(r);i.collectionId==e&&this._match(t,n.getValue(0))&&(s.push(n),o.push({_type:"wix:Ref<"+n.getTypeName()+">",collectionId:e,itemId:i.itemId}))}.bind(this)),this._sortQueryResults(s,o,n),this._cropQueryResults(s,o,r,i),{items:s,refList:o}},_putInCacheIfNotDirty:function(e,t){var n=this._cache.putIfNotDirty(e,t);return n.wasDirty||n.item.resetDirtyFlag(),n.item},_sortQueryResults:function(e,t,n){var r=[];for(var i=0;i<e.length;i++)r.push({item:e[i],ref:t[i]});r=r.sort(function(e,t){return this._compare(e.item.getValue(0),t.item.getValue(0),n)}.bind(this)),e.empty(),t.empty();for(var s=0;s<r.length;s++)e.push(r[s].item),t.push(r[s].ref)},_cropQueryResults:function(e,t,n,r){n=n===undefined||n===null?0:n,r=r===undefined||r===null?-1:r,n>0&&(e.splice(0,n),t.splice(0,n));if(r>-1){r=Math.min(r,e.length);var i=e.length-r,s=e.length-i;e.splice(s,i),t.splice(s,i)}},deReference:function(e,t){return this._cache.get(this._cache.key(e,t))||null},readItemFromCache:function(e,t){return this.deReference(e,t)},_match:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],i=this._evaluatePath(t,n);typeof i!="array"&&(i=[i]);var s=function(e){return this._matchSingleValue(r,e)}.bind(this);if(!i.some(s))return!1}return!0},_matchSingleValue:function(e,t){return typeof e=="object"?e.hasOwnProperty("$in")?e.$in.contains(t):e.hasOwnProperty("$ne")?t!=e["$ne"]:e.hasOwnProperty("$gt")?t>e.$gt:e.hasOwnProperty("$gte")?t>=e.$gte:e.hasOwnProperty("$lt")?t<e.$lt:e.hasOwnProperty("$lte")?t<=e.$lte:e.hasOwnProperty("$size")?e["$size"]==t.length:!1:t==e},_compare:function(e,t,n){var r=0;for(var i in n)if(n.hasOwnProperty(i)){var s=this._evaluatePath(e,i),o=this._evaluatePath(t,i),u=s===undefined&&o===undefined?0:s===undefined?-1:o===undefined?1:s>o?1:s<o?-1:0;if(u!==0){r=u*n[i];break}}return r},_evaluatePath:function(e,t){var n=t.split("."),r=e;for(var i=0;i<n.length;i++){if(r===undefined||r===null)return r;var s=n[i],o=s.match(/^(.*)\[([0-9]+)\]$/);if(o){var u=o[1],a=o[2];r=r[u]&&r[u][a]}else r=r[s]}return r}}}),define.oldClass({name:"wixapps.core.dataservice.DataServiceTransport",imports:[],Class:{Extends:"wixapps.core.dataservice.DataServiceTransportBase",_storeId:null,initialize:function(e,t,n){this.parent(t,n),this._storeId=e},createStore:function(e,t){this.doRequest("CreateStore",{storeId:this._storeId},e,t)},createType:function(e,t,n){this.doRequest("CreateType",{storeId:this._storeId,type:e},t,n)},readType:function(e,t,n){this.doRequest("ReadType",{storeId:this._storeId,typeName:e},t,n)},listTypes:function(e,t){this.doRequest("ListTypes",{storeId:this._storeId},e,t)},deleteType:function(e,t,n){this.doRequest("DeleteType",{storeId:this._storeId,typeName:e},t,n)},createCollection:function(e,t,n,r){this.doRequest("CreateCollection",{storeId:this._storeId,collectionId:e,typeNames:t},n,r)},listCollections:function(e,t){this.doRequest("ListCollections",{storeId:this._storeId},e,t)},deleteCollection:function(e,t,n){this.doRequest("DeleteCollection",{storeId:this._storeId,collectionId:e},t,n)},createItem:function(e,t,n,r){this.doRequest("CreateItem",{storeId:this._storeId,collectionId:e,item:t},n,r)},updateItem:function(e,t,n,r){this.doRequest("UpdateItem",{storeId:this._storeId,collectionId:e,item:t},n,r)},deleteItem:function(e,t,n,r){this.doRequest("DeleteItem",{storeId:this._storeId,collectionId:e,itemId:t},n,r)},readItem:function(e,t,n,r){this.doRequest("ReadItem",{storeId:this._storeId,collectionId:e,itemId:t,autoDereferenceLevel:3},n,r)},query:function(e,t,n,r,i,s,o){this.doRequest("Query",{storeId:this._storeId,collectionId:e,filter:t,sort:n,skip:r,limit:i==-1?null:i,autoDereferenceLevel:3},s,o)}}}),define.oldClass({name:"wixapps.core.dataservice.DataServiceTransportBase",imports:["wixapps.core.utils.WixAppsLogger"],Class:{_serviceUrl:null,_userProperties:null,_accessToken:null,_logger:null,initialize:function(e,t){this._userProperties=e,this._accessToken=t;var n=window.location.origin||this._extractBasePath(window.location.href);this._serviceUrl=n+"/apps/lists/1/"},_extractBasePath:function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.hostname},getLogger:function(){return this._logger||(this._logger=new this.imports.WixAppsLogger),this._logger},doRequest:function(e,t,n,r){r||(r=function(e){throw e.description+" ("+e.code+")"});var i=function(e){var t=this.getLogger();t.reportError(e,this.$className,"doRequest",t.SubCategory.DATA_SERVICE)}.bind(this),s=function(e){if(!e.success){var t={code:e.errorCode,description:e.errorDescription};i(t),r(t)}else n(e.payload)}.bind(this),o=function(e){var t={code:e.status?e.status:-1,description:e.statusText?e.statusText:"Unspecified error occurred, possibly a connection problem"};i(t),r(t)};this._postJsonRequest(e,t,s,o)},_postJsonRequest:function(e,t,n,r){var i=new Request.JSON({url:this._serviceUrl+e+"/",urlEncoded:!1,onSuccess:n,onFailure:r});i.options=i.options||{},i.options.headers=i.options.headers||{},i.options.headers["If-Modified-Since"]="Sat, 1 Jan 2005 00:00:00 GMT",i.options.headers["Content-Type"]="application/json; charset=utf-8",i.options.headers["x-wix-user-properties"]=this._userProperties,i.options.headers["x-wix-access-token"]=this._accessToken,i.post(JSON.encode(t))}}}),define.oldClass({name:"wixapps.core.dataservice.ItemCache",imports:[],Class:{_dataItemFactory:null,_items:{},_markedDeleted:{},initialize:function(e){this._dataItemFactory=e},get:function(e){return this._items[e]||null},put:function(e,t){var n=this._items[e];return n?n.setValue(t):(n=this._dataItemFactory.createDataItem(t),this._items[e]=n),n},putIfNotDirty:function(e,t){var n=!1,r=this._items[e];return r?(n=r.isDirty(),n||r.setValue(t)):(r=this._dataItemFactory.createDataItem(t),this._items[e]=r),{wasDirty:n,item:r}},insertDataItem:function(e,t){this._items[e]=t},remove:function(e){delete this._items[e]},key:function(e,t){return e+"/"+t},idsFromKey:function(e){var t=e.split("/");return{collectionId:t[0],itemId:t[1]}},each:function(e){Object.each(this._items,e)},removeAll:function(){for(var e in this._items)delete this._items[e]},markItemAsDeleted:function(e){this._markedDeleted[e]=!0},unMarkItemAsDeleted:function(e){delete this._markedDeleted[e]},isItemMarkedAsDeleted:function(e){return this._markedDeleted[e]===!0},getItemsMarkedAsDeleted:function(){return Object.keys(this._markedDeleted)}}}),define.oldTrait({name:"wixapps.core.events.EventAggregator",trait:{Binds:["_aggregatingDispatchFunc"],_aggregatedEvents:[],_eventFilter:[],_originalFireEventFunc:null,initialize:function(){this._originalFireEventFunc=this.fireEvent},startEventAggregation:function(e){this._eventFilter=e||[],this.fireEvent=this._aggregatingDispatchFunc},releaseEventAggregation:function(e){e=e||Constants.DataItemEvents.CHANGE,this.fireEvent=this._originalFireEventFunc,this._aggregatedEvents.length>0&&this.fireEvent(e,{target:this,events:this._aggregatedEvents}),this._aggregatedEvents=[]},_aggregatingDispatchFunc:function(e,t){this._eventFilter.length===0||this._eventFilter.contains(e)?t.events?this._aggregatedEvents=this._aggregatedEvents.concat(t.events):this._aggregatedEvents.push({type:e,payload:t}):this._originalFireEventFunc(e,t)}}}),define.Class("wixapps.core.events.ProxyEventBus",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize(["wixapps.core.events.TreePath"]),t.fields({_map:null,_originals:[],_interceptors:[]}),t.methods({initialize:function(){this._map={same:Constants.WixAppTreeRelation.THIS,parent:Constants.WixAppTreeRelation.PARENT,ancestor:Constants.WixAppTreeRelation.ANCESTOR,sibling:Constants.WixAppTreeRelation.SIBLING,descendant:Constants.WixAppTreeRelation.DESCENDANT,"parent-descendant":Constants.WixAppTreeRelation.PARENT_DESCENDANT,"sibling-descendant":Constants.WixAppTreeRelation.SIBLING_DESCENDANT}},fireProxyEvent:function(e,t,n,r){n.sender=e,n.context=e.getViewContext(),n.data=e.getData(),n.def=e.getViewDefinition(),n.type=t,this.fireEvent(t,n,r)},addEventFilteredByScope:function(e,t,n,r,i){t||(t="same");var s=this._map[t];if(!s&&t!="any")throw'"'+t+'" is invalid scope value';var o=function(n){var i=n&&n.context&&n.context.getEnvironment().getTreePath(),o=e.getEnvironment().getTreePath();(t=="any"||o&&i&&o.isOtherRelatedToThisAs(i,s))&&r(n)};this._originals.push(r),this._interceptors.push(o),this.addEvent(n,o,i)},removeEvent:function(e,t){var n=this._originals.indexOf(t),r=n==-1?t:this._interceptors[n];n!=-1&&(this._originals.splice(n,1),this._interceptors.splice(n,1)),this.parent(e,r)}})}),define.Const("WixAppTreeRelation",{PARENT:1,ANCESTOR:2,SIBLING:4,DESCENDANT:8,PARENT_DESCENDANT:16,SIBLING_DESCENDANT:32,THIS:64}),define.Class("wixapps.core.events.TreePath",function(e){var t=e,n=0;t.fields({_path:null}),t.methods({initialize:function(e){this._path=e?e._path.clone():[]},pushScope:function(){this._path.push(n++)},isOtherRelatedToThisAs:function(e,t){switch(t){case Constants.WixAppTreeRelation.THIS:return this._path.length==e._path.length&&this._path.every(function(t,n){return e._path[n]==t});case Constants.WixAppTreeRelation.PARENT:return!this.isRoot()&&e.get(-1)==this.get(-2);case Constants.WixAppTreeRelation.ANCESTOR:return this._path.indexOf(e.get(-1))!=-1;case Constants.WixAppTreeRelation.SIBLING:return this._path.length==e._path.length&&this.get(-2)==e.get(-2);case Constants.WixAppTreeRelation.DESCENDANT:return e.isOtherRelatedToThisAs(this,Constants.WixAppTreeRelation.ANCESTOR);case Constants.WixAppTreeRelation.PARENT_DESCENDANT:return this.isRoot()||e.isOtherRelatedToThisAs(this._createTempParent(),Constants.WixAppTreeRelation.ANCESTOR);case Constants.WixAppTreeRelation.SIBLING_DESCENDANT:return this.isOtherRelatedToThisAs(e,Constants.WixAppTreeRelation.PARENT_DESCENDANT)&&!this.isOtherRelatedToThisAs(e,Constants.WixAppTreeRelation.PARENT)&&!this.isOtherRelatedToThisAs(e,Constants.WixAppTreeRelation.DESCENDANT)}},_createTempParent:function(){var e=new this.constructor(this);return e._path=this._path.slice(0,-1),e},isRoot:function(){return this._path.length==1},get:function(e){return this._path[(this._path.length+e)%this._path.length]}})}),define.oldClass({name:"wixapps.core.expressions.EvalScopeWrapper",imports:["wixapps.core.data.DataItemFactory","wixapps.core.data.DataItemUtils"],traits:[],Class:{Binds:["_onSourceChange","_onEvaluationContextChange"],_source:null,_evaluationContext:null,_maxRefDepth:0,_data:null,_dataItemFactory:null,_dataItemUtils:null,_evalPending:!1,_changeUpdateTimeChunk:0,initialize:function(e,t,n,r){this._source=e,this._evaluationContext=t,this._viewEnvironment=n,this._maxRefDepth=r,this._dataItemFactory=this._viewEnvironment.getDataItemFactory(),this._dataItemUtils=new this.imports.DataItemUtils,this.evaluateData(),this._source.addEvent(Constants.DataItemEvents.CHANGE,this._onSourceChange),this._exprChangeDispatchers=this._getExprChangeDispatchers(this._source,this._evaluationContext),this._exprChangeDispatchers.each(function(e){e.addEvent(Constants.DataItemEvents.CHANGE,this._onEvaluationContextChange)}.bind(this))},evaluateData:function(){var e=this._source.getValue(this._maxRefDepth,this._evaluationContext);this._data===null?this._data=this._dataItemFactory.createDataItem(e):this._data.setValue(e)},getData:function(){return this._data},_onSourceChange:function(){this._requestEvaluation()},_onEvaluationContextChange:function(){this._requestEvaluation()},_requestEvaluation:function(){this._evalPending===!1&&(this._evalPending=!0,setTimeout(function(){this.evaluateData(),this._evalPending=!1}.bind(this),this._changeUpdateTimeChunk))},_getExprChangeDispatchers:function(e,t){return this._dataItemUtils.findExprItems(e).reduce(function(e,n){var r=n.getChangeDispatchers(t)||[];return Array.concat(e,r)},[]).reduce(function(e,t){return e.indexOf(t)==-1?e.concat(t):e},[])},dispose:function(){this._exprChangeDispatchers.each(function(e){e.removeEvent(Constants.DataItemEvents.CHANGE,this._onEvaluationContextChange)}),this._exprChangeDispatchers=null,this._source.removeEvent(Constants.DataItemEvents.CHANGE,this._onSourceChange),this._source=null}}}),define.oldClass({name:"wixapps.core.expressions.Expression",imports:["wixapps.core.expressions.ExpressionParser"],Class:{Binds:[],_parser:null,_funcLib:null,_expr:null,_exprSource:"",initialize:function(e){this._parser=new this.imports.ExpressionParser,this._funcLib=e},parseExpression:function(e){this._exprSource=e,this._expr=this._parser.parseExpressionSource(e)[0]},getSymbolItems:function(e){var t=this,n=function(t,r){return r.type=="ref"?t.concat(e.resolveExpressionReference(r.content)):r.type=="function"?Array.reduce(r.params,n,t):t};return Array.reduce([this._expr],n,[]).filter(function(e){return e.addEvent})},evaluate:function(e){var t=this,n=function(r,i,s){if(r.type=="function"){var o=i.getFunctionByName(r.content),u=Array.map(r.params,function(e){return n(e,i,s)});if(!!o||r.content.slice(0,5)!="Debug")return o.apply(null,u);t._performDebugFunc(r.content,e,u)}else{if(r.type=="primitive")return r.content;if(r.type=="ref"){var a=s.evaluateExpressionReference(r.content);if(a===undefined)throw new Error("Expression: "+t._exprSource+" | Cannot resolve symbol "+r.content);return a}}};if(this._expr)return n(this._expr,this._funcLib,e)},_performDebugFunc:function(e,t,n){if(e=="Debug.symbols"){var r=t.listSymbols();Object.each(r,function(e,t){console.log(e,"=",t)})}},dispose:function(){this._funcLib=null,this._parser=null}}}),define.oldClass({name:"wixapps.core.expressions.ExpressionLexer",imports:[],Class:{parseExpression:function(e){if(e.length){var t=this._findString(e)||this._findSymbol(e)||this._findBracket(e);return t?Array.concat([t],this.parseExpression(e.slice(t.length))):this.parseExpression(e.slice(1))}return[]},_findString:function(e){var t=["'",'"'],n=function(e,t){if(e.length){var r=e.charAt(0);if(r=="\\"&&e.length>1)return String.concat(r+e.charAt(1),n(e.slice(2),t));if(r!=t)return String.concat(r,n(e.slice(1),t))}return""},r=e.charAt(0);if(t.contains(r))return String.concat('"',n(e.slice(1),r),'"')},_findSymbol:function(e){var t=/[\w\*\/\-\%\+\$]/,n=/[\w\*\/\-\%\+\.\$\[\]\?_]/,r=function(e){var t=e.charAt(0);return e.length&&t.match(n)?String.concat(t,r(e.slice(1))):""},i=e.charAt(0);if(i.match(t))return String.concat(i,r(e.slice(1)))},_findBracket:function(e){var t=e.charAt(0);if(t=="("||t==")")return t}}}),define.oldClass({name:"wixapps.core.expressions.ExpressionParser",imports:["wixapps.core.expressions.ExpressionLexer"],Class:{DIALECT_JS:0,DIALECT_LISP:1,_primitiveTypes:["boolean","string","number"],parseExpressionSource:function(e){var t=new this.imports.ExpressionLexer(e),n=t.parseExpression(e),r=n[0]=="("?this.DIALECT_LISP:this.DIALECT_JS,i=this._foldTokenList(n,r);return this._foldFunctionChain(i)},_foldTokenList:function(e,t){if(e.length){var n=this._getFunction(e,t)||this._getPrimitive(e,t)||this._getReference(e,t);if(n)return Array.concat([n.node],this._foldTokenList(n.next,t))}return[]},_foldFunctionChain:function(e){var t=this._foldFunctionChain;if(e.length>0&&e.every(function(e){return e.type=="function"})){var n=e.slice(1).reduce(function(e,n){return{type:n.type,content:n.content,params:Array.concat([e],t(n.params))}},e[0]);return[n]}return e},_getFunction:function(e,t){var n,r=t==this.DIALECT_LISP?0:1,i=t==this.DIALECT_LISP?1:0;if(e[r]=="("&&typeOf(e[i])=="string"){var s=this._getFuncParams(e);return{next:e.slice(s.length+3),node:{type:"function",content:e[i],params:this._foldTokenList(s,t)}}}},_getFuncParams:function(e){var t=function(e,n){if(e.length&&n>0){var r=e[0],i=e.slice(1);return r=="("?Array.concat([r],t(i,n+1)):r==")"?Array.concat([r],t(i,n-1)):Array.concat([r],t(i,n))}return[]};return t(e.slice(2),1).slice(0,-1)},_getPrimitive:function(e,t){var n,r=e[0];r=="true"?n=!0:r=="false"?n=!1:r.charAt(0)=='"'&&r.charAt(r.length-1)=='"'||r.charAt(0)=="'"&&r.charAt(r.length-1)=="'"?n=this._unescapeString(r.slice(1,r.length-1)):isNaN(parseFloat(r,10))?isNaN(parseInt(r,10))||(n=parseInt(r,10)):n=parseFloat(r,10);if(n!==undefined)return{next:e.slice(1),node:{type:"primitive",content:n}}},_unescapeString:function(e){return e=e.replace(/\\/g,""),e},_getReference:function(e,t){return{next:e.slice(1),node:{type:"ref",content:e[0]}}}}}),define.oldClass({name:"wixapps.core.expressions.FunctionLibrary",imports:[],Class:{_funcDef:{and:function(){for(var e=0;e<arguments.length;e++)if(arguments[e]===!1)return!1;return!0},or:function(){for(var e=0;e<arguments.length;e++)if(arguments[e]===!0)return!0;return!1},"if":function(e,t,n){return e?t:n},eq:function(e,t){return e==t},ne:function(e,t){return e!=t},not:function(e){return!e},"!":function(e){return!e},gt:function(e,t){return e>t},lt:function(e,t){return e<t},toString:function(e){return e.toString()},mod:function(e,t){return e%t},add:function(){var e=0;for(var t=0;t<arguments.length;t++)e+=arguments[t];return e},mult:function(){var e=1;for(var t=0;t<arguments.length;t++)e*=arguments[t];return e},sub:function(e,t){return e-t},div:function(e,t){return e/t},match:function(e,t,n){return e==t?n:undefined},"true?":function(e,t){return Boolean(e)===!0?t:undefined},"false?":function(e,t){return Boolean(e)===!1?t:undefined},"else":function(e,t){return e===undefined?t:e},Math:{floor:function(e){return Math.floor(e)},round:function(e){return Math.round(e)}},Array:{length:function(e){return e.length},isEmpty:function(e){return e==null||e.length===0}},String:{length:function(e){return e.length},isEmpty:function(e){return e==null||e.length===0},charAt:function(e,t){return e.charAt(t)},charCodeAt:function(e,t){return e.charCodeAt(e,t)},concat:function(){return String.concat.apply(arguments[0],arguments)},indexOf:function(e,t){return e.indexOf(t)},lastIndexOf:function(e,t){return e.lastIndexOf(t)},match:function(e,t){return e.match(new RegExp(t))},replace:function(e,t,n){return e.replace(t,n)},search:function(e,t){return e.search(new RegExp(t))},slice:function(e,t,n){return e.slice(t,n)},split:function(e,t){return e.split(t)},substr:function(e,t,n){return e.substr(t,n)},substring:function(e,t,n){return e.substring(t,n)},toLowerCase:function(e){return e.toLowerCase()},toUpperCase:function(e){return e.toUpperCase()},contains:function(e,t){return e.contains(t)},trim:function(e){return e.trim()},toInt:function(e){return parseInt(e,10)},toFloat:function(e){return parseFloat(e)}}},_funcTable:{},initialize:function(){var e=function(t,n,r){Object.each(n,function(n,i){typeOf(n)=="function"?t[r+i]=n:typeOf(n=="object")&&e(t,n,i+".")})};this._funcTable={},e(this._funcTable,this._funcDef,"")},getFunctionByName:function(e){return this._funcTable[e]}}}),define.Const("FlowLayout",{Anchors:{TOP_LEFT:"top-left",BOTTOM_LEFT:"bottom-left",TOP_RIGHT:"top-right",BOTTOM_RIGHT:"bottom-right",ALL:["top-left","bottom-left","top-right","bottom-right"]}}),define.oldClass({name:"wixapps.core.layouts.FlowLayout",imports:["wixapps.core.layouts.Width","wixapps.core.layouts.Padding","wixapps.core.layouts.Spacing"],Class:{_anchor:null,_width:null,_model:null,_elements:null,_lines:null,_defaults:null,initialize:function(e){this._anchor=Array.contains(Constants.FlowLayout.Anchors.ALL,e)?e:Constants.FlowLayout.Anchors.TOP_LEFT,this._defaults={spacing:new this.imports.Spacing(5),padding:new this.imports.Padding(0)}},setModel:function(e,t){this._model=Object.clone(e),this._elements=t.slice(),this._buildLines()},getHeight:function(){return this._lines.height},_getSpacing:function(){return this._model.spacing?new this.imports.Spacing(this._model.spacing):this._defaults.spacing},_getPadding:function(e){return e.padding?new this.imports.Padding(e.padding):this._defaults.padding},positionElements:function(e,t,n){e=e||this.getHeight(),t=t||0,n=n||0;var r=this._getSpacing(),i=0;for(var s=0;s<this._lines.length;s++){var o=this._lines[s],u=0+(o.align=="default"?0:o.align=="center"?Math.floor((this._model.minWidth-o.width)/2):this._model.minWidth-o.width);for(var a=0;a<o.items.length;a++){var f=o.items[a],l=o.elements[a];this._positionElement(e,t,n,f,l,u,i,o.height),u+=o.widths[a]+r.horizontal}i+=o.height+r.vertical}},_positionElement:function(e,t,n,r,i,s,o,u){var a=r.vAlign||"bottom";this._anchor.indexOf("bottom")>-1&&(a=="bottom"?a="top":a=="top"&&(a="bottom"));var f=this._getPadding(r);a=="middle"&&(o+=Math.floor((u-f.getPaddedHeight(i))/2)),a=="bottom"&&(o+=u-f.getPaddedHeight(i)),this._anchor.indexOf("bottom")>-1&&(o=e-(o+f.getPaddedHeight(i))),this._anchor.indexOf("right")>-1&&(s=this._model.minWidth-(s+f.getPaddedWidth(i))),i.setPos(t+s+f.left,n+o+f.top)},_buildLines:function(){var e=function(){return{height:0,width:0,items:[],elements:[],widths:[]}},t=[e()],n=this._getSpacing();for(var r=0;r<this._model.items.length;r++){var i=this._elements[r],s=this._model.items[r],o=this._getPadding(s),u=s.minWidth!==undefined?new this.imports.Width(s.minWidth):new this.imports.Width(this._elements[r].getWidth()),a=s.maxWidth!==undefined?new this.imports.Width(s.maxWidth):u,f=t[t.length-1],l=f.items.length>0?n.horizontal:0;f.width+l+u.toAbsolute(this._model.minWidth)>this._model.minWidth&&(f=e(),t.push(f),l=0);var c=Math.min(Math.max(a.toAbsolute(this._model.minWidth),u.toAbsolute(this._model.minWidth)),this._model.minWidth-(f.width+l));o.getPaddedWidth(i)!=c&&i.setWidth(c-o.getHorizontalPadding());if(f.items.length===0){var h=this._anchor.indexOf("left")!=-1?"left":"right",p=s.align?s.align:h;f.align=p==h?"default":p=="center"?"center":"opposite"}f.items.push(s),f.elements.push(i),f.widths.push(c),f.width+=l+c;var d=o.getPaddedHeight(i);d>f.height&&(f.height=d),(s.last===!0||s.last==="true")&&t.push(e())}t[t.length-1].items.length===0&&t.pop();var v=0;for(var m=0;m<t.length;m++)v+=t[m].height;t.height=v+Math.max(t.length-1,0)*n.vertical,this._lines=t}}}),define.oldClass({name:"wixapps.core.layouts.FourWayFlowLayout",imports:["wixapps.core.layouts.Spacing","wixapps.core.layouts.FlowLayout"],Class:{_model:null,_elements:null,_layouts:{},_spacing:null,setModel:function(e,t){this._model=Object.clone(e),this._elements=t.slice(),this._spacing=new this.imports.Spacing(e.spacing!==undefined?e.spacing:5);var n={},r={},i=function(t){var r=n[t];return r||(r={minWidth:e.minWidth,spacing:this._spacing.toString(),items:[]},n[t]=r),r}.bind(this),s=function(e){var t=r[e];return t||(t=[],r[e]=t),t};this._model.items.forEach(function(e,n){var r=Object.clone(e),o=r.anchor||Constants.FlowLayout.Anchors.TOP_LEFT;delete r.anchor,i(o).items.push(r),s(o).push(t[n])}.bind(this)),Constants.FlowLayout.Anchors.ALL.forEach(function(e){if(n[e]){var t=new this.imports.FlowLayout(e);t.setModel(n[e],r[e]),this._layouts[e]=t}else this._layouts[e]={getHeight:function(){return 0},positionElements:function(e,t,n){}}}.bind(this))},getHeight:function(){var e=Constants.FlowLayout.Anchors,t=function(e,t){var n=e.getHeight(),r=t.getHeight();return n+r+(n>0&&r>0&&this._spacing.vertical>0?this._spacing.vertical:0)}.bind(this);return Math.max(t(this._layouts[e.TOP_LEFT],this._layouts[e.BOTTOM_LEFT]),t(this._layouts[e.TOP_RIGHT],this._layouts[e.BOTTOM_RIGHT]),this._model.minHeight||0)},positionElements:function(e,t,n){e=e||this.getHeight(),t=t||0,n=n||0,Constants.FlowLayout.Anchors.ALL.forEach(function(r){this._layouts[r].positionElements(e,t,n)}.bind(this))}}}),define.oldClass({name:"wixapps.core.layouts.Padding",imports:[],Class:{top:0,right:0,bottom:0,left:0,initialize:function(e){this.setFromString(e)},setFromString:function(e){var t=e.toString().split(/\s+/);t.length>0&&(this.top=this.bottom=this.right=this.left=parseInt(t[0],10)),t.length>1&&(this.right=this.left=parseInt(t[1],10)),t.length>2&&(this.bottom=parseInt(t[2],10)),t.length>3&&(this.left=parseInt(t[3],10))},getHorizontalPadding:function(){return this.left+this.right},getVerticalPadding:function(){return this.top+this.bottom},getPaddedWidth:function(e){return e.getWidth()+this.right+this.left},getPaddedHeight:function(e){return e.getHeight()+this.top+this.bottom}}}),define.oldClass({name:"wixapps.core.layouts.Spacing",imports:[],Class:{horizontal:0,vertical:0,initialize:function(e){this.setFromString(e)},setFromString:function(e){var t=e.toString().split(/\s+/);t.length>0&&(this.horizontal=this.vertical=parseInt(t[0],10)),t.length>1&&(this.vertical=this.left=parseInt(t[1],10))},toString:function(){return this.horizontal.toString()+" "+this.vertical.toString()}}}),define.Const("SuperFlowLayout",{Regions:{NORTH:"north",SOUTH:"south",EAST:"east",WEST:"west",CENTER:"center",ALL:["north","south","east","west","center"]}}),define.oldClass({name:"wixapps.core.layouts.SuperFlowLayout",imports:["wixapps.core.layouts.FourWayFlowLayout"],Class:{_model:null,_elements:null,_widths:{},_heights:{north:0,middle:0,south:0},_layouts:{},setModel:function(e,t){this._model=Object.clone(e),this._elements=t.slice();var n=Constants.SuperFlowLayout.Regions,r={};n.ALL.forEach(function(e){r[e]=this._model.regions&&this._model.regions[e]&&this._model.regions[e].minWidth||0}.bind(this)),this._widths={};var i=r[n.EAST]+r[n.CENTER]+r[n.WEST],s=Math.max(r[n.NORTH],r[n.SOUTH],i,this._model.minWidth||0);this._widths[n.NORTH]=this._widths[n.SOUTH]=s,this._widths[n.EAST]=r[n.EAST],this._widths[n.WEST]=r[n.WEST],this._widths[n.CENTER]=s-(r[n.EAST]+r[n.WEST]);var o={},u={},a=function(e){var t=o[e];if(!t){t={minWidth:this._widths[e],items:[]};var n=this._model.regions&&this._model.regions[e];n&&(n.spacing!==undefined&&(t.spacing=n.spacing),n.minHeight!==undefined&&(t.minHeight=n.minHeight)),o[e]=t}return t}.bind(this),f=function(e){var t=u[e];return t||(t=[],u[e]=t),t};this._model.items.forEach(function(e,r){var i=Object.clone(e),s=i.region||n.CENTER;delete i.region,a(s).items.push(i),f(s).push(t[r])}.bind(this)),n.ALL.forEach(function(e){if(o[e]){var t=new this.imports.FourWayFlowLayout;t.setModel(o[e],u[e]),this._layouts[e]=t}else this._layouts[e]={getHeight:function(){return 0},positionElements:function(e,t,n){}}}.bind(this)),this._heights.north=this._layouts[n.NORTH].getHeight(),this._heights.south=this._layouts[n.SOUTH].getHeight(),this._heights.middle=Math.max(this._layouts[n.CENTER].getHeight(),this._layouts[n.EAST].getHeight(),this._layouts[n.WEST].getHeight())},getHeight:function(){return this._heights.north+this._heights.middle+this._heights.south},positionElements:function(e,t,n){e=e||this.getHeight(),t=t||0,n=n||0;var r=Constants.SuperFlowLayout.Regions,i=this._layouts,s=i[r.NORTH],o=i[r.SOUTH],u=i[r.EAST],a=i[r.WEST],f=i[r.CENTER],l=t,c=n;s.positionElements(this._heights.north,l,c),c+=this._heights.north,a.positionElements(this._heights.middle,l,c),l+=this._widths[r.WEST],f.positionElements(this._heights.middle,l,c),l+=this._widths[r.CENTER],u.positionElements(this._heights.middle,l,c),l=0,c+=this._heights.middle,o.positionElements(this._heights.south,l,c)}}}),define.oldClass({name:"wixapps.core.layouts.Width",imports:[],Class:{_kind:null,_val:null,initialize:function(e){if(e=="undefined"||e==null||!this.setFromString(e.toString()))throw"Incorrect width format: ["+e+"]"},setFromString:function(e){if(e&&/^(-?[0-9]+|[0-9]+%)$/.test(e)){var t={val:parseInt(e,10),kind:"exact"};return e.indexOf("-")!=-1&&(t.kind="offset"),e.indexOf("%")!=-1&&(t.kind="percent"),this._kind=t.kind,this._val=t.val,!0}return!1},toAbsolute:function(e){return this._kind=="offset"?e+this._val:this._kind=="percent"?Math.floor(e*this._val/100):this._val}}}),define.Const("DataEditingModel",{ContainmentOptions:{NONE:"none",DIRECT:"direct",ONE_TO_MANY_REFERENCE:"one-2-many-ref",MANY_TO_MANY_REFERENCE:"many-2-many-ref"}}),define.oldClass({name:"wixapps.core.logics.AbstractDataEditingModel",imports:[],Class:{Binds:[],initialize:function(e){},getDataService:function(){},getTypesManager:function(){},getCategories:function(){},getCategorySections:function(e){},getAddNewTypesInCategory:function(e){},getAddNewTypesToParent:function(e){},getQueryItems:function(e,t,n){},loadTree:function(e,t,n){},getTreeTopLevelItems:function(e,t,n){},getTreeChildren:function(e,t,n){},getChildren:function(e){},getContainmentOptions:function(e,t){},removeChild:function(e,t){},insertChild:function(e,t,n,r){},createItem:function(e,t){},copyItem:function(e){},getCollectionOfItem:function(e){},deleteItem:function(e){}}}),define.oldClass({name:"wixapps.core.logics.CategoryLogic",imports:[],Class:{Extends:"wixapps.core.logics.SingleItemLogic",Binds:[],_dsp:function(e,t){return this._environment.getAppInstance().getDescriptorValue(["dataEditing","logicParams","dataSelection",e])||t},_getDescriptorValue:function(e){return this._environment.getAppInstance().getDescriptorValue(e)},generateDataSelectorPanel:function(e,t,n){this.generateSelectionList(e,t,n)},generateSelectionList:function(e,t,n,r,i){var s=this._getItemsCollection(n),o=this._dsp("categoriesSelectionFilter",null),u=this._dsp("categoriesSelectionSort",null),a=this._dsp("categoriesSelectionSkip",null),f=this._dsp("categoriesSelectionLimit",null);this._environment.getDataService().query(s,o,u,a,f,function(r){var s;if(r.length===0)e.addLabel(this._dsp("noCategoriesLabel","No categories found")),s=this._dsp("addFirstCategoryLabel","Create a new category");else{e.addLabel(this._dsp("inlineHelp","Pick which category you'd like to appear and click OK.")),s=this._dsp("anotherCategoryLabel","No thanks, I'd like to create a new category");var o=this._generateCategoriesComboSection(r,e,t,n);o.runWhenReady(function(e){i&&i.apply(this,[e])})}var u=e.addButtonField(null,s,null,null,"withArrow");u.addEvent(Constants.CoreEvents.CLICK,function(){this._createNewListAndSelect(e,t,n)}.bind(this))}.bind(this))},_createCategoryListData:function(e){var t=this._getItemsCollection(this._logicParams),n=[],r;for(var i=0;i<e.length;i++)r=e[i].getValue(),n.push({value:t+"/"+r._iid,label:r.title});return n},_generateCategoriesComboSection:function(e,t,n,r){return t.addBreakLine(20),this._generateCategoriesCombo(e,t,n,r)},_generateCategoriesCombo:function(e,t,n,r){var i=this._createCategoryListData(e),s=t.addComboBoxField("",i);s.addEvent("inputChanged",function(e){this._changeSelectedCategory(n,e.value)}.bind(this));if(r.collectionId&&r.itemId){var o=r.collectionId+"/"+r.itemId,u=-1;for(var a=0;a<i.length;a++)if(i[a].value==o){u=a;break}u!=-1?s.setValue(o):i.length>0&&this._changeSelectedCategory(n,i[0].value)}return s},_createNewListAndSelect:function(e,t,n){var r=e.injects();if(r.Config.siteNeverSavedBefore())r.EditorDialogs.openWixAppsSiteMustBeSaved();else{var i=this._dsp("newItemType","Category"),s=this._dsp("newItemCollection","Categories"),o=this.getDataEditingModel().getItemTemplate(i,!0),u=this._dsp("newItemOverrides",{title:"New Category"});Object.each(u,function(e,t){o.getChildByRef(t).setValue(e)}),this._environment.getDataService().createItem(s,o,function(n){this._changeSelectedCategory(t,s+"/"+n.getChildValue("_iid")),e._dialogWindow.closeDialog(),r.Commands.executeCommand("WAppsEditorCommands.OpenEditDataDialog",{selectedComp:this._environment.getAppPart()})}.bind(this),function(e){r.EditorDialogs.openErrorDialog(this._dsp("newItemErrorTitle","Error creating new category"),this._dsp("newItemErrorDescription","Please try again in a few minutes"),e.code+"\n"+e.description,null)}.bind(this))}},_changeSelectedCategory:function(e,t){this._fixingItemNotFound=!1;var n=e.get("appLogicParams"),r=t.split("/")[0],i=t.split("/")[1],s={};s=Object.merge(s,e._data),n.itemId={type:"AppPartParam",value:i},n.collectionId={type:"AppPartParam",value:r};var o={};o=Object.merge(o,e._data),e.fireDataChangeEvent(undefined,o,s)},getSelectedIId:function(e,t){return t.itemId},getDataEditingMetaInfo:function(){var e=this._environment.getAppInstance(),t=e.getDescriptorValue(["dataEditing","dataSelectionLabel"])||"Choose Category",n=e.getDescriptorValue(["dataEditing","dataEditingLabel"])||"Edit Data",r=this._environment.getAppPart().getPartDef().name,i=this._logicParams?this._environment.getDataService().deReference(this._logicParams.collectionId,this._logicParams.itemId):null;return i&&(r=r+" - "+i.getChildValue("title"),r.length>35&&(r=r.substr(0,35)+"...")),{title:r,hasDataEdit:!0,hasDataSelection:!0,dataSelectionLabel:t,dataEditingLabel:n}}}}),define.oldClass({name:"wixapps.core.logics.DescriptorDataEditingModel",imports:["wixapps.core.logics.AbstractDataEditingModel"],Class:{Binds:[],_logicEnv:null,_descriptor:null,_categories:[],_sectionsByCat:{},_addNewByCat:{},_sections:{},_trees:{},initialize:function(e){this._logicEnv=e,this._descriptor=e.getAppInstance().getAppDescriptor(),this._parse()},getDataService:function(){return this._logicEnv.getDataService()},getTypesManager:function(){return this._logicEnv.getTypesManager()},getCategories:function(){return this._categories},getDataEditingHelpId:function(){return this._getDescriptorValue(["dataEditing","helpId"])},getItemEditingHelpId:function(){return this._getDescriptorValue(["dataEditing","itemEditingHelpId"])},getPotentialParentsTree:function(e,t){var n=this._getDescriptorValue(["dataEditing","typeMetaData",e,"parentsTreeId"]);this.loadTree(n,function(){t(this.getFullTree(n))}.bind(this))},getCategorySections:function(e){return this._sectionsByCat[e]},getCategoryHeight:function(e){var t=this._getDescriptorValue(["dataEditing","categories"]);for(var n=0;n<t.length;n++)if(t[n].name==e)return t[n].height},getAddNewTypesInCategory:function(e){return this._addNewByCat[e]||[]},getAddNewTypesToParent:function(e){var t=this._getDescriptorValue(["dataEditing","typeMetaData",e.getTypeName(),"addChildrenTypes"]);if(t)return t;var n=this._getChildrenTypeField(e.getTypeName());if(n){var r=this.getTypesManager(),i=r.getArrayAllowedTypes(n.type),s=[];for(var o=0;o<i.length;o++){var u=r.isRef(i[o])?r.getReferredType(i[o]):i[o];s.contains(u)||s.push(u),s.combine(r.getExtendingTypes(u))}return s}return[]},getQueryItems:function(e,t){var n=function(e,n){t(e)},r=function(e){throw e};this.getDataService().query(e.collectionId,e.filter,e.sort,e.skip,e.limit,n,r)},getQueryNoResultsMessage:function(e){return e.noResultsMessage||"No items"},loadTree:function(e,t){var n=function(e,n){t(e)},r=function(e){throw e},i=this._getDescriptorValue(["dataEditing","trees",e]),s=i.collectionId,o=i.topLevelSorting||{};this.getDataService().query(s,{},o,0,null,n,r)},getTreeTopLevelItems:function(e){var t=this._getDescriptorValue(["dataEditing","trees",e]),n=t.collectionId,r=t.topLevelSorting||{};return this.getDataService().queryCache(n,{},r,0,-1).items},getTreeChildren:function(e,t){var n=this._getChildrenTypeField(t.getTypeName());if(!n)return[];var r=this._getDescriptorValue(["dataEditing","trees",e]),i=r.includedTypes||[],s=t.getChildByRef(n.name),o=[];return s.getChildren().forEach(function(e){i.contains(e.getTypeName())&&o.push(e)}),o},getFullTree:function(e){var t=this.getTreeTopLevelItems(e),n=[];for(var r=0;r<t.length;r++)n.push({title:t[r].getChildValue("title"),item:t[r],children:this._getTreeChildrenRecursive(e,t[r])});return n},getNoChildrenForItemMessage:function(e){return this._getDescriptorValue(["dataEditing","typeMetaData",e,"noChildrenMessage"])||"No Items"},_getTreeChildrenRecursive:function(e,t){var n=[],r=this.getTreeChildren(e,t);for(var i=0;i<r.length;i++)n.push({title:r[i].getChildValue("title"),item:r[i],children:this._getTreeChildrenRecursive(e,r[i])});return n},getChildren:function(e){var t=this._getChildrenTypeField(e.getTypeName());if(!t)return[];var n=e.getChildByRef(t.name);return n.getChildren()},getContainmentOptions:function(e,t){return this.getContainmentOptionsByTypeNames(e.getTypeName(),t.getTypeName())},getContainmentOptionsByTypeNames:function(e,t){var n=this._getChildrenTypeField(e);if(!n)return[];var r=this.getTypesManager().getArrayAllowedTypes(n.type),i=[],s=this.getTypesManager();for(var o=0;o<r.length;o++){var u;if(s.isOf(t,r[o]))u=Constants.DataEditingModel.ContainmentOptions.DIRECT,i.contains(u)||i.push(u);else if(s.isOf(t,s.getReferredType(r[o]))){var a=this._getParentTypeField(t);u=a&&!s.isArray(a.type)?Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE:Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE,i.contains(u)||i.push(u)}}return i},getContainmentType:function(e,t){var n=this.getTypesManager();t.isRef()&&(t=t.getReferencedDataItem());var r=this.getChildren(e);for(var i=0;i<r.length;i++){var s=r[i];if(s===t)return Constants.DataEditingModel.ContainmentOptions.DIRECT;if(s.isRef()&&s.getReferencedDataItem()===t){var o=this._getParentTypeField(t.getTypeName());return o&&!n.isArray(o.type)?Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE:Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE}}return null},getItemBreadCrumbs:function(e){var t="",n=this.getItemParents(e);return n.length==1&&(t=n[0].getChildValue("title")+"/"),t+=e.getChildValue("title"),t},getItemParents:function(e){var t=this._getParentTypeField(e.getTypeName());if(!t){var n=e.getParent()&&e.getParent().getParent();return n?[n]:[]}var r=e.getChildByRef(t.name);return r.getValue()==null?[]:this.getTypesManager().isArray(r.getTypeName())?r.getChildren():[r]},getChildContainmentOptions:function(e){var t=this._getParentTypeField(e);return t?this._getFieldAcceptableTypes(t):this._getContainmentOptions(e)},removeChild:function(e,t){var n=this._getChildrenTypeField(e.getTypeName());if(n){var r=e.getChildByRef(n.name);this._removeFromArray(r,t)}var i=this._getParentTypeField(t.getTypeName());if(i){var s=t.getChildByRef(i.name);if(this.getTypesManager().isArray(s.getTypeName()))this._removeFromArray(s,e);else if(this._areDataItemsEqual(s,e)){var o={_type:i.type,collectionId:Constants.DataItem.VOID_REF,itemId:Constants.DataItem.VOID_REF};s.setValue(o)}}return t},insertChild:function(e,t,n,r){var i=this._getChildrenTypeField(e.getTypeName());if(!i)throw"child ["+t+"] cannot be added to parent ["+e+"] because parent has no children field definition in descriptor";var s=e.getChildByRef(i.name),o=t;if(n==Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE||n==Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE){var u=this.getCollectionOfItem(t);if(!u)throw"CollectionId for child ["+t+"] is unknown";o={_type:"wix:Ref<"+t.getTypeName()+">",collectionId:u,itemId:t.getChildValue("_iid")};var a=this._getParentTypeField(t.getTypeName());if(a){var f=this.getCollectionOfItem(e),l={_type:"wix:Ref<"+e.getTypeName()+">",collectionId:f,itemId:e.getChildValue("_iid")};if(n==Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE){var c=t.getChildByRef(a.name);c.addChild(l)}else{var h=t.getChildByRef(a.name);h.setValue(l)}}}s.addChild(o,r)},getItemTemplate:function(e,t){var n=Object.clone(this._getDescriptorValue(["dataEditing","typeMetaData",e,"newItemTemplate"]));n._type=e,t&&(n._iid=this._generateId());var r=this.getDataService().getDataItemFactory().createDataItem(n);return this.getTypesManager().applyDefaults(r)},getItemDefaultCollection:function(e){return this._getDescriptorValue(["dataEditing","typeMetaData",e,"collectionId"])},getItemDefaultNewChild:function(e){return this._getDescriptorValue(["dataEditing","typeMetaData",e,"defaultChildType"])},getTypeFriendlyName:function(e){return this._getDescriptorValue(["dataEditing","typeMetaData",e,"friendlyName"])},copyItem:function(e,t){var n=Object.clone(e.getValue(0));n._iid=this._generateId(),delete n._hash;var r=this.addToCache(t,n);return r.setDirty(),r},copyDependentItem:function(e){var t=Object.clone(e.getValue(0));return this._logicEnv.getDataItemFactory().createDataItem(t)},addToCache:function(e,t){var n=this.getDataService().getItemCache(),r=t._iid;return n.put(n.key(e,r),t)},deleteItem:function(e){},getCollectionOfItem:function(e){var t=e.getChildValue("_iid");if(!t)return null;var n=this._descriptor.collections;e.isRef()&&(e=e.getReferencedDataItem());for(var r=0;r<n.length;r++)if(this.getDataService().deReference(n[r].id,t)===e)return n[r].id;return null},_areDataItemsEqual:function(e,t){return e.isRef()&&(e=e.getReferencedDataItem()),t.isRef()&&(t=t.getReferencedDataItem()),e===t},_removeFromArray:function(e,t){var n=e.getChildren();for(var r=0,i=0;r<n.length;r++,i++){var s=n[r];this._areDataItemsEqual(s,t)&&(e.deleteChild(i),i--)}},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_generateId:function(){var e=this._CHARS,t=[],n=0,r;for(var i=0;i<36;i++)i==8||i==13||i==18||i==23?t[i]="-":i==14?t[i]="4":(n<=2&&(n=33554432+Math.random()*16777216|0),r=n&15,n>>=4,t[i]=e[i==19?r&3|8:r]);return t.join("")},_getFieldAcceptableTypes:function(e){var t,n=[];if(this.getTypesManager().isArray(e.type)){t=this.getTypesManager().getArrayAllowedTypes(e.type);for(var r=0;r<t.length;r++)n.push(this.getTypesManager().getReferredType(t[r]));return{relation:Constants.DataEditingModel.ContainmentOptions.MANY_TO_MANY_REFERENCE,types:n}}return n.push(this.getTypesManager().getReferredType(e.type)),{relation:Constants.DataEditingModel.ContainmentOptions.ONE_TO_MANY_REFERENCE,types:[n]}},_getContainmentOptions:function(e){var t=this._getDescriptorValue(["dataEditing","childrenField"]),n,r=[];for(var i in t){var s=this._getChildrenTypeField(i);n=this._getFieldAcceptableTypes(s).types,n.contains(e)&&r.push(i)}return r.length===0?{relation:Constants.DataEditingModel.ContainmentOptions.NONE}:{relation:Constants.DataEditingModel.ContainmentOptions.DIRECT,types:r}},_getChildrenTypeField:function(e){var t=this._getDescriptorValue(["dataEditing","typeMetaData",e,"childrenField"]);if(t){var n=this.getTypesManager();return n.getField(n.getType(e),t)}return null},_getParentTypeField:function(e){var t=this._getDescriptorValue(["dataEditing","typeMetaData",e,"parentField"]);if(t){var n=this.getTypesManager();return n.getField(n.getType(e),t)}return null},_getDescriptorValue:function(e){return this._logicEnv.getAppInstance().getDescriptorValue(e)},_getCollectionAllowedTypes:function(e){var t=this._descriptor.collections||[];for(var n=0;n<t.length;n++)if(t[n].id==e)return t[n].allowedTypes;return[]},_parse:function(){var e=this._getDescriptorValue(["dataEditing","categories"])||{};for(var t=0;t<e.length;t++){var n=e[t].name;this._categories.push(n),this._sectionsByCat[n]=e[t].items||[];for(var r=0;r<this._sectionsByCat[n].length;r++){var i=this._sectionsByCat[n][r];this._sections[n+"/"+i.name]=i}e[t].newTypes&&(this._addNewByCat[n]=e[t].newTypes)}}}}),define.oldClass({name:"wixapps.core.logics.LogicBase",imports:[],Class:{Binds:[],_environment:null,initialize:function(e){this._environment=e},run:function(e,t,n){},getDataEditingModel:function(){},getDataEditingMetaInfo:function(){return{title:"",hasDataSelection:!1,dataSelectionLabel:"",dataEditingLabel:"",hasDataEdit:!0}},_getLastTenItems:function(){return[]},getLastTenItemsZoomParams:function(e,t,n,r){this._getLastTenItems(e,function(e){r=r||"title",n=n||"_iid";if(e.length===0)return{list:[],selectedIndex:0};var i=e[0].getValue()[n],s=e.map(function(e){return{id:e.getChildByRef(n).getValue(),title:e.getChildByRef(r).getValue()}}),o=s.getIndexByField("id",i);t({list:s,selectedIndex:o})})},sendEmail:function(e,t,n,r,i,s,o,u,a){var f={to:e,cc:t,bcc:n,from:r,subject:i,htmlMessage:s,plainTextMessage:o,metaSiteId:u},l=this.injects(),c=l.Config.getServiceTopologyProperty("emailServer"),h=this._isPreviewMode();h&&(c+="Secured");var p=[];p.push(c),p.push("?accept=json&contentType=json"),p.push("&appUrl="+encodeURIComponent(window.location.href)),h&&p.push("&wixSession="+l.CookiesManager.getCookie("wixSession")),this._sendJsonCORS(p.join(""),f,"POST",a)},_sendJsonCORS:function(url,data,method,onComplete){var createXHR=function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?(n.open(e,t,!0),n.withCredentials="true"):typeof XDomainRequest!="undefined"&&(n=new XDomainRequest,n.open(e,t),n.setRequestHeader=function(e,t){}),n},parseResponseJSON=function(responseText){if(!xhr.responseText)return{success:!1,errorDescription:"Invalid ajax response, no responseText",errorCode:-9001};var parser=JSON.parse?JSON.parse:eval;try{return parser(responseText)}catch(e){return{success:!1,errorDescription:"Invalid JSON object",errorCode:-9e3}}},errorToString=function(e){return e.errorDescription+" ("+e.errorCode+")"},xhr=createXHR(method,url);xhr.onabort=function(){onComplete(!1,"request aborted")},xhr.ontimeout=function(){onComplete(!1,"request timeout")},xhr.onerror=function(){onComplete(!1,errorToString(parseResponseJSON(xhr.responseText)))},xhr.onload=function(){var e=parseResponseJSON(xhr.responseText);onComplete(e.success,e.success?e:errorToString(e))},xhr.setRequestHeader("Content-Type","application/json"),xhr.send(JSON.encode(data))},_isPreviewMode:function(){return this.injects().Viewer.getViewMode()!="site"}}}),define.Class("wixapps.core.logics.SingleItemLogic",function(e){var t=e;t.inherits("wixapps.core.logics.LogicBase"),t.binds(["onSuccess","onFailure","_validateAfterSave"]),t.utilize(["wixapps.core.logics.DescriptorDataEditingModel"]),t.fields({_environment:null,_logicParams:null,_fixingItemNotFound:!1}),t.methods({initialize:function(e){this._environment=e,this._environment.getAppInstance().addEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._validateAfterSave)},getSelectedIId:function(e,t){return t.itemId},run:function(e,t,n){var r=this._environment;this._viewName=e,this._callBacks=n,this._logicParams=t;if(!t.collectionId||!t.itemId){this.onFailure({description:"'collectionId' and 'itemId' should be defined",code:-1});return}var i=r.getDataService().readItemFromCache(t.collectionId,t.itemId);i?this.onSuccess(i):(r.getDataService().readItem(t.collectionId,t.itemId,this.onSuccess,this.onFailure),this._showLoading(n))},onSuccess:function(e){var t=this._environment,n=t.getTypesManager(),r=t.getProxyFactory();n.applyDefaults(e);var i=r.createView(e,this._viewName);this._onBeforeItemRendered(i),this._callBacks.showProxy(i)},onFailure:function(e){this._logicParams["wixapps:first-load-after-add-to-stage"]===!0&&e.code==-1021?this._fixItemNotFound():this._showError(this._callBacks,e)},_validateAfterSave:function(){var e=this._logicParams,t=this._environment.getDataService().readItemFromCache(e.collectionId,e.itemId);t||this.onFailure({code:-1021,description:"Item not found"})},_fixItemNotFound:function(){this._fixingItemNotFound=!0;var e=this._getItemsCollection(this._logicParams),t=function(t){if(this._fixingItemNotFound){this._fixingItemNotFound=!1;if(t.length===0){this.onFailure({description:"No items found in collection "+e,code:-1});return}var n=t[0],r=n.getChildValue("_iid");if(!r){this.onFailure({description:"New selected item id not found",code:-1});return}var i=this._environment.getAppPart().getDataItem().get("appLogicParams");i.itemId={type:"AppPartParam",value:r},this._environment.getAppPart().getDataItem().fireDataChangeEvent()}}.bind(this),n=function(e){this._fixingItemNotFound&&(this._fixingItemNotFound=!1,this._showError(this._callBacks,e))}.bind(this);this.getDataEditingModel().getDataService().query(e,{},{_updatedAt:-1},0,-1,t,n)},_getItemsCollection:function(e){return e.collectionId},getDataEditingModel:function(){return new this.imports.DescriptorDataEditingModel(this._environment)},_getLastTenItems:function(e,t){var n=this.getDataEditingModel().getItemDefaultCollection(e);this.getDataEditingModel().getDataService().query(n,{_type:e},{_updatedAt:-1},0,10,t)},_onBeforeItemRendered:function(e){},_showLoading:function(e){e.showLoadingIndicator()},_getResourceSync:function(e){var t=null;return this.resource.getResourceValue("W.Viewer",function(e){t=e}),t},_showError:function(e,t){var n=Object.clone(t);n._type="Error";var r=this._environment.getProxyFactory(),i=this._getResourceSync("W.Viewer").isPublicMode()?"ErrorInPublished":"ErrorInEditor";if(r.getViewDefinition(n._type,i)){var s=r.createView(this._environment.getDataItemFactory().createDataItem(n),i);e.showProxy(s)}else e.showErrorIndicator(t.code,t.description)},dispose:function(){this._environment.getAppInstance().removeEvent(Constants.WixAppEvents.FULL_DATA_EDITOR_SAVED,this._validateAfterSave)}})}),define.oldClass({name:"wixapps.core.logics.TwoLevelCategoryLogic",imports:[],Class:{Extends:"wixapps.core.logics.CategoryLogic",Binds:[],_getItemsCollection:function(e){return this._getTopLevelCollection()},_getTopLevelItemType:function(){return this._dsp("topLevelItemType","Category")},_getMidLevelItemType:function(){return this._dsp("midLevelItemType","Section")},_getTopLevelCollection:function(){return this._dsp("topLevelCollection","Categories")},_getMidLevelCollection:function(){return this._dsp("midLevelCollection","Sections")},_generateCategoriesComboSection:function(e,t,n,r){return this._generateCategoriesCombo(e,t,n,r)},_createCategoryListData:function(e){var t=[],n;for(var r=0;r<e.length;r++){n=e[r].getValue(),t.push({value:this._getTopLevelCollection()+"/"+n._iid,label:n.title});var i=this._getDescriptorValue(["dataEditing","typeMetaData",e[r].getTypeName(),"childrenField"]),s=e[r].getChildByRef(i).getChildren();for(var o=0;o<s.length;o++){var u=s[o];u.getTypeName()==this._getMidLevelItemType()&&t.push({value:this._getMidLevelCollection()+"/"+u.getChildValue("_iid"),label:" - "+u.getValue().title})}}return t}}}),define.oldClass({name:"wixapps.core.logics.page.EventsPageLogic",imports:[],Class:{Extends:"wixapps.core.logics.page.PageLogicBase",Binds:[],_environment:null,initialize:function(e){this._environment=e},generateLinkParams:function(e){return{title:e.getChildValue("title"),params:{collectionId:this._getCollectionId(),itemId:e.getChildValue("_iid")}}},_getCollectionId:function(){return"Events"},getSampleDataItem:function(){return{collectionId:"Events",itemId:"Talk1"}},fetchSampleDataItem:function(e,t){this.fetchDataItem(this.getSampleDataItem(),e,t)},fetchDataItem:function(e,t,n){var r=this._environment.getDataService(),i=e.collectionId,s=e.itemId,o=function(e){var r=this._environment.options.acceptableTypes;!r||r.length>0||r.contains(e.getTypeName())?t(e):n({code:-10003,description:"Page expected ["+r+" ] but received "+e.getTypeName()})}.bind(this),u=function(e){n(e)}.bind(this),a=r.readItemFromCache(i,s);a?t(a):this._environment.getDataService().readItem(i,s,o,u)}}}),define.oldClass({name:"wixapps.core.logics.page.ItemFromPageLogic",imports:[],Class:{Extends:"wixapps.core.logics.page.PageDependentLogicBase",Binds:[],_environment:null,initialize:function(e){this._environment=e},_onDataLoaded:function(e){var t=this._params.acceptableTypes;if(t&&t.length>0&&!t.contains(e.getTypeName()))throw"Part expected ["+t+" ] but received "+e.getTypeName();this.parent(e)}}}),define.oldClass({name:"wixapps.core.logics.page.MenuPageLogic",imports:[],Class:{Extends:"wixapps.core.logics.page.PageLogicBase",Binds:[],_environment:null,initialize:function(e){this._environment=e},generateLinkParams:function(e){return{title:e.getChildValue("title"),params:{collectionId:this._getCollectionId(),itemId:e.getChildValue("_iid")}}},_getCollectionId:function(){return"Items"},getSampleDataItem:function(){return{collectionId:"Items",itemId:"SampleItem1"}},fetchSampleDataItem:function(e,t){this.fetchDataItem(this.getSampleDataItem(),e,t)},fetchDataItem:function(e,t,n){var r=this._environment.getDataService(),i=e.collectionId,s=e.itemId,o=function(e){var r=this._environment.options.acceptableTypes;!r||r.length>0||r.contains(e.getTypeName())?t(e):n({code:-10003,description:"Page expected ["+r+" ] but received "+e.getTypeName()})}.bind(this),u=function(e){n(e)}.bind(this),a=r.readItemFromCache(i,s);a?t(a):this._environment.getDataService().readItem(i,s,o,u)}}}),define.oldClass({name:"wixapps.core.logics.page.PageDependentLogicBase",imports:[],Class:{Binds:["_onDataLoaded"],Extends:"wixapps.core.logics.SingleItemLogic",initialize:function(e){this.parent(e)},run:function(e,t,n){this._viewName=e,this._callBacks=n,this._params=t;var r=this._environment.getAppPart().getViewNode().getParent('[comp$="AppPage"]'),i=r.getLogic(),s=this,o=function(){W.Viewer.isSiteReady()?i.registerPageAppPart(s,s._onDataLoaded):W.Utils.callLater(o)};o(),this._showLoading(n)},_onDataLoaded:function(e){this.onSuccess(e)}}}),define.oldClass({name:"wixapps.core.logics.page.PageLogicBase",imports:[],Class:{Binds:[],Extends:"wixapps.core.logics.LogicBase",generateLinkParams:function(e){},getSampleDataItem:function(){},fetchDataItem:function(e,t,n){}}}),define.oldClass({name:"wixapps.core.managers.TypesManager",imports:["wixapps.core.data.PrimitiveValidations"],Class:{Binds:[],_validator:null,_typesMap:{},_extendingTypes:{},initialize:function(){this._validator=new this.imports.PrimitiveValidations},getType:function(e){return this._typesMap[e]},getTypeName:function(e){return e.name||e._iid},registerType:function(e){var t=this.getTypeName(e);this._typesMap[t]=e;if(e.baseTypes&&typeOf(e.baseTypes)!="array")throw"Type ["+t+'] "baseTypes" field should be an array';if(e.baseTypes){for(var n=0;n<e.baseTypes.length;n++){var r=e.baseTypes[n],i=this._extendingTypes[r];i||(i=[],this._extendingTypes[r]=i),i.contains(t)||i.push(t)}var s={},o=function(e){this.getBaseTypes(e).forEach(function(e){o(e)});if(!e.fields)return;for(var n=0;n<e.fields.length;n++){var r=e.fields[n];if(s[r.name]){if(s[r.name].type!=r.type)throw"Type ["+t+"] is invalid. Field ["+r.name+"] is defined both as ["+r.type+"] and as ["+s[r.name].type+"]"}else s[r.name]=r}}.bind(this);o(e)}},removeType:function(e){var t=this._extendingTypes[e]||[];for(var n=0;n<t.length;n++){var r=t[n],i=this._typesMap[r];i.baseTypes&&i.baseTypes.erase(e)}delete this._extendingTypes[e],delete this._typesMap[e]},getExtendingTypes:function(e){var t=function(e,n){var r=this._extendingTypes[e];r&&r.forEach(function(e){t(e,n),n[e]=!0})}.bind(this),n={};return t(e,n),Object.keys(n)},getBaseTypeNames:function(e){return e&&e.baseTypes?e.baseTypes:[]},getBaseTypes:function(e){var t=[];return this.getBaseTypeNames(e).forEach(function(n){var r=this.getType(n);if(!r)throw"Base type ["+n+"] of type ["+this.getTypeName(e)+"] not found";t.push(r)}.bind(this)),t},getField:function(e,t){var n;return this._getInheritanceTreeDFS(e).forEach(function(e){if(e.fields)for(var r=0;r<e.fields.length;r++)e.fields[r].name==t&&(n=this._mergeFieldDefinitions(n,e.fields[r]))}.bind(this)),n},getFields:function(e){var t={};return this._getInheritanceTreeDFS(e).forEach(function(e){if(e.fields)for(var n=0;n<e.fields.length;n++){var r=e.fields[n].name;t[r]=this._mergeFieldDefinitions(t[r],e.fields[n])}}.bind(this)),Object.values(t)},isOf:function(e,t){var n=function(e){if(e==t)return!0;var r=this.getType(e);return this.getBaseTypeNames(r).some(function(e){return n(e,t)})}.bind(this);return n(e,t)},_getInheritanceTreeDFS:function(e){var t={},n=[],r=function(e){var i=this.getTypeName(e);t[i]||(t[i]=!0,n.push(e),this.getBaseTypes(e).forEach(r))}.bind(this);return r(e),n},_mergeFieldDefinitions:function(e,t){return e?(!e.defaultValue&&t.defaultValue&&(e.defaultValue=t.defaultValue),t.validations&&(e.validations?e.validations=e.validations.concat(t.validations):e.validations=t.validations.clone()),e):Object.clone(t)},applyDefaults:function(e){function n(e){return t[e.collectionId+"/"+e.itemId]}function r(e){t[e.collectionId+"/"+e.itemId]=!0}var t={},i=function(e){if(e.isRef()){var t=e.getValue(0);if(n(t))return e;r(t)}var s=e.getTypeName();if(this.isArray(s))return e.getChildren().forEach(function(e){i(e)}.bind(this)),e;if(this.isSimple(s))return e;var o=this.getType(s);if(!o)return e;var u=this.getFields(o);for(var a=0;a<u.length;a++){var f=u[a],l=e.getChildByRef(f.name);if(!l&&f.defaultValue!==undefined){var c=this.isSimple(f.type)?f.defaultValue:this.isArray(f.type)?Array.clone(f.defaultValue):Object.clone(f.defaultValue);e.addChild(c,f.name)}}return e.getChildrenRefs().forEach(function(t){var n=e.getChildByRef(t);i(n)}.bind(this)),e}.bind(this);return i(e)},validateDataItem:function(e){return this._validateDataItem(e,{validations:[]})},_validateDataItem:function(e,t){var n=e.getTypeName(),r=!0;if(e.isRef())return!0;if(t.validations&&t.validations.length>0){var i=e.getValue();r=this.validateValue(i,t)&&r}if(n=="Array")e.getChildren().forEach(function(e){e&&(r=this.validateDataItem(e)&&r)}.bind(this));else if(!this.isSimple(n)){var s=this.getType(n);this.getFields(s).forEach(function(t){if(t.computed!==!0){var n=e.getChildByRef(t.name);n&&(r=this._validateDataItem(n,t)&&r)}}.bind(this))}return e.fireEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,{target:e,valid:r}),r},validateValue:function(e,t){var n=t.validations||[];for(var r=0;r<n.length;r++){var i=n[r];if(!this._validator.validate(i.func,e,i.params||[]))return!1}return!0},isSimple:function(e){return e&&e.test(/^(String|Boolean|Number)$/)},isArray:function(e){return e&&e.test(/^Array(<.+>)?$/)},getArrayAllowedTypes:function(e){var t=e&&e.match(/^Array<(.+)>$/),n=[];if(t){var r=t[1];r.split(",").forEach(function(e){n.push(e.trim())})}return n},isRef:function(e){return e&&e.test(/^wix:Ref<.+>$/)},getReferredType:function(e){var t=e&&e.match(/^wix:Ref<(.+)>$/);return t&&t[1].trim()},isNative:function(e){return this.isSimple(e)||this.isArray(e)},getAllTypes:function(){return Object.values(this._typesMap)},getDefaultDataForType:function(e){if(Constants.WixAppsDefaultTypeValues.hasOwnProperty(e))return Constants.WixAppsDefaultTypeValues[e];var t=this.getBaseTypeNames(this.getType(e));for(var n=0;n<t.length;n++){var r=this.getDefaultDataForType(t[n]);if(r)return r}return undefined},getUniqueFieldName:function(e,t,n){var r=this.getType(e),i=function(e){var n=r.fields&&r.fields.some(function(n){return n.displayName===e&&n.name!==t});return!n};if(i(n))return n;var s=2;for(;!i(n+" ("+s+")");s++);return n+" ("+s+")"}}}),define.oldClass({name:"wixapps.core.utils.AppLint",imports:[],Class:{_lintRules:{},_traverseCache:{},Binds:["_traverseCompNodes","_traverseLayoutNodes"],initialize:function(){this._lintRules={layout_in_comp:{walkFunc:this._traverseCompNodes,cond:function(e){return e.comp&&e.comp.layout},message:"Layout placed inside the comp instead alongside it."},dimension_in_comp:{walkFunc:this._traverseCompNodes,cond:function(e){return e.comp&&(e.comp.width||e.comp.height)},message:'Width/height placed inside the "comp" instead of the "layout" node.'},dimensions_as_string:{walkFunc:this._traverseLayoutNodes,cond:function(e){return e.width&&typeOf(e.width)=="string"&&!String.contains(e.width,"%")||e.height&&typeOf(e.height)=="string"&&!String.contains(e.height,"%")},message:"Width/height specified as a string where integer number might be used."},hbox_flexbox_conflict:{walkFunc:this._traverseCompNodes,cond:function(e){if(e.comp&&e.comp.name==="HBox"&&e.comp.items)return Array.some(e.comp.items,function(e){return e.layout&&e.layout.width!==undefined&&e.layout["box-flex"]!==undefined})},message:'"Width" property superfluous when horizontal "box-flex" specified.'},vbox_flexbox_conflict:{walkFunc:this._traverseCompNodes,cond:function(e){if(e.comp&&e.comp.name==="VBox"&&e.comp.items)return Array.some(e.comp.items,function(e){return e.layout&&e.layout.height!==undefined&&e.layout["box-flex"]!==undefined})},message:'"Height" property superfluous when vertical "box-flex" specified.'},box_dimension_100:{walkFunc:this._traverseCompNodes,cond:function(e){if(e.comp&&e.comp.items){if(e.comp.name==="VBox")return Array.some(e.comp.items,function(e){return e.layout&&e.layout.height=="100%"});if(e.comp.name==="HBox")return Array.some(e.comp.items,function(e){return e.layout&&e.layout.width=="100%"})}},message:'Width/height set to "100%" inside HBox/VBox is rendered inconsistently across the browsers.'}}},formatResult:function(e){var t=this._getNodePath,n="* AppLint *\n";return n+=e.length+" warning(s)\n",n+"	"+Array.map(e,function(e){return e.message+"\n"+e.nodes.map(function(e){return"		"+t(e)}).join("\n")}).join("\n	")},lintDescriptor:function(e){var t=this;return e=this._mapRelationships(e),this._traverseCache={},Object.values(this._lintRules).map(function(n){return t._applyRule(n,e)}).filter(function(e){return e})},_applyRule:function(e,t){var n=e.walkFunc(t).filter(e.cond);if(n.length>0)return{nodes:n,message:e.message}},_getNodePath:function(e){var t=[];while(e)t.push(e),e=e._parent;return t.map(function(e){return Object.keys(e).filter(function(e){return["name","id","_iid","forType"].contains(e)}).map(function(t){return e[t]}).join(", ")}).filter(function(e){return e}).reverse().join(" > ")},_memoize:function(e,t){return e in this._traverseCache||(this._traverseCache[e]=t()),this._traverseCache[e]},_traverseCompNodes:function(e){var t=function(e){var n=[];return typeOf(e)==="array"?Array.forEach(e,function(e){n=n.concat(t(e))}):(typeOf(e)==="object"&&n.push(e),e.comp&&e.comp.items&&e.comp.items.forEach(function(e,r){n=n.concat(t(e))}),e.comp&&e.comp.cases&&Object.each(e.comp.cases,function(e){n=n.concat(t(e))}),e.comp&&e.comp.columns&&e.comp.name=="Table"&&e.comp.columns.forEach(function(e){Array.forEach(["item","header","footer"],function(r){e[r]!==undefined&&(n=n.concat(t(e[r])))})})),n};return t(e.views)},_traverseLayoutNodes:function(e){return this._traverseCompNodes(e).map(function(e){return e.layout}).filter(function(e){return e})},_mapRelationships:function(e){var t=function(e,n){var r=typeOf(e);(r=="object"||r=="array")&&Object.each(e,function(n){t(n,e)}),e._parent=n},n=Object.clone(e);return t(n,null),n}}}),define.utils("AppsUtils",function(){return{getTimeBasedUniqueId:function(e){return e=e?e.replace(/[^A-Za-z0-9_-]/g,""):"",e+(new Date).getTime().toString(36)},getType:function(e){return Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}}}),define.oldClass({name:"wixapps.core.utils.DataTypesUtils",imports:[],traits:[],Class:{Extends:Object,Binds:[],_wixTypeMap:{string:"String",number:"Number","boolean":"Boolean",object:"wix:Object"},_typeDefaultValues:{String:"",Number:0,Boolean:!0},initialize:function(){},generateTypeDefinitionFromData:function(e,t,n){var r=Object.keys(t).map(function(e){var r=this._wixTypeMap[typeOf(t[e])],i=n?t[e]:this._typeDefaultValues[r];return{_type:"wix:Field",name:e,type:r,defaultValue:i}}.bind(this)).filter(function(e){return Boolean(e.type)});return{_iid:e,_type:"wix:Type",fields:r}}}}),define.component("wixapps.core.utils.ListCursor",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.traits([]),t.skinParts({}),t.states(),t.dataTypes(),t.fields({_currentItemIndex:-1}),t.methods({initialize:function(e,t){this._data=e,t<0?this.removeSelection():this.setSelectedIndex(t)},next:function(){this.setSelectedIndex(this._currentItemIndex+1)},prev:function(){this.setSelectedIndex(this._currentItemIndex-1)},last:function(){this.setSelectedIndex(this._getItemsLength()-1)},_getItemsLength:function(){return this._data.getChildren().length},setSelectedIndex:function(e,t){var n=this._currentItemIndex,r=this._getItemsLength();r===0?this._currentItemIndex=-1:e>=r?this._currentItemIndex=0:e<0?this._currentItemIndex=r-1:this._currentItemIndex=e,t||this.fireChangeEvent(this._currentItemIndex,n)},removeSelection:function(){this._currentItemIndex=-1},fireChangeEvent:function(e,t){this.fireEvent(Constants.WixAppEvents.SELECTED_INDEX_CHANGED,{index:e||this._currentItemIndex,oldIndex:t===undefined?-1:t})},getCurrentItemIndex:function(){return this._currentItemIndex}})}),define.Class("wixapps.core.utils.Map",function(e){var t=e;t.fields({_keys:[],_values:[]}),t.methods({get:function(e){var t=this._keys.indexOf(e);return t>-1?this._values[t]:undefined},put:function(e,t){var n=this._keys.indexOf(e);n===-1?(this._keys.push(e),this._values.push(t)):this._values[n]=t},containsKey:function(e){return this._keys.indexOf(e)>-1},containsValue:function(e){return this._values.indexOf(e)>-1},remove:function(e){var t=this._keys.indexOf(e);if(t>-1){var n=this._values[t];return this._keys.splice(t,1),this._values.splice(t,1),n}return undefined},getKeys:function(){return this._keys.concat()},getValues:function(){return this._values.concat()},getEntries:function(){return this._keys.map(function(e,t){return{key:e,value:this._values[t]}}.bind(this))},clear:function(){this._keys=[],this._values=[]}})}),define.oldClass({name:"wixapps.core.utils.WixAppsLogger",imports:[],Class:{Static:{LISTS_EVENT_SOURCE:60,Type:{ERROR:10,USER_ACTION:40},Category:{EDITOR:1,VIEWER:2,CORE:3,SERVER:4},SubCategory:{GENERAL:0,PROXY:1,APP_LOGIC:2,DATA_SERVICE:3,DATA_ITEMS:4,CORE_WIRING:5,DATA_EDITING:6,APP_BUILDER:7,APP_REPO_SERVICE:8},Severity:{RECOVERABLE:10,WARNING:20,ERROR:30,FATAL:40},Errors:{GENERIC_ERROR:{code:-2e4,description:"WixApps unspecified error"},APP_INSTANCE_NOT_LOADED:{code:-20001,description:"Application instance failed to load"},UNABLE_TO_REFRESH_AFTER_SAVE:{code:-20002,description:"Failed to update views after data save"},UNABLE_TO_LOAD_DATA_ITEM_FROM_PARAMS:{code:-20003,description:"Failed to load data item from url params"},CREATE_ITEM_CALLED_FOR_NON_NEW:{code:-20004,description:"CreateItem called with a non-new item"},UPDATE_ITEM_CALLED_FOR_NEW:{code:-20005,description:"UpdateItem called with a new item"},ITEM_NOT_FOUND:{code:-20006,description:"ReadItem called with unknown item"},WIX_DATA_PROVIDER_DOESNT_EXIST:{code:-20007,description:"Data provider wasn't found in loaded app definition"}},Events:{APP_BUILDER_SAVE:{id:1100,description:"App builder - save"},APP_BUILDER_PART_ADDED:{id:1105,description:"App builder - part added"},APP_BUILDER_FIELD_ADDED:{id:1110,description:"App builder - field added"},APP_BUILDER_PART_LOADED:{id:1115,description:"App builder - part loaded in published"},APP_BUILDER_ORGANIZE_CLICKED:{id:1120,description:"App builder - organized clicked"},APP_BUILDER_PART_ERROR:{id:1150,description:"App builder - part error"}}},reportError:function(e,t,n,r,i,s){try{var o={desc:e.description||this.Errors.GENERIC_ERROR.description,errorCode:e.code||this.Errors.GENERIC_ERROR.code,type:this.Type.ERROR,issue:r||this.SubCategory.GENERAL,severity:i||this.Severity.ERROR,category:s||this.getDefaultCategory()};LOG.reportError(o,t,n,{src:this.LISTS_EVENT_SOURCE,desc:e.description})}catch(u){}},reportEvent:function(e,t){try{var n={type:this.Type.USER_ACTION,desc:e.description,biEventId:e.id,biAdapter:"lists",category:this.getDefaultCategory()};t=t||{},t.src=this.LISTS_EVENT_SOURCE,LOG.reportEvent(n,t)}catch(r){}},getDefaultCategory:function(){return W.Viewer.isPublicMode()?this.Category.VIEWER:this.Category.EDITOR}}}),define.oldClass({name:"wixapps.core.utils.WixServiceTransportBase",imports:["wixapps.core.utils.WixAppsLogger"],Class:{_logger:null,_appInstance:null,initialize:function(e){this._appInstance=e},_getServiceUrl:function(){},getLogger:function(){return this._logger||(this._logger=new this.imports.WixAppsLogger),this._logger},doRequest:function(e,t,n,r){this._doRequestInternal(e,t,"POST",n,r)},doGetRequest:function(e,t,n,r){this._doRequestInternal(e,t,"GET",n,r)},_extractBasePath:function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.hostname},_doRequestInternal:function(e,t,n,r,i){i||(i=function(e){throw e.description+" ("+e.code+")"}),r||(r=function(e){}),n||(n="POST");var s=function(e){var t=this.getLogger();t.reportError(e,this.$className,"doRequest",t.SubCategory.DATA_SERVICE)}.bind(this),o=function(e){if(!e.success){var t={code:e.errorCode,description:e.errorDescription};s(t),i(t)}else r(e.payload)}.bind(this),u=function(e){var t={code:e.status?e.status:-1,description:e.statusText?e.statusText:"Unspecified error occurred, possibly a connection problem"};s(t),i(t)};this._postJsonRequest(e,t,n,o,u)},_postJsonRequest:function(e,t,n,r,i){var s=new Request.JSON({url:this._getServiceUrl()+e,urlEncoded:!1,onSuccess:r,onFailure:i,method:n,data:t?JSON.encode(t):""});s.options=s.options||{},s.options.headers=s.options.headers||{},s.options.headers["If-Modified-Since"]="Sat, 1 Jan 2005 00:00:00 GMT",s.options.headers["Content-Type"]="application/json; charset=utf-8",s.options.headers.Accept="application/json",s.send()}}}),define.oldClass({name:"wixapps.core.views.ProxyFactory",imports:["wixapps.core.events.ProxyEventBus","wixapps.core.views.ViewEnvironment","wixapps.core.views.ViewContext","wixapps.core.data.DataItemUtils","wixapps.core.expressions.EvalScopeWrapper","wixapps.core.views.ViewEvaluationContext"],Class:{Binds:[],_viewRepository:null,_dataItemFactory:null,_typesManager:null,_managers:null,_defaultByTypeAndMode:{},_byName:{},_eventDispatcher:null,_resourceResolverFunction:null,_lifecycleManager:null,_dataItemUtils:null,_defaultTypeForProxy:{},initialize:function(e,t,n,r,i,s,o){this._viewRepository=n,this._dataItemFactory=e,this._typesManager=t,this._eventDispatcher=r||new this.imports.ProxyEventBus,this._resourceResolverFunction=i,this._nameSpace=s,this._lifecycleManager=o,this._dataItemUtils=new this.imports.DataItemUtils},registerProxy:function(e,t,n,r){this._byName[e]=t,r=r||[],r.forEach(function(t){this._defaultByTypeAndMode[t.forType+"|"+t.forMode]=e}.bind(this)),n=n||"",this._defaultTypeForProxy[e]=n},createView:function(e,t,n){n=n||"view";var r=new this.imports.ViewEnvironment(this._dataItemFactory,this._typesManager,this,t,e.getTypeName(),n,this._eventDispatcher,[],undefined,undefined,this._lifecycleManager),i=new this.imports.ViewContext(r,e);return this._createViewInternal(i,t)},getViewDefinition:function(e,t){var n=this._viewRepository.getViewDefinition(e,t);if(n)return n;var r=this._typesManager.getBaseTypeNames(this._typesManager.getType(e));for(var i=0;i<r.length;i++){var s=this.getViewDefinition(r[i],t);if(s)return s}return undefined},hasViewDefinition:function(e,t){var n=this._viewRepository.hasViewDefinition(e,t);if(n)return!0;var r=this._typesManager.getBaseTypeNames(this._typesManager.getType(e));for(var i=0;i<r.length;i++){var s=this.hasViewDefinition(r[i],t);if(s)return!0}return!1},getDefaultProxy:function(e,t){var n=this._defaultByTypeAndMode[e+"|"+t];if(n)return n;var r=this._typesManager.getBaseTypeNames(this._typesManager.getType(e));for(var i=0;i<r.length;i++){var s=this.getDefaultProxy(r[i],t);if(s)return s}return undefined},getProxyClassByName:function(e){return this._byName[e]},_createViewInternal:function(e,t){var n=e.getData().getTypeName(),r=e.getEnvironment(),i=this.getViewDefinition(n,t);if(!i)throw"View definition ["+t+"] for type ["+n+"] is missing in the repository";var s=i.getChildValue("mode")||r.getMode()||"view",o=i.getChildByRef("comp");if(!o||!o.getChildValue("name"))throw"View definition ["+t+"] for type ["+n+"] is incorrect. Missing comp.name attribute";var u=i.getChildValue("forType");r.setViewName(t),r.setVar("viewName",t),r.setForType(u),r.setVar("viewDataType",n),r.setMode(s),r.getTreePath().pushScope(),r.addIncludedView(u,t),this._setupViewVariables(r,i),i=this.createNewEvaluationScope(i,e);var a=this.createProxyFromItemDefinition(e,i);return a.proxy},_resolveItemDataForProxy:function(e,t,n){var r=e.resolveTypeForPath(t);r||(r=this._defaultTypeForProxy[n]);if(!r)throw"Unable to resolve Type of field ["+t+"] in item ["+JSON.stringify(e.getData().getValue())+"]";var i,s=this._typesManager.getType(e.getData().getTypeName()),o=this._typesManager.getField(s,t);o&&o.hasOwnProperty("defaultValue")&&(i=this._dataItemFactory.createDataItem(o.defaultValue));if(!i){var u=this._typesManager.getDefaultDataForType(r);if(u===undefined)throw"Unable to resolve default value for type ["+r+"] it might be missing in the ProxyMap";i=this._dataItemFactory.createDataItem(u)}return i},createProxyFromItemDefinition:function(e,t){var n=t.getChildValue("id"),r=e.getEnvironment();if(!n)throw"ID not defined for an item in ["+JSON.stringify(t.getValue())+"] in view for ["+r.getForType()+"|"+r.getViewName()+"]";var i=t.getChildByRef("value"),s=e.getData(),o=this._dataItemFactory,u=t.getChildByRef("comp")||t.addChild({},"comp"),a=!0;if(i){var f=o.createDataItem(t.getChildValue("value"));t.getChildByRef("value").addEvent(Constants.DataItemEvents.CHANGE,function(){f.setValue(t.getChildValue("value"))}),s=f}else{var l=t.getChildValue("data")||"this";s=e.evaluatePath(l);if(!s){a=!1;var c=this._resolveProxyName(e.getData().getTypeName(),u,r.getViewName(),r.getForType(),r.getMode());c.type==="view"?(u=o.createDataItem({name:"Empty"}),s=o.createDataItem({})):s=this._resolveItemDataForProxy(e,l,c.name)}if(!s)throw"Evaluation of ["+l+"] on type ["+e.getData().getTypeName()+"] did not generate child context"}var h=this._createProxy(e,s,u,n);return h.setIsBound(a),{id:n,proxy:h}},_createProxy:function(e,t,n,r){var i=e.getEnvironment(),s=n.getChildValue("mode")||i.getMode(),o=t.getTypeName(),u=i.getViewName(),a=this._resolveProxyName(o,n,u,i.getForType(),s);if(!a.name)throw"Cannot resolve view/proxy for type ["+o+"] in mode ["+s+"] in context of view ["+u+"]";if(a.type=="view")return e=e.newContextForData(t),this._createViewInternal(e,a.name);n.getParent()&&n.getParent().getChildValue("scope")==="new"&&(e=e.newContextForData(t));var f=this._byName[a.name];if(!f)throw"Proxy ["+a.name+"] for type ["+o+"] in mode ["+s+"] is not registered in factory";return new f(e,t,n,r)},_setupViewVariables:function(e,t){var n=t.getChildByRef("vars");if(n){var r=n.getChildrenRefs();for(var i=0;i<r.length;i++){var s=r[i],o=n.getChildByRef(s);e.setVar(s,o.getValue(0)),o.addEvent(Constants.DataItemEvents.CHANGE,function(e,t,n){return function(){e.setVar(t,n.getValue(0))}}(e,s,o))}}},resolveResourcePath:function(e){return this._resourceResolverFunction&&this._resourceResolverFunction(e)||e},getNameSpace:function(){return this._nameSpace},_resolveProxyName:function(e,t,n,r,i){var s=t.getChildValue("name"),o=s||n;if(this.hasViewDefinition(e,o))return{name:o,type:"view"};if(s)return{name:s,type:"proxy"};throw"Component [name] was not defined in view ["+n+"|"+r+"] for data type ["+e+"]"},createNewEvaluationScope:function(e,t){if(this._dataItemUtils.findExprItems(e).length>0){var n=new this.imports.ViewEvaluationContext(t),r=new this.imports.EvalScopeWrapper(e,n,t.getEnvironment());return r.getData()}return e}}}),define.Class("wixapps.core.views.ViewBuilder",function(e){var t=e;t.utilize(["wixapps.core.views.ViewsCustomizer","wixapps.core.managers.TypesManager","wixapps.integration.managers.AppBuilderLocalizer"]),t.resources(["W.Utils"]),t.fields({_delimiter:"_",_typesManager:null,_types:null,_views:null,_data:null,_templates:null,_fieldTemplates:null,_utils:null,_localizer:null,_typesTemplatesMap:null}),t.methods({initialize:function(){this._typesManager=new this.imports.TypesManager,this._localizer=new this.imports.AppBuilderLocalizer,this._utils=this.resources.W.Utils.AppsUtils;if(!Constants)throw"ViewBuilder:: where is Constants?";Constants.AppBuilderViewTemplates&&this.registerTemplates(),Constants.AppBuilderTemplates&&this.registerBundles(),this._buildTypesTemplateMap()},registerBundles:function(){for(var e in Constants.AppBuilderTemplates)if(Constants.AppBuilderTemplates.hasOwnProperty(e)){var t=Constants.AppBuilderTemplates[e];this._registerTypes([t.type]),this._registerData(t.data),this._registerViews([t.view]),this._registerTemplates([t.template])}},registerTemplates:function(){var e=Constants.AppBuilderViewTemplates;this._registerTypes(e.types),this._registerData(e.data),this._registerViews(e.views),this._registerTemplates(e.templates),this._registerFieldTemplates(e.fieldTemplates)},_buildTypesTemplateMap:function(){this._typesTemplatesMap={};for(var e in this._fieldTemplates)if(this._fieldTemplates.hasOwnProperty(e)){var t=this._fieldTemplates[e];t.hasOwnProperty("category")&&(this._typesTemplatesMap.hasOwnProperty(t.category)?this._typesTemplatesMap[t.category].push(e):this._typesTemplatesMap[t.category]=[e])}},getViewTemplateDefinition:function(e){var t=this._getTemplateDef(e),n={id:t.id,friendlyName:t.friendlyName,description:t.description,defaultWidth:t.defaultWidth,type:null,view:null,data:null};n.type=this._getTypeDef(t.type),n.type.name=n.type.name+this._delimiter+this._utils.getTimeBasedUniqueId(),t.typeDisplayName&&(n.type.displayName=this._localizer.localize("TEMPLATE_BUNDLE_TYPE_NAME_"+t.id,t.typeDisplayName)),n.view=this.imports.ViewsCustomizer.fillMissingIds(this._getViewDef(t.type,t.viewName)),n.view.forType=n.type.name,n.view.name=this._utils.getTimeBasedUniqueId(n.view.name+this._delimiter);var r,i,s;i=t.data.length,n.data=[];for(r=0;r<i;r++)s=this._getDataItem(t.data[r]),s._iid=this._utils.getTimeBasedUniqueId(s._iid+this._delimiter)+this._delimiter+r,s._type=n.type.name,n.data.push(s);return n=this._addPredefinedExtraFields(n,t.extraFields),n},_addPredefinedExtraFields:function(e,t){if(!t||t.length===0)return e;for(var n=0;n<t.length;n++){var r=t[n],i=e.type.fields.some(function(e){return e.name===r.typeField.name});if(i===!0)throw"ViewBuilder:: field with name ["+r.typeField.name+"] already defined for type ["+e.type.name+"] ";e.type.fields.push(r.typeField);var s=this.getDefaultExtraFieldParams(e.view,r.containerId);r.hasOwnProperty("params")&&(s=Object.merge(s,r.params));var o=this.createFieldDefinitionFromTemplate(r.typeField.name,r.fieldTemplateName,r.typeField.type,s);this.addFieldToView(e.view,r.containerId,o),r.typeField.hasOwnProperty("defaultValue")||(r.typeField.defaultValue=this._typesManager.getDefaultDataForType(r.typeField.type));if(r.typeField.hasOwnProperty("defaultValue")&&r.typeField.defaultValue!==undefined)for(var u=0;u<e.data.length;u++){var a=e.data[u];a[r.typeField.name]=r.typeField.defaultValue}}return e},getTemplateBundles:function(){var e=Object.values(this._templates),t=e.filter(function(e){return e.hasOwnProperty("showOrder")});t.sort(function(e,t){return e.showOrder-t.showOrder});var n=e.filter(function(e){return!e.hasOwnProperty("showOrder")});n.sort(function(e,t){return e.id>t.id});var r=[].concat(t,n);return r},getListViewTemplateDefinition:function(e){var t=this._getViewDef("Array","ListTemplate");return t=this._localizer.localizeView(t),this.imports.ViewsCustomizer.fillMissingIds(t),t.name=e,this.imports.ViewsCustomizer.applyRule(t,{fieldId:"listItem",key:"comp.name",mode:"view",value:e}),t},_registerInner:function(e,t,n){var r,i,s=e.length;for(r=0;r<s;r++)i=e[r],n[t(i)]=i},_registerTypes:function(e){this._types=this._types||{},this._registerInner(e,function(e){return e.name},this._types)},_registerViews:function(e){this._views=this._views||{},this._registerInner(e,function(e){return e.forType+"|"+e.name},this._views)},_registerData:function(e){this._data=this._data||{},this._registerInner(e,function(e){return e._iid},this._data)},_registerTemplates:function(e){this._templates=this._templates||{},this._registerInner(e,function(e){return e.id},this._templates)},_registerFieldTemplates:function(e){this._fieldTemplates=this._fieldTemplates||{},this._registerInner(e,function(e){return e.forType+"|"+e.name},this._fieldTemplates)},_getTypeDef:function(e){if(this._types.hasOwnProperty(e))return Object.clone(this._types[e]);throw"ViewBuilder:: type ["+e+"] doesn't exist"},_getViewDef:function(e,t){var n=e+"|"+t;if(this._views.hasOwnProperty(n))return Object.clone(this._views[n]);throw"ViewBuilder:: view for type ["+e+"] with name ["+t+"] doesn't exist"},_getDataItem:function(e){if(this._data.hasOwnProperty(e))return Object.clone(this._data[e]);throw"ViewBuilder:: data item ["+e+"] doesn't exist"},_getTemplateDef:function(e){if(this._templates.hasOwnProperty(e))return this._templates[e];throw"ViewBuilder:: template ["+e+"] doesn't exist"},_getFieldTemplateDef:function(e,t){var n=[e,t].join("|");if(this._fieldTemplates.hasOwnProperty(n))return Object.clone(this._fieldTemplates[n]);throw"ViewBuilder:: field template ["+n+"] doesn't exist"},getTypesAndTemplatesMap:function(){return Object.clone(this._typesTemplatesMap)},getExtraFieldContainers:function(e){var t={},n=this._findCompNames(e,"FieldBox"),r,i,s,o,u;for(r=0;r<n.length;r++){s=n[r],u=[];if(s.comp.hasOwnProperty("items"))for(i=0;i<s.comp.items.length;i++)o=s.comp.items[i],u.push(o);t[s.id]=u}return t},getViewFieldsMapping:function(e,t){var n=[],r=function(e){return this._utils.getType(e)==="object"&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&(e.comp.name==="Field"||e.comp.name==="TextField")}.bind(this),i=this._findCompNames(e,"FieldBox"),s,o,u,a,f;for(s=0;s<i.length;s++){u=i[s];var l=u.id;if(u.comp&&u.comp.editorData&&u.comp.editorData.displayName){var c=u.comp.editorData.displayName;this._localizer.isValidKey(c)&&(c=this._localizer.localize(this._localizer.getKeyValue(c),l)),l=c}n.push({containerId:u.id,containerName:l,containerFields:[],hasFields:!1,orientation:u.comp.orientation});if(!u.comp.items)continue;for(o=0;o<u.comp.items.length;o++){a=u.comp.items[o];if(!r(a)||this.isFieldHidden(e,a.id))continue;f=a.comp.items[0],n[s].containerFields.push({id:a.id,data:a.data,compName:f.comp.name,fieldType:a.comp.name,containerId:u.id,containerName:l})}n[s].containerFields.length>0&&(n[s].hasFields=!0)}if(t){var h=this._getHiddenFields(e),p=[];if(h.length)for(o=0;o<h.length;o++)a=h[o],f=a.comp.items[0],p.push({id:a.id,data:a.data,compName:f.comp.name,fieldType:a.comp.name,containerId:"Hidden",containerName:"Hidden Fields"});n.push({containerId:"Hidden",containerName:"Hidden Fields",containerFields:p,hasFields:p.length>0,orientation:"not relevant"})}return n},getDefaultExtraFieldParams:function(e,t){var n=this._getExtraFieldContainerById(e,t);return n.comp.editorData},getBaseFieldTemplate:function(e,t,n){var r=this._getFieldTemplateDef(e,t);return this._cleanFieldTemplateDef(r),this._uniqify(r),this._fixFieldTemplateData(r,n),r},createFieldDefinitionFromTemplate:function(e,t,n,r){var i=this.getBaseFieldTemplate(n,t,e),s=i.comp.name;s==="Field"&&(i.comp.labelPosition=r.labelPosition||"none",i.comp.spacers=Object.merge({},i.comp.spacers,r.spacers),r.hasOwnProperty("alignment")&&(i.comp["box-align"]=r.alignment));if(s==="TextField"){i.comp.labelPosition=r.labelPosition||"none",i.comp.spacers=Object.merge({},i.comp.spacers,r.spacers);var o=i.comp.items[0];r.hasOwnProperty("alignment")&&(o.layout=o.layout||{},o.layout["text-align"]=r.alignment),o.hasOwnProperty("comp")&&r.hasOwnProperty("textStyle")&&(r.textStyle.hasOwnProperty("styleName")&&(o.comp.style=r.textStyle.styleName),r.textStyle.hasOwnProperty("bold")&&(o.comp.bold=r.textStyle.bold))}return i},addFieldToView:function(e,t,n,r){var i=this._getExtraFieldContainerById(e,t);i.comp.items=i.comp.items||[],n.comp.hidden=!1,r!==undefined&&r>=0?i.comp.items.splice(r,0,n):i.comp.items.push(n)},removeFieldFromView:function(e,t){var n=this._findCompNames(e,"FieldBox"),r;for(var i=0;i<n.length;i++){var s=n[i];s.comp.items&&(s.comp.items=s.comp.items.filter(function(e){return e.id===t&&(r=e),e.id!==t}))}return r},moveField:function(e,t,n,r){var i=this.removeFieldFromView(e,t);i&&this.addFieldToView(e,n,i,r)},replaceFieldInView:function(e,t,n){var r=this._getExtraFieldContainerById(e,t);for(var i=0;i<r.comp.items.length;i++){var s=r.comp.items[i];s.id===n.id&&r.comp.items.splice(i,1,n)}},reorderExtraFields:function(e,t,n,r){var i=this._getExtraFieldContainerById(e,t),s=i.comp.items[n];i.comp.items[n]=i.comp.items[r],i.comp.items[r]=s},_getHiddenFields:function(e){return this._find(e,function(e){return this._utils.getType(e)==="object"&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&(e.comp.name==="Field"||e.comp.name==="TextField")&&e.comp.hasOwnProperty("hidden")&&(e.comp.hidden===!0||e.comp.hidden==="true")}.bind(this))},isFieldHidden:function(e,t){var n=this._getHiddenFields(e);return n.some(function(e){return e.id===t})},_getExtraFieldContainerById:function(e,t){var n=this._find(e,function(e){return this._utils.getType(e)==="object"&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&e.comp.name==="FieldBox"&&e.hasOwnProperty("id")&&e.id===t}.bind(this));if(n.length===0)throw"view ["+e.forType+"|"+e.name+"] has no extra field container with id ["+t+"]";return n[0]},_cleanFieldTemplateDef:function(e){delete e.customizations,delete e.name,delete e.forType,delete e.category},_uniqify:function(e){var t=this._find(e,function(e){return this._utils.getType(e)==="string"&&e.test(/\[[a-zA-z0-9_-]*?\]/ig)}.bind(this)),n={},r;for(var i=0;i<t.length;i++){r=t[i].match(/\[[a-zA-z0-9_-]*?\]/ig);for(var s=0;s<r.length;s++)n[r[s]]=r[s].replace(/[\[\]]/gi,"")+this._delimiter+this._utils.getTimeBasedUniqueId()}var o=this._find(e,function(e){if(this._utils.getType(e)==="object"&&(e.hasOwnProperty("id")||e.hasOwnProperty("fieldId"))){var t=e.id||e.fieldId;return this._utils.getType(t)==="string"&&t.test(/\[[a-zA-z0-9_-]*?\]/ig)}return!1}.bind(this));for(var u=0;u<o.length;u++){var a=o[u],f;a.hasOwnProperty("id")&&(f="id"),a.hasOwnProperty("fieldId")&&(f="fieldId");var l;while((l=/\[[a-zA-z0-9_-]*?\]/ig.exec(a[f]))!==null)l=l[0],a[f]=a[f].replace(l,n[l])}return e},_find:function(e,t,n){n=n||function(){return!0};var r=[],i=function(e){if(e===undefined||e===null)return;t(e)&&r.push(e);if(!n(e))return;switch(this._utils.getType(e)){case"object":for(var s in e)e.hasOwnProperty(s)&&i(e[s]);break;case"array":for(var o=0;o<e.length;o++)i(e[o])}}.bind(this);return i(e),r},_findCompNames:function(e,t){this._utils.getType(t)==="string"&&(t=[t]);if(this._utils.getType(t)!=="array")throw"ViewBuilder::_findCompNames - argument compNames should be string of an array of strings but got '"+t+"'.";return this._find(e,function(e){return this._utils.getType(e)==="object"&&e.hasOwnProperty("comp")&&e.comp.hasOwnProperty("name")&&t.contains(e.comp.name)}.bind(this))},_fixFieldTemplateData:function(e,t){var n=this._find(e,function(e){return this._utils.getType(e)==="object"&&e.hasOwnProperty("data")}.bind(this));for(var r=0;r<n.length;r++){var i=n[r].data.split(".").filter(function(e){return e.length});i.length===0?n[r].data=t:i[0]==="this"?(i[0]=t,n[r].data=i.join(".")):(i=[t].concat(i),n[r].data=i.join("."))}return e}})}),define.oldClass({name:"wixapps.core.views.ViewContext",imports:[],Class:{Binds:[],_parent:null,_data:null,_computedFields:{},initialize:function(e,t,n){this._env=e.newCopy(),this._data=t,this._parent=n},getEnvironment:function(){return this._env},getData:function(){return this._data},getParent:function(){return this._parent},newContextForData:function(e){return new this.constructor(this._env,e,this)},newContextFromPath:function(e){var t=this.evaluatePath(e);return t?new this.constructor(this._env,t,this):undefined},evaluatePath:function(e){try{return this._evaluatePathRecursive(e.split("."),this._data)}catch(t){return undefined}},_evaluatePathRecursive:function(e,t){if(e.length===0)return t;var n=e.shift(),r=t,i=-1,s=n.match(/^(.*)\[([0-9]+)\]$/);s&&(n=s[1],i=s[2]);if(n=="parent"){if(!this._parent)throw"'parent' not found";return this._parent._evaluatePathRecursive(e,i==-1?this._parent._data:this._parent._data.getChildByIndex(i))}if(n=="this")return this._evaluatePathRecursive(e,i==-1?this._data:this._data.getChildByIndex(i));if(n.indexOf("$")===0){r=this._env.getVar(n.substr(1));if(!r)throw"var '"+n+"' not found"}else{var o=r.getChildByRef(n);r=o?o:this._getComputedChild(r,n);if(!r)throw"field '"+n+"' not found"}if(i!=-1){r=r.getChildByIndex(i);if(!r)throw"index "+i+" on '"+n+"' not found"}return this._evaluatePathRecursive(e,r)},_getComputedChild:function(e,t){var n=this._env.getTypesManager(),r=e.getTypeName();if(n.isNative(r)||r=="wix:Object")return undefined;var i=n.getType(r);if(!i)throw"Type ["+r+"] is not defined in TypesManager";var s=n.getField(i,t);return!s||s.computed!==!0?undefined:this._env.getDataItemFactory().createComputedField(s.name,s.type,r,e)},resolveTypeForPath:function(e){var t=e.split(".").length>1||e.indexOf("$")===0||e.indexOf("parent")===0;if(t)return undefined;var n=this._data.getTypeName(),r=e,i=-1,s=r.match(/^(.*)\[([0-9]+)\]$/);s&&(r=s[1],i=s[2]);if(r=="this")return n;var o=this._env.getTypesManager(),u=o.getType(n),a=o.getField(u,r);if(!a)return undefined;if(i==-1)return a.type;var f=o.getArrayAllowedTypes(a.type);return f.length>0?f[0]:undefined}}}),define.Class("wixapps.core.views.ViewDefinitionsOverrideRepository",function(e){var t=e;t.fields({_byTypeAndName:{},_baseViewDefRepo:null,_customizations:null,_dataItemFactory:null}),t.methods({initialize:function(e,t,n){this._baseViewDefRepo=e,this._customizations=t,this._dataItemFactory=n},getViewDefinition:function(e,t){var n=this._byTypeAndName[e+"|"+t];if(!n){var r=this._baseViewDefRepo.getViewDefinition(e,t);if(!r)return undefined;var i=r.getValue(0);this._customizations.applyAll(i),n=this._dataItemFactory.createDataItem(i),this._byTypeAndName[e+"|"+t]=n}return n},hasViewDefinition:function(e,t){return this._baseViewDefRepo.hasViewDefinition(e,t)},getAllViewDefinitions:function(){var e=Object.values(this._byTypeAndName);return e.sort(function(e,t){var n=function(e,t){return e>t?1:e==t?0:-1},r=n(e.getChildByRef("forType").getValue(),t.getChildByRef("forType").getValue());return r!==0?r:n(e.getChildByRef("name").getValue(),t.getChildByRef("name").getValue())}),e}})}),define.Class("wixapps.core.views.ViewDefinitionsRepository",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.binds(["_onClonedViewChanged"]),t.utilize(["wixapps.core.data.DataItemFactory"]),t.fields({_dataItemFactory:null,_byTypeAndName:{}}),t.methods({initialize:function(e){this._dataItemFactory=e},clone:function(){var e=this.getAllViewDefinitions(),t=this.constructor,n=new t(this._dataItemFactory);return e.forEach(function(e){n.setViewDefinition(e.getValue(0))}),n},cloneAndMultiply:function(e){var t=[];if(typeOf(e.name)=="array"){for(var n=0;n<e.name.length;n++){var r=Object.clone(e);r.name=e.name[n],t.push(r)}return t}return t.push(Object.clone(e)),t},setViewDefinition:function(e){var t=e.forType+"|"+e.name,n=this._byTypeAndName[t];return n?n.setValue(e):(n=this._dataItemFactory.createDataItem(e),this._byTypeAndName[t]=n,n.addEvent(Constants.DataItemEvents.CHANGE,function(e){this.fireEvent(Constants.DataItemEvents.CHANGE,e)}.bind(this))),n},removeViewDefinition:function(e){var t=e.forType+"|"+e.name;delete this._byTypeAndName[t]},getViewDefinition:function(e,t){return this._byTypeAndName[e+"|"+t]},hasViewDefinition:function(e,t){return!!this._byTypeAndName[e+"|"+t]},cloneAndListen:function(e){var t=e.getAllViewDefinitions();for(var n=0;n<t.length;n++)this.setViewDefinition(t[n].getValue()),t[n].addEvent(Constants.DataItemEvents.CHANGE,this._onClonedViewChanged)},_onClonedViewChanged:function(e){this.setViewDefinition(e.currentTarget.getValue())},getAllViewDefinitions:function(){var e=Object.values(this._byTypeAndName);return e.sort(function(e,t){var n=function(e,t){return e>t?1:e==t?0:-1},r=n(e.getChildByRef("forType").getValue(),t.getChildByRef("forType").getValue());return r!==0?r:n(e.getChildByRef("name").getValue(),t.getChildByRef("name").getValue())}),e}})}),define.Class("wixapps.core.views.ViewEnvironment",function(e){var t=e;t.utilize(["wixapps.core.events.TreePath"]),t.fields({_dataItemFactory:null,_typesManager:null,_proxyFactory:null,_viewName:null,_forType:null,_mode:null,_eventsDispatcher:null,_includedViews:null,_treePath:null,_vars:null}),t.methods({initialize:function(e,t,n,r,i,s,o,u,a,f,l){this._dataItemFactory=e,this._typesManager=t,this._proxyFactory=n,this._viewName=r,this._forType=i,this._mode=s,this._eventsDispatcher=o,this._includedViews=u,this._vars={parent:a,vars:{}},this._treePath=new this.imports.TreePath(f),this._lifecycleManager=l},newCopy:function(){return new this.constructor(this._dataItemFactory,this._typesManager,this._proxyFactory,this._viewName,this._forType,this._mode,this._eventsDispatcher,this._includedViews,this._vars,this._treePath,this._lifecycleManager)},setViewName:function(e){this._viewName=e},setForType:function(e){this._forType=e},setMode:function(e){this._mode=e},getDataItemFactory:function(){return this._dataItemFactory},getTypesManager:function(){return this._typesManager},getProxyFactory:function(){return this._proxyFactory},getViewName:function(){return this._viewName},getForType:function(){return this._forType},getMode:function(){return this._mode},getEventsDispatcher:function(){return this._eventsDispatcher},getIncludedViews:function(){return this._includedViews},getTreePath:function(){return this._treePath},getLifecycleManager:function(){return this._lifecycleManager},addIncludedView:function(e,t){var n=e+"|"+t;this._includedViews.indexOf(n)==-1&&this._includedViews.push(n)},getVars:function(){var e=function(t){if(!t)return{};var n=e(t.parent);return Object.each(t.vars,function(e,t){n[t]=e.getValue()}),n};return e(this._vars)},getVar:function(e){for(var t=this._vars;t;t=t.parent){var n=t.vars[e];if(n)return n}return undefined},setVar:function(e,t){var n=this._vars.vars[e];return n?n.setValue(t):(n=this._dataItemFactory.createDataItem(t),this._vars.vars[e]=n),n}})}),define.oldClass({name:"wixapps.core.views.ViewEvaluationContext",Class:{_viewContext:null,initialize:function(e){this._viewContext=e},getSymbolResolver:function(){return this},resolveExpressionReference:function(e){return this._viewContext.evaluatePath(e)},evaluateExpressionReference:function(e){var t=this.resolveExpressionReference(e);if(t)return t.getValue(undefined,this)},listSymbols:function(){var e={},t=this._data,n={};return Object.merge(e,n)},inheritsScope:function(e){return e.className!="wixapps.core.data.CompositeDataItem"||!e.getParent()||!e.getParent().getChildRef||e.getParent().getChildRef(e)!="templates"}}}),define.Class("wixapps.core.views.ViewsCustomizer",function(e){var t=e;t.binds(["addRule"]),t.fields({_byIndex:[],_byTypeAndView:{}}),t.methods({addRules:function(e){e.forEach(this.addRule)},addRule:function(e){var t=this.getByTypeAndView(e.forType,e.view);t.push(this._byIndex.length),this._byIndex.push(e)},replaceRule:function(e){var t=-1;for(var n=0;n<this._byIndex.length;n++){var r=this._byIndex[n];if(r.forType===e.forType&&r.view===e.view&&r.fieldId===e.fieldId&&r.mode===e.mode&&r.key===e.key){t=n;break}}t==-1?this.addRule(e):this._byIndex[t]=e},clearRules:function(){this._byIndex=[],this._byTypeAndView={}},getByTypeAndView:function(e,t){var n=e+"|"+t,r=this._byTypeAndView[n];return r===undefined&&(r=[],this._byTypeAndView[n]=r),r},applyToViewDefinitionsRepository:function(e){e.getAllViewDefinitions().forEach(function(e){var t=e.getValue(0);this.applyAll(t),e.setValue(t)}.bind(this))},applyAll:function(e){var t=[];t=t.concat(this.getByTypeAndView(e.forType,e.name)),t=t.concat(this.getByTypeAndView("*",e.name)),t=t.concat(this.getByTypeAndView(e.forType,"*")),t=t.concat(this.getByTypeAndView("*","*")),t.sort(function(e,t){return e-t}),t.forEach(function(t){this.applyRule(e,this._byIndex[t])}.bind(this))}}),t.statics({applyRule:function(e,t){var n=e.mode||"view",r=this._findApplicableFields(e,t);r.forEach(function(e){if(typeof e!="object")return;var r=e.mode||n;if(t.mode=="*"||t.mode==r){var i=e,s=t.key.split(".");for(var o=0;o<s.length;o++){var u=s[o];if(o==s.length-1){var a=t.value;/^\s*(\+|-)?\d+\s*$/.test(t.value)&&(a=parseInt(a,10)),a===undefined?delete i[u]:i[u]=a}else i[u]||(i[u]={}),i=i[u]}}})},fillMissingIds:function(e){return this._fillMissingIdsForItem(e,0),e},getCurrentRule:function(e,t){var n=Object.clone(t);return n.value=this.getCurrentValue(e,t),n},getCurrentValue:function(e,t){var n=this._findApplicableFields(e,t);for(var r=0;r<n.length;r++){var i=n[r],s=t.key.split(".");for(var o=0;o<s.length;o++){var u=s[o];if(o==s.length-1){if(i[u]!==undefined)return i[u];break}if(!i[u])break;i=i[u]}}return undefined},_findApplicableFields:function(e,t,n){var r=[];return t.fieldId=="vars"?r.push(e.vars):this._findApplicableFieldsOnItem(e,t,0,r),r},_findApplicableFieldsOnItem:function(e,t,n,r){var i=e.id||e.data||n,s=this;(t.fieldId=="*"||t.fieldId==i)&&r.push(e),e.comp&&e.comp.items&&e.comp.items.forEach(function(e,n){s._findApplicableFieldsOnItem(e,t,n,r)}),e.comp&&e.comp.templates&&Object.each(e.comp.templates,function(e){s._findApplicableFieldsOnItem(e,t,0,r)}),e.comp&&e.comp.cases&&Object.each(e.comp.cases,function(e){s._findApplicableFieldsOnItem(e,t,0,r)}),e.comp&&e.comp.columns&&e.comp.name=="Table"&&e.comp.columns.forEach(function(e,n){Array.forEach(["item","header","footer"],function(n){e[n]!==undefined&&s._findApplicableFieldsOnItem(e[n],t,0,r)})})},_fillMissingIdsForItem:function(e,t){e.id=e.id||e.data||"def_"+t;var n=t+1,r=this;return e.comp&&e.comp.items&&e.comp.items.forEach&&e.comp.items.forEach(function(e,t){n=r._fillMissingIdsForItem(e,n)}),e.comp&&e.comp.templates&&Object.each(e.comp.templates,function(e){n=r._fillMissingIdsForItem(e,n)}),e.comp&&e.comp.cases&&Object.each(e.comp.cases,function(e){n=r._fillMissingIdsForItem(e,n)}),e.comp&&e.comp.columns&&e.comp.name=="Table"&&e.comp.columns.forEach(function(e,t){Array.forEach(["item","header","footer"],function(t){e[t]!==undefined&&(n=r._fillMissingIdsForItem(e[t],n))})}),n}})}),define.oldClass({name:"wixapps.core.views.proxies.ArrayProxy",imports:["wixapps.core.views.ViewContext"],Class:{Extends:"wixapps.core.views.proxies.Proxy",Binds:[],_children:[],_components:[],initialize:function(e,t,n,r){this.parent(e,t,n,r),this._loadTemplates()},_createChildren:function(){var e=this._data.getChildren();for(var t=0;t<e.length;t++){var n=e[t];this._addChild(n,t,e.length)}},_getItemTemplate:function(e){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(e)},_addPositionInParentVars:function(e,t,n){var r=e.getEnvironment();r.setVar("indexInParent",t),r.setVar("indexOneInParent",t+1),r.setVar("positionInParent",t===0?"first":t==n-1?"last":"middle"),r.setVar("isOddIndexInParent",t%2==1)},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def)},_processDefinitionsChangeList:function(e){this.parent(e);var t=e.filter(function(e){return e.path[e.path.length-1]=="templates"});t.length&&this._loadTemplates()},_addChild:function(e,t,n){var r=this._viewContext.getEnvironment().getProxyFactory(),i=this._viewContext.newContextForData(e),s=this._def.getChildValue("mode");s&&s!=i.getEnvironment().getMode()&&i.getEnvironment().setMode(s),this._addPositionInParentVars(i,t,n);var o=r.createProxyFromItemDefinition(i,this._itemTemplate).proxy;this._children.push(o)},_createChildComponents:function(e){this._children.forEach(function(t){var n=t.createComponent();this._components.push(n),e.grab(n)}.bind(this))}}}),define.oldClass({name:"wixapps.core.views.proxies.CompositeProxy",imports:["wixapps.core.views.ViewContext"],Class:{Extends:"wixapps.core.views.proxies.Proxy",Binds:[],_ids:[],_children:[],_components:[],_itemsDefAsRaw:{},initialize:function(e,t,n,r){this.parent(e,t,n,r)},_isReloadRequired:function(){var e=this._itemsDefAsRaw,t=this._def.getChildValue("items")||[];if(t.length!=e.length)return!0;for(var n=0;n<e.length;n++){var r=e[n],i=t[n],s=r.comp&&r.comp.name||"unspecified",o=i.comp&&i.comp.name||"unspecified";if(s!=o||r.data!=i.data||r.id!=i.id)return!0}return!1},_createChildProxies:function(){while(this._children.length>0){var e=this._children.pop();e.isDisposed()||e.dispose()}this._ids=[],this._components=[];var t=this._def.getChildByRef("items");this._itemsDefAsRaw=t?t.getValue():[];if(t){var n=this._viewContext.getEnvironment().getProxyFactory();t.getChildren().forEach(function(e,t){var r=n.createProxyFromItemDefinition(this._viewContext,e);this._ids.push(r.id),this._children.push(r.proxy)}.bind(this))}},_createChildComponents:function(e){e.set("html",""),this._components=[],this._children.forEach(function(t){var n=t.createComponent();this._components.push(n),e.grab(n)}.bind(this))},_reloadProxy:function(){},_processDefinitionsChangeList:function(e){this.parent(e);if(!this.isDisposed()){if(e.length&&this._isReloadRequired()){this._reloadProxy();return}var t=e.filter(function(e){return e.path.length==4&&e.path[1]=="layout"});t.length&&this._onChildLayoutPropertyChange(t)}},_onChildLayoutPropertyChange:function(e){}}}),define.Class("wixapps.core.views.proxies.Proxy",function(e){var t=e;t.binds(["_onDataChangedInternal","_onDefinitionsChangedInternal"]),t.utilize(["wixapps.core.data.DataItemUtils"]),t.fields({_viewContext:null,_data:null,_def:null,_disposed:!1,_fieldId:null,_isBound:!0}),t.methods({initialize:function(e,t,n,r){this._viewContext=e,this._data=t,this._def=n,this._fieldId=r,this._dataItemUtils=new this.imports.DataItemUtils,this._validateDataType(),this._setVarsFromDef();var i=n.getChildValue("events");i&&Object.each(i,function(e,t){this._registerProxyEvents(t,this._createTranslator(e))}.bind(this)),this._data.addEvent(Constants.DataItemEvents.CHANGE,this._onDataChangedInternal),this._def.addEvent(Constants.DataItemEvents.CHANGE,this._onDefinitionsChangedInternal)},_createTranslator:function(e){var t,n={};return typeOf(e)=="object"?(t=e.event,Object.each(e,function(e,t){t!=="event"&&(n[t]=e)})):t=String(e),function(e){n.cause=e,this.fireEvent(t,n)}.bind(this)},setIsBound:function(e){this._isBound=e},getIsBound:function(){return this._isBound},isDisposed:function(){return this._disposed},dispose:function(){if(this._disposed)return;this._disposed=!0,this._data.removeEvent(Constants.DataItemEvents.CHANGE,this._onDataChangedInternal),this._data=null,this._def.removeEvent(Constants.DataItemEvents.CHANGE,this._onDefinitionsChangedInternal),this._viewContext=null,this._def=null},addEvent:function(e,t){this._viewContext.getEnvironment().getEventsDispatcher().addEvent(e,t)},addEventFilteredByScope:function(e,t,n){this._viewContext.getEnvironment().getEventsDispatcher().addEventFilteredByScope(this._viewContext,e,t,n)},removeEvent:function(e,t){this._viewContext.getEnvironment().getEventsDispatcher().removeEvent(e,t)},fireEvent:function(e,t,n){this._viewContext.getEnvironment().getEventsDispatcher().fireProxyEvent(this,e,t,n)},setupProxy:function(){},createComponent:function(){},_registerProxyEvents:function(e,t){},_onDefinitionsChangedInternal:function(e){var t=this._createChangeEventList(e);t.length&&this._processDefinitionsChangeList(t)},_processDefinitionsChangeList:function(e){if(this._shouldDefinitionChangesBeIgnored(e))return;this._setVarsFromDef();var t=e.filter(function(e){return e.path.length==1});t.length&&this._onDefPropertyChanged(t)},_shouldDefinitionChangesBeIgnored:function(e){return e.some(function(e){return e.path.length==1&&e.path[0]==="name"})},_createChangeEventList:function(e){var t=[],n=e.events||[{type:e.type,payload:{target:e.target}}];for(var r=0;r<n.length;r++){var i=n[r],s=i.payload.action||Constants.DataItemEvents.CHANGE,o;s==Constants.DataItemEvents.CHANGE?o=i.payload.target:i.payload.target.getChildByRef?o=i.payload.target.getChildByRef(i.payload.ref):i.payload.target.getChildByIndex&&(o=i.payload.target.getChildByIndex(i.payload.index));var u=this._dataItemUtils.getDataItemPath(this._def,o).reverse();t.push({type:s,item:o,path:u})}return t},_onDefPropertyChanged:function(e){},_setVarsFromDef:function(){var e=this._def.getChildValue("vars");if(e){var t=this._viewContext.getEnvironment();Object.each(e,function(e,n){t.setVar(n,e)})}},_onDataChanged:function(e){},_onDataChangedInternal:function(e){this._validateDataType(),this._onDataChanged(e)},_validateDataType:function(){var e=this._getAcceptableDataTypes();if(e&&e.length>0){var t=this._viewContext.getEnvironment().getTypesManager(),n=this._data.getTypeName();for(var r=0;r<e.length;r++)if(t.isOf(n,e[r]))return;throw"Proxy "+this.$className+" accepts only ["+e+"] but received ["+n+"]"}},_getAcceptableDataTypes:function(){return[]},getViewContext:function(){return this._viewContext},getData:function(){return this._data},getViewDefinition:function(){return this._def},getFieldId:function(){return this._fieldId},getFullFieldId:function(){return this._viewContext._env.getForType()+"|"+this._viewContext._env.getViewName()+"|"+this._fieldId},setWidth:function(e){},getWidth:function(){return 0},getHeight:function(){return 0},setPos:function(e,t){}})}),define.Const("WixApps",{TEXT_STYLES:{Title:"font_0",Menu:"font_1","Page title":"font_2","Heading XL":"font_3","Heading L":"font_4","Heading M":"font_5","Heading S":"font_6","Body L":"font_7","Body M":"font_8","Body S":"font_9","Body XS":"font_10"},TEXT_STYLE_NAMES:{font_0:"Title",font_1:"Menu",font_2:"Page title",font_3:"Heading XL",font_4:"Heading L",font_5:"Heading M",font_6:"Heading S",font_7:"Body L",font_8:"Body M",font_9:"Body S",font_10:"Body XS"},EDIT_TEMPLATE_NAME:"EditPanel"}),define.Const("WixAppEvents",{FULL_DATA_EDITOR_SAVED:"wix:fullDataEditorSaved",APP_PART_RESIZE:"wix:appPartResize",APP_VIEW_READY:"wix:appViewready",APP_VIEW_CREATED:"wix:appViewCreated",APP_ZOOM_READY:"wix:appZoomready",APP_CONTENT_RESIZE:"wix:appContentResize",PROXY_IRRECOVERABLE:"wix:proxyIrrecoverable",TYPE_CHANGE:"wix:typeChange",FIELD_ADDED:"wix:fieldAdded",FIELD_REMOVED:"wix:fieldRemoved",ITEM_CHANGED:"wix:itemChanged",SELECTED_INDEX_CHANGED:"wix:selectedItemChanged",PROXY_SIZE_INVALID:"wix:proxySizeInvalid"}),define.component("wixapps.integration.components.AppPage",function(e){var t=e;t.inherits("core.components.Page"),t.utilize(["_onLogicClassLoaded","_onDataItemLoaded","_onDataItemLoadError"]),t.traits([]),t.binds([]),t.skinParts({}),t.states(),t.dataTypes(["AppPage"]),t.fields({_itemLoadedCallbacks:[]}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this._logger=new this.imports.WixAppsLogger},_onAllSkinPartsReady:function(){this._appPageId=this._data.get("appPageId");var e=this._data.get("appInnerID")||"1";this._appInstance=W.Apps.getApp(e);if(!this._appInstance){var t=this._logger;t.reportError(t.Errors.APP_INSTANCE_NOT_LOADED,this.$className,"render",t.SubCategory.CORE_WIRING);return}this._pageDefinition=this._appInstance.getPageDefinition(this._appPageId);var n=this._pageDefinition.logic.display.type;W.Classes.get(n,this._onLogicClassLoaded)},_onLogicClassLoaded:function(e){this._pagePrimaryLogic=new e(this.getEnvironment()),this._primaryLogicLoaded=!0,this._fetchDataItem()},updateParams:function(e){var t=this._getParams(e);this._fetchDataItem(t)},_fetchDataItem:function(e){if(this._primaryLogicLoaded===!1){W.Utils.callLater(this._fetchDataItem,[e],this);return}e||(e=this._getParams()),this._pagePrimaryLogic.fetchDataItem(e,this._onDataItemLoaded,this._onDataItemLoadError)},_getParams:function(e){if(!e){var t=W.Utils.hash.getHashParts();e=t.extData}var n=this._fromQueryString(e);return Object.keys(n).length===0&&(n=this._pagePrimaryLogic.getSampleDataItem()),n},registerPageAppPart:function(e,t){this._itemLoadedCallbacks.push(t),this._dataItemLoaded&&t(this._dataItem)},_onDataItemLoaded:function(e){this._dataItem=e,this._dataItemLoaded=!0,this._itemLoadedCallbacks.each(function(t){t(e)})},_onDataItemLoadError:function(e){this._logger.reportError(this._logger.Errors.UNABLE_TO_LOAD_DATA_ITEM_FROM_PARAMS,this.$className,"_onDataItemLoadError",this._logger.SubCategory.CORE_WIRING);if(W.Viewer.isPublicMode()){var t=W.Data.getDataMap().SITE_STRUCTURE.get("mainPage");W.Viewer.goToPage(t)}else this._pagePrimaryLogic.fetchSampleDataItem(this._onDataItemLoaded,this._onDataItemLoadError)},getLogger:function(){return this._logger},getEnvironment:function(){if(!this._environment){var e=this;this._environment={_context:[{dataService:e._appInstance.getDataService(),itemCache:e._appInstance.getItemCache(),dataItemFactory:e._appInstance.getDataItemFactory()}],getDataItemFactory:function(){return this._getContext().dataItemFactory},getTypesManager:function(){return e._appInstance.getTypesManager()},getDataService:function(){return this._getContext().dataService},getItemCache:function(){return this._getContext().itemCache},getAppInstance:function(){return e._appInstance},getLogger:function(){return e.getLogger()},_getContext:function(){return this._context[this._context.length-1]}};if(this._pageDefinition.logic.display.options){var t={};Object.each(this._pageDefinition.logic.display.options,function(e,n){t[n]=e}),this._environment.options=t}}return this._environment},_fromQueryString:function(e){var t={};if(e!==undefined&&e.length>0){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].split("=");t[r[0]]=r[1]}}return t}})}),define.component("wixapps.integration.components.AppPart",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["wixapps.core.utils.WixAppsLogger","wixapps.core.views.ViewsCustomizer","wixapps.core.views.ViewDefinitionsOverrideRepository","wixapps.core.dataservice.ItemCache","wixapps.core.dataservice.DataService","wixapps.core.events.ProxyEventBus","wixapps.core.views.ProxyFactory","wixapps.integration.proxies.ProxyMap","wixapps.integration.managers.AppResizeHandler","wixapps.integration.managers.LifecycleManager"]),t.traits(["wixapps.integration.components.traits.SizeRefreshHandler"]),t.binds(["_onLogicLoaded","_onContentResize"]),t.skinParts({inlineContent:{type:"htmlElement"}}),t.states(["loading","error","rendering","content"]),t.dataTypes(["AppPart"]),t.fields({_eventDispatcher:null,_resizeHandler:null,EDITOR_META_DATA:{general:{help:!1,settings:!0,design:!1},custom:[{label:"EDIT_DATA_BUTTON",command:"WAppsEditorCommands.OpenEditDataDialog",commandParameter:{}}]}}),t.methods({initialize:function(e,t,n,r){this.parent(e,t,n),this._logger=new this.imports.WixAppsLogger,this._appInstance=null,this._eventDispatcher=new this.imports.ProxyEventBus,this.setState("content"),this._resizeHandler=new this.imports.AppResizeHandler,this._resizeHandler.activateResizeHandler(this._eventDispatcher,this._view),this._lifecycleManager=new this.imports.LifecycleManager(this._eventDispatcher),this._eventDispatcher.addEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,this._onContentResize),this.injects().Commands.registerCommand("WViewerCommands.AppDataChange",!0),this.setMaxH(8e3)},render:function(){try{this.getAppInstance()}catch(e){this.setState("error");var t=this._logger;t.reportError(t.Errors.APP_INSTANCE_NOT_LOADED,this.$className,"render",t.SubCategory.CORE_WIRING)}},initApp:function(){this._customizations=new this.imports.ViewsCustomizer(this._appInstance.getDataItemFactory()),this._viewDefinitions=new this.imports.ViewDefinitionsOverrideRepository(this._appInstance.getViewDefRepo(),this._customizations,this._appInstance.getDataItemFactory()),this._applyCustomizationRulesToDefinitions(),this._proxyFactory=new this.imports.ProxyFactory(this._appInstance.getDataItemFactory(),this._appInstance.getTypesManager(),this._viewDefinitions,this._eventDispatcher,this._appInstance.resolveResourcePath,this._appInstance.getPackageName(),this._lifecycleManager),(new this.imports.ProxyMap).registerComponentProxies(this._proxyFactory),this._partDef=this._appInstance.getPartDefinition(this._data.get("appPartName"));if(!this._partDef)throw new Error("AppPart.initApp partName ["+this._data.get("appPartName")+"] not found in app descriptor");this._allowHeightResize=this._partDef.allowHeightResize||!1,this._allowHeightResize||(this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]),this._partDef.minWidth&&this.setMinW(this._partDef.minWidth),this._loadPartLogic(),this._view.set("partid",this._appInstance.getPackageName()+"_"+this._partDef.id)},getCustomizationDefaultValue:function(e,t,n,r){var i={forType:e,viewName:t,fieldId:n,key:r},s=this._appInstance.getViewDefRepo(),o=s.getViewDefinition(e,t);if(!o)throw"View "+e+"|"+t+" not found in repository";return o=o.getValue(0),this._customizations.getCurrentValue(o,i)},_applyCustomizationRulesToDefinitions:function(){this._customizations.clearRules(),this._customizations.addRules(this._data.get("appLogicCustomizations"));var e=this._appInstance.getViewDefRepo();this._viewDefinitions.getAllViewDefinitions().forEach(function(t){var n=e.getViewDefinition(t.getChildValue("forType"),t.getChildValue("name")).getValue(0);this._customizations.applyAll(n),t.setValue(n)}.bind(this)),this.fireEvent("customizationApplied")},getPartDef:function(){return this._partDef},getHelpId:function(){return this._partDef.helpId?this._partDef.helpId:this._appInstance.getAppDescriptor().helpId},getAppPartViewDefRepo:function(){return this._viewDefinitions},getViewDef:function(){if(!this._mainProxy)return;return this._mainProxy.getViewDefinition()},getViewsCustomizer:function(){return this._customizations},getMainProxy:function(){return this._mainProxy},getAppInstance:function(){return this._appInstance||(this._appInstance=W.Apps.getApp(this._data.get("appInnerID")),this._appInstance.registerAppPart(this)),this._appInstance},getLogger:function(){return this._logger},getLogicParams:function(){var e={};this._partDef.logic.display.options&&Object.each(this._partDef.logic.display.options,function(t,n){e[n]=t});var t=!1,n=this._data.get("appLogicParams");return Object.each(n,function(n,r){r=="wixapps:first-load-after-add-to-stage"?(t=!0,e["wixapps:first-load-after-add-to-stage"]=!0):e[r]=n.value}),t&&delete n["wixapps:first-load-after-add-to-stage"],e},getEnvironment:function(){if(!this._environment){var e=this;this._environment={_context:[{dataService:e._appInstance.getDataService(),itemCache:e._appInstance.getItemCache(),dataItemFactory:e._appInstance.getDataItemFactory()}],getProxyFactory:function(){return e._proxyFactory},getDataItemFactory:function(){return this._getContext().dataItemFactory},getTypesManager:function(){return e._appInstance.getTypesManager()},getDataService:function(){return this._getContext().dataService},getItemCache:function(){return this._getContext().itemCache},getAppPart:function(){return e},getAppInstance:function(){return e._appInstance},getViewDefRepo:function(){return e._appInstance.getViewDefRepo()},getLogger:function(){return e.getLogger()},_getContext:function(){return this._context[this._context.length-1]},newDataServiceContext:function(){var t=this.getDataService(),n=t.getDataItemFactory().clone(),r=new e.imports.ItemCache(n),i=new e.imports.DataService(t.getTransport(),n,r);this._context.push({dataService:i,itemCache:r,dataItemFactory:n})},popDataServiceContext:function(){if(this._context.length<2)throw"no data service context to pop";return this._context.pop().dataService}}}return this._environment},_loadPartLogic:function(){W.Classes.get(this._partDef.logic.display.type,this._onLogicLoaded)},_onLogicLoaded:function(e){var t=this.getEnvironment();this._disposeLogic(),this._logic=new e(t),this.fireEvent("logicLoaded"),this.getViewNode().fireEvent("logicLoaded"),this._runLogic()},_runLogic:function(){var e=this.getLogicParams(),t=this,n={showProxy:function(e){t.setState("rendering"),t._mainProxy&&t._mainProxy.dispose(),t._mainProxy=e,t._mainComponent=t._mainProxy.createComponent(),t._skinParts.inlineContent.set("html",""),t._skinParts.inlineContent.adopt(t._mainComponent),t._allowHeightResize&&t._mainProxy.getElement().setStyle("height",t.getHeight()),t._mainProxy.setupProxy(),window.requestAnimFrame(function(){t._lifecycleManager.performAction(function(){t.fireEvent("proxyDisplayed",e),t._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),t.setState("content")})}),t._mainProxy.addEvent("innerCompResize",function(e){!t._userResize&&!t._allowHeightResize&&t._wCheckForSizeChangeAndFireAutoSized(1)}),t._mainProxy.addEvent("wix:zoom-link:open-zoom",function(e){var n=e.zoomParams,r=t.getPartDef().zoomPartName;t.getAppInstance().getZoomHandler().openZoomForItemsList(n.list,n.selectedIndex,r)}),t._mainProxy.addEvent("wix:app-link:navigate",function(e){t._navigateToAppPage(e)})},showLoadingIndicator:function(){t.setState("loading")},hideLoadingIndicator:function(){t.setState("content")},showErrorIndicator:function(e,n){e=e||-1,n=n||"Unspecified error",t.setState("error");var r=t._logger;r.reportError({code:e,description:n},this.$className,"showErrorIndicator",r.SubCategory.APP_LOGIC)}},r=this._data.get("viewName");r||(r=this._partDef.views[0],this._data.set("viewName",r,!0)),this._logic.run(r,e,n)},_navigateToAppPage:function(e){var t=e.appPageId,n=e.dataItem,r=function(e){this._pagePrimaryLogic=new e(this.getEnvironment());var r=this._pagePrimaryLogic.generateLinkParams(n),i=r.title,s=r.params,o=Object.toQueryString(s),u=W.Viewer.getAppPages()[t],a=u._data.get("id");W.Utils.hash.setHash(a,i,o)}.bind(this),i=this._appInstance.getPageDefinition(t),s=i.logic.display.type;W.Classes.get(s,r)},_onAutoSized:function(e){this._allowHeightResize===!1&&this.setHeight(this._getMinPhysicalHeight(),!1,!1),this.parent(e)},_getMinPhysicalHeight:function(){var e=0;return this._mainProxy&&this._mainProxy.getElement()&&(e=this._mainProxy.getElement().getSize().y),e},_onAllSkinPartsReady:function(){this._skinParts.inlineContent.setStyles({position:"relative"})},hasChildren:function(){return!1},isContainer:function(){return!1},_onDataChange:function(e,t,n){if(this._ignoreUpdate)return;this._appInstance&&this._runLogic()},getAppPartLogic:function(){return this._logic},_ruleFits:function(e,t){var n=!0;for(var r in t)t[r]!=e[r]&&(n=!1);return n},getCustomization:function(e){var t=[];if(!e)return this._data.get("appLogicCustomizations");var n=this._data.get("appLogicCustomizations");for(var r=n.length-1;r>-1;r--)this._ruleFits(n[r],e)&&t.push(n[r]);return t},clearCustomizations:function(e,t){if(!e)this._data.set("appLogicCustomizations",[]);else{var n=this._data.get("appLogicCustomizations");for(var r=n.length-1;r>-1;r--)this._ruleFits(n[r],e)&&n.splice(r,1)}this._ignoreUpdate=!t,this._data.fireDataChangeEvent(),this._ignoreUpdate=!1,this._applyCustomizationRulesToDefinitions(),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))},applyCustomizationRule:function(e,t){var n=this._data.get("appLogicCustomizations"),r=!1,i,s;e.type="AppPartCustomization";for(var o=0;o<n.length;o++){i=n[o];if(i.forType===e.forType&&i.view===e.view&&i.fieldId===e.fieldId&&i.mode===e.mode&&i.key===e.key){s=n.splice(o,1);break}}n.push(e),this._ignoreUpdate=!t;var u=s?s[0]:undefined,a=this.getCustomizationDefaultValue(e.forType,e.view,e.fieldId,e.key),f=u?!this.injects().Utils.areObjectsEqual(e,u):a!=e.value;f&&this.injects().Commands.executeCommand("WViewerCommands.AppDataChange",[e,u,this]),this._data.fireDataChangeEvent(this._data,e,u,this,!0),this._ignoreUpdate=!1,this._applyCustomizationRulesToDefinitions(),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))},_onResize:function(){if(!this._mainProxy)return this.parent();this._allowHeightResize===!1?this.setHeight(this._getMinPhysicalHeight(),!1,!1):this._mainProxy&&this._mainProxy.getElement().setStyle("height",this.getHeight()),this.parent(),this._userResize=!0,this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),this._userResize=!1},_onContentResize:function(){window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))},getEventDispatcher:function(){return this._eventDispatcher},_disposeLogic:function(){this._logic&&this._logic.dispose&&this._logic.dispose()},dispose:function(){this._disposeLogic(),this.parent()}})}),define.component("wixapps.integration.components.AppPart2",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["wixapps.integration.managers.ViewHolder","wixapps.core.views.ViewsCustomizer","wixapps.integration.utils.GeometryUtils","wixapps.integration.utils.FunctionCallThrottle"]),t.traits(["wixapps.integration.components.traits.SizeRefreshHandler"]),t.resources(["W.Utils","W.Viewer"]),t.binds(["_onError","_onAppViewReady","_initApp","_retrieveData","_onContentResize","_onResizeEnd","_onViewDefinitionsChanged","_onAppDataChanged","checkSizeLimits"]),t.skinParts({inlineContent:{type:"htmlElement"},error:{type:"htmlElement"}}),t.states(["loading","error","rendering","content"]),t.dataTypes(["AppBuilderComponent"]),t.fields({_viewHolder:null,_allowHeightResize:!1,_appPartDefinition:null,_appInstance:null,_appPartData:null,isWixApps2:!0,_geometryUtils:null}),t.methods({initialize:function(e,t,n,r){this.parent.apply(this,arguments),this._utils=this.resources.W.Utils.AppsUtils,this._geometryUtils=new this.imports.GeometryUtils,this.setState("loading"),this.addEvent("resizeEnd",this._onResizeEnd),this.setMaxH(8e3),this._checkSizeLimitsDebounce=this.imports.FunctionCallThrottle.debounceFunction(this.checkSizeLimits,500)},_onAllSkinPartsReady:function(){W.Apps2.getApplicationInstance(this._data.get("appInnerID"),function(e){this._appInstance=e,e.getViewDefinitions().addEvent(Constants.DataItemEvents.CHANGE,this._onViewDefinitionsChanged),this._viewHolder=new this.imports.ViewHolder(e.getDataItemFactory(),this._appInstance.getTypesManager(),e.getViewDefinitions(),e.resolveResourcePath,""),this._viewHolder.setContainer(this._skinParts.inlineContent),this._viewHolder.getEventDispatcher().addEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,this._onContentResize);try{var t=this._appInstance.getAppPartDefinitions(),n=this._data.get("appPartName");this._appPartDefinition=t.getById(n)}catch(r){this.setState("error");return}this._initApp()}.bind(this))},_initApp:function(){this._viewName=this._appPartDefinition.getViewName(),this._forType=this._appPartDefinition.getType();var e=this._appPartDefinition.getDataSelectorId(),t=this._appInstance.getDataSelectors();this._dataSelector=t.getById(e),this._dataSelector.isListSelector()?this._dataSelector.getItems(this._retrieveData,this._onError):this._dataSelector.getItem(this._retrieveData,this._onError)},_retrieveData:function(e){this._appPartData=e,this.setState("rendering"),this._viewHolder.getEventDispatcher().addEvent(Constants.WixAppEvents.APP_VIEW_CREATED,this._onAppViewReady),this._viewHolder.setupViewHolder(e,this._viewName),e.addEvent(Constants.DataItemEvents.CHANGE,this._onAppDataChanged)},_onError:function(e){this.setState("error"),this._reportError(e)},getEventDispatcher:function(){return this._viewHolder&&this._viewHolder.getEventDispatcher?this._viewHolder.getEventDispatcher():null},_onAppViewReady:function(){this.setState("content"),this._allowHeightResize===!0?this._viewHolder.setContentHeight(this.getHeight()):this.fireEvent("autoSized"),this._view.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this._reportLoaded()},_onResize:function(){this._viewHolder&&(this._allowHeightResize===!1?this.setHeight(this._getMinPhysicalHeight(),!1,!1):this._viewHolder&&this._viewHolder.setContentHeight(this.getHeight()),this.parent(),this._viewHolder.getEventDispatcher().fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),this._wCheckForSizeChangeAndFireAutoSized(3))},_onContentResize:function(){window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))},_getMinPhysicalHeight:function(){return 100},_onResizeEnd:function(){this.checkSizeLimits()},_onViewDefinitionsChanged:function(e){this._viewHolder.performActionWhenReady(this._checkSizeLimitsDebounce)},_onAppDataChanged:function(e){this._viewHolder.performActionWhenReady(this._checkSizeLimitsDebounce)},checkSizeLimits:function(e){console.log(+(new Date)),e=e===undefined?0:e,this._viewHolder.getGeometryMap().reset();var t=this._geometryUtils.getOverflowRegions(this._skinParts.inlineContent,this._viewHolder.getGeometryMap());if(t.length>0&&t.length!==e){var n=t.reduce(function(e,t){return Math.max(e,t.left+t.right)},-Infinity);this.setWidth(this.getWidth()+n),t.length>1&&window.requestAnimFrame(function(){this.checkSizeLimits(t.length)}.bind(this))}},getAcceptableDataTypes:function(){return["AppBuilderComponent"]},getAppInstance:function(){return this._appInstance},getAppPartData:function(){return this._appPartData},getAppPartDefinition:function(){return this._appPartDefinition},getViewDefinition:function(){return this._appInstance.getViewDefinitions().getViewDefinition(this._forType,this._viewName)},getViewHolder:function(){return this._viewHolder},getUniqueFieldName:function(e,t){return this.getAppInstance().getTypesManager().getUniqueFieldName(this._forType,e,t)},getDataSelector:function(){return this._dataSelector},onDuplicate:function(){var e=this._forType+"_dup_"+this._utils.getTimeBasedUniqueId(),t=this._viewName+"_dup_"+this._utils.getTimeBasedUniqueId(),n=this._appInstance.getViewDefinitions().getViewDefinition("Array",this._viewName);n=n.getValue(),n.forType="Array",n.name=t,n.id=W.Utils.getUniqueId("view"),this.imports.ViewsCustomizer.applyRule(n,{fieldId:"listItem",key:"comp.name",mode:"view",value:t}),this._appInstance.addViewDefinition(n);var r=this._appInstance.getViewDefinitions().getViewDefinition(this._forType,this._viewName);r=r.getValue(),r.forType=e,r.name=t,this._appInstance.addViewDefinition(r);var i=this._dataSelector.duplicate(e),s=this.getAppInstance().getAppPartDefinitions().createAndRegister(i,t,e);this._data.set("appPartName",s),this._initApp(this._appInstance)},_reportLoaded:function(){if(this.resources.W.Viewer.isPublicMode()){var e=this._appInstance.getLogger(),t={appInstanceId:this._appInstance.getInstanceId(),partId:this._appPartDefinition.getId(),uuid:rendererModel&&rendererModel.userId};e.reportEvent(e.Events.APP_BUILDER_PART_LOADED,t)}},_reportError:function(e){if(this.resources.W.Viewer.isPublicMode()){var t=this._appInstance.getLogger(),n={appInstanceId:this._appInstance.getInstanceId(),partId:this._appPartDefinition.getId(),uuid:rendererModel&&rendererModel.userId,error:e};t.reportEvent(t.Events.APP_BUILDER_PART_ERROR,n)}},dispose:function(){this._appInstance.getViewDefinitions().removeEvent(Constants.DataItemEvents.CHANGE,this._onViewDefinitionsChanged),this._appPartData&&this._appPartData.removeEvent(Constants.DataItemEvents.CHANGE,this._onAppDataChanged),this._viewHolder.getEventDispatcher().removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewReady),this._viewHolder.dispose(),this._viewHolder=null,this._dataSelector=null,this.parent()}})}),define.component("wixapps.integration.components.Area",function(e){var t=e;t.inherits("core.components.Container"),t.skinParts({inlineContent:{type:"htmlElement"}}),t.methods({initialize:function(e,t,n){this.parent(e,t,n)},setStyle:function(e){this._setStyleInProgress=!0,this.parent(e),this._setStyleInProgress=!1,this.fireEvent(Constants.DisplayEvents.SKIN_CHANGE)},_replaceSkin:function(e){this.parent(e),this._setStyleInProgress||this.fireEvent(Constants.DisplayEvents.SKIN_CHANGE)}})}),define.component("wixapps.integration.components.ClippedParagraph",function(e){var t=e;t.inherits("wysiwyg.viewer.components.WRichText"),t.utilize(["wixapps.integration.utils.ParagraphLinesMap","wixapps.integration.utils.ParagraphClipping"]),t.skinParts({richTextContainer:{type:"htmlElement"}}),t.propertiesSchemaType("ClippedParagraphProperties"),t.resources(["W.Theme"]),t.fields({_paragraphClipping:null,_paragraphLineMap:null}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this._paragraphClipping=new this.imports.ParagraphClipping,this._paragraphLineMap=new this.imports.ParagraphLinesMap},render:function(){this._clipTextContent()},_updateText:function(){},_onAllSkinPartsReady:function(){this.parent(),this.resources.W&&this.resources.W.Theme&&this.resources.W.Theme.addEvent("propertyChange",function(e){e.name.indexOf("font_")===0&&(this._paragraphClipping.resetCache(),this._clipTextContent())}.bind(this)),this._view.setStyles({overflow:"hidden",position:"absolute",width:this.getWidth(),"white-space":"normal"})},_clipTextContent:function(){var e=this._data.get("text"),t=parseInt(this.getComponentProperty("maxLines"),10)||0,n=parseInt(this.getComponentProperty("minLines"),10)||0,r=String(this.getComponentProperty("pack")),i=this.getRichTextContainer();if(i.isVisible()){i.setStyles({width:this.getWidth()}),t?this._clipParagraphByLines(e,i,this.getWidth(),n,t,r):this._clipParagraphBySize(e,i,this.getWidth(),this.getHeight());if(this.getComponentProperty("showTooltip")==="true"||this.getComponentProperty("showTooltip")===!0)this._paragraphClipping.isClipped()?i.setAttribute("title",e.replace(/<.*?>/gi,"")):i.removeAttribute("title")}},_clipParagraphBySize:function(e,t,n,r){this._paragraphClipping.clipParagraph(e,t,n,r)},_clipParagraphByLines:function(e,t,n,r,i,s){var o=e!==this._paragraphClipping.getLastTextContent();o&&t.set("html",e),this._paragraphClipping.hideEllipsis(),this._paragraphLineMap.updateMap(t),this._paragraphClipping.showEllipsis();var u=Math.min(i,this._paragraphLineMap.getLineNum()),a=this._paragraphLineMap.getParagraphHeight(u),f=a/u;this._paragraphClipping.clipParagraph(e,t,n,a);var l=0;if(s!=="none"&&u<i){var c=parseInt((i-u)*f,10);a+=c,s==="bottom"?l=c:s==="middle"&&(l=Math.floor(c/2))}r>0&&(a=Math.max(a,f*r)),t.setStyle("margin-top",l),this.setHeight(a,undefined,!1),this.fireEvent("autoSizeChange")},_getElementInnerText:function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=this._getElementInnerText(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=this._getElementInnerText(t);return n},_onResize:function(){this._isRendered===!0&&this.getRichTextContainer().getParents("body").length&&this._clipTextContent()}})}),define.oldComponent({name:"wixapps.integration.components.Expander",skinParts:{icon:{type:"htmlElement"},summary:{type:"htmlElement"},content:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_toggle"],_states:["expand","collapsed"],initialize:function(e,t,n){this.parent(e,t,n),this._createSummary=n.createSummaryFunc,this._createContent=n.createContentFunc,this._initialState=n.initialState,this._noIcon=n.noIcon},_onAllSkinPartsReady:function(e){this._noIcon&&e.icon.hide(),e.icon.addEvent("click",this._toggle),e.summary.addEvent("click",this._toggle),this._createSummary(e.summary),this._createContent(e.content),this.setState(this._initialState||"expand")},setOpen:function(){this.setState("expand")},setClosed:function(){this.setState("collapsed")},_toggle:function(){this.getState()=="expand"?this.setClosed():this.setOpen()},_onResize:function(){this.parent()}}}),define.component("wixapps.integration.components.HorizontalRepeater",function(e){var t=e;t.inherits("wysiwyg.viewer.components.VerticalRepeater"),t.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),t.traits([]),t.binds([]),t.skinParts({inlineContent:{type:"htmlElement"}}),t.states(),t.dataTypes([]),t.fields({}),t.methods({})}),define.component("wixapps.integration.components.Icon",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_onClick"]),t.skinParts({img:{type:"htmlElement"}}),t.dataTypes(["Icon"]),t.methods({_onAllSkinPartsReady:function(e){e.img.addEvent("click",this._onClick)},render:function(){this._skinParts.img.set("src",this._data.get("url")),this._skinParts.img.set("width",this._data.get("width")),this._skinParts.img.set("height",this._data.get("height")),this._skinParts.img.set("title",this._data.get("title"))},_onClick:function(e){this.fireEvent(Constants.CoreEvents.CLICK,e)}})}),define.oldComponent({name:"wixapps.integration.components.ImageLite",imports:["core.components.image.ImageUrl"],traits:["wixapps.integration.components.traits.ImageDimensionsTrait"],Class:{Extends:"mobile.core.components.base.BaseComponent",_currentUri:"",_img:null,_imgWidth:0,_imgHeight:0,_imageMode:"",initialize:function(e,t,n){this.parent(e,t,n),this._imageMode=n.imageMode||"fill"},_onAllSkinPartsReady:function(){this._img||(this._img=new Element("img"),this._view.adopt(this._img))},render:function(){var e=this._view.getSize();this.setSize(e.x,e.y)},setOwner:function(){},invalidateSize:function(){},setWidth:function(e,t,n,r){this.parent(e,t,n),r!==!0&&this.setSize(e,this._$height)},setHeight:function(e,t,n,r){this.parent(e,t,n),r!==!0&&this.setSize(this._$width,e)},setImageMode:function(e){this._imageMode=e,this.setSize(this._$width,this._$height)},setSize:function(e,t,n){n=n||this._imageMode,this._imgWidth=parseInt(this._data.get("width"),10),this._imgHeight=parseInt(this._data.get("height"),10);var r=this._getImageModeDimensionsFunc(n)({width:this._$width,height:this._$height},{width:this._imgWidth,height:this._imgHeight}),i;this._data.get("uri").indexOf("http:")!==0?i=(new this.imports.ImageUrl).getImageUrlFromPyramid({x:parseInt(r.imgWidth,10),y:parseInt(r.imgHeight,10)},this._data.get("uri")).url:i=this._data.get("uri"),this._currentUri!==i&&(this._currentUri=i,this._img.setAttribute("src",i));var s={position:"static",width:Math.round(r.imgWidth)+1,height:parseInt(r.imgHeight,10),"margin-top":parseInt(r.imgTop,10),"margin-left":parseInt(r.imgLeft,10),"box-shadow":"#000 0 0 0","image-rendering":"optimizequality"};this._img.setStyles(s);var o={width:parseInt(e,10),height:parseInt(t,10),overflow:"hidden"};"wrapperWidth"in r&&(o.width=r.wrapperWidth),"wrapperHeight"in r&&(o.height=r.wrapperHeight),this._$width=o.width,this._$height=o.height,this._view.setStyles(o),this.fireEvent("autoSizeChange")},getAcceptableDataTypes:function(){return["Image"]}}}),define.oldComponent({name:"wixapps.integration.components.InlineText",imports:["mobile.core.components.base.BaseComponent"],skinParts:{},Class:{Extends:"wysiwyg.viewer.components.WRichText",_updateText:function(){var e=this._data.get("text");e=e.replace("<p","<span"),e=e.replace("</p","</span"),this._view.set("html",e)},getRichTextContainer:function(){return this._skinParts?this._view:null}}}),define.component("wixapps.integration.components.LinkSelector",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_onClick"]),t.skinParts({description:{type:"htmlElement"}}),t.states(),t.dataTypes(["Text"]),t.fields({_descriptionVisibility:!1}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this._descriptionVisibility=n&&n.descriptionVisible||!1},_onAllSkinPartsReady:function(e){e.description.addEvent("click",this._onClick)},_onClick:function(e){this.fireEvent(Constants.CoreEvents.CLICK,e)},render:function(){this.parent(),this.setDescriptionVisibility(this._descriptionVisibility)},setDescriptionVisibility:function(e){this._descriptionVisibility=e,this._skinParts.description.set("text",e?this._data.get("text"):""),this._skinParts.description.set("title",e?"":this._data.get("text"))}})}),define.oldComponent({name:"wixapps.integration.components.MultiColumnList",imports:["wysiwyg.viewer.utils.ComponentSequencer"],Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:[],_columns:3,_columnWidth:0,initialize:function(e,t,n){this.parent(e,t,n),this._sequencer=new this.imports.ComponentSequencer;if(!n||!n.sequencingHook)throw new Error("No sequencer");this._sequencer.resolveItem=n.sequencingHook},_onAllSkinPartsReady:function(){this._sequencer.addEvent("componentSetup",function(e){this._onDisplayerCreation(e.compView,e.method,e.index)}.bind(this)),this._sequencer.addEvent("productionFinished",function(e){this._onSequencerFinished(e)}.bind(this))},getAcceptableDataTypes:function(){return["ImageList"]},render:function(){this._columnWidth=this._view.getSize().x/this._columns,this._sequencer.createComponents(this._skinParts.itemsContainer,this._data.get("items").slice(0,this._numCols*this._numRows))},_onSequencerFinished:function(e){},_onDisplayerCreation:function(e,t,n){e.setStyles({width:this._columnWidth})},getSequencer:function(){return this._sequencer}}}),define.component("wixapps.integration.components.PaginatedGridGallery",function(e){var t=e;t.inherits("wysiwyg.viewer.components.MatrixGallery"),t.utilize(["wysiwyg.viewer.utils.MatrixTransitions","wysiwyg.viewer.utils.GalleryUtils"]),t.resources(["W.Utils"]),t.traits(["wysiwyg.viewer.components.traits.GalleryAutoplay"]),t.binds(["next","prev","_onTransitionComplete","_onRollOut","_onMouseMove","_onClick","_onRollOverViewCreated"]),t.skinParts({itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement",optional:!0},rolloverHolder:{type:"htmlElement",optional:!0},rolloverContent:{type:"htmlElement",optional:!0},title:{type:"htmlElement",optional:!0},description:{type:"htmlElement",optional:!0},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!0}}),t.states({rendering:["pending","ready"],itemSelection:["rollover","idle"],linkableComponent:["link","noLink"]}),t.propertiesSchemaType("PaginatedGridGalleryProperties"),t.fields({_pageItemsCount:0,_currentItemIndex:0,_displayerDict:{},_transitionPending:!1,_transitionUtils:null,_linkUtils:null,_hasRollOver:!0,_NO_LINK_PROPAGATION:!0}),t.methods({initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this._transitionsOn=!1,this._transitionUtils=new this.imports.MatrixTransitions,this._linkUtils=this.resources.W.Utils.linkUtils,this._view.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onMouseMove),this._view.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onRollOut),"fixedRowNumber"in n&&(this._fixedRowNumber=n.fixedRowNumber===!0),n.sequencingHook===undefined&&(this._sequencer.resolveItem=function(){return{comp:"wysiwyg.viewer.components.ImageLite",skin:"mobile.core.skins.InlineSkin"}}),n.rolloverHook&&(this._rolloverSequencer=new this.imports.ComponentSequencer,this._rolloverSequencer.resolveItem=n.rolloverHook,this._rolloverSequencer.addEvent("componentSetup",this._onRollOverViewCreated)),n.sequencingHook&&!n.rolloverHook&&(this._hasRollOver=!1)},getSequencer:function(){return this._sequencer},getRolloverSequencer:function(){return this._rolloverSequencer},_onAllSkinPartsReady:function(){this.parent(),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.itemsContainer.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder&&(this._skinParts.rolloverHolder.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder.setStyles({overflow:"hidden"}));var e=this.injects().Utils.getCSSBrowserFeature("user-select"),t={cursor:"pointer"};e&&(t[e]="none"),this._skinParts.buttonPrev.setStyles(t),this._skinParts.buttonNext.setStyles(t),this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.CLICK,function(e){e.stopPropagation(),this.prev()}.bind(this)),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.CLICK,function(e){e.stopPropagation(),this.next()}.bind(this)),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._transitionUtils.setupTransitionMap(this._calcItemPosition.bind(this),this._skinParts.itemsContainer),this._checkSkinPartsVisibility()},_getRowNumber:function(){return this._fixedRowNumber===!0?parseInt(this.getComponentProperty("maxRows"),10):this.parent()},_calculateItemSize:function(){if(this._skinParts&&this._data.get("items").length>0){var e={x:this.getWidth(),y:this.getHeight()},t=e.x-this._widthDiff,n=e.y-this._heightDiff;this._itemWidth=Math.max(Math.floor((t-(this._numCols-1)*this._gap)/this._numCols),0),this._itemHeight=Math.max(Math.floor((n-(this._numRows-1)*this._gap)/this._numRows),0)}},_onResize:function(){this.parent(),this._skinParts&&this._resetRollOver()},_onResizeEnd:function(){this._skinParts&&this._skinParts.itemsContainer.getChildren().forEach(function(e,t){this._updateDisplayerGeometry(e,t)}.bind(this))},_onDataChange:function(e,t){this._currentItemIndex=0,this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber(),10),this._componentReady&&e===this._data&&this._skinParts.itemsContainer.empty(),this.parent.apply(this,arguments),this._checkSkinPartsVisibility()},render:function(){var e=this._data.get("items");this._displayerDict={},this._skinParts.counter&&this._skinParts.counter.set("text",this._getCounterText(this._currentItemIndex,e.length)),this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber(),10),this._displayedItems=this._getPageItems(e,this._currentItemIndex);var t=this._displayedItems;e.length>this._pageItemsCount?(this._nextPageItems=this._getPageItems(e,this._getNextPageItemIndex()),this._prevPageItems=this._getPageItems(e,this._getPrevPageItemIndex()),t=t.concat(this._nextPageItems).concat(this._prevPageItems),this._skinParts.buttonNext.setStyles({display:"block"}),this._skinParts.buttonPrev.setStyles({display:"block"})):(this._skinParts.buttonNext.setStyles({display:"none"}),this._skinParts.buttonPrev.setStyles({display:"none"})),this._sequencer.createComponents(this._skinParts.itemsContainer,t)},_getPageItems:function(e,t){var n=[],r=Math.min(this._numItems-1,t+this._pageItemsCount-1);for(var i=t;i<=r;i++)n.push(e[i]);return n},_translateRefList:function(e){var t,n=[],r,i,s=this._skinParts.itemsContainer.children,o=typeOf(e[0]);e=e.slice(0);for(var u=0;u<s.length;u++)t=s[u],r=t.getLogic().getDataItem(),i=o==="string"?"#"+r.get("id"):r,e.contains(i)&&(n.push(t),e.splice(e.indexOf(i),1));return n},_checkSkinPartsVisibility:function(){this._skinParts&&(this._resetRollOver(),this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"),this._skinParts.rolloverHolder&&this._skinParts.rolloverHolder.setStyle("cursor",this.getComponentProperty("expandEnabled")?"pointer":"default"))},_updateState:function(){},_onDisplayerCreation:function(e,t,n){var r,i=e.getViewNode();e.getRef?r=e.getRef():r="#"+e.getDataItem().get("id"),i.addClass("galleryDisplayer"),this._displayerDict[r]=e,this._updateDisplayerGeometry(i,n)},_updateDisplayerGeometry:function(e,t){this._setupItem(e),t>=this._displayedItems.length&&e.setStyles({top:-this._itemHeight*1.5,position:"absolute"})},_onSequencerFinished:function(e){e.elements=e.elements.slice(0,this._displayedItems.length),this.parent(e),this._transitionPending=!1,this.fireEvent("transitionFinished")},gotoNext:function(){this.next()},next:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&(this._currentItemIndex=this._getNextPageItemIndex(),this._goto(this._nextPageItems,0))},prev:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&(this._currentItemIndex=this._getPrevPageItemIndex(),this._goto(this._prevPageItems,1))},_getNextPageItemIndex:function(){var e=this._currentItemIndex+this._pageItemsCount;return e>=this._numItems&&(e=0),e},_getPrevPageItemIndex:function(){var e=this._currentItemIndex-this._pageItemsCount;return e<0&&(e=(this._getTotalPageCount()-1)*this._pageItemsCount),e},_getTotalPageCount:function(){var e=Math.floor(this._numItems/this._pageItemsCount);return this._numItems%this._pageItemsCount>0&&e++,e},_getCounterText:function(e,t){var n=Math.floor(e/this._pageItemsCount),r=Math.max(this._getTotalPageCount(),1);return String(n+1)+"/"+String(r)},_goto:function(e,t){this._transitionPending=!0,this._resetRollOver();var n=this._translateRefList(this._displayedItems),r=this._translateRefList(e),i=this._transitionUtils.getTransition(this.getComponentProperty("transition"));this._setupAllItems(r),i(n,r,this._numCols,this._numRows,t,parseFloat(this.getComponentProperty("transDuration")),function(){Array.each(n,function(e){e.getLogic?e.getLogic().dispose():e.destroy()}),this._onTransitionComplete(r)}.bind(this))},_onTransitionComplete:function(){this.render()},_onMouseMove:function(e){if(this._transitionPending===!0)return;var t=this._findDisplayerFromPosition(e.page);if(t&&this._skinParts.rolloverHolder&&this._hasRollOver){if(this._highlightedDisplayer!==t){this._highlightedDisplayer=t;var n=t.getCoordinates(this._skinParts.rolloverHolder.getParent());this._skinParts.rolloverHolder.setStyles({visibility:"visible",position:"absolute",padding:0,left:n.left,top:n.top,width:n.width,height:n.height}),this._skinParts.rolloverHolder.uncollapse(),this.setState("idle"),window.requestAnimFrame(function(){if(this._highlightedDisplayer){this._updateDisplayerInfo(t.getLogic().getDataItem());var e=this._highlightedDisplayer.getLogic().getDataItem();if(e.getType&&e.getType()==="Image"){var n=this.getSkinPart("link");this._linkUtils.linkifyElement(this,n,e,!0)}this.setState("rollover")}}.bind(this))}}else this._resetRollOver()},_onRollOut:function(e){e.relatedTarget&&!e.relatedTarget.getParents().contains(this._view)&&this._resetRollOver()},_findDisplayerFromPosition:function(e){var t,n=this._skinParts.itemsContainer.getPosition(),r={x:e.x-n.x,y:e.y-n.y},i=Math.floor(r.x/(this._itemWidth+this._gap)),s=Math.floor(r.y/(this._itemHeight+this._gap));if(i>=0&&s>=0){var o=s*this._numCols+i;o<this._galleryItems.length&&(t=this._galleryItems[o])}return t},_findDisplayer:function(e){while(e){if(e===this._skinParts.itemsContainer)return null;if(this._galleryItems.contains(e))return e;e=e.getParent()}return null},_updateDisplayerInfo:function(e){if(this._skinParts.rolloverHolder&&this._rolloverSequencer){var t=this._skinParts.rolloverContent||this._skinParts.rolloverHolder;this._rolloverSequencer.createComponents(t,[e])}else e&&e.getData&&"title"in e.getData()&&"description"in e.getData()&&(this._skinParts.title.set("text",e.get("title")),this._skinParts.description.set("text",e.get("description")))},_onRollOverViewCreated:function(e){this._setupItem(e.compView)},_hideRollOverHolder:function(){this.setState("idle"),this._skinParts.rolloverHolder.collapse()},_resetRollOver:function(){this._hideRollOverHolder(),this._highlightedDisplayer=null},_onClick:function(e){var t;if(e.rightClick===!1&&this.getComponentProperty("expandEnabled")===!0){var n=this._highlightedDisplayer||this._findDisplayer(e.target);if(n){t=n.getLogic().getDataItem();if(t.get){var r=t.get("id"),i=this._data.get("items"),s=i.indexOf("#"+r);this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._data,currentIndex:s,getDisplayerDivFunction:this.injects().Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:function(e,t){this.injects().Data.getDataItem(e,function(e){t({id:e.get("id"),title:e.get("title")})})}.bind(this)})}}}}})}),define.oldComponent({name:"wixapps.integration.components.Toggle",skinParts:{on:{type:"htmlElement"},off:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["toggle"],_states:["on","off"],initialize:function(e,t,n){this.parent(e,t,n),this._createOnHook=n.createOnHook,this._createOffHook=n.createOffHook,this._initialState=n.initialState,this._listensToPartsClick=n.listensToPartsClick},_onAllSkinPartsReady:function(e){this._listensToPartsClick&&(e.on.addEvent("click",this.toggle),e.off.addEvent("click",this.toggle)),this._createOnHook(e.on),this._createOffHook(e.off),this.setState(this._initialState=="on"?"on":"off")},turnOn:function(){this.setState("on")},turnOff:function(){this.setState("off")},toggle:function(){this.getState()=="on"?this.turnOff():this.turnOn(),this.fireEvent("wix:toggle",{state:this.getState()})},_onResize:function(){this.parent()}}}),define.oldComponent({name:"wixapps.integration.components.VerticalListEditor",skinParts:{inlineContent:{type:"htmlElement"}},imports:[],Class:{Extends:"wysiwyg.viewer.components.VerticalRepeater",Binds:["_sequencingHook","_onItemsUpdated","_startDragChild","_onItemEndDrag","_onItemDrag"],initialize:function(e,t,n){this.parent(e,t,n),this._sequencer.addEvent("productionFinished",this._onItemsUpdated),this._dragEnabled=n.dragEnabled,this._dragEventsHandler=n.dragEventHandler||{onDragItemCopyCreated:function(e){},disposeDragItemCopy:function(e){e.getLogic().dispose()}},this._maxDragIndex=n.maxDragIndex!==undefined?n.maxDragIndex:-1},render:function(){if(!this._data)return;this._sequencer.createComponents(this._skinParts.inlineContent,this._data.get("items")),this._hideShowContainers()},setDragEnabled:function(e){this._dragEnabled=e},_onItemsUpdated:function(e){if(e.elements.length===0)return;this._items=e.elements;for(var t=0;t<this._items.length;t++)this._listenToItem(this._items[t],t)},_listenToItem:function(e,t){var n=this;if(e.hasClass("container"))return;e.addEvent("click",function(r){n.fireEvent("itemClick",{idx:t,element:e,dataItem:n._data.get("items")[t]})}),e.addEvent(Constants.CoreEvents.MOUSE_DOWN,function(r){n._startDragChild(e,t,r)})},_startDragChild:function(e,t,n){if(!this._dragEnabled)return;this._startIdx=t,this._body=this._body||$$("body"),this._basePos=this._view.getPosition().y,this._itemPos=e.getPosition().y;var r=n.client.y+window.getScroll().y;this._deltaY=r-this._itemPos,this._startMousePos=r,this._startedDrag=!1,this._body.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onItemDrag),this._body.addEvent(Constants.CoreEvents.MOUSE_UP,this._onItemEndDrag)},_doStartDrag:function(){var e=this._data.get("items"),t=this._items[this._startIdx];this._movedItem=t.dispose();var n=e[this._startIdx];this.createFloatingItem(n,e)},createFloatingItem:function(e,t){this._childCopy=this._sequencer.createComponent(this._view,e,this._startIdx,t);var n=this._childCopy.get("comp");if(!n){var r=this._childCopy.getElements("[comp]");for(var i=0;i<r.length;i++){var s=r[i];s.addEvent(Constants.ComponentEvents.WIXIFIED,function(){var e=this.getLogic();e.setDragged&&e.setDragged()})}}else this._childCopy.addEvent(Constants.ComponentEvents.WIXIFIED,function(){this._childCopy.getLogic().setDragged()}.bind(this));this._childCopy.setStyles({position:"absolute",left:"0px",top:this._itemPos-this._basePos,width:"100%"}),this._view.grab(this._childCopy),this._dragEventsHandler.onDragItemCopyCreated(this._childCopy)},_onItemDrag:function(e){var t=e.client.y+window.getScroll().y,n=3;!this._startedDrag&&Math.abs(t-this._startMousePos)>n&&(this._startedDrag=!0,this._doStartDrag());if(!this._startedDrag)return;var r=t-this._basePos-this._deltaY+this._view.getScrollTop();this._childCopy.setStyle("top",r);var i=this._getNewItemIndex(e);if(i<this._maxDragIndex)return;var s=this._items[i];i>this._items.length-1?this._movedItem.inject(this._skinParts.inlineContent):i>-1&&this._movedItem.inject(s,"before"),this._hideShowContainers()},_getNewItemIndex:function(e){var t=-1,n,r,i=e.client.y+window.getScroll().y;for(var s=0;s<this._items.length-1;s++){r=this._items[s].getPosition().y+(this._items[s+1].getPosition().y-this._items[s].getPosition().y)/2,t=s;if(i<r){n=!0;break}}if(!n){var o=this._items.length-1;r=this._items[o].getPosition().y+this._items[o].getSize().y/2,i<r?t=o:t=o+1}return t},_hideShowContainers:function(){var e=this._skinParts.inlineContent.getElements(".container");Array.each(e,function(e){var t=e.getElement(".container-box"),n=e.getNext();!n||n&&n.hasClass("container")?(t.removeClass("hidden"),e.setStyle("opacity","0.4")):(t.addClass("hidden"),e.setStyle("opacity","1"))})},_onItemEndDrag:function(e){this._body.removeEvent(Constants.CoreEvents.MOUSE_MOVE,this._onItemDrag),this._body.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onItemEndDrag);if(!this._startedDrag)return;var t=this._skinParts.inlineContent.getChildren().indexOf(this._movedItem);this._dragEventsHandler.disposeDragItemCopy(this._childCopy),this.fireEvent("itemMoved",{idx:t,oldIdx:this._startIdx,dataItem:this._data.get("items")[this._startIdx]})}}}),define.component("wixapps.integration.components.inputs.CheckBoxGroupInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.binds(["_handleSingleCheckboxClick"]),t.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),t.dataTypes(["MultiSelectableList"]),t.states({validity:["valid","invalid"]}),t.fields({}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validity")}.bind(this)),this._checkboxGroupName=n.checkboxGroupName||"cbGroup"},_onAllSkinPartsReady:function(){this._createCheckboxGroup()},_createCheckboxGroup:function(){var e=function(e){this._optionsData=Object.values(e),this._bindCheckboxGroupToData(this._skinParts.collection)}.bind(this);this._selectedOptions=this.getDataItem().get("selected");var t=this.getDataItem().get("items").filter(function(e){return e.get("enabled")});t.length>0&&typeof t[0]=="string"?this.injects().Data.getDataByQueryList(t,e):e(t)},_bindCheckboxGroupToData:function(e){e.empty();for(var t=0;t<this._optionsData.length;t++){var n=this._optionsData[t],r=n.get("value"),i=new Element("Input",{type:"checkbox",name:this._checkboxGroupName,value:r,idInData:t});e.grab(i,"bottom"),e.addEvent("click",this._handleSingleCheckboxClick),e.innerHTML+=n.get("text")+"<BR/>"}this._setSelected(e)},_setSelected:function(e){var t=this.getDataItem().get("selected"),n=e.getElements('input[name="'+this._checkboxGroupName+'"]');t&&Array.each(t,function(e){var t=this._optionsData.indexOf(e);t>-1&&t<n.length&&n[t].set("checked","checked")}.bind(this))},_handleSingleCheckboxClick:function(e){var t=e.target,n=this.getDataItem().get("selected"),r=t.getAttribute("idInData"),i=this._optionsData[r];t.checked?n.push(i):n.erase(i),this.getDataItem().set("selected",n),this.getDataItem().fireDataChangeEvent("selected",n),this.fireEvent("selectionChanged",i)},setError:function(e){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",e)}})}),define.dataSchema("DateInputProperties",{allowEmpty:{type:"boolean","default":!0,description:"If set to false will not have empty options in the combo-boxes and the default value will be set to the current date."}}),define.component("wixapps.integration.components.inputs.DateInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_userChange"]),t.skinParts({year:{type:Constants.ComponentPartTypes.HTML_ELEMENT},month:{type:Constants.ComponentPartTypes.HTML_ELEMENT},day:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),t.states({validation:["invalid"],allowEmpty:["allowEmpty","hideEmpty"]}),t.dataTypes(["Text"]),t.propertiesSchemaType("DateInputProperties"),t.fields({_invalidDateString:"Invalid Date",_emptyYearText:"YYYY",_emptyMonthText:"MM",_emptyDayText:"DD"}),t.methods({initialize:function(e,t,n){this.parent(e,t,n)},showValidationMessage:function(e){this.setState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text",e)},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text","")},_onAllSkinPartsReady:function(){this._skinParts.year.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.month.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.day.addEvent(Constants.CoreEvents.CHANGE,this._userChange);var e=new Option(this._emptyYearText,this._emptyYearText);e.addClass("empty"),this._skinParts.year.options.add(e),e=new Option(this._emptyMonthText,this._emptyMonthText),e.addClass("empty"),this._skinParts.month.options.add(e);var t=(new Date).getFullYear(),n;for(n=(new Date(0)).getFullYear();n<t+6;n++)this._skinParts.year.options.add(new Option(n,n));for(n=1;n<13;n++)this._skinParts.month.options.add(new Option(n,n))},render:function(){var e,t,n=this._data.get("text"),r=new Date(n),i=r.getFullYear(),s=r.getMonth()+1,o=r.getDate(),u=this._allowEmpty();this.setState(u?"allowEmpty":"hideEmpty","allowEmpty");if(u){if(r.toString()==this._invalidDateString){if(this._skinParts.day.options.length===0){t=new Option(this._emptyDayText,this._emptyDayText),t.addClass("empty"),this._skinParts.day.options.add(t);for(e=1;e<this._getDaysForMonth(i,s)+1;e++)this._skinParts.day.options.add(new Option(e,e));this._setSelectedValue(this._skinParts.day,this._emptyDayText)}return}if(r.getTime()===0){this._skinParts.day.innerHTML="",t=new Option(this._emptyDayText,this._emptyDayText),t.addClass("empty"),this._skinParts.day.options.add(t);var a=this._getDaysForMonth(i,s);for(e=1;e<=a;e++)this._skinParts.day.options.add(new Option(e,e));this._setSelectedValue(this._skinParts.year,this._emptyYearText),this._setSelectedValue(this._skinParts.month,this._emptyMonthText),this._setSelectedValue(this._skinParts.day,this._emptyDayText);return}}this._skinParts.day.innerHTML="",t=new Option(this._emptyDayText,this._emptyDayText),t.addClass("empty"),this._skinParts.day.options.add(t);for(e=1;e<this._getDaysForMonth(i,s)+1;e++)this._skinParts.day.options.add(new Option(e,e));this._setSelectedValue(this._skinParts.year,i),this._setSelectedValue(this._skinParts.month,s),this._setSelectedValue(this._skinParts.day,o)},_setSelectedValue:function(e,t){var n=Array.from(e.options).filter(function(e){return e.value==t});n.length&&(n[0].selected=!0)},_isValidDate:function(){return this._skinParts.year.getSelected()[0].value!=this._emptyYearText&&this._skinParts.month.getSelected()[0].value!=this._emptyMonthText&&this._skinParts.day.getSelected()[0].value!=this._emptyDayText},_isEmptyDate:function(){return this._skinParts.year.getSelected()[0].value==this._emptyYearText&&this._skinParts.month.getSelected()[0].value==this._emptyMonthText&&this._skinParts.day.getSelected()[0].value==this._emptyDayText},_userChange:function(){var e=new Date(0);if(this._isEmptyDate())this.getDataItem().set("text",e.toISOString()),this.fireEvent("selectionChanged",e.toISOString());else if(this._isValidDate()){e.setFullYear(this._skinParts.year.getSelected()[0].value),e.setMonth(this._skinParts.month.getSelected()[0].value-1);var t=this._getDaysForMonth(e.getFullYear(),e.getMonth()+1);e.setDate(t<this._skinParts.day.getSelected()[0].value?t:this._skinParts.day.getSelected()[0].value),this.getDataItem().set("text",e.toISOString()),this.fireEvent("selectionChanged",e.toISOString())}else this.getDataItem().set("text",this._invalidDateString),this.fireEvent("selectionChanged",this._invalidDateString)},_allowEmpty:function(){return this.getComponentProperty("allowEmpty")===!0||this.getComponentProperty("allowEmpty")==="true"},_getDaysForMonth:function(e,t){return e=e||(new Date).getFullYear(),t=t,(new Date(e,t,0)).getDate()}})}),define.component("wixapps.integration.components.inputs.InlineTextInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_onPreviewClicked","_onInputBlur","_onKeyUp"]),t.skinParts({preview:{type:"htmlElement"},input:{type:"htmlElement"}}),t.states(["preview","input"]),t.dataTypes(["Text"]),t.fields({}),t.methods({render:function(){this.setState("preview");var e=this.getDataItem().get("text");this._skinParts.preview.set("text",e),this._skinParts.input.set("value",e)},_onAllSkinPartsReady:function(){this._listenToInput()},getValue:function(){return this._skinParts.preview.get("text")},_onPreviewClicked:function(e){this._skinParts.input.set("value",this.getValue()),this.setState("input"),this._skinParts.input.select()},_onKeyUp:function(e){e=e||window.event,e.code==13&&this._onInputCaptureDone(e)},_onInputBlur:function(e){this._onInputCaptureDone(e)},_onInputCaptureDone:function(e){var t=this.getValue(),n=this._skinParts.input.get("value");if(n&&n!==t){this._skinParts.preview.set("text",n),this._data.set("text",n);var r={value:n,origEvent:e,compLogic:this};this.fireEvent("inputChanged",r)}this.setState("preview")},_listenToInput:function(){this._skinParts.preview.addEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._onKeyUp),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._onInputBlur)},_stopListeningToInput:function(){this._skinParts.preview.removeEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._onKeyUp),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._onInputBlur)},dispose:function(){this._stopListeningToInput(),this.parent()}})}),define.component("wixapps.integration.components.inputs.LocationSelector",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_handleSearch","_handleAddressKeyDown"]),t.skinParts({address:{type:Constants.ComponentPartTypes.HTML_ELEMENT},viewMode:{type:Constants.ComponentPartTypes.HTML_ELEMENT},message:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),t.states({validation:["invalid"],viewMode:["loading","error","found","search"]}),t.dataTypes(["GeoMap"]),t.propertiesSchemaType("GoogleMapProperties"),t.fields({API_KEY:"AIzaSyBnz6ANN4hVboRWYKZGVT44WJjfmsso9B4",geocoder:null}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.setState("search","viewMode")},showValidationMessage:function(e){this.setState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",e),this._skinParts.message.uncollapse())},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",""),this._skinParts.message.collapse())},render:function(){var e=this.getDataItem().get("address");this._skinParts.address.value=e},_onAllSkinPartsReady:function(){this._skinParts.address.addEvent(Constants.CoreEvents.KEY_DOWN,this._handleAddressKeyDown),this._skinParts.address.addEvent(Constants.CoreEvents.BLUR,this._handleSearch),this._skinParts.viewMode.addEvent(Constants.CoreEvents.CLICK,this._handleSearch)},_handleAddressKeyDown:function(e){if(e.code==13)e.stop(),this._getGeoLocationFromAddress(this._skinParts.address.value);else{var t=this.getDataItem();t.set("latitude",-1970,!0),t.set("longitude",-1970,!0),this.setState("search","viewMode")}},_handleSearch:function(e){this.getState("viewMode")==="search"&&this._getGeoLocationFromAddress(this._skinParts.address.value)},_getGeoLocationFromAddress:function(e){this.setState("loading","viewMode");if(this.geocoder===null){var t=new Request.JSONP({url:"http://maps.googleapis.com/maps/api/js?key="+this.API_KEY+"&sensor=true",onComplete:function(){var t=window.google;this.geocoder=new t.maps.Geocoder,this._getGeoLocationFromAddress(e)}.bind(this)});t.send();return}var n=this.getDataItem();if(e.trim().length===0){this.resetInvalidState(),n.set("latitude",1970,!0),n.set("longitude",1970,!0),n.set("address","",!0),n.fireDataChangeEvent(),this.setState("search","viewMode");return}this.geocoder.geocode({address:e},function(t,n){var r=this.getDataItem(),i=window.google;if(n==i.maps.GeocoderStatus.OK){this.resetInvalidState();var s=t[0].geometry.location;r.set("latitude",s.lat(),!0),r.set("longitude",s.lng(),!0),r.set("address",t[0].formatted_address,!0),r.fireDataChangeEvent(),this.setState("found","viewMode")}else this.showValidationMessage("We couldn't find this address, enter another one or leave it empty"),r.set("address",e,!0),r.set("latitude",-1970,!0),r.set("longitude",-1970,!0),r.fireDataChangeEvent(),this.setState("error","viewMode")}.bind(this))}})}),define.dataSchema("TextInputProperties",{label:"string",placeholder:"string"}),define.component("wixapps.integration.components.inputs.TextInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_changeEventHandler","_fireBlur","_fireKeyUp","_selectPresetFieldContent","_deselectPresetFieldContent"]),t.skinParts({input:{type:"htmlElement"}}),t.states({label:["hasLabel","noLabel"],validation:["invalid"]}),t.dataTypes(["Text"]),t.propertiesSchemaType("TextInputProperties"),t.fields({}),t.methods({render:function(){this.setLabel(this.getComponentProperty("label")),this.setValue(this.getDataItem().get("text"),!1),this.setPlaceholder(this.getComponentProperty("placeholder"))},_onAllSkinPartsReady:function(){this.addEvent("inputChanged",function(e){this._ignoreUpdate=!0,this.getDataItem().set("text",e.value),this._ignoreUpdate=!1}.bind(this)),this.resetInvalidState(),this._listenToInput()},dispose:function(){this._stopListeningToInput(),this.parent()},setPlaceholder:function(e){this._skinParts.input.set("placeholder",e),window.Modernizr&&!window.Modernizr.input.placeholder&&this._placeholderPolyFill()},_placeholderPolyFill:function(){function e(e){var t=e.target;t.get("value")===""&&t.get("placeholder")&&(t.addClass("isPlaceholder"),t.set("value",t.get("placeholder")))}function t(e){var t=e.target;t.hasClass("isPlaceholder")&&(t.removeClass("isPlaceholder"),t.set("value",""))}this.hasPlaceholder||(this.hasPlaceholder=!0,this._skinParts.input.addEvent("focus",t),this._skinParts.input.addEvent("blur",e),e({target:this._skinParts.input}))},setLabel:function(e){e&&typeof e=="string"?(this.setState("hasLabel","label"),this._skinParts.label.set("html",e),this._skinParts.label.uncollapse()):(this.setState("noLabel","label"),this._skinParts.label.set("html",""),this._skinParts.label.collapse())},showValidationMessage:function(e){this.setState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",e),this._skinParts.message.uncollapse())},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&(this._skinParts.message.set("text",""),this._skinParts.message.collapse())},setValue:function(e,t){var n=this._skinParts.input;this.hasPlaceholder&&n.removeClass("isPlaceholder"),this._ignoreUpdate||n.set("value",e),t?n.set("isPreset","true"):n.erase("isPreset")},_changeEventHandler:function(e){if(e.code&&!W.Utils.isInputKey(e.code))return;this._skinParts.input.set("isPreset","");var t=this.getValue();t=this.injects().Utils.convertToHtmlText(t);var n={value:t,origEvent:e,compLogic:this};this.fireEvent("inputChanged",n)},_selectPresetFieldContent:function(e){e.target.get("isPreset")&&(e.target.get("isSelected")||(e.target.set("isSelected","true"),e.target.select()))},_deselectPresetFieldContent:function(e){e.target.erase("isSelected")},_fireBlur:function(e){this.fireEvent(Constants.CoreEvents.BLUR,e)},_fireKeyUp:function(e){this.fireEvent(Constants.CoreEvents.KEY_UP,e)},_listenToInput:function(){this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.addEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.CLICK,this._selectPresetFieldContent),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._deselectPresetFieldContent),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_stopListeningToInput:function(){this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.removeEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.CLICK,this._selectPresetFieldContent),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._deselectPresetFieldContent),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._fireBlur)},getValue:function(){var e=this._skinParts.input,t="";return e.hasClass("isPlaceholder")||(t=e.get("value")),t}})}),define.dataSchema("TimeInputProperties",{resolution:{type:"string","enum":["hours","half-hour","quarter-hour","minutes","seconds"],"default":"minutes",description:"Specify the resolution of the time selector"},hourFormat:{type:"string","enum":["12h","24h"],"default":"12h",description:"Specify the format of the hour field in the time selector (12h / 24h)"},allowEmpty:{type:"boolean","default":!0,description:"If set to false will not have empty options in the combo-boxes and the default value will be set to the current date."}}),define.component("wixapps.integration.components.inputs.TimeInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize([]),t.traits([]),t.binds(["_userChange"]),t.skinParts({hours24:{type:Constants.ComponentPartTypes.HTML_ELEMENT},hours12:{type:Constants.ComponentPartTypes.HTML_ELEMENT},minutes:{type:Constants.ComponentPartTypes.HTML_ELEMENT},seconds:{type:Constants.ComponentPartTypes.HTML_ELEMENT},ampm:{type:Constants.ComponentPartTypes.HTML_ELEMENT},message:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),t.states({resolution:["hours","half-hour","quarter-hour","minutes","seconds"],hourFormat:["12h","24h"],allowEmpty:["allowEmpty","hideEmpty"],validation:["invalid"]}),t.dataTypes(["Text"]),t.propertiesSchemaType("TimeInputProperties"),t.fields({_options:{minutes:[],quarterHour:[],halfHour:[]},_invalidDateString:"Invalid Date",_emptyHoursText:"HH",_emptyMinutesText:"MI",_emptySecondsText:"SS"}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this._buildMinuteOptionCache()},showValidationMessage:function(e){this.setState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text",e)},resetInvalidState:function(){this.removeState("invalid","validation"),this._skinParts.message&&this._skinParts.message.set("text","")},render:function(){var e=this._data.get("text"),t=this.getComponentProperty("resolution"),n=this.getComponentProperty("hourFormat"),r=this._allowEmpty();this.setState(t,"resolution"),this.setState(n,"hourFormat"),this.setState(r?"allowEmpty":"hideEmpty","allowEmpty");if(r&&e==this._invalidDateString)return;var i=new Date(e);isNaN(i.getTime())&&(i=r?new Date(0):new Date);var s=i.getHours(),o=i.getMinutes(),u=i.getSeconds();this._clearOptions(this._skinParts.minutes),t=="quarter-hour"&&(this._populateOptions(this._skinParts.minutes,this._options.quarterHour),o=parseInt((o+7.5)/15,10)*15%60,s=i.getMinutes()>52?s+1:s),t=="half-hour"&&(this._populateOptions(this._skinParts.minutes,this._options.halfHour),o=parseInt((o+15)/30,10)*30%60,s=i.getMinutes()>45?s+1:s),this._skinParts.minutes.options.length===0&&this._populateOptions(this._skinParts.minutes,this._options.minutes),r&&i.getTime()===0?(this._setSelectedValue(this._skinParts.hours12,this._emptyHoursText),this._setSelectedValue(this._skinParts.hours24,this._emptyHoursText),this._setSelectedValue(this._skinParts.minutes,this._emptyMinutesText),this._setSelectedValue(this._skinParts.seconds,this._emptySecondsText)):(s===0?(this._setSelectedValue(this._skinParts.hours12,12),this._setSelectedValue(this._skinParts.ampm,"PM")):(this._setSelectedValue(this._skinParts.hours12,s%12),this._setSelectedValue(this._skinParts.ampm,s>12?"PM":"AM")),this._setSelectedValue(this._skinParts.hours24,s),this._setSelectedValue(this._skinParts.minutes,o),this._setSelectedValue(this._skinParts.seconds,u))},_setSelectedValue:function(e,t){var n=Array.from(e.options).filter(function(e){return e.value==t});n.length&&(n[0].selected=!0)},_clearOptions:function(e){e.innerHTML=""},_populateOptions:function(e,t){for(var n=0;n<t.length;n++)e.options.add(t[n])},_formatTimePart:function(e,t){return t=t||" ",(t+e).substr(-2)},_onAllSkinPartsReady:function(){this._populateStaticOptions(),this._skinParts.hours24.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.hours12.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.minutes.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.seconds.addEvent(Constants.CoreEvents.CHANGE,this._userChange)},_isValidDate:function(){return(this.getState("hourFormat")=="24h"||this._skinParts.hours12.getSelected()[0].value!=this._emptyHoursText)&&(this.getState("hourFormat")=="12h"||this._skinParts.hours24.getSelected()[0].value!=this._emptyHoursText)&&(this.getState("resolution")=="hours"||this._skinParts.minutes.getSelected()[0].value!=this._emptyMinutesText)&&(this.getState("resolution")!="seconds"||this._skinParts.seconds.getSelected()[0].value!=this._emptySecondsText)},_isEmptyDate:function(){var e=this.getState("hourFormat")=="24h"&&this._skinParts.hours24.getSelected()[0].value==this._emptyHoursText||this.getState("hourFormat")=="12h"&&this._skinParts.hours12.getSelected()[0].value==this._emptyHoursText,t=this._skinParts.minutes.getSelected()[0].value==this._emptyMinutesText,n=this._skinParts.seconds.getSelected()[0].value==this._emptySecondsText;return this.getState("resolution")=="hours"?e:this.getState("resolution")=="seconds"?e&&t&&n:e&&t},_userChange:function(){var e=new Date(0),t;this._isEmptyDate()?(this.getDataItem().set("text",e.toISOString()),this.fireEvent("selectionChanged",e.toISOString())):this._isValidDate()?(this.getState("hourFormat")=="12h"?(t=this._skinParts.hours12.getSelected()[0].value,this._skinParts.ampm.getSelected()[0].value=="PM"?t=(parseInt(t,10)+12)%24:t=parseInt(t,10)):(t=this._skinParts.hours24.getSelected()[0].value,t=parseInt(t,10)),e.setHours(t),this.getState("resolution")!="hours"?e.setMinutes(parseInt(this._skinParts.minutes.getSelected()[0].value,10)):e.setMinutes(0),this.getState("resolution")=="seconds"?e.setSeconds(parseInt(this._skinParts.seconds.getSelected()[0].value,10)):e.setSeconds(0),e.setDate(5),this.getDataItem().set("text",e.toISOString()),this.fireEvent("selectionChanged",e.toISOString())):(this.getDataItem().set("text",this._invalidDateString),this.fireEvent("selectionChanged",this._invalidDateString))},_buildMinuteOptionCache:function(){var e,t,n;n=new Option(this._emptyMinutesText,this._emptyMinutesText),n.addClass("empty"),this._options.quarterHour.push(n),this._options.halfHour.push(n),this._options.minutes.push(n);for(e=0;e<60;e++)t=this._formatTimePart(e,"0"),n=new Option(t,e),e%15===0&&this._options.quarterHour.push(n),e%30===0&&this._options.halfHour.push(n),this._options.minutes.push(n)},_populateStaticOptions:function(){var e,t,n;this._skinParts.ampm.options.add(new Option("AM","AM")),this._skinParts.ampm.options.add(new Option("PM","PM")),n=new Option(this._emptyHoursText,this._emptyHoursText),n.addClass("empty"),this._skinParts.hours12.options.add(n);for(e=1;e<13;e++)t=this._formatTimePart(e),this._skinParts.hours12.options.add(new Option(t,e));n=new Option(this._emptyHoursText,this._emptyHoursText),n.addClass("empty"),this._skinParts.hours24.options.add(n);for(e=0;e<24;e++)t=this._formatTimePart(e),this._skinParts.hours24.options.add(new Option(t,e));n=new Option(this._emptySecondsText,this._emptySecondsText),n.addClass("empty"),this._skinParts.seconds.options.add(n);for(e=0;e<60;e++)t=this._formatTimePart(e,"0"),this._skinParts.seconds.options.add(new Option(t,e))},_allowEmpty:function(){return this.getComponentProperty("allowEmpty")===!0||this.getComponentProperty("allowEmpty")==="true"}})}),define.Class("wixapps.integration.gui.ChooseTemplatePresenter",function(e){var t=e;t.utilize(["wixapps.integration.managers.AppBuilderLocalizer"]),t.fields({_appInstance:null,_templateBundles:null,_onTemplateSelectedCB:null,_builderDialogPanel:null,_model:null,_localizer:null}),t.methods({initialize:function(e,t,n){this._appInstance=e,this._templateBundles=n,this._onTemplateSelectedCB=t,this._localizer=new this.imports.AppBuilderLocalizer},setupPresenter:function(e){var t=this._appInstance.getDataItemFactory();this._builderDialogPanel=e,this._model=t.createDataItem([]),this._getTemplateData()},_getLocalizedTitle:function(e){return this._localizer.localize("TEMPLATE_BUNDLE_NAME_"+e.id,e.friendlyName)},_getLocalizedDescription:function(e){return this._localizer.localize("TEMPLATE_BUNDLE_DESC_"+e.id,e.description)},_getTemplateData:function(){var e=this._templateBundles.map(function(e){var t="images/templates/"+e.id.toLowerCase()+".jpg";return{imageData:{_type:"wix:Image",src:t,width:360,height:280},title:this._getLocalizedTitle(e),description:this._getLocalizedDescription(e),id:e.id}}.bind(this));this._model.setValue(e)},onTemplateChosen:function(e){var t=e.data.getChildValue("id");this._onTemplateSelectedCB(t),this._builderDialogPanel.closeDialog(),e.cause.stopPropagation();var n=localStorage.getItem("app-builder-first-time-experience");n||(W.Commands.executeCommand("WEditorCommands.ShowHelpDialog","FirstTimeInAppBuilder"),localStorage.setItem("app-builder-first-time-experience","true"))},onTemplateMouseOver:function(e){var t=e.sender.getElement();t&&t.setStyles({"border-color":"#29a7eb","-webkit-box-shadow":"0px 2px 11px 2px rgba(0, 0, 0, .4)","box-shadow":"0px 2px 11px 2px rgba(0, 0, 0, .4)"});var n=t.getElement("[vcfield='hoverButton']");if(n){n.uncollapse();var r=n.getViewProxy();r._onAppResize&&r._onAppResize();var i=n.getElement("a");i&&i.setStyle("cursor","pointer")}var s=t.getElement("[vcfield='imageData']");if(s){var o=s.getElement("a");o&&o.setStyle("cursor","pointer")}},onTemplateMouseOut:function(e){var t=e.sender.getElement();t&&t.setStyles({"border-color":"transparent","-webkit-box-shadow":"none","box-shadow":"none"});var n=t.getElement("[vcfield='hoverButton']");if(n){n.collapse();var r=n.getViewProxy();r._onAppResize&&r._onAppResize()}},getModel:function(){return this._model},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.CustomizationBinding",function(e){var t=e;t.binds(["_onInputProxyChange","_onColorSelectorChange","_onCustomizationChange"]),t.fields({_appInstance:null,_customization:null,_inputToCustomizationFn:null,_customizationToInputFn:null,_inputProxy:null,_listener:null}),t.resources(["W.Commands","W.UndoRedoManager"]),t.utilize(["wixapps.integration.utils.FunctionCallThrottle","wixapps.core.views.ViewsCustomizer"]),t.methods({initialize:function(e){this._appPart=e,this._appInstance=this._appPart.getAppInstance()},setupAutoPanelBinding:function(e,t,n,r,i){this._inputProxy=e,this._customization=t,this._inputToCustomizationFn=r,this._customizationToInputFn=i;var s=this._customization.value;s===undefined&&(s=n),this._updateInputProxyValue(s),this._inputProxy.addEvent("inputChanged",this._onInputProxyChange),this._inputProxy.addEvent("colorChanged",this._onColorSelectorChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.CustomizationChangeMade",this,this._onCustomizationChange)},setListener:function(e){this._listener=e},_updateInputProxyValue:function(e){if(this._customizationToInputFn){var t=this._customizationToInputFn(e);t!==undefined&&(e=t)}e!==undefined&&this._inputProxy.setValue(e)},updateInputProxyValueWithNewRule:function(e){e.forType==this._customization.forType&&e.view==this._customization.view&&e.fieldId==this._customization.fieldId&&e.mode==this._customization.mode&&e.key==this._customization.key&&this._updateInputProxyValue(e.value)},_onInputProxyChange:function(e){this._processProxyValue(e.value)},_onColorSelectorChange:function(e){this._processProxyValue(e.color)},_processProxyValue:function(e){var t=this._customization;if(this._inputToCustomizationFn){var n=this._inputToCustomizationFn(e);if(n===undefined)return;e=n}var r=this._appInstance.getViewDefinitions().getViewDefinition(t.forType,t.view),i=r.getValue();this.resources.W.UndoRedoManager.startTransaction();var s={forType:t.forType,view:t.view,fieldId:t.fieldId,mode:t.mode,key:t.key,value:e},o=this._appInstance.getViewsCustomizer().getCurrentRule(i,s);this.applyCustomizationRule(i,s),r.setValue(i),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.CustomizationChange",{viewDef:i,viewRepo:this._appInstance.getViewDefinitions(),newRule:s,oldRule:o,appPart:this._appPart})},_onCustomizationChange:function(e){this.updateInputProxyValueWithNewRule(e.rule)},applyCustomizationRule:function(e,t){var n=this.imports.ViewsCustomizer.getCurrentRule(e,t);this.imports.ViewsCustomizer.applyRule(e,t),this._listener&&this._listener(t.key,n.value,t.value)},dispose:function(){this._inputProxy.removeEvent("inputChanged",this._onInputProxyChange),this._inputProxy.removeEvent("colorChanged",this._onColorSelectorChange),this._inputProxy=null,this._appInstance=null,this._inputToCustomizationFn=null,this._customizationToInputFn=null}})}),define.Class("wixapps.integration.gui.CustomizeItemsPresenter",function(e){var t=e;t.inherits(),t.utilize(["wixapps.core.data.DataItemUtils"]),t.binds(["_createDataStructure","_onFieldAdded","onItemMoved","_onFieldRemoved","_updateModel"]),t.resources(["W.Utils","W.Commands","W.AppsEditor2","W.EditorDialogs"]),t.fields({_model:null,_appPart:null,_appInstance:null,_typeDef:{},_viewBuilder:null,_fieldHighlighter:null,_dataItemUtils:null}),t.methods({initialize:function(e,t,n,r,i){this._appInstance=e,this._typeDef=n,this._viewBuilder=this.resources.W.AppsEditor2.getViewBuilder(),this._dataItemFactory=e.getDataItemFactory(),this._model=this._dataItemFactory.createDataItem([]),this._appPart=r,this._viewDataItem=this._appPart.getViewDefinition(),this._parentUpdateModel=i,this._fieldHighlighter=this.resources.W.AppsEditor2.getFieldHighlighter(),this._dataItemUtils=new this.imports.DataItemUtils},setupPresenter:function(){this._createDataStructure(),this._isReady=!0},onTypeChanged:function(e){this._typeDef=e.newType,this._createDataStructure()},onViewChanged:function(e){if(e.phase==Constants.DataItemEventPhase.ON_TARGET){var t=this._dataItemUtils.createDataChangeEventList(e,this._data),n=t.some(function(e){return e.type=="add"||e.type=="delete"});n&&this._createDataStructure()}},_loc:function(e,t){return this.resources.W.AppsEditor2.localize(e,t)},_onFieldAdded:function(e){this._createDataStructure()},_onFieldRemoved:function(e){this._createDataStructure()},_getFieldDisplayName:function(e){var t=this._typeDef.fields.filter(function(t){return t.name===e});if(t.length===0)throw"CustomizeItemsPresenter:: field ["+e+"] was not found in type definition.";return t[0].displayName},_getFieldIconClass:function(e){switch(e.compName){case"Label":return"text";case"Image":return"image";case"Video":return"video";case"RichText":return"richtext";default:return"text"}},_createDataStructure:function(){var e,t,n,r,i,s,o=[],u=this._viewDataItem.getValue(),a=this._viewBuilder.getViewFieldsMapping(u,!0);for(e=0;e<a.length;e++){n=a[e],o.push({isContainer:!0,displayName:n.containerName,containerId:n.containerId,dragEnabled:!1,hasFields:n.hasFields,iconType:"none",fieldIcon:"none",showEditLabel:!1,orientation:n.orientation,hideEditLink:!1});if(n.hasFields){i=n.containerName==="Hidden Fields",r=n.containerFields;if(r.length>0)for(t=0;t<r.length;t++){s=r[t];var f={isContainer:!1,containerId:s.containerId,hasFields:!1,displayName:this._getFieldDisplayName(s.data),iconType:i?"hidden":"arrow",dragEnabled:!0,fieldIcon:this._getFieldIconClass(s),showEditLabel:!1,hideEditLink:i?!0:!1,boxOrientation:n.orientation};o.push(Object.merge(f,s))}}}this._model.setValue([]),this._model.setValue(o)},runWhenReady:function(e){this._isReady?e():this.resources.W.Utils.callLater(this.runWhenReady,[e])},addField:function(){this.resources.W.AppsEditor2.openAddFieldDialog(this._appPart)},onItemMoved:function(e){var t=e.cause.oldIdx,n=e.cause.idx,r=e.sender,i=r.getViewContext().getData().getValue(),s=i[t].id;i.splice(t,1);var o=this._viewDataItem.getValue(),u=Object.clone(o);if(t==n)return;var a=this._getContainerByIndex(t,i),f=this._getContainerByIndex(n,i);if(!a||!f){this._createDataStructure();return}t-=a.indexInList+1,n-=f.indexInList+1;var l=a.data.containerId,c=f.data.containerId;c=="Hidden"?this.resources.W.Commands.executeCommand("WAppsEditor2Commands.HideField",{appPart:this._appPart,fieldId:s}):(c===l?this._viewBuilder.reorderExtraFields(o,l,t,n):this._viewBuilder.moveField(o,s,c,n),this._viewDataItem.setValue(o),W.UndoRedoManager.startTransaction(),W.Commands.executeCommand("WAppsEditor2Commands.Undo.ViewDefinitionChange",{viewRepo:this._appInstance.getViewDefinitions(),oldValue:u,newValue:o,appPart:this._appPart}),W.UndoRedoManager.endTransaction()),this._createDataStructure()},_getContainerByIndex:function(e,t){var n,r=t;for(n=e-1;n>=0;n--)if(r[n].isContainer)return{data:r[n],indexInList:n}},onFieldClicked:function(e){var t=e.data.getValue();t.containerId!=="Hidden"&&this.resources.W.AppsEditor2.openEditFieldDialog(t,this._appPart,this._updateModel)},_updateModel:function(){this._createDataStructure(),this._parentUpdateModel()},onEditFieldBox:function(e){var t=e.data.getValue();this.resources.W.AppsEditor2.openEditFieldBoxDialog(t,this._appPart,this._createDataStructure)},openListSettingsPanel:function(){this.resources.W.Commands.executeCommand("WAppsEditor2Commands.CloseAppBuilderManageDialog"),this.resources.W.Commands.executeCommand(Constants.EditorUI.OPEN_PROPERTY_PANEL,{forceOpen:!0})},getModel:function(){return this._model},getAcceptableDataTypes:function(){return["AppBuilderComponent",""]},onFieldMouseOver:function(e){var t=e.sender.getData().getChildValue("id"),n=e.sender.getData().getChildValue("containerId");this._fieldHighlighter.highlightField({appPart:this._appPart,fieldId:t,containerId:n})},onFieldMouseOut:function(e){this._fieldHighlighter.removeHighlightField({appPart:this._appPart})},onFieldBoxMouseOver:function(e){e.data.getChildByRef("showEditLabel").setValue(!0)},onFieldBoxMouseOut:function(e){e.data.getChildByRef("showEditLabel").setValue(!1)},dispose:function(){}})}),define.Class("wixapps.integration.gui.DataEditPresenter",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize(["wixapps.integration.utils.SelectionMarker","wixapps.integration.gui.EditViewGenerator","wixapps.integration.gui.ManageItemsPresenter"]),t.traits([]),t.binds(["_onModelChanged"]),t.resources(["W.AppsGUI","W.Utils","W.EditorDialogs","W.AppsEditor2","W.Commands"]),t.fields({_generatedViewPart:null,_metaData:null,_presetViewName:"AppBuilder",_editViewGenerator:null,_appPart:null,_typesManager:null,_itemsData:null,_model:null,_currentIndex:-1}),t.methods({initialize:function(e,t,n){this._appPart=e,this._appPartDataSelector=this._appPart.getDataSelector(),this._editViewGenerator=new this.imports.EditViewGenerator,this._listCursor=t,this._itemsData=n,this._typeName=this._appPart.getAppPartDefinition().getType();var r=this._appPart.getAppInstance();this._typesManager=r.getTypesManager(),this._typeDef=this._typesManager.getType(this._typeName),this._dataItemFactory=r.getDataItemFactory();var i={_iid:"NULL_ITEM",_type:this._typeName};this._model=this._dataItemFactory.createDataItem(i),this._typesManager.applyDefaults(this._model),this.rebuildModel(),this._model.addEvent(Constants.DataItemEvents.CHANGE,this._onModelChanged)},exportVars:function(){return{generatedViewPart:this._generatedViewPart,metaData:this._metaData}},setupPresenter:function(){this._listCursor.getCurrentItemIndex()<0&&this._listCursor.next(),this.updateGeneratedViewPart(),this.updateMetadata()},getModel:function(){return this._model},rebuildModel:function(e){var t=this._listCursor.getCurrentItemIndex(),n=this._itemsData.getChildByIndex(t);n&&this._model.setValue(n.getValue()),this.updateMetadata()},_onModelChanged:function(e){var t=this._listCursor.getCurrentItemIndex(),n=this._itemsData.getChildByIndex(t);if(!n)return;n.setValue(this._model.getValue())},gotoNext:function(){this._listCursor.next()},gotoPrev:function(){this._listCursor.prev()},createDataItem:function(){this.resources.W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{appPart:this._appPart,onDataItemAdded:function(){this.updateMetadata()}.bind(this)})},removeDataItem:function(){var e=this._listCursor.getCurrentItemIndex();this._listCursor.removeSelection();var t=this._itemsData.getChildByIndex(e);if(!t)return;var n=t.getChildValue("_iid");this.resources.W.Commands.executeCommand("WAppsEditor2Commands.RemoveDataItem",{appPart:this._appPart,dataItemId:n,onDataItemRemoved:function(){this.updateMetadata()}.bind(this)})},duplicateDataItem:function(){var e=this._model.getValue();delete e._createdAt,delete e._updatedAt,e._iid=this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId(),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{appPart:this._appPart,rawData:e})},hideItem:function(){W.UndoRedoManager.startTransaction();var e=this._listCursor.getCurrentItemIndex();if(e>=0){var t=this._appPartDataSelector.getItemIds()[e];this._setVisibility(t,!1),this.updateMetadata()}W.UndoRedoManager.endTransaction()},showItem:function(){var e=this._getCurrentDataItemId();this._setVisibility(e,!0)},createField:function(){this.resources.W.AppsEditor2.openAddFieldDialog(this._appPart)},_setVisibility:function(e,t){if(e){var n=this._appPartDataSelector.isHidden(e);this._appPartDataSelector.setVisibility(e,t),W.UndoRedoManager.startTransaction(),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataSelectorChange",{changeType:"Hide",selector:this._appPartDataSelector,dataItemId:e,newValue:t,oldValue:n,appPart:this._appPart}),this.updateMetadata(),W.UndoRedoManager.endTransaction()}},_getCurrentDataItemId:function(){var e=this._listCursor.getCurrentItemIndex();if(e>=0)return this._appPartDataSelector.getItemIds()[e]},onTypeChanged:function(e){this._typeDef=e.newType,this._typesManager.applyDefaults(this._model),this.updateGeneratedViewPart(),this.rebuildModel(!0)},updateGeneratedViewPart:function(){var e=this._editViewGenerator.generateViews(this._presetViewName,this._typeDef);this._generatedViewPart?this._generatedViewPart.setValue(e):this._generatedViewPart=this._dataItemFactory.createDataItem(e)},updateMetadata:function(){var e=this._model.getChildValue("_iid"),t=this._appPartDataSelector.getHiddenItemIds().contains(e),n={hidden:t,noItems:this._itemsData.getChildren().length===0,pagingLabel:this._createPagingLabel(),noFields:this._typeDef.fields.length===0};this._metaData?this._metaData.setValue(n):this._metaData=this._dataItemFactory.createDataItem(n)},_createPagingLabel:function(){var e=this._listCursor.getCurrentItemIndex()+1,t=this._itemsData.getChildren().length,n=this.resources.W.AppsEditor2.localize("DATA_EDIT_PANEL_ITEM_COUNT");return n=n.replace("%index%",e).replace("%total%",t),n},dispose:function(){}})}),define.oldClass({name:"wixapps.integration.gui.EditViewGenerator",imports:["wixapps.integration.gui.EditViewGeneratorIdioms"],traits:[],Class:{Extends:Object,Binds:["_generateFieldRepeater"],_idioms:null,_viewBuilder:null,initialize:function(){this._idioms=new this.imports.EditViewGeneratorIdioms,this._viewBuilder=W.AppsEditor2.getViewBuilder()},generateViews:function(e,t){var n=t.fields.map(this._generateFieldRepeater);return n.forEach(function(e){this._injectUniqueIDs(e)}.bind(this)),n},_injectUniqueIDs:function(e){var t=0,n=function(e){e.id||(e.id="def"+String(t++)),e.comp&&e.comp.items&&e.comp.items.forEach(n)};n(e)},_generateFieldRepeater:function(e){var t=this._idioms.label(e.displayName||e.name);return t.layout={spacerAfter:5},this._idioms.vbox([t,this._idioms.vspacer(5),this._viewBuilder.getBaseFieldTemplate(e.type,Constants.WixApps.EDIT_TEMPLATE_NAME,e.name),this._idioms.vspacer(15)])}}}),define.oldClass({name:"wixapps.integration.gui.EditViewGeneratorIdioms",imports:[],traits:[],Class:{Extends:Object,Binds:[],initialize:function(){},label:function(e){return{value:e,comp:{name:"Label"}}},inlineTextInput:function(e,t){var n={value:e,comp:{name:"InlineTextInput"}};return t&&(n.comp.events={inputChanged:t}),n},boundLabel:function(e){return{id:W.Utils.getUniqueId(),data:e,comp:{name:"Label"}}},link:function(e,t){var n=this.button(e,t);return n.comp.align="right",n.comp.skin="wixapps.integration.skins.editor.LinkButton",n},hspacer:function(e){return{comp:{name:"HSpacer",size:e}}},vspacer:function(e){return{comp:{name:"VSpacer",size:e}}},hbox:function(e){return this.container("HBox",e)},vbox:function(e){return this.container("VBox",e)},container:function(e,t){return{comp:{name:e,items:t}}},vlist:function(e){return{comp:{name:"VerticalList",templates:{item:e}}}},button:function(e,t){return{comp:{name:"Button",label:e,skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:t}}}}}}),define.oldClass({name:"wixapps.integration.gui.EventBinding",imports:[],traits:[],Class:{Binds:["_onInternalEvent"],_presenter:null,_eventDispatcher:null,_handledEvents:[],initialize:function(e,t){this._eventDispatcher=e,this._presenter=t},setupHandlers:function(e){this._handledEvents=this._getRelevantEventTypes(e),this._handledEvents.each(function(e){this._eventDispatcher.addEvent(e,this._onInternalEvent)}.bind(this))},_getEventType:function(e){return typeOf(e)=="string"?e:e.event},_getEventsRecursively:function(e){var t=[];for(var n in e)if(n){var r=e[n];n=="events"&&(t=t.concat(Object.values(r).map(this._getEventType)));if(typeOf(r)=="object"||typeOf(r)=="array")t=t.concat(this._getEventsRecursively(r))}return t},_getRelevantEventTypes:function(e){return this._getEventsRecursively(e).map(function(e){return typeOf(e)=="string"?e:e.event}).filter(function(e){return e&&e.indexOf("presenter.")===0}).reduce(function(e,t){return e.indexOf(t)==-1?e.concat(t):e},[])},_onInternalEvent:function(e){var t=e.type,n=t.split(".");if(n.length>1&&n[0]=="presenter"){var r=this._presenter[n[1]];if(!r||typeOf(r)!=="function")throw"EventBinding: function '"+n[1]+"()' not defined on the presenter '"+this._presenter.className+"'";r.call(this._presenter,e)}},dispose:function(){this._handledEvents.each(function(e){this._eventDispatcher.removeEvent(e,this._onInternalEvent)}.bind(this)),this._eventDispatcher=null,this._presenter=null}}}),define.Class("wixapps.integration.gui.FieldBoxEditPresenter",function(e){var t=e;t.binds(["updateModel"]),t.fields({_fieldBoxMetaData:null,_appPart:null,_viewName:null,_updateModel:null,_appInstance:null,_customizationTemplate:null}),t.methods({initialize:function(e,t,n){this._fieldBoxMetaData=e,this._appPart=t,this._appInstance=t.getAppInstance(),this._updateModel=n},setupPresenter:function(){var e=this._appPart.getAppPartDefinition(),t=this._appPart.getAppPartDefinition().getType(),n=e.getViewName();this._customizationTemplate={forType:t,view:n,fieldId:this.getFieldBoxId(),mode:"view"}},getAppInstance:function(){return this._appInstance},getAppPart:function(){return this._appPart},getCustomizationTemplate:function(){return this._customizationTemplate},getFieldBoxId:function(){return this._fieldBoxMetaData.containerId},getFieldBoxName:function(){return this._fieldBoxMetaData.containerName},getFieldBoxOrientation:function(){return this._fieldBoxMetaData.orientation},getItemView:function(){var e=this._appPart.getAppPartDefinition().getType(),t=this._appPart.getAppPartDefinition().getViewName();return this._appInstance.getViewDefinitions().getViewDefinition(e,t)},isFieldBoxVertical:function(){return this._fieldBoxMetaData.orientation==="vertical"},updateModel:function(){this._updateModel()},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.FieldEditPresenter",function(e){var t=e;t.binds(["_fieldDisplayNameChanged"]),t.fields({_editedFieldMetaData:null,_appPart:null,_appInstance:null,_customizationTemplate:null,_fieldInfo:null,_typeDef:null,_associatedProxy:null,_fieldDisplayNameDataItem:null}),t.methods({initialize:function(e,t,n){this._editedFieldMetaData=e,this._appPart=t,this._updateModel=n,this._appInstance=t.getAppInstance()},setupPresenter:function(){var e=this._appPart.getViewNode();this._associatedProxy=this._findAssociatedProxy(this.getFieldId(),e);var t=this._appPart.getAppPartDefinition(),n=t.getViewName(),r=this._appInstance.getTypesManager();this._typeName=t.getType(),this._typeDef=r.getType(this._typeName),this._customizationTemplate={forType:this._typeName,view:n,fieldId:this.getFieldId(),mode:"view"}},getAppInstance:function(){return this._appInstance},getAppPart:function(){return this._appPart},getCustomizationTemplate:function(){return this._customizationTemplate},getItemView:function(){var e=this._appPart.getAppPartDefinition().getType(),t=this._appPart.getAppPartDefinition().getViewName();return this._appInstance.getViewDefinitions().getViewDefinition(e,t)},getAssociatedProxy:function(){return this._associatedProxy},getEditedFieldMetaData:function(){return this._editedFieldMetaData},getFieldId:function(){return this._editedFieldMetaData.id},getFieldName:function(){return this._editedFieldMetaData.data},getFieldType:function(){return this._editedFieldMetaData.fieldType},getFieldContainerId:function(){return this._editedFieldMetaData.containerId},getFieldContainerName:function(){return this._editedFieldMetaData.containerName},setFieldContainerId:function(e){this._editedFieldMetaData.containerId=e},setFieldContainerName:function(e){this._editedFieldMetaData.containerName=e},getCompName:function(){return this._editedFieldMetaData.compName},getBoxOrientation:function(){return this._editedFieldMetaData.boxOrientation},getFieldInfo:function(){return this._typeDef.fields.filter(function(e){var t=e.name;return t===this.getFieldName()}.bind(this))[0]},getFieldDisplayName:function(){return this._editedFieldMetaData.displayName},setFieldDisplayName:function(e){this._fieldDisplayNameChanged(e)},_fieldDisplayNameChanged:function(e){var t=this.getFieldInfo();t.displayName=this._appPart.getUniqueFieldName(t.name,e),this._editedFieldMetaData.displayName=t.displayName,this._appInstance.getDataProviders().getWixDbDataProvider().updateType(this._typeDef),this._appInstance.fireEvent(Constants.WixAppEvents.TYPE_CHANGE,{typeName:this._typeName,oldType:this._typeDef,newType:this._typeDef})},_findAssociatedProxy:function(e,t){var n=t.getElements("[hasproxy]").map(function(e){return e.getViewProxy()}).filter(function(t){return t.getFieldId()===e});return n.length>0?n[0]:null},updateModel:function(){this._updateModel()},dispose:function(){this.parent()}})}),define.Class("wixapps.integration.gui.ManageItemsPresenter",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize([]),t.traits([]),t.binds(["onItemMoved","onShowHideItem","onSelectionChanged","_onSharedDataChange"]),t.resources(["W.Utils","W.Commands","W.AppsEditor2"]),t.fields({_viewsCustomizer:null,_dataSelector:null,_model:null,_idioms:null,_selectedItemIndex:-1}),t.methods({initialize:function(e,t,n,r,i){this._appPart=e,this._appInstance=e.getAppInstance(),this._typeDef=r,this._itemsData=n,this._appPartDataSelector=t,this._dataItemFactory=this._appInstance.getDataItemFactory(),this._model=this._dataItemFactory.createDataItem([]),this._listCursor=i,this._itemsData.addEvent(Constants.DataItemEvents.CHANGE,this._onSharedDataChange)},setupPresenter:function(){this._createModel(),this._isReady=!0},runWhenReady:function(e){this._isReady?e():W.Utils.callLater(this.runWhenReady,[e])},rebuildModel:function(){this._createModel()},_loc:function(e,t){return this.resources.W.AppsEditor2.localize("MANAGE_ITEMS_PANEL_"+e,t)},_onSharedDataChange:function(){this.rebuildModel()},_getNoTitleFieldText:function(e){return this._loc("TextWhenTitleFieldWasNotFound")+" "+e},_createModel:function(){var e=[],t=this._appPartDataSelector.getHiddenItemIds(),n=this._listCursor.getCurrentItemIndex(),r=this._itemsData.getChildren(),i=this._getTitleFieldName();for(var s=0;s<r.length;s++){var o=r[s],u=o.getChildValue("_iid"),a=t.contains(u),f={itemId:u,title:i!==null?o.getChildValue(i):this._getNoTitleFieldText(s),hidden:a,iconType:a?"hidden":"arrow",selected:n==s};e.push(f)}this._model.setValue([]),this._model.setValue(e)},onTypeChanged:function(e){this._typeDef=e.newType,this.rebuildModel()},getModel:function(){return this._model},onAddItem:function(){W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{appPart:this._appPart,onDataItemAdded:function(e){this.rebuildModel()}.bind(this)})},onItemMoved:function(e){var t=e.cause.oldIdx,n=e.cause.idx;W.UndoRedoManager.startTransaction(),this._appPartDataSelector.moveItem(t,n),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataSelectorChange",{changeType:"Move",selector:this._appPartDataSelector,dataItemId:this._appPartDataSelector.getItemIds()[t],newValue:n,oldValue:t,appPart:this._appPart}),W.UndoRedoManager.endTransaction()},onShowHideItem:function(e,t){this.rebuildModel()},onSelectionChanged:function(e){var t=e.cause.idx;if(t<0)return;this._listCursor.setSelectedIndex(t)},_getTitleFieldName:function(e){var t="1000",n=function(e){var n=e.type,r=e.name.toLowerCase(),i=e.displayName.toLowerCase(),s=t;return i.contains("title")?s=17:i.contains("description")?s=18:n=="String"?s=20:n=="wix:RichText"?s=25:s=t,{mark:s,fieldName:r}},r=(e||this._typeDef).fields,i={mark:t,fieldName:null};for(var s=0;s<r.length;s++){var o=r[s],u=n(o);u.mark<i.mark&&(i=u)}return i.fieldName},dispose:function(){this._itemsData.removeEvent(Constants.DataItemEvents.CHANGE,this._onSharedDataChange),this.parent()},getAcceptableDataTypes:function(){return["AppBuilderComponent",""]}})}),define.Class("wixapps.integration.gui.MoveFieldPresenter",function(e){var t=e;t.binds(["_createDataStructure"]),t.fields({_viewBuilder:null}),t.methods({initialize:function(e,t,n,r,i){this._fieldId=e,this._containerName=t,this._appPart=n,this._updateModel=i,this._appInstance=n.getAppInstance(),this._viewBuilder=r,this._dataItemFactory=this._appInstance.getDataItemFactory(),this._model=this._dataItemFactory.createDataItem({}),this._viewDataItem=this._appPart.getViewDefinition(),this._viewDefinitionRaw=this._viewDataItem.getValue()},setupPresenter:function(e){this._builderDialogPanel=e,this._model.setValue(this._createDataStructure())},_createDataStructure:function(){var e=this._viewBuilder.getViewFieldsMapping(this._viewDefinitionRaw),t=this._containerName,n=e.map(function(e){return{value:e.containerId,text:e.containerName,enabled:!0,description:""}}).filter(function(e){return e.text!==t});return{possibleContainers:{selectedValue:n[0].value,items:n}}},onContainerChosen:function(e){var t=e.context.getData().getValue().possibleContainers;if(t){var n=t.items.filter(function(e){return e.value===t.selectedValue})[0],r=Object.clone(this._viewDefinitionRaw);this._viewBuilder.moveField(this._viewDefinitionRaw,this._fieldId,n.value),this._appPart.getViewDefinition().setValue(this._viewDefinitionRaw),this._updateModel(n.value,n.text),this._builderDialogPanel.closeDialog(),W.UndoRedoManager.startTransaction(),W.Commands.executeCommand("WAppsEditor2Commands.Undo.ViewDefinitionChange",{viewRepo:this._appInstance.getViewDefinitions(),oldValue:r,newValue:this._viewDefinitionRaw,appPart:this._appPart}),W.UndoRedoManager.endTransaction()}},onCancel:function(){this._builderDialogPanel.closeDialog()},getModel:function(){return this._model},dispose:function(){this._viewDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._createDataStructure),this.parent()}})}),define.component("wixapps.integration.gui.SelectionHandler",function(e){var t=e;t.utilize(["wixapps.integration.utils.ProxySelector","wixapps.integration.utils.SelectionMarker"]),t.traits([]),t.binds(["_onComponentSelectionChange","_onSelectorAction"]),t.resources(["W.Preview","W.Commands"]),t.skinParts({}),t.states(),t.dataTypes(),t.fields({_proxySelector:null,_selectionMarker:null,_appPart:null,_currentItemIndex:-1,_currentDataItem:null}),t.methods({initialize:function(){this._selectionMarker=new this.imports.SelectionMarker,this._proxySelector=new this.imports.ProxySelector,this.resources.W.Commands.registerCommand("WAppsEditor2Commands.SelectionChanged"),this.resources.W.Commands.registerCommandListenerByName("WEditorCommands.SelectedComponentChange",this,this._onComponentSelectionChange,null,!0),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditModeChanged),this._proxySelector.addEvent(this.imports.ProxySelector.SELECTION_ACTION,this._onSelectorAction)},next:function(){this.setSelectedIndex(++this._currentItemIndex)},prev:function(){this.setSelectedIndex(--this._currentItemIndex)},last:function(){this.setSelectedIndex(this._appPart.getAppPartData().getChildren().length-1)},setSelectedIndex:function(e,t){var n=this._currentItemIndex,r=this._appPart.getAppPartData().getChildren().length,i=this._appPart.getDataSelector();if(r===0){this._currentItemIndex=-1,i.isListSelector()&&i.resetSelectedItem();return}e>=r?this._currentItemIndex=0:e<0?this._currentItemIndex=r-1:this._currentItemIndex=e,i.isListSelector()&&i.setSelectedItemByIndex(this._currentItemIndex),this._markCurrentProxy(n,t)},removeSelection:function(){this._selectionMarker.unmarkSelectedSubComponent(),this._currentItemIndex=-1,this._currentDataItem=undefined,this._proxySelector.deactivateProxySelectorIfActivated()},getCurrentItemIndex:function(){return this._currentItemIndex},getCurrentDataItem:function(){return this._currentDataItem},_onEditModeChanged:function(e){this._appPart&&e=="PREVIEW"&&this.removeSelection()},_onComponentSelectionChange:function(e){this.removeSelection(),e.comp.className=="wixapps.integration.components.AppPart2"&&(this._appPart=e.comp,this._typeName=this._appPart.getAppPartDefinition().getType(),this.resources.W.Preview.getPreviewManagersAsync(function(e){this._selectionMarker.initUIColors(e.Theme,this._appPart)},this),this._proxySelector.deactivateProxySelectorIfActivated(),this._proxySelector.activateProxySelector(this._appPart,function(e){return e.getViewContext().getEnvironment().getForType()==this._typeName}.bind(this)),this._markCurrentProxy())},_onSelectorAction:function(e){if(e.action==this.imports.ProxySelector.ACTION_MOUSE_DOWN&&this._appPart){var t=e.proxyList[e.proxyList.length-1];this._currentDataItem=t.getData();var n=this._currentDataItem.getParent()||this.appPart.getAppPartData();this.setSelectedIndex(n.getChildIndex(this._currentDataItem))}},_markCurrentProxy:function(e,t){if(!this._appPart)return;var n=this._currentDataItem;this._currentDataItem=this._appPart.getAppPartData().getChildByIndex(this._currentItemIndex);var r=this._findProxyByDataItem(this._currentDataItem);r&&(this._selectionMarker.unmarkSelectedSubComponent(),this._selectionMarker.markSelectedSubComponent(r.getElement()),t||this.notifySelectionChanged(e,n))},notifySelectionChanged:function(e,t){this.resources.W.Commands.executeCommand("WAppsEditor2Commands.SelectionChanged",{index:this._currentItemIndex,dataItem:this._currentDataItem,oldIndex:e||-1,oldDataItem:t||null,typeName:this._typeName,appPart:this._appPart})},_findProxyByDataItem:function(e){var t=this._appPart.getViewNode().getElements("[hasproxy]").map(function(e){return e.getViewProxy()}).filter(function(t){return t.getData()===e});return t[0]},dispose:function(){this.resources.W.Commands.unregisterListener(this),this._selectionMarker.unmarkSelectedSubComponent()}})}),define.resource("wixapps.integration.gui.WixAppsGUIViews",[{name:"DataEditView",forType:"Object",comp:{name:"VBox",items:[{comp:{name:"VBox",hidden:{$expr:"or($presenter.metaData.noItems,  $presenter.metaData.noFields)"},items:[{id:"upperBoxSwitch",value:{$expr:"$presenter.metaData.hidden"},comp:{name:"Switch",cases:{"default":"NO_PROXY","true":{comp:{name:"VBox",items:[{comp:{name:"HBox",items:[{comp:{name:"VBox",items:[{id:"exIcon",value:{_type:"wix:Image",src:"images/icons/hidden.png",width:16,height:16},comp:{name:"Icon"},layout:{spacerBefore:3,width:16,height:16}}]},layout:{spacerAfter:10}},{value:"@ITEM_HIDDEN@",comp:{name:"Label"}},{id:"bad_monkey",comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@UNHIDE_ITEM@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.showItem"}}}]}}],css:{"background-color":"#CCEBFF",width:"280px",spacerAfter:10,margin:"10px","line-height":"30px",border:"1px solid #c8e5f7","border-top-color":"#bfdbf0",padding:"0 10px"}}}}}},{id:"toolBar",comp:{name:"HBox","box-align":"right",items:[{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"Add Item",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.createDataItem"}}},{comp:{name:"HSpacer",size:"10"}},{comp:{name:"VBox",items:[{value:"@DUPLICATE@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.duplicateDataItem"}}},{comp:{name:"HSpacer",size:"10"}},{comp:{name:"VBox",items:[{id:"hideButtonSwitch",value:{$expr:"$presenter.metaData.hidden"},comp:{name:"Switch",cases:{"default":{comp:{name:"VBox",items:[{value:"@HIDE@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],events:{click:"presenter.hideItem"}}},"true":{value:"@HIDE@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin",css:{cursor:"default"}}}}}}]}},{comp:{name:"HSpacer",size:"10"}},{comp:{name:"VBox",items:[{value:"Delete",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.removeDataItem"}}},{comp:{name:"HSpacer",size:"20"}}]}},{comp:{name:"VSpacer",size:"5"}},{id:"generatedPartSwitch",value:{$expr:"$presenter.metaData.hidden"},comp:{name:"Switch",cases:{"default":{comp:{name:"HBox",items:[{comp:{name:"VBox",items:{$expr:"$presenter.generatedViewPart"},css:{width:"260px"}}}],css:{height:"474px","overflow-y":"auto","padding-left":"10px","padding-right":"10px"}}},"true":{comp:{name:"HBox",items:[{comp:{name:"VBox",items:{$expr:"$presenter.generatedViewPart"},css:{width:"260px"}}}],css:{height:"424px","overflow-y":"auto","padding-left":"10px","padding-right":"10px"}}}}}},{id:"navigationButtons",comp:{name:"HBox",items:[{comp:{name:"Button",cssClass:"previous",skin:"wixapps.integration.skins.editor.HorizontalArrowButtonSkin",label:"Previous",css:{position:"relative"},events:{click:"presenter.gotoPrev"}},layout:{width:"30px"}},{value:{$expr:"$presenter.metaData.pagingLabel"},comp:{name:"Label",css:{"line-height":"36px",color:"#595959","text-align":"center"}},layout:{"box-flex":1}},{comp:{name:"Button",cssClass:"next",skin:"wixapps.integration.skins.editor.HorizontalArrowButtonSkin",label:"Next",css:{position:"relative"},events:{click:"presenter.gotoNext"}},layout:{width:"30px"}}],css:{margin:"0px","border-top":"1px solid #d3d3d3",padding:"0px",height:"36px"}}}]}},{comp:{name:"VBox",hidden:{$expr:"or (not($presenter.metaData.noItems),  $presenter.metaData.noFields)"},items:[{comp:{name:"VSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@NO_ITEMS@",comp:{name:"Label"}},{comp:{name:"VSpacer",size:"5"}},{comp:{name:"VBox",items:[{value:"@CLICK_TO_ADD_ITEM@",comp:{name:"Label",bold:"true",css:{"text-decoration":"underline",cursor:"pointer"}}}],events:{click:"presenter.createDataItem"}}}]}},{comp:{name:"VSpacer",size:"*"}}]}},{comp:{name:"VBox",hidden:{$expr:" not($presenter.metaData.noFields) "},items:[{comp:{name:"VSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@NO_FIELDS@",comp:{name:"Label"}},{comp:{name:"VSpacer",size:"5"}},{comp:{name:"VBox",items:[{value:"@CLICK_TO_ADD_FIELD@",comp:{name:"Label",bold:"true",css:{"text-decoration":"underline",cursor:"pointer"}}}],events:{click:"presenter.createField"}}}]}},{comp:{name:"VSpacer",size:"*"}}]}}],css:{width:"100%"}}},{name:"FieldEditView",forType:"Object",comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"baseline",items:[{value:"@FIELD_NAME@",comp:{name:"Label"},layout:{spacerAfter:20}},{data:"fieldDisplayName",comp:{name:"TextInput"}}]}}]},customizations:[]},{name:"ManageItemsView",forType:"Array",comp:{name:"VBox",items:[{comp:{name:"VerticalListEditor",dragEnabled:"true",templates:{item:{comp:{name:"DraggableListItem",orientation:"horizontal",selected:{$expr:"selected"},iconType:{$expr:"iconType"},items:[{data:"title",comp:{name:"Label"},layout:{spacerAfter:5}}],css:{width:"99%"}}}},css:{"max-height":"442px","overflow-y":"auto","padding-bottom":"1px"},events:{itemMoved:"presenter.onItemMoved",itemClick:"presenter.onSelectionChanged"}},layout:{"box-flex":1}}],css:{height:"485px",width:"100%"}}},{name:"CustomizeItemsView",forType:"Array",comp:{name:"VBox",items:[{comp:{name:"HBox","box-align":"right",items:[{comp:{name:"HSpacer",size:"*"}},{comp:{name:"VBox",items:[{value:"@ADD_FIELD@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.addField"}}},{comp:{name:"HSpacer",size:"10"}},{comp:{name:"VBox",items:[{value:"@LIST_SETTINGS@",comp:{name:"Label",skin:"wixapps.integration.skins.inputs.TextLinkSkin"}}],css:{cursor:"pointer"},events:{click:"presenter.openListSettingsPanel"}}},{comp:{name:"HSpacer",size:"20"}}]}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"HBox",items:[{value:"@CUSTOMIZE_ITEMS_DESCRIPTION@",comp:{name:"Label"},layout:{"box-flex":1}},{comp:{name:"HSpacer",size:"10"}}]}},{comp:{name:"VSpacer",size:"10"}},{data:"this",comp:{name:"VerticalListEditor",cssClass:"groupsWrapper",dragEnabled:"true",maxDragIndex:"1",templates:{item:{comp:{name:"VBox",cssClass:{$expr:"if(isContainer,  'container',  '')"},items:[{data:"isContainer",comp:{name:"Switch",cases:{"default":{comp:{name:"DraggableListItem",skin:"wixapps.integration.skins.editor.DesignDraggableItemSkin",orientation:"horizontal","box-align":"center",dragEnabled:"true",hideEditLink:{$expr:"hideEditLink"},iconType:{$expr:"iconType"},items:[{comp:{name:"HBox",items:[{comp:{name:"Css",cssClass:"iconContainer",items:[{comp:{name:"Css",cssClass:{$expr:"String.concat('fieldType icon-', fieldIcon)"}}}]}},{data:"displayName",comp:{name:"Label"}}],css:{width:"100%"}}}],css:{width:"260px"},events:{click:"presenter.onFieldClicked","dom:mouseover":"presenter.onFieldMouseOver","dom:mouseout":"presenter.onFieldMouseOut"}}},"true":{comp:{name:"VBox",cssClass:"group",items:[{comp:{name:"HBox",items:[{data:"displayName",comp:{name:"Label",bold:"true",css:{"padding-left":"6px"}}},{comp:{name:"HBox",hidden:{$expr:"or(eq(containerId,  'Hidden'),  not(hasFields))"},items:[{value:"@EDIT@",comp:{name:"Label",hidden:{$expr:"not(showEditLabel)"},color:"#0099FF",css:{"padding-left":"5px",cursor:"pointer"}}},{id:"arrowIcon",value:{_type:"wix:Image",src:"images/icons/arrow_from_sprite.png",width:8,height:8},comp:{name:"Icon",css:{"line-height":"15px"}},layout:{spacerBefore:5}}],events:{click:"presenter.onEditFieldBox"}}}],events:{"dom:mouseover":"presenter.onFieldBoxMouseOver","dom:mouseout":"presenter.onFieldBoxMouseOut"}},layout:{spacerAfter:5,spacerBefore:10}},{comp:{name:"VBox",cssClass:"container-box",items:[{comp:{name:"DraggableListItem",skin:"wixapps.integration.skins.DropTargetSkin",css:{width:"260px",height:"34px"}}}]}}],css:{"margin-top":"10px",width:"100%"}}}}}}],css:{width:"100%"}}}},css:{height:"402px","overflow-y":"auto","overflow-x":"none"},events:{itemMoved:"presenter.onItemMoved"}},layout:{spacerAfter:30}}]}},{name:"ChooseTemplate",forType:"Array",comp:{name:"VBox","box-align":"center",items:[{comp:{name:"Gallery",skin:"wysiwyg.viewer.skins.paginatedgrid.wixapps.TemplateChooserGallerySkin",columns:"2",rows:"1",gap:"10",transition:"swipe_horiz_All",expandEnabled:"false",autoplay:"false",templates:{item:{comp:{name:"HBox",items:[{comp:{name:"HSpacer",size:"12"}},{comp:{name:"VBox",items:[{id:"hoverBorder",comp:{name:"VBox",items:[{comp:{name:"HBox",items:[{data:"title",comp:{name:"Label",style:"Heading XL",singleLine:"true",color:"#0099FF",bold:"true"},layout:{"box-flex":1,"text-align":"center"}}]}},{comp:{name:"HBox",items:[{comp:{name:"VBox","box-align":"center",items:[{data:"imageData",comp:{name:"Image",css:{cursor:"pointer"}},layout:{height:"225px",width:"300px",spacerBefore:4,spacerAfter:5}}],css:{"-webkit-border-radius":"3px","border-radius":"3px","-webkit-box-shadow":"0px 1px 2px 1px rgba(0,  0,  0,  .2)","box-shadow":"0px 1px 2px 1px rgba(0,  0,  0,  .2)",background:"#fff",border:"1px solid #e1e1e1"}},layout:{height:"235px",width:"310px",spacer:10}}]}},{comp:{name:"HBox",items:[{data:"description",comp:{name:"Label"},layout:{"box-flex":1,spacer:20}}]},layout:{spacerBefore:10,height:"30px",width:"330px"}},{comp:{name:"HBox",items:[{id:"hoverButton",comp:{name:"Button",hidden:"true",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",label:"@CHOOSE_THIS_LIST@",css:{margin:"auto",position:"relative"}},layout:{height:"32px",width:"100px",cursor:"pointer"}}],css:{"-moz-box-pack":"center","text-align":"center"}},layout:{spacerBefore:"*",width:300,height:32}},{comp:{name:"VSpacer",size:"15"}}],css:{width:"330px",height:"385px",border:"solid 2px transparent","background-color":"#fff","-webkit-border-radius":"6px","border-radius":"6px"},events:{click:"presenter.onTemplateChosen","dom:mouseover":"presenter.onTemplateMouseOver","dom:mouseout":"presenter.onTemplateMouseOut"}},layout:{spacerBefore:10,spacerAfter:25,"box-align":"center"}}],css:{width:"330px",height:"420px",cursor:"pointer"}}},{comp:{name:"HSpacer",size:"13"}}]}}}},layout:{width:"820px",height:"420px"}}],css:{width:"100%",height:"100%",background:"#fff",border:"solid 1px #ccc","-webkit-border-radius":"5px","border-radius":"5px"}}},{name:"MoveField",forType:"wix:Object",comp:{name:"VBox",items:[{comp:{name:"Container",skin:"wixapps.integration.skins.dialogs.InputGroupSkin",items:[{comp:{name:"VBox",items:[{value:"@CHOOSE_LOCATION@",comp:{name:"Label"}},{data:"this.possibleContainers",comp:{name:"ComboBox",skin:"wysiwyg.editor.skins.inputs.ComboBoxSkin",css:{width:"260px"}}},{comp:{name:"VSpacer",size:"10"}}]}}],css:{"background-color":"#FFF"}},layout:{spacerBefore:10}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"HBox",items:[{value:"@CANCEL@",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:"presenter.onCancel"}}},{comp:{name:"HSpacer",size:"*"}},{value:"@MOVE_FIELD@",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:"presenter.onContainerChosen"}}}]}}],css:{width:"99%"}}},{name:"ShowField",forType:"wix:Object",comp:{name:"VBox",items:[{comp:{name:"VSpacer",size:"10"}},{comp:{name:"Container",skin:"wixapps.integration.skins.dialogs.InputGroupSkin",items:[{comp:{name:"HBox",items:[{comp:{name:"VBox",items:[{id:"exIcon",value:{_type:"wix:Image",src:"images/icons/hidden.png",width:16,height:16},comp:{name:"Icon"},layout:{spacerBefore:4,width:16,height:16}}]},layout:{spacerAfter:10}},{value:"@FIELD_IS_HIDDEN@",comp:{name:"Label"}}]}}],css:{"background-color":"#CCEBFF"}}},{comp:{name:"VSpacer",size:"10"}},{value:"@TO_SHOW_A_FIELD_LOCATE_IT@",comp:{name:"Label"}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"Container",skin:"wixapps.integration.skins.dialogs.InputGroupSkin",items:[{comp:{name:"VBox",items:[{value:"@CHOOSE_LOCATION@",comp:{name:"Label"}},{data:"this.possibleContainers",comp:{name:"ComboBox",skin:"wysiwyg.editor.skins.inputs.ComboBoxSkin",css:{width:"260px"}}},{comp:{name:"VSpacer",size:"10"}}]}}],css:{"background-color":"#FFF"}}},{comp:{name:"VSpacer",size:"10"}},{comp:{name:"HBox",items:[{value:"Cancel",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:"presenter.onCancel"}}},{comp:{name:"HSpacer",size:"*"}},{value:"Show Field",comp:{name:"Button",skin:"wixapps.integration.skins.editor.EditorButtonBlueSkin",events:{click:"presenter.onContainerChosen"}}}]}}],css:{width:"100%"}}}]),define.Class("wixapps.integration.managers.AppBuilderLocalizer",function(e){var t=e;t.inherits("wixapps.integration.managers.BaseLocalizer"),t.fields({}),t.methods({localize:function(e,t){return this.resources.W.Resources.get("WIXAPPS2_LANGUAGE",e,t)||"["+e+"]"},localizeView:function(e){return this._processValue(e,"")},localizeTemplates:function(e){return this._processValue(e,"")}})}),define.oldClass({name:"wixapps.integration.managers.AppResizeHandler",Class:{Binds:["_onAppResize","_onAppViewCreated","_onProxySizeInvalid"],_appHolderView:null,_resizeDispatcher:null,_lastSize:null,_resizeLocked:!1,activateResizeHandler:function(e,t){this._resizeDispatcher&&this.deactivateResizeHandler(this._resizeDispatcher),this._resizeDispatcher=e,this._appHolderView=t,this._resizeDispatcher.addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppResize),this._resizeDispatcher.addEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewCreated),this._resizeDispatcher.addEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,this._onProxySizeInvalid)},deactivateResizeHandler:function(){this._resizeDispatcher.removeEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppResize),this._resizeDispatcher.removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewCreated),this._resizeDispatcher.removeEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,this._onProxySizeInvalid),this._resizeDispatcher=null,this._appHolderView=null},_onAppViewCreated:function(){this._performResizeAction(this._appHolderView,function(e){e._onAppViewCreated()}),this._checkContentSizeChange()},_onAppResize:function(){this._performResizeAction(this._appHolderView,function(e){e._onAppResize.call()}),this._checkContentSizeChange()},_onProxySizeInvalid:function(){this._resizeLocked=!0,window.requestAnimFrame(function(){this._resizeLocked=!1,this._performResizeAction(this._appHolderView,function(e){e._onAppResize.call()}),this._checkContentSizeChange()}.bind(this))},_checkContentSizeChange:function(){window.requestAnimFrame(function(){var e=!1,t=this._appHolderView.getSize();this._lastSize&&(e=t.x!==this._lastSize.x||t.y!==this._lastSize.y),this._lastSize=t,e&&this._resizeDispatcher.fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE)}.bind(this))},_performResizeAction:function(e,t){if(!this._resizeLocked){var n=this,r=e.getElements("[hasproxy]");this._updateGeometry(e);var i=r.filter(function(e){return n._isResizableProxy(e.getViewProxy())}).map(function(t){return{proxy:t.getViewProxy(),depth:n._getElementDepth(e,t)}}).sort(function(e,t){return e.depth-t.depth});i.forEach(function(e){t(e.proxy)})}},_updateGeometry:function(e){if(e.$flexPolyfill)e.$flexPolyfill.updateGeometry();else for(var t=0;t<e.children.length;t++)this._updateGeometry(e.children[t])},_isResizableProxy:function(e){return e._onAppResize&&e._onAppViewCreated},_getElementDepth:function(e,t){return t==e||t==null?0:this._getElementDepth(e,t.getParent())+1}}}),define.Class("wixapps.integration.managers.ApplicationInstance",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.binds(["_onDescriptorLoaded","resolveResourcePath"]),t.utilize(["wixapps.core.managers.TypesManager","wixapps.core.dataservice.DataServiceTransport","wixapps.core.data.DataItemFactory","wixapps.core.dataservice.ItemCache","wixapps.core.dataservice.DataService","wixapps.core.views.ViewsCustomizer","wixapps.core.views.ViewDefinitionsRepository","wixapps.integration.managers.ApplicationInstanceUtils","wixapps.integration.managers.applicationhandlers.ZoomHandler","wixapps.core.expressions.FunctionLibrary","wixapps.integration.managers.ApplicationLocalizer"]),t.fields({_localizer:null}),t.methods({initialize:function(e){this._appParts=[],this._idInMetasite=e.applicationId,this._appDefinitionId=e.appDefinitionId,this._packageName=e.packageName,this._types=new this.imports.TypesManager,this._funcLibrary=new this.imports.FunctionLibrary,this._dataFactory=new this.imports.DataItemFactory,this._dataFactory.registerFunctionLibrary(this._funcLibrary),this._itemCache=new this.imports.ItemCache(this._dataFactory),this._zoomHandler=new this.imports.ZoomHandler(this),this._localizer=null,e.type=="wixapps"?(this._transport=new this.imports.DataServiceTransport(e.datastoreId,"",""),this._dataService=new this.imports.DataService(this._transport,this._dataFactory,this._itemCache)):e.type=="ecommerce"&&(this._magentoStoreId=e.magentoStoreId),this._customizations=new this.imports.ViewsCustomizer,this._viewDefinitions=new this.imports.ViewDefinitionsRepository(this._dataFactory),this._appBasePath=null;var t=W.Config.getServiceTopologyProperty("scriptsLocationMap");if(!t||!t.wixapps)throw"wixapps topology path is undefined";this._appBasePath=t.wixapps+"/javascript/wixapps/apps/"+this._packageName+"/",this._createdApplicationPages={},this._utils=new this.imports.ApplicationInstanceUtils(this)},loadDescriptor:function(){this.resource.getResourceValue("W.Apps",function(e){e.requestAppDescriptor(this._packageName,this._onDescriptorLoaded)}.bind(this))},getAppDefinitionId:function(){return this._appDefinitionId},getPackageName:function(){return this._packageName},getIdInMetasite:function(){return this._idInMetasite},getDataService:function(){return this._dataService},getMagentoStoreId:function(){return this._magentoStoreId},getAppDescriptor:function(){return this._descriptor},getAppBasePath:function(){return this._appBasePath},getAppParts:function(){return this._appParts},getLocalizer:function(){return this._localizer},getUtils:function(){return this._utils},resolveResourcePath:function(e){if(e){var t=e.match(/^(http:\/\/)?(images\/.*)/);if(t)return this._appBasePath+t[2]}return e},registerAppPart:function(e){this._appParts.push(e),this.getDescriptorLoaded()&&e.initApp()},getDescriptorLoaded:function(){return!!this._descriptor},getTypesManager:function(){return this._types},getDataServiceTransport:function(){return this._transport},getDataItemFactory:function(){return this._dataFactory},getItemCache:function(){return this._itemCache},getCustomizations:function(){return this._customizations},getViewDefRepo:function(){return this._viewDefinitions},getPartDefinition:function(e){if(!this._descriptor||!this._descriptor.parts)return null;for(var t=0;t<this._descriptor.parts.length;t++)if(this._descriptor.parts[t].id==e)return this._descriptor.parts[t];return null},getPageDefinition:function(e){return!this._descriptor||!this._descriptor.pages?null:this._descriptor.pages.first(function(t){return t.id==e})},_onDescriptorLoaded:function(e){var t,n=e.lang||{};this._localizer=new this.imports.ApplicationLocalizer(n),e=this._localizer.localizeDescriptor(e),this._descriptor=e;var r=Constants.WixAppsSystemTypes;for(t=0;t<r.length;t++)this._types.registerType(r[t]);for(t=0;t<e.types.length;t++)this._types.registerType(e.types[t]);this._customizations.addRules(e.customizations),this._addDataEditingCustomizations();for(t=0;t<e.views.length;t++){var i=this._viewDefinitions.cloneAndMultiply(e.views[t]);for(var s=0;s<i.length;s++)this._customizations.fillMissingIds(i[s]),this._customizations.applyAll(i[s]),this._viewDefinitions.setViewDefinition(i[s])}for(t=0;t<this._appParts.length;t++)this._appParts[t].initApp();W.Viewer&&W.Viewer.isSiteReady()?this._zoomHandler.validateZoomRelatedData():this._callValidateZoomData()},_callValidateZoomData:function(){W.Viewer&&W.Viewer.isPublicMode()?W.Viewer.addEvent("SiteReady",this._zoomHandler.validateZoomRelatedData):W.Commands.registerCommandListenerByName("EditorCommands.SiteLoaded",this,this._zoomHandler.validateZoomRelatedData)},_addDataEditingCustomizations:function(){var e=this.getDescriptorValue(["dataEditing","typeMetaData"]),t=this.getCustomizations();for(var n in e){var r=e[n];if(r.validationMessages)for(var i in r.validationMessages)t.addRule({forType:n,view:"editorForm",fieldId:i,mode:"*",key:"comp.validationMessage",value:r.validationMessages[i]})}},getDescriptorValue:function(e){return this._getInnerValue(this._descriptor,e)},_getInnerValue:function(e,t){var n=e;for(var r=0;r<t.length;r++){n=n[t[r]];if(!n)return null}return n},getZoomHandler:function(){return this._zoomHandler}})}),define.Class("wixapps.integration.managers.ApplicationInstanceUtils",function(e){var t=e;t.fields({_appInstance:null}),t.methods({initialize:function(e){this._appInstance=e},createRunner:function(){return{_tasks:[],_onDone:null,_done:function(){if(this._tasks.length<1){this._onDone&&this._onDone();return}var e=this._tasks.shift();e.func(this._done.bind(this))},add:function(e,t){this._tasks.push({name:e,func:t})},run:function(e){this._onDone=e,this._done()}}},extractStoreData:function(e){var t,n={},r=this.createRunner();r.add("Loading collection names",function(e){var i=t.getDescriptorValue(["collections"]);for(var s=0;s<i.length;s++){var o=i[s].id;r.add("Loading items from "+o,function(e){return function(r){t.getDataService().getTransport().query(e,{},null,0,-1,function(t){n[e]=t.items,r()},function(e){r()})}}(o))}r.add("Cleaning items",function(e){Object.each(n,function(e){e.forEach(function(e){delete e._createdAt,delete e._hash,delete e._updatedAt,delete e._vg})}),e()}),e()}),r.run(function(){e(n)})},extractDescriptorData:function(){return this._appInstance.getDescriptorValue(["preLoadedData"])},cleanDataInStore:function(e,t){function u(){i.length+s.length==r&&t&&t({successes:i.length,failures:s,failuresCause:o})}function a(e){return function(){i.push(e),u()}}function f(e){return function(t){t.code==-1021||t.description.indexOf("ItemNotExistsException")>-1?i.push(e):(s.push(e),o.push(t)),u()}}var n=this._appInstance,r=0,i=[],s=[],o=[];Object.each(e,function(e,t){e.forEach(function(e){e._iid&&r++})}),Object.each(e,function(e,t){e.forEach(function(e){e._iid&&n.getDataService().deleteItem(t,e._iid,a(e),f(e))}.bind(this))}.bind(this))},cleanStore:function(e){var t={},n=this._appInstance,r=this.createRunner();r.add("Loading collection names",function(e){var i=n.getDescriptorValue(["collections"]);for(var s=0;s<i.length;s++){var o=i[s].id;r.add("Loading items from "+o,function(e){return function(r){n.getDataService().getTransport().query(e,{},null,0,-1,function(n){t[e]=n.items,r()},function(e){r()})}}(o))}r.add("Delete all items",function(e){function i(){r--,r===0&&e()}var r=0;Object.each(t,function(e){r+=e.length}),Object.each(t,function(e,t){e.forEach(function(e){n.getDataService().getTransport().deleteItem(t,e._iid,i,i)})}),e()}),e()}),r.run(e)},uploadData:function(e,t){function u(){i.length+s.length==r&&t&&t({successes:i.length,failures:s.length})}function a(e){return function(){i.push(e),u()}}function f(e){return function(t){s.push(e),o.push(t),u()}}var n=this._appInstance,r=0;Object.each(e,function(e,t){r+=e.length});var i=[],s=[],o=[];Object.each(e,function(e,t){e.forEach(function(e){var r=Object.clone(e);delete r._createdAt,delete r._hash,delete r._updatedAt,delete r._vg;var i=n.getDataItemFactory().createDataItem(r);n.getDataService().createItem(t,i,a(e),f(e))})})},resetStoreToDescriptorData:function(e){this.cleanStore(function(){var t=this.extractDescriptorData(),n=this._appInstance.getDataService().getItemCache();n&&n.removeAll(),this.uploadData(t,e)}.bind(this))}})}),define.Class("wixapps.integration.managers.ApplicationLocalizer",function(e){var t=e;t.inherits("wixapps.integration.managers.BaseLocalizer"),t.fields({_blackList:["/collections","/permissions","/types","/preLoadedData","/lang"]}),t.methods({initialize:function(e){this._lang=e||{},this.parent()},localizeDescriptor:function(e){return this._processValue(e,"")},localize:function(e,t){return t=t||this._locale,this._getByLocale(e,t)||this._getByLocale(e,this.DEFAULT_LANG)||"["+e+"]"},_getByLocale:function(e,t){return t?this._lang.hasOwnProperty(t)?this._lang[t].hasOwnProperty(e)?this._lang[t][e]:null:null:null}})}),define.Class("wixapps.integration.managers.BaseLocalizer",function(e){var t=e;t.resources(["W.Resources","W.Utils","W.CookiesManager","W.Config"]),t.fields({THINGY_CHAR:"@",DEFAULT_LANG:"en",_blackList:[],_utils:null}),t.methods({initialize:function(){this._locale=this._getLangCode(),this._macroPattern=new RegExp(this.THINGY_CHAR+"[a-zA-Z_\\-\\.]*"+this.THINGY_CHAR),this._thingyPattern=new RegExp(this.THINGY_CHAR,"g"),this._utils=this.resources.W.Utils.AppsUtils},localize:function(e,t){throw"Not implemented: ask my children."},isValidKey:function(e){return this._macroPattern.test(e)},getKeyValue:function(e){return e.replace(this._thingyPattern,"")},_getLangCode:function(){var e=this.resources.W.Config;if(e.isEditorMode())return this.resources.W.Resources.getLanguageSymbol();if(e.isPreviewMode())return e.getLanguage()||this.resources.W.CookiesManager.getCookie("wixLanguage");if(e.isPublicMode()){var t=window.navigator.userLanguage||window.navigator.language;return t.split("-")[0]}throw"Localizer:: Not in Editor, Preview or Public... something is wrong"},_processValue:function(e,t){var n=this._utils.getType(e);if(~this._blackList.indexOf(t))return e;switch(n){case"object":return this._iterateObject(e,t);case"array":return this._iterateArray(e,t);case"string":return this._localize(e);default:return e}},_localize:function(e){var t,n,r;while((t=this._macroPattern.exec(e))!==null)t=t[0],n=t.replace(this._thingyPattern,""),r=this.localize(n),e=e.replace(t,r);return e},_iterateArray:function(e,t){var n,r=e.length;for(n=0;n<r;n++)e[n]=this._processValue(e[n],t+"["+n+"]");return e},_iterateObject:function(e,t){var n;for(n in e)e.hasOwnProperty(n)&&(e[n]=this._processValue(e[n],t+"/"+n));return e}})}),define.Class("wixapps.integration.managers.FieldHighlightHandler",function(e){var t=e;t.inherits(),t.utilize([]),t.traits([]),t.binds([]),t.fields({_highlightedFields:[],_highlightedContainers:[],_editPanelParams:null}),t.methods({initialize:function(){},_resolveHighlightContainer:function(e){switch(e.$className){case"wixapps.integration.proxies.ImageProxy":case"wixapps.integration.proxies.VideoProxy":return e.getElement().firstChild;default:return e.getElement()}},_createFieldRect:function(e,t){var n=new Element("div",{styles:{border:"1px solid #FFC700","background-color":"#FFDD55",opacity:.3,position:"absolute",top:"0px",right:"0px",bottom:"0px",left:"0px"}});this._highlightedFields.push(n);var r=this._resolveHighlightContainer(e),i=r.getStyle("position");if(i==="static"||i==="inherit")r.oldPosition=i,r.setStyle("position","relative");r.adopt(n)},_createContainerRect:function(e,t){e.getElement().setStyles({"outline-style":"dashed","outline-width":"1px","outline-offset":"0px","outline-color":"#FFC700"}),this._highlightedContainers.push(e.getElement())},_clearFieldRects:function(){while(this._highlightedFields.length){var e=this._highlightedFields.pop();e&&e.parentElement&&e.parentElement.oldPosition&&e.parentElement.setStyle("position",e.parentElement.oldPosition),e.destroy()}},_clearContainerRects:function(){while(this._highlightedContainers.length)this._highlightedContainers.pop().setStyles({"outline-style":null,"outline-width":null,"outline-offset":null,"outline-color":null})},highlightField:function(e){e.isInEditPanel&&(this._editPanelParams=e),this._editPanelParams!==null&&this.removeHighlightField({appPart:e.appPart,isInEditPanel:!1},!0);var t=e.appPart.getViewNode(),n=t.getElements("[vcfield="+e.fieldId+"_proxy]").map(function(e){return e.getViewProxy()}),r=t.getElements("[vcfield="+e.containerName+"]").map(function(e){return e.getViewProxy()}),i=this;r.forEach(function(e){i._createContainerRect(e,t)}),n.forEach(function(e){i._createFieldRect(e,t)})},removeHighlightField:function(e,t){this._clearContainerRects(),this._clearFieldRects();if(t===!0)return;e.isInEditPanel?this._editPanelParams=null:this._editPanelParams!==null&&this.highlightField(this._editPanelParams)},_createFieldRect2:function(e,t){e.getElement().setStyles({"outline-style":"dashed","outline-width":"1px","outline-offset":"0px","outline-color":"#0033ff"}),this._highlightedFields.push(e.getElement())},_clearFieldRects2:function(){while(this._highlightedFields.length)this._highlightedFields.pop().setStyles({"outline-style":null,"outline-width":null,"outline-offset":null,"outline-color":null})}})}),define.oldClass({name:"wixapps.integration.managers.LifecycleManager",imports:[],traits:[],Class:{Extends:Object,Binds:["_defaultInvalidateLayoutAction","_onProxyIrrecoverable"],_dispatcher:null,_pendingComponents:[],_pendingActions:[],_irrecoverableContainers:[],initialize:function(e){this._dispatcher=e,this._dispatcher.addEvent(Constants.WixAppEvents.PROXY_IRRECOVERABLE,this._onProxyIrrecoverable)},notifyComponentCreated:function(e){this._pendingComponents.indexOf(e)==-1&&this._pendingComponents.push(e)},notifyComponentReady:function(e){var t=this._pendingComponents.indexOf(e);t>-1&&this._pendingComponents.splice(t,1),this._performCleanup(),this._pendingComponents.length===0&&this._executeAllPendingActions()},reset:function(){this._pendingComponents=[],this._pendingActions=[]},performAction:function(e){this._pendingActions.indexOf(e)==-1&&this._pendingActions.push(e),this._performCleanup(),this._pendingComponents.length===0&&this._executeAllPendingActions()},_performCleanup:function(){var e=this._pendingComponents;this._pendingComponents=[];for(var t=0;t<e.length;t++){var n=e[t];n.$viewProxy&&n.$viewProxy._disposed===!1&&this._waitsForWixification(n)&&this._pendingComponents.push(n)}},_waitsForWixification:function(e){return!e.getLogic||e.getLogic().isReady()!==!0},_executeAllPendingActions:function(){var e=this._pendingActions;this._pendingActions=[],e.each(function(e){e()})},_defaultInvalidateLayoutAction:function(){this._dispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_READY)},getDefaultInvalidateLayoutAction:function(){return this._defaultInvalidateLayoutAction},_onProxyIrrecoverable:function(e){var t=Boolean(this._irrecoverableContainers.length===0),n=e.sender,r=n.getElement().getParents("[hasproxy]")[0]?n.getElement().getParents("[hasproxy]")[0].getViewProxy():null;r&&this._irrecoverableContainers.indexOf(r)===-1&&this._irrecoverableContainers.push(r),n.dispose(),t&&window.requestAnimFrame(function(){while(this._irrecoverableContainers.length){var e=this._irrecoverableContainers.shift();e.isDisposed()||e._reloadProxy()}}.bind(this))}}}),define.oldClass({name:"wixapps.integration.managers.ViewHolder",imports:["wixapps.core.events.ProxyEventBus","wixapps.integration.managers.AppResizeHandler","wixapps.integration.managers.LifecycleManager","wixapps.core.views.ProxyFactory","wixapps.integration.proxies.ProxyMap","wixapps.integration.utils.LayoutGeometryMap"],Class:{Binds:[],Extends:"bootstrap.utils.Events",_container:null,_rootProxy:null,_data:null,_viewName:"",_geometryMap:null,initialize:function(e,t,n,r,i){this._eventDispatcher=new this.imports.ProxyEventBus,this._resizeHandler=new this.imports.AppResizeHandler,this._lifecycleManager=new this.imports.LifecycleManager(this._eventDispatcher),this._resourceResolverFunction=r,this._nameSpace=i,this._geometryMap=new this.imports.LayoutGeometryMap,this._proxyFactory=new this.imports.ProxyFactory(e,t,n,this._eventDispatcher,this._resourceResolverFunction,this._nameSpace,this._lifecycleManager),(new this.imports.ProxyMap).registerComponentProxies(this._proxyFactory)},setContainer:function(e){this._container&&this.destroyContent(),e.getStyle("position")=="static"&&e.setStyle("position","relative"),this._container=e},setupViewHolder:function(e,t,n){this._mode=n||"view",this._data=e,this._viewName=t,this._container&&this._updateContent()},setContentHeight:function(e){this._rootProxy.getElement().setStyle("height",e)},invalidateSize:function(){this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE)},getGeometryMap:function(){return this._geometryMap},_updateContent:function(){this._rootProxy=this._proxyFactory.createView(this._data,this._viewName,this._mode);var e=this._rootProxy.createComponent();this.destroyContent(),this._container.adopt(e),this._resizeHandler.activateResizeHandler(this._eventDispatcher,e),this._rootProxy.setupProxy(),window.requestAnimFrame(function(){this._lifecycleManager.performAction(function(){this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_VIEW_CREATED)}.bind(this))}.bind(this))},getRootProxy:function(){return this._rootProxy},getEventDispatcher:function(){return this._eventDispatcher},performActionWhenReady:function(e){this._lifecycleManager.performAction(e)},destroyContent:function(){this._container.empty(),this._geometryMap.dispose()},dispose:function(){this.destroyContent(),this._container=null,this._data=null,this._rootProxy&&(this._rootProxy.dispose(),this._rootProxy=null)}}}),define.oldClass({name:"wixapps.integration.managers.WixAppsEditorData",imports:[],traits:[],Class:{Extends:"wixapps.integration.managers.WixAppsEditorDataBase",Binds:[],_setupData:function(){this.addDataPanel("AppPart","wixapps.integration.components.AppPart",{logic:"wixapps.integration.components.editor.AppPartDataPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"}),this.addDataPanel("AppBuilderComponent","wixapps.integration.components.AppPart2",{logic:"wixapps.integration.components.panels.ListSettingsPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"})}}}),define.Class("wixapps.integration.managers.WixAppsEditorDataBase",function(e){var t=e;t.binds(["_setupData"]),t.methods({setup:function(){this._setupData()},_setupData:function(){},addLanguageKey:function(e,t){this.resource.getResourceValue("W.Resources",function(n){n.bundles.EDITOR_LANGUAGE[e]=t})},addDataPanel:function(e,t,n){this.resource.getResourceValue("W.Editor",function(r){r.addDataPanel(e,t,n)})}})}),define.Class("wixapps.integration.managers.WixAppsGUIManager",function(e){var t=e;t.inherits(),t.utilize(["wixapps.core.views.ViewsCustomizer","wixapps.integration.managers.AppBuilderLocalizer"]),t.traits([]),t.binds([]),t.resources(["wixapps.integration.gui.WixAppsGUIViews"]),t.fields({_viewDescMap:{},_viewCustomizer:null,_localizer:null,DEFAULT_DIALOG_PROFILE:"basicPopup",_dialogProfiles:{basicPopup:{width:300,position:"side",level:1,allowScroll:!0,showToolbar:!0,nonModal:!0,allowDrag:!0,buttonSet:["OK"]}}}),t.methods({initialize:function(){this._viewCustomizer=new this.imports.ViewsCustomizer,this._localizer=new this.imports.AppBuilderLocalizer,this.registerViewDescriptors(this.resources.wixapps.integration.gui.WixAppsGUIViews)},registerViewDescriptors:function(e){e.forEach(function(e){e=this._viewCustomizer.fillMissingIds(e),this._viewDescMap[e.name]=e}.bind(this))},getViewDescriptor:function(e){if(this._viewDescMap.hasOwnProperty(e)){var t=this._viewDescMap[e];return this._localizer.localizeView(t)}throw"WixAppsGUI:: view ["+e+"] doesn't exist in map"},openDialog:function(e,t,n,r){var i=this.getViewDescriptor(t);i&&this.resource.getResourceValue("W.EditorDialogs",function(s){s._createAndOpenWDialog(t,"wixapps.integration.components.panels.BuilderDialogPanel","mobile.core.skins.InlineSkin",function(t){t.setupPanel(e,i,n)}.bind(this),r,undefined,!0,undefined,!1,!1,!0)}.bind(this))},openWDialog:function(e,t,n,r){this.resource.getResourceValue("W.EditorDialogs",function(i){i._createAndOpenWDialog(e+"_inst",e,r||"wysiwyg.editor.skins.panels.base.AutoPanelSkin",function(e){e.setupPanel(t)}.bind(this),n,undefined,!0,undefined,!1,!1,!0)}.bind(this))},getDialogParams:function(e,t,n){var r=Object.clone(this._dialogProfiles[n]||this._dialogProfiles[this.DEFAULT_DIALOG_PROFILE]);return r.title=e,r.description=t,r},isReady:function(){return!0}})}),define.Class("wixapps.integration.managers.WixAppsLocalizer",function(e){var t=e;t.inherits("wixapps.integration.managers.BaseLocalizer"),t.fields({}),t.methods({localize:function(e,t){return this.resources.W.Resources.get("WIXAPPS_LANGUAGE",e,t)||"["+e+"]"}})}),define.Class("wixapps.integration.managers.WixAppsManager",function(e){var t=e;t.utilize(["wixapps.integration.managers.ApplicationInstance"]),t.resources(["scriptLoader","topology","W.Viewer"]),t.fields({_isReady:!1}),t.methods({initialize:function(){this._initialize(),this._isReady=!0},_initialize:function(){this._appInstanceMap={},this._appDescriptorMap={},this._descriptionCallBacks={},this._loadInstalledApps()},_loadInstalledApps:function(){var e=this.resources.W.Viewer.getAppDataHandler().getAppsData();Object.each(e,function(e,t){["wixapps","ecommerce"].indexOf(e.type)!=-1&&this.loadApplication(e)},this)},isReady:function(){return this._isReady},loadApplication:function(e){var t=new this.imports.ApplicationInstance(e);this._appInstanceMap[e.applicationId]=t,t.loadDescriptor()},getApp:function(e){return this._appInstanceMap[e]},getAppByPackageName:function(e){for(var t in this._appInstanceMap)if(this._appInstanceMap[t].getPackageName()==e)return this._appInstanceMap[t];return null},requestAppDescriptor:function(e,t){if(this._appDescriptorMap[e]){t(this._appDescriptorMap[e]);return}var n={id:"js",url:this._buildDescriptorURL(e)},r={onLoad:function(e,t,n){},onFailed:function(e,t,n){}};this._descriptionCallBacks[e]=this._descriptionCallBacks[e]||[],this._descriptionCallBacks[e].push(t),this.resources.scriptLoader.loadResource(n,r)},_buildDescriptorURL:function(e){var t=this.resources.topology.wixapps+"/javascript/";return t+"wixapps/apps/"+e+"/descriptor.js"},registerAppDescriptor:function(e){var t=0,n=e.packageName;this._appDescriptorMap[n]=e;if(this._descriptionCallBacks[n]){for(t=0;t<this._descriptionCallBacks[n].length;t++)this._descriptionCallBacks[n][t](e);delete this._descriptionCallBacks[n]}},openPermaLink:function(e){var t=e.get("dataItemRef"),n=W.Data.getDataByQuery(t),r=this._appInstanceMap[n.get("appInnerID")];r.getZoomHandler().openZoomFromHash(e)},setPageState:function(e,t){this._stateByPage||(this._stateByPage={}),this._stateByPage[e]=t},getPageState:function(e){var t=this._stateByPage&&this._stateByPage[e];return t||""}})}),define.Class("wixapps.integration.managers.WixAppsManager2",function(e){var t=e;t.utilize(["wixapps.core.apprepo.ApplicationInstance2","wixapps.core.apprepo.AppRepoTransport","wixapps.core.utils.WixAppsLogger"]),t.statics({APP_BUILDER_APP_TYPE:"appbuilder",APP_BUILDER_APP_DEFINITION_ID:"3d590cbc-4907-4cc4-b0b1-ddf2c5edf297"}),t.resources(["W.Viewer"]),t.fields({_appInstanceMap:{},_appInstWaitingList:[],_appRepoTransport:null,_isReady:!1}),t.methods({initialize:function(){this._appRepoTransport=new this.imports.AppRepoTransport,this._loadInstalledApps(),this._isReady=!0,this._logger=new this.imports.WixAppsLogger},isReady:function(){return this._isReady},registerNewApplication:function(e,t){var n=t.applicationId;return this._registerAppInstance(n,e),t.appDefinitionId=this.APP_BUILDER_APP_DEFINITION_ID,this.resources.W.Viewer.getAppDataHandler().registerAppData(t),n},_registerAppInstance:function(e,t){this._appInstanceMap[e]=t},_loadInstalledApps:function(){var e=this.resources.W.Viewer.getAppDataHandler().getAppsData();Object.each(e,function(e,t){if([this.APP_BUILDER_APP_TYPE].indexOf(e.type)!=-1){e.appDefinitionId=this.APP_BUILDER_APP_DEFINITION_ID,this.resources.W.Viewer.getAppDataHandler().registerAppData(e);var n=e.applicationId,r=e.instanceId;this._loadApplicationFromRepo(n,r)}},this)},_loadApplicationFromRepo:function(e,t){var n=function(n){var r=new this.imports.ApplicationInstance2(t,n);r.setApplicationId(e),r.setSavedInRepo(!0),this._registerAppInstance(e,r),this._appInstWaitingList.hasOwnProperty(e)&&this._appInstWaitingList[e](r),this._appLoaded=!0}.bind(this),r=function(e,t){var n=this._logger;n.reportError({code:e,description:t},this.$className,"_loadApplicationFromRepo",n.SubCategory.APP_REPO_SERVICE,n.Severity.ERROR,n.Category.VIEWER)}.bind(this);this.resources.W.Viewer.isPublicMode()?this._appRepoTransport.getPublishedInstance(t,n,r):this._appRepoTransport.getSavedInstance(t,n,r)},getApplicationInstance:function(e,t){this._appLoaded?this._appInstanceMap.hasOwnProperty(e)?t(this._appInstanceMap[e]):t(null):this._appInstanceMap.hasOwnProperty(e)?t(this._appInstanceMap[e]):this._appInstWaitingList[e]=t},createApplicationInstance:function(e,t){var n=new this.imports.ApplicationInstance2(t);return n.setApplicationId(e),n.setSavedInRepo(!1),n},getApplicationInstances:function(){return this._appInstanceMap},getNextGeneratedApplicationId:function(){var e=this.resources.W.Viewer.getAppDataHandler();return e.getLargestApplicationId()+1},getAppPart2Components:function(){var e=$("SITE_STRUCTURE").getElements("div[comp*='AppPart2']");return e.map(function(e){return e.getLogic()})}})}),define.Class("wixapps.integration.managers.applicationhandlers.ZoomHandler",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.binds(["validateZoomRelatedData"]),t.utilize([]),t.resources(["W.Data","W.Commands","W.Components","W.Utils","W.Viewer"]),t.methods({initialize:function(e){this._applicationInstance=e},validateZoomRelatedData:function(){var e=this._applicationInstance.getDescriptorValue(["parts"]).filter(function(e){return!!e.zoomParams}),t=this;this.resources.W.Data.getDataItemsByType("PermaLink",function(n){var r=Object.values(n).map(function(e){return e.get("dataItemRef")});t.resources.W.Data.getDataByQueryList(r,function(r){t._initializePermaLinkAndPartDataMap(e,n,r),t.fireEvent("mapInitialized",t._permaLinkAndPartDataMap)})})},getZoomPartData:function(e,t){this._getPermaLinkAndZoomPartData(e,function(e){t(e&&e.partData)})},_getPermaLinkAndZoomPartData:function(e,t){var n=this,r=function(i){n.removeEvent("mapInitialized",r);var s=i[e];t(s)};this._permaLinkAndPartDataMap?r(this._permaLinkAndPartDataMap):this.addEvent("mapInitialized",r)},_initializePermaLinkAndPartDataMap:function(e,t,n){var r={};Object.forEach(n,function(e){e.get("appInnerID")==this._applicationInstance.getIdInMetasite()&&(r[e.get("appPartName")]=e)},this),this._permaLinkAndPartDataMap={},e.forEach(function(e){var n=this._getPermaLinkAndPartDataForPart(e,t,r);this._permaLinkAndPartDataMap[e.id]=n},this)},_getPermaLinkAndPartDataForPart:function(e,t,n){var r=this._getPermaLinkCorrectId(e),i=t["#"+r];return i||(i=this._getPermaLinkByPartName(t,n,e)),i?{permaLinkData:i,partData:n[e.id]}:this._addPermaLinkAndPartDataItem(e)},_getPermaLinkByPartName:function(e,t,n){var r=n.id,i=t[r]&&t[r].get("id");if(!i)return null;var s=Object.values(e).filter(function(e){return e.get("dataItemRef")=="#"+i}).pick();if(!s)return null;if(this.resources.W.Viewer.getPreviewMode()===!0){var o=this._addPermaLinkItem(n,t[r]);return s.set("correctPermaLinkRef","#"+o.get("id")),o}return s},_addPermaLinkAndPartDataItem:function(e){var t=this._applicationInstance.getIdInMetasite(),n=this.resources.W.Data.addDataItemWithUniqueId("appPart",{type:"AppPart",appInnerID:t,appLogicParams:{},appLogicCustomizations:[],appPartName:e.id,viewName:e.views[0]}),r=this._addPermaLinkItem(e,n.dataObject);return{permaLinkData:r,partData:n.dataObject}},_addPermaLinkItem:function(e,t){return this.resources.W.Data.addDataItem(this._getPermaLinkCorrectId(e),{type:"PermaLink",appType:"ListsApps",dataItemRef:"#"+t.get("id"),mutableSeoTitle:e.zoomParams&&e.zoomParams.urlTitle||""})},_getPermaLinkCorrectId:function(e){if(!e.zoomParams||!e.zoomParams.urlIdPrefix)throw"must define urlIdPrefix on the part definition -> zoomParams which is unique for the app";var t=this._applicationInstance.getIdInMetasite();return e.zoomParams.urlIdPrefix+t},openZoomFromHash:function(e){this._detectCircularZoomUpdate()||this.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{item:this._getItemFromHash(),getDisplayerDivFunction:this._getAppPartDivFunction(e),getHashPartsFunction:this._getHashPartsFunction(e)},this)},_detectCircularZoomUpdate:function(){return this._lastOpenedItem&&(new Date).getTime()-this._lastOpenedItemTimestamp<1e3?this._getItemFromHash().id===this._lastOpenedItem.id:!1},openZoomForItemsList:function(e,t,n,r){var i=this;this._lastOpenedItem=e[t],this._lastOpenedItemTimestamp=(new Date).getTime(),this._getPermaLinkAndZoomPartData(n,function(n){var s=n&&n.permaLinkData,o=i.resources.W.Data.createDataItem({type:"list",items:e},"list");i.resources.W.Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:o,currentIndex:t,extraParams:r||{},getDisplayerDivFunction:i._getAppPartDivFunction(s),getHashPartsFunction:i._getHashPartsFunction(s)},i)})},_getAppPartDivFunction:function(e){return function(t,n,r){this._createZoomContent(e,t,n,r)}.bind(this)},_createZoomContent:function(e,t,n,r){var i="container"in n?"zoomLayout":"legacy",s=this.resources.W.Data.getDataByQuery(e.get("dataItemRef")),o=this._applicationInstance.getPartDefinition(s.get("appPartName")),u=this._getItemAppPartData(t,e,s,o),a;a=new Element("div"),i=="zoomLayout"&&n.container.adopt(a);var f=this;this.resources.W.Components.createComponent("wixapps.integration.components.AppPart","wysiwyg.viewer.skins.area.CleanZoomAreaSkin",u,null,null,function(e){f.fireEvent("zoomContentChanged",e),i=="legacy"?f._setComponentSize(o,e,n.x,r):e.addEvent("proxyDisplayed",function(t){if(t.className.contains("wixapps.integration.proxies.layout.ZoomLayoutProxy")){var i=function(){e.getViewNode().getParents("body").length&&(e.setWidth(e.getSkinPart("inlineContent").children[0].getSize().x),window.requestAnimFrame(function(){r(e.getViewNode())})),t.removeEvent(Constants.WixAppEvents.APP_ZOOM_READY,i)};t.addEvent(Constants.WixAppEvents.APP_ZOOM_READY,i),t.renderZoomLayout(n.x,n.y)}else f._setComponentSize(o,e,n.x,r)})},null,a)},_getItemAppPartData:function(e,t,n,r){var i=this.resources.W.Data.createDataItem({type:n.getType()},n.getType());i.copySchemaFieldsFrom(n,!0);var s=i.get("appLogicParams"),o=r.zoomParams.itemIdParamName?r.zoomParams.itemIdParamName:"itemId";return s[o]={type:"AppPartParam",value:e.id},i},_setComponentSize:function(e,t,n,r){var i=e.defaultWidth?Math.min(e.defaultWidth,n):n;t.setWidth(i),e.defaultHeight&&t.setHeight(e.defaultHeight),window.requestAnimFrame(function(){t.getMainProxy().updateLayoutWhenReady(function(){t.getEventDispatcher().fireEvent(Constants.WixAppEvents.APP_VIEW_READY),r(t.getViewNode())}.bind(this))}.bind(this))},_getHashPartsFunction:function(e){var t=this.resources.W.Data.getDataByQuery(e.get("dataItemRef")),n=this._applicationInstance.getPartDefinition(t.get("appPartName")).zoomParams;return function(t,r){var i=e.get("mutableSeoTitle"),s=i||n.urlTitle||"";r({id:e.get("id"),title:s,extData:this._getHashExtraDataString(t.id,t.title)})}.bind(this)},_getHashExtraDataString:function(e,t){return e+"/"+encodeURIComponent(t.toLowerCase().replace(/\s+/ig,"-"))},_getItemFromHash:function(){var e=this.resources.W.Utils.hash.getHashParts().extData,t=e.split("/");return{id:t[0],title:t[1]}}})}),define.Const("WixAppsDefaultTypeValues",{String:"Text.",Number:0,Boolean:!1,Array:[],Object:{},"wix:Date":{_type:"wix:Date",iso:"1970-01-01T00:00:00.000Z"},"wix:Image":{_type:"wix:Image",title:"Default image",src:"6c90a0673862c3ba34f0cd12a004aa6f.wix_mp",width:1280,height:850},"wix:Video":{_type:"wix:Video",videoId:"UAxMzrWZOpY",videoType:"YOUTUBE"},"wix:Link":{_type:"wix:Link",linkType:"",href:"",label:"",target:"_blank",icon:""},"wix:NumberInRange":{_type:"wix:NumberInRange",value:0,minValue:0,maxValue:100},"wix:RichText":{_type:"wix:RichText",text:"RichText.",links:[]},"wix:LinkBase":{_type:"wix:LinkBase"},"wix:TextLink":{_type:"wix:TextLink",text:"I am a text link",link:{_type:"wix:LinkBase"}},"wix:Location":{_type:"wix:Location",address:"",addressInfo:"",latitude:1970,longitude:1970}}),define.Const("WixAppsSystemTypes",[{_iid:"wix:Type",_type:"wix:Type",fields:[{name:"name",type:"String"},{name:"fields",type:"Array<wix:Field>"},{name:"validations",type:"Array<wix:Validation>",defaultValue:"[]"}]},{_iid:"wix:Field",_type:"wix:Type",fields:[{name:"name",type:"String"},{name:"type",type:"String"},{name:"defaultValue"},{name:"computed",type:"Boolean",defaultValue:!1},{name:"validations",type:"Array<wix:Validation>",defaultValue:[]}]},{_iid:"wix:Validation",_type:"wix:Type",fields:[{name:"func",type:"String"},{name:"params",type:"Array",defaultValue:[]}]},{_iid:"wix:Object",_type:"wix:Type",fields:[]},{_iid:"wix:Ref",_type:"wix:Type",fields:[{name:"itemId",type:"String"},{name:"collectionId",type:"String"}]},{_iid:"wix:Permission",_type:"wix:Type",fields:[{name:"collectionId",type:"String"},{name:"operation",type:"String"},{name:"role",type:"String"}]},{_iid:"wix:Customizations",_type:"wix:Type",fields:[{name:"rules",type:"Array<wix:Object>",defaultValue:[]}]},{_iid:"wix:Date",_type:"wix:Type",fields:[{name:"iso",type:"String",defaultValue:"1970-01-01T00:00:00.000Z",validations:[{func:"ne",params:["Invalid Date"]}]}]},{_iid:"wix:Image",_type:"wix:Type",fields:[{name:"title",type:"String",defaultValue:""},{name:"src",type:"String"},{name:"width",type:"Number"},{name:"height",type:"Number"}]},{_iid:"wix:Video",_type:"wix:Type",fields:[{_type:"wix:Field",name:"videoId",type:"String",defaultValue:"UAxMzrWZOpY"},{_type:"wix:Field",name:"videoType",type:"String",defaultValue:"YOUTUBE"}]},{_iid:"wix:Link",_type:"wix:Type",fields:[{name:"linkType",type:"String"},{name:"href",type:"String"},{name:"label",type:"String"},{name:"target",type:"String"},{name:"icon",type:"String"}]},{_iid:"wix:NumberInRange",_type:"wix:Type",fields:[{name:"value",type:"Number"},{name:"minValue",type:"Number"},{name:"maxValue",type:"Number"}]},{_iid:"wix:RichText",_type:"wix:Type",fields:[{name:"text",type:"String",defaultValue:""},{name:"links",type:"Array<wix:PageLink,wix:DocLink,wix:ExternalLink,wix:MailLink>",defaultValue:[]}]},{_iid:"wix:LinkBase",_type:"wix:Type",fields:[]},{_iid:"wix:PageLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"pageId",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:DocLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"docId",type:"String"},{name:"docName",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:ExternalLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"address",type:"String"},{name:"target",type:"String"},{name:"protocol",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:MailLink",_type:"wix:Type",baseTypes:["wix:LinkBase"],fields:[{name:"email",type:"String"},{name:"subject",type:"String"},{name:"linkId",type:"String"}]},{_iid:"wix:Location",_type:"wix:Type",fields:[{name:"address",type:"String"},{name:"latitude",type:"Number"},{name:"longitude",type:"Number"},{name:"addressInfo",type:"String"}]},{_iid:"wix:TextLink",_type:"wix:Type",fields:[{name:"text",type:"String"},{name:"link",type:"wix:LinkBase"}]}]),define.Class("wixapps.integration.managers.undoredomanager.AppBuilderChange",function(e){var t=e;t.inherits("wysiwyg.editor.managers.undoredomanager.BaseChange"),t.utilize(["wixapps.core.data.DataItemFactory","wixapps.core.views.ViewsCustomizer"]),t.resources(["W.Preview"]),t.methods({initialize:function(){this._dataFactory=new this.imports.DataItemFactory,W.Commands.registerCommand("WAppsEditor2Commands.Undo.DataChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.ViewDefinitionChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.CustomizationChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.CustomizationChangeMade",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.DataSelectorChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.TypeChange",!0),W.Commands.registerCommand("WAppsEditor2Commands.Undo.FieldRemoved",!0)},startListen:function(){W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.DataChange",this,this._onDataChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.ViewDefinitionChange",this,this._onViewDefinitionChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.CustomizationChange",this,this._onViewCustomizationChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.DataSelectorChange",this,this._onDataSelectorChange),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.TypeChange",this,this._onTypeChanged),W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.FieldRemoved",this,this._onFieldRemoved)},stopListen:function(){W.Commands.unregisterListener(this)},getPreliminaryActions:function(e){var t=this.injects().UndoRedoManager._constants.PreliminaryActions;switch(e.changeType){case"Data":return[t.SELECT_COMPONENT];case"View":return[t.SELECT_COMPONENT];case"Selector":return[t.SELECT_COMPONENT];case"Customization":return[t.SELECT_COMPONENT];default:return null}},_onDataChange:function(e){var t={type:this.className,changeType:"Data",dataProvider:e.dataProvider,dataSelector:e.dataSelector,index:e.index,id:e.id,newValue:e.newValue,oldValue:e.oldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onViewDefinitionChange:function(e){var t={type:this.className,changeType:"View",viewRepo:e.viewRepo,newValue:e.newValue,oldValue:e.oldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onViewCustomizationChange:function(e){var t={type:this.className,changeType:"Customization",viewDef:e.viewDef,viewRepo:e.viewRepo,newValue:e.newRule,oldValue:e.oldRule,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onDataSelectorChange:function(e){var t={type:this.className,selector:e.selector,changeType:"Selector",changeSubType:e.changeType,dataItemId:e.dataItemId,newValue:e.newValue,oldValue:e.oldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onTypeChanged:function(e){var t={type:this.className,changeType:"Type",dataProvider:e.dataProvider,newValue:e.newValue,oldValue:e.oldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},_onFieldRemoved:function(e){var t={type:this.className,changeType:"FieldRemoved",fieldName:e.fieldName,viewRepo:e.viewRepo,dataProvider:e.dataProvider,viewOldValue:e.viewOldValue,viewNewValue:e.viewNewValue,typeNewValue:e.typeNewValue,typeOldValue:e.typeOldValue,changedComponentIds:[e.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,t),t},undo:function(e){var t=e.changeType;switch(t){case"Customization":this._applyCustomizationValue(e.viewDef,e.viewRepo,e.oldValue);break;case"Data":this._applyDataChange(e.dataProvider,e.dataSelector,e.index,e.oldValue,e.newValue);break;case"View":this._applyViewChange(e.oldValue,e.newValue,e.viewRepo);break;case"Type":this._applyTypeChange(e.oldValue,e.dataProvider);break;case"Selector":this._applySelectorChange(e.selector,e.changeSubType,e.dataItemId,e.oldValue,e.newValue);break;case"FieldRemoved":this._applyTypeViewChange(e.viewOldValue,e.viewNewValue,e.viewRepo,e.typeOldValue,e.dataProvider)}},redo:function(e){var t=e.changeType;switch(t){case"Customization":this._applyCustomizationValue(e.viewDef,e.viewRepo,e.newValue);break;case"Data":this._applyDataChange(e.dataProvider,e.dataSelector,e.index,e.newValue,e.oldValue);break;case"View":this._applyViewChange(e.newValue,e.oldValue,e.viewRepo);break;case"Type":this._applyTypeChange(e.newValue,e.dataProvider);break;case"Selector":this._applySelectorChange(e.selector,e.changeSubType,e.dataItemId,e.newValue,e.oldValue);break;case"FieldRemoved":this._applyViewTypeChange(e.viewNewValue,e.viewOldValue,e.viewRepo,e.typeNewValue,e.dataProvider)}},_applyCustomizationValue:function(e,t,n){console.log("UNDO: applyCustomizationRule",JSON.stringify(n)),W.Commands.executeCommand("WAppsEditor2Commands.Undo.CustomizationChangeMade",{rule:n}),this.imports.ViewsCustomizer.applyRule(e,n),t.setViewDefinition(e)},_applyDataChange:function(e,t,n,r,i){var s;if(!i)s=this._dataFactory.createDataItem(r),e.createItem(s),t.addItem(s,n);else if(!r){s=this._dataFactory.createDataItem(i);var o=s.getChildValue("_iid");e.deleteItem(o),t.removeItem(o)}else s=this._dataFactory.createDataItem(r),e.updateItem(s)},_applyViewChange:function(e,t,n){e?n.setViewDefinition(e):n.removeViewDefinition(t)},_applyTypeChange:function(e,t){t.updateType(e)},_applySelectorChange:function(e,t,n,r,i){e.handleUndo(t,n,r,i)},_applyViewTypeChange:function(e,t,n,r,i){this._applyViewChange(e,t,n),this._applyTypeChange(r,i)},_applyTypeViewChange:function(e,t,n,r,i){this._applyTypeChange(r,i),this._applyViewChange(e,t,n)}})}),define.oldClass({name:"wixapps.integration.proxies.AppLinkProxy",imports:[],traits:[],Class:{Extends:"wixapps.integration.proxies.layout.BoxLayoutProxy",Binds:["_onClicked"],createComponent:function(){var e=this.parent();return e.setStyle("display","block"),e.addEvent("click",this._onClicked),e},_getContainerElementType:function(){return"a"},_dispose:function(){this._element&&this._element.removeEvent("click",this._onClicked)},_onClicked:function(){this.fireEvent("wix:app-link:navigate",{dataItem:this._data,appPageId:this._def.getChildValue("pageId")})}}}),define.Class("wixapps.integration.proxies.AreaProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),t.utilize(["wixapps.integration.utils.flex.BoxFlexPolyfill"]),t.binds(["_applyBoxLayout"]),t.fields({}),t.methods({createComponent:function(){this._orientation=this._def.getChildValue("orientation")||this._getDefaultOrientation();var e=this._createWixComponent("wixapps.integration.components.Area",undefined,{allowDragChildren:!1});return this._createChildComponents(e),e},_onComponentWixified:function(){this.parent(),this._componentLogic.addEvent(Constants.DisplayEvents.SKIN_CHANGE,this._applyBoxLayout),this._applyBoxLayout()},_applyBoxLayout:function(){var e=this._getLayoutRootElement();this.imports.BoxFlexPolyfill.applyBoxFlexPolyfill(e),this._applyBoxStyles(e),this._setupBox(e),this._element.setStyle("position","relative");if(this._componentLogic){var t=this._getInlineContent();this._isLayoutBasedHeight()?(this._componentLogic.getSkinPart("bg").setStyle("height","100%"),t.setStyle("position","absolute"),t.setStyle("height","100%")):(t.setStyle("position","static"),t.setStyle("width","100%"))}},_getLayoutRootElement:function(){return this._getInlineContent()},_getInlineContent:function(){return this._componentLogic&&this._componentLogic.getSkinPart("inlineContent")},_getDefaultOrientation:function(){return"vertical"},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.area.AppleArea",style:"c1"},ecomCouponBox:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_cbx1"},ecomCartHeader:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ch1"},ecomEmptyCartBG:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ecbg1"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},dispose:function(){this._componentLogic&&this._componentLogic.removeEvent(Constants.DisplayEvents.SKIN_CHANGE,this._applyBoxLayout),this.parent()}})}),define.Class("wixapps.integration.proxies.ButtonProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.utilize([]),t.binds(["_handleSizeChange"]),t.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),t.methods({createComponent:function(){var e=this._createWixComponent("wysiwyg.viewer.components.SiteButton",this._createRawData(),undefined);return this._innerElement.hasAttribute("height")||this._innerElement.setAttribute("height","30"),e},_createRawData:function(){var e=this._data.getValue();return{type:"SiteButton",label:this._getLabel(e),href:this._getChildValue("href","",e),target:this._getChildValue("target","_self",e),linkType:this._getChildValue("linkType","FREE_LINK",e),icon:this._getChildValue("icon","",e)}},_getLabel:function(e){var t=null;return t=this._def.getChildValue("label"),t=t||this._data.getTypeName()=="String"&&e,t=t||e.label,t=t||"Submit",t},_getChildValue:function(e,t,n){return this._def.getChildValue(e)||(n[e]?n[e]:t)},_onDataChanged:function(e){this._refresh(),this.parent(e)},_refresh:function(){if(!this._componentLogic)return;this._setNewData()},_setNewData:function(){var e=this._componentLogic.getDataItem();e.setData(this._createRawData()),e.setMeta("isPersistent",!1)},_getPropSchemaName:function(){return"ButtonProperties"},_setupPropertyHandlers:function(){this._mapToCompProperty("align"),this._mapToCompProperty("margin","margin",function(e){return parseInt(e,10)}),this._handleProperties(["label"],function(){this._refresh()})},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"b3"},ecomViewCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_vc1"},ecomCheckout:{skin:"wysiwyg.viewer.skins.button.DisabledLayerButton",style:"ecom_co1"},ecomAddToCart:{skin:"wysiwyg.viewer.skins.button.BasicButton",style:"ecom_atc1"},ecomRemoveFromCart:{skin:"wysiwyg.viewer.skins.button.FixedFontButton",style:"ecom_rfc1"},ecomApplyCoupon:{skin:"wysiwyg.viewer.skins.button.ApplyButtonEcom",style:"ecom_apl1"},ecomAddProduct:{skin:"wysiwyg.viewer.skins.button.AddProductButton",style:"ecom_ap1"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},_setNaturalSize:function(){if(this._isCompBasedWidth()){var e=this._getNaturalWidth();this._element.setStyle("width",e),this._innerElement.setStyle("width",e)}if(this._isCompBasedHeight()){var t=this._getNaturalHeight();this._element.setStyle("height",t),this._innerElement.setStyle("height",t)}},_getNaturalWidth:function(){return this._componentLogic.getSizeLimits().minW},_getNaturalHeight:function(){return this._componentLogic.getSizeLimits().minH}})}),define.oldClass({name:"wixapps.integration.proxies.CheckBoxProxy",traits:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onComponentDataChanged","_onValidation"],initialize:function(e,t,n,r){this.parent(e,t,n,r),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){var e=this._createWixComponent("wysiwyg.viewer.components.inputs.CheckBoxInput",this._createRawData(),{label:this._def.getChildValue("label")});return e},_createRawData:function(){return{type:"Boolean",value:this._data.getValue()}},_onDataChanged:function(e){this._refresh(),this.parent(e)},_refresh:function(){if(!this._componentLogic)return;this._setNewData()},_setNewData:function(){var e=this._componentLogic.getDataItem();e.setData(this._createRawData()),e.setMeta("isPersistent",!1)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.CheckBoxInputSkin"},_onComponentDataChanged:function(e,t,n){this._data.setValue(!!e.get("value"))},_onValidation:function(e){if(!this._componentLogic||!e)return;if(e.valid)this._componentLogic.setValidationState(!0);else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(t)}this._componentLogic.setValidationState(e.valid)},_getAcceptableDataTypes:function(){return["Boolean"]},_getDefaultStyleName:function(){return null}}}),define.oldClass({name:"wixapps.integration.proxies.CheckBoxViewProxy",traits:[],Class:{Extends:"wixapps.integration.proxies.CheckBoxProxy",Binds:["_onComponentDataChanged","_onValidation"],_onComponentWixified:function(){this._componentLogic.setDisabled()}}}),define.oldClass({name:"wixapps.integration.proxies.CheckBoxGroupProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onComponentDataChanged","_onValidation"],initialize:function(e,t,n,r){this.parent(e,t,n,r),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){var e=Number.random(0,99999).toString(36),t="x_group_"+e;return this._createWixComponent("wixapps.integration.components.inputs.CheckBoxGroupInput",this._createRawData(),{checkboxGroupName:t})},_createRawData:function(){var e=this._data.getChildByRef("items").getValue(),t=e.map(this._getOptionWDataItem),n=this._data.getChildByRef("selectedValues").getValue(),r=[];return n.each(function(e){var n=t.filter(function(t){return t.get("value")==e});n.length>0&&r.push(n[0])}),{type:"MultiSelectableList",items:t,selected:r}},_getOptionWDataItem:function(e){var t={type:"SelectOption",value:e.value,text:e.text,enabled:e.enabled,description:e.description},n=W.Data.createDataItem(t);return n.setMeta("isPersistent",!1),n},_onComponentDataChanged:function(e,t,n){if(t=="selected"&&e){var r=e.get("selected"),i=[];for(var s=0;s<r.length;s++){var o=r[s].get("value");i.push(o)}this._data.getChildByRef("selectedValues").setValue(i)}},_onDataChanged:function(e){var t=e.target.getParent().getChildRef(e.target);if(t==="selectedValues")return;this._refreshComponentData()},_refreshComponentData:function(){if(!this._componentLogic)return;var e=this._createRawData(),t=this._componentLogic.getDataItem();t.setData(e),t.setMeta("isPersistent",!1)},_onValidation:function(e){if(!this._componentLogic||!e)return;if(e.valid===!1){var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(t)}this._componentLogic.setValidationState(e.valid)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.CheckBoxGroupInputSkin"},_getDefaultStyleName:function(){return"wa_cbg1"}}}),define.oldClass({name:"wixapps.integration.proxies.ClippedParagraphProxy",imports:[],traits:["wixapps.integration.components.traits.ResizableProxyTrait"],Class:{Extends:"wixapps.integration.proxies.LabelProxy",_getCompName:function(){return"wixapps.integration.components.ClippedParagraph"},_getPropSchemaName:function(){return"ClippedParagraphProperties"},_isLayoutBasedHeight:function(){return this._def.getChildValue("maxLines")?!1:this.parent()},_setupPropertyHandlers:function(){this.parent(),this._handleProperties(["maxLines","minLines","pack"],function(){this._componentLogic.getDataItem().set("text",this._createFormattedText())}),this._mapToCompProperties(["maxLines","minLines","pack","showTooltip"])}}}),define.oldClass({name:"wixapps.integration.proxies.ComboBoxProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onValidation","_onComponentDataChanged"],initialize:function(e,t,n,r){this.parent(e,t,n,r),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.inputs.ComboBoxInput",this._createRawData())},_createRawData:function(){var e=this,t=this.getData().getChildValue("items"),n=this.getData().getChildValue("selectedValue"),r=null,i=t.map(function(t){var i=e._createOptionDataItem(t);return t.value==n&&(r=i),i});return{type:"SelectableList",items:i,selected:r}},_createOptionDataItem:function(e){var t={type:"SelectOption",value:e.value,text:e.text,enabled:e.enabled,description:e.description},n=W.Data.createDataItem(t);return n.setMeta("isPersistent",!1),n},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["hasPrompt","promptText"])},_getOptionWDataItem:function(e){var t={type:"SelectOption",value:e.value,text:e.text,enabled:e.enabled,description:e.description},n=W.Data.createDataItem(t);return n.setMeta("isPersistent",!1),n},_getPropSchemaName:function(){return"ComboBoxInputProperties"},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.input.ComboBoxInputSkinNoValidation",style:"wa_cb1"},ecomComboBox:{skin:"wixapps.integration.skins.ecommerce.inputs.ComboBoxInputSkin",style:""},ecomShippingComboBox:{skin:"wysiwyg.viewer.skins.appinputs.EcomComboBoxInputSkin",style:"ecom_scb1"},wixAppsGui:{skin:"wixapps.integration.skins.inputs.ComboBoxInputSkin",style:""}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},_onDataChanged:function(e){if(this._componentLogic&&!this._ignoreUpdate){var t=this._findSelectedWDataItem();t?(this._componentLogic.getDataItem().set("selected",t),this._updateEnabledItemsState()):this._refreshComponentData()}},_onComponentDataChanged:function(e,t,n){t=="selected"&&n.selected&&(this._ignoreUpdate=!0,this.getData().getChildByRef("selectedValue").setValue(n.selected.get("value")),this._ignoreUpdate=!1)},_updateEnabledItemsState:function(){var e=this._componentLogic.getDataItem().get("items"),t=this.getData().getChildValue("items");for(var n=0;n<e.length;n++){var r=t[n].enabled!==undefined?t[n].enabled:!0;e[n].set("enabled",r)}},_findSelectedWDataItem:function(){var e=this.getData().getChildValue("selectedValue");if(e===undefined||!this._componentLogic)return undefined;var t=this._componentLogic.getDataItem().get("items");for(var n=0;n<t.length;n++){var r=t[n].get("value");if(r===e)return t[n]}return undefined},_refreshComponentData:function(){if(!this._componentLogic)return;var e=this._createRawData(),t=this._componentLogic.getDataItem();t.setData(e),t.setMeta("isPersistent",!1)},_onValidation:function(e){if(!this._componentLogic||!e)return;if(e.valid===!1){var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(t)}this._componentLogic.setValidationState(e.valid)}}}),define.oldClass({name:"wixapps.integration.proxies.ContainerProxy",imports:[],traits:["wixapps.integration.components.traits.ResizableProxyTrait"],Class:{Extends:"wixapps.integration.proxies.WCompositeProxy",Binds:["_handleSizeChange","_handleSizeChange"],_inlineDiv:null,createComponent:function(){var e=this._createWixComponent("mobile.core.components.Container",undefined,{allowDragChildren:!1});return this._createChildProxies(),this._createChildComponents(this._innerElement),e},_onComponentWixified:function(){this._doStuff()},_onSkinChange:function(e){this._doStuff()},_doStuff:function(){this._autoStretchContent(),this.updateLayoutWhenReady(function(){this._handleSizeChange(),this._resizeMechanismActivated||this._activateResizeMechanism(),setTimeout(function(){this._updateComponentDimension("x")}.bind(this),2e3)}.bind(this))},_onLayoutChange:function(){this._autoStretchContent();var e={};this._isLayoutBasedWidth()&&this._updateComponentDimension("x",e),this._isLayoutBasedHeight()&&this._updateComponentDimension("y",e),window.requestAnimFrame(this._handleSizeChange),W.Utils.forceBrowserRepaint(this._innerElement,150,["safari","chrome"]),W.Utils.forceBrowserRepaint(this._componentLogic.getSkinPart("bg"),150,["safari","chrome"])},_autoStretchContent:function(){if(this._def.getChildValue("heightMode")=="stretch")return;if(!this._inlineDiv||!this._inlineDiv.getParent())this._inlineDiv=this._componentLogic.getSkinPart("inlineContent"),this._inlineDiv.setStyles({height:this._def.getChildValue("packHeight")=="false"||this._def.getChildValue("packHeight")===!1?"100%":"auto",position:"static"})},_getComponentHeight:function(){return this._componentLogic.getSkinPart("inlineContent").getSize().y},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.area.AppleArea",style:"c1"},ecomCouponBox:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_cbx1"},ecomCartHeader:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ch1"},ecomEmptyCartBG:{skin:"wysiwyg.viewer.skins.apps.DefaultBoxSkin",style:"ecom_ecbg1"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style}}}),function(){var e=function(){var t=/d{1,5}|m{1,5}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[\-+]\d{4})?)\b/g,r=/[^-+\dA-Z]/g,i=function(e,t){e=String(e),t=t||2;while(e.length<t)e="0"+e;return e};return function(s,o,u){var a=e;arguments.length==1&&Object.prototype.toString.call(s)=="[object String]"&&!/\d/.test(s)&&(o=s,s=undefined),s=s?new Date(s):new Date;if(isNaN(s))throw"invalid date";o=String(a.masks[o]||o||a.masks["default"]),o.slice(0,4)=="UTC:"&&(o=o.slice(4),u=!0);var f=u?"getUTC":"get",l=s[f+"Date"](),c=s[f+"Day"](),h=s[f+"Month"](),p=s[f+"FullYear"](),d=s[f+"Hours"](),v=s[f+"Minutes"](),m=s[f+"Seconds"](),g=s[f+"Milliseconds"](),y=u?0:s.getTimezoneOffset(),b={d:l,dd:i(l),ddd:a.i18n.dayNames[c],dddd:a.i18n.dayNames[c+7],ddddd:a.i18n.dayNames[c].toUpperCase(),m:h+1,mm:i(h+1),mmm:a.i18n.monthNames[h],mmmm:a.i18n.monthNames[h+12],mmmmm:a.i18n.monthNames[h].toUpperCase(),yy:String(p).slice(2),yyyy:p,h:d%12||12,hh:i(d%12||12),H:d,HH:i(d),M:v,MM:i(v),s:m,ss:i(m),l:i(g,3),L:i(g>99?Math.round(g/10):g),t:d<12?"a":"p",tt:d<12?"am":"pm",T:d<12?"A":"P",TT:d<12?"AM":"PM",Z:u?"UTC":(String(s).match(n)||[""]).pop().replace(r,""),o:(y>0?"-":"+")+i(Math.floor(Math.abs(y)/60)*100+Math.abs(y)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return o.replace(t,function(e){return e in b?b[e]:e.slice(1,e.length-1)})}}();e.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},define.oldClass({name:"wixapps.integration.proxies.DateProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.LabelProxy",_getInnerText:function(){var t="",n=this._def.getChildValue("prefix"),r=this._def.getChildValue("postfix");n&&(t+=n);var i=this._def.getChildValue("format")||"default",s=this._data.getValue(),o=s.iso||s,u=new Date(o);return u.getTime()>0&&(t+=e(u,i)),r&&(t+=r),t},_setupPropertyHandlers:function(){this._handleProperties(["format"],function(){this._componentLogic.getDataItem().set("text",this._createFormattedText())}),this.parent()},getProxyMetaTags:function(){return["text"]},_getAcceptableDataTypes:function(){return["wix:Date","String"]}}})}(),define.oldClass({name:"wixapps.integration.proxies.DateSelectorProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onComponentDataChanged","_onValidation"],createComponent:function(){this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation);var e="wixapps.integration.components.inputs.DateInput";this.useSkinsInsteadOfStyles();var t=this._getIsoDate();return this._createWixComponent(e,{type:"Text",text:t})},_getPropSchemaName:function(){return"DateInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["allowEmpty"])},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.appinputs.DateInputSkin"},_getIsoDate:function(){var e=this._data.getValue(),t=new Date(e.iso);return!this._allowEmpty()&&(isNaN(t.getTime())||t.getDate()==(new Date(0)).getDate())&&(e.iso=(new Date).toISOString(),this._data.setValue(e)),e.iso},_onDataChanged:function(e){!this._userInputChange&&this._element&&this._element.getLogic()&&this._element.getLogic().getDataItem().set("text",this._getIsoDate())},_onComponentDataChanged:function(e){var t=this._element.getLogic().getDataItem().get("text");this._userInputChange=!0,this._data.setValue({_type:"wix:Date",iso:t}),this._userInputChange=!1},_onValidation:function(e){if(!this._componentLogic)return;if(e.valid)this._componentLogic.resetInvalidState();else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.showValidationMessage(t)}},_allowEmpty:function(){return this._def.getChildValue("allowEmpty")!==!1&&this._def.getChildValue("allowEmpty")!=="false"},_getAcceptableDataTypes:function(){return["wix:Date"]}}}),define.oldClass({name:"wixapps.integration.proxies.DeckProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.ListProxy",Binds:["_onSelectionChange"],getRepeaterClass:function(){return"wysiwyg.viewer.components.VerticalRepeater"},createComponent:function(){var e=this.parent();return this._childrenLeftToBeReady=this._getInitialSelection()>=0?1:0,e},setComponentStyles:function(e){return e.setStyles({display:"flex","flex-direction":"column"}),e},_getInitialSelection:function(){var e=this.getViewDefinition().getChildValue("initialSelection");return e!==undefined&&e>=0?e:-1},_onComponentWixified:function(){var e=this.getViewDefinition().getChildValue("selectionChangeScope"),t=this.getViewDefinition().getChildValue("selectionChangeEvent");this.addEventFilteredByScope(e,t,this._onSelectionChange);var n=this._getInitialSelection();n>=0&&this._selectIndex(n)},_onSelectionChange:function(e){var t=e.data,n=this._data.getChildren(),r=0;for(var i=0,s=n.length;i<s;i++){var o=n[i];if(o==t){r=i;break}}this._selectIndex(r)},_selectIndex:function(e){e>=0&&(this._selectedIndex!==undefined&&this.getElement().children[this._selectedIndex].collapse(),this._selectedIndex=e,this.getElement().children[e].uncollapse()),this.updateLayoutWhenReady()},onChildCreate:function(e,t){return e.collapse(),e}}}),define.oldClass({name:"wixapps.integration.proxies.DraggableListItemProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.layout.BoxLayoutProxy",initialize:function(e,t,n,r){this.parent(e,t,n,r);var i=this._def.getChildValue("dragEnabled");this._dragEnabled=i!=="false"&&i!==!1,this._selected=this._def.getChildValue("selected"),this._iconType=this._def.getChildValue("iconType"),this._hideEditLink=this._def.getChildValue("hideEditLink"),this._proxyFactory=this._viewContext.getEnvironment().getProxyFactory()},createComponent:function(){this._orientation=this._def.getChildValue("orientation")||this._getDefaultOrientation();var e=this._createRawData(),t=this._createWixComponent("wixapps.integration.components.editor.DraggableListItem",e,{dragEnabled:this._dragEnabled,selected:this._selected,iconType:this._iconType,hideEditLink:this._hideEditLink,isHeader:!1});return this._nativeEvents.forEach(function(e){t.addEvent(e.type,e.fn)}),this._createChildComponents(t),t},_onComponentWixified:function(){this.parent(),this._setupBox(this._getLayoutRootElement())},_onDataChanged:function(e){if(this._componentLogic&&!this._componentLogic.getIsDisposed()){var t=this._data.getChildValue("selected"),n=this._data.getChildValue("iconType");this._componentLogic.setSelected(t),this._componentLogic.setIcon(n)}},_getLayoutRootElement:function(){return this._componentLogic&&this._componentLogic.getLayoutElement()},_getDefaultOrientation:function(){return"vertical"},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.DraggableListItemSkin"},_createRawData:function(){return{type:""}}}}),define.oldClass({name:"wixapps.integration.proxies.EmptyProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",createComponent:function(){return this._createElement("div")}}}),define.oldClass({name:"wixapps.integration.proxies.ExpanderProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",createComponent:function(){var e=this._viewContext.getEnvironment().getProxyFactory(),t=this._def.getChildByRef("items"),n=this.getViewDefinition().getChildValue("initialState"),r=this.getViewDefinition().getChildValue("noIcon");if(t.getChildren().length!=2)throw"Expander must have two children, for summary and content.";var i=t.getChildByIndex(0),s=e.createProxyFromItemDefinition(this._viewContext,i).proxy,o=t.getChildByIndex(1),u=e.createProxyFromItemDefinition(this._viewContext,o).proxy;this._childrenLeftToBeReady=2;var a=function(e){e.grab(s.createComponent()),s.setupProxy(this._onChildReady)}.bind(this),f=function(e){e.grab(u.createComponent()),u.setupProxy(this._onChildReady)}.bind(this);return this._createWixComponent("wixapps.integration.components.Expander",undefined,{createSummaryFunc:a,createContentFunc:f,initialState:n,noIcon:r})},_getDefaultSkinName:function(){return"wixapps.integration.skins.ExpanderSkin"}}}),define.oldClass({name:"wixapps.integration.proxies.FlowListProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.ListProxy",getRepeaterClass:function(){return"wixapps.integration.components.HorizontalRepeater"},setComponentStyles:function(e){return e},onChildCreate:function(e,t){var n={};n.display="inline-block";var r=this.getViewDefinition().getChildValue("margin");return t<this._data.getChildren().length-1&&(n["margin-right"]=r+"px"),e.setStyles(n),e}}}),define.oldClass({name:"wixapps.integration.proxies.FormattedPriceProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.LabelProxy",_currencySymbols:{GBP:"£",USD:"$",NIS:"₪"},_getInnerText:function(){var e=this._data.getValue();return this._currencySymbols[e.currency]+e.amount.toFixed(2)}}}),define.oldClass({name:"wixapps.integration.proxies.GalleryProxy",imports:["wysiwyg.viewer.utils.GalleryUtils"],traits:["wixapps.integration.components.traits.ResizableProxyTrait"],Class:{Extends:"wixapps.integration.proxies.ListProxy",Binds:["_sequencingHook","_sequencingRolloverHook"],initialize:function(e,t,n,r){this.parent(e,t,n,r),this._galleryUtils=new this.imports.GalleryUtils,this._rolloverTemplate&&(this._repeaterArgs.rolloverHook=this._sequencingRolloverHook),this._repeaterArgs.fixedRowNumber=!0},getRepeaterClass:function(){return"wixapps.integration.components.PaginatedGridGallery"},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("*",function(){this.resetResizingCache()}),this._mapToCompProperties(["transition","autoplayInterval","transDuration"]),this._mapToCompProperty("columns","numCols"),this._mapToCompProperty("rows","maxRows"),this._mapToCompProperty("gap","margin"),this._mapToCompProperty("autoplay","autoplay",function(e){return e===!0||e=="true"}),this._mapToCompProperty("expandEnabled","expandEnabled",function(e){return e===!0||e=="true"})},_getPropSchemaName:function(){return"PaginatedGridGalleryProperties"},_sequencingHook:function(e,t,n){var r=this._createGalleryDisplayer(e,t,n,this._itemTemplate),i=new Element("div",{"class":"displayerBackground"});return i.inject(r,"top"),r},_sequencingRolloverHook:function(e,t,n){return this._createGalleryDisplayer(e,t,n,this._rolloverTemplate)},_createGalleryDisplayer:function(e,t,n,r){var i=this._viewContext.getEnvironment().getProxyFactory(),s=this._viewContext.newContextForData(e);this._addPositionInParentVars(s,t,n.length);var o=i.createProxyFromItemDefinition(s,r).proxy,u=o.createComponent();u.setStyles({overflow:"hidden",width:"1px",height:"1px"});if(Browser.firefox){var a=new Element("div");a.getViewProxy=function(){return o},a.$viewProxy=o,a.adopt(u),u.setStyles({width:"100%",height:"100%"}),u=a}return this._galleryUtils.createMinimalGalleryDisplayer(u,e),u},_updateSequencerListeners:function(){this.parent(),this._rolloverSequencer||(this._rolloverSequencer=this._componentLogic.getRolloverSequencer()),this._rolloverSequencer&&(this._rolloverSequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,function(){this.updateLayoutWhenReady()}.bind(this)),this._rolloverSequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,function(e){if(e.method=="create"){var t=e.compView.getViewProxy();t.setupProxy()}}.bind(this)))},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridDefaultSkin",style:"pagg1"},productGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridSimple",style:"pgg_cg0"},contentGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg1"},minipostGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg2"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def),this._rolloverTemplate=this._getItemTemplate("rollover")},_onStylePropertiesChange:function(e){Object.values(e).contains(Constants.SkinParamTypes.SIZE)&&this.updateLayoutWhenReady()},_onComponentWixified:function(){this.parent(),this._activateResizeMechanism(),this._onLayoutChange()}}}),define.oldClass({name:"wixapps.integration.proxies.GoogleMapProxy",traits:["wixapps.integration.components.traits.ResizableProxyTrait"],imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:[],createComponent:function(){var e="wysiwyg.viewer.components.GoogleMap",t=this._data.getValue(),n={type:"GeoMap",address:t.address,latitude:t.latitude,longitude:t.longitude,addressInfo:t.addressInfo};return this._createWixComponent(e,n)},_getPropSchemaName:function(){return"GoogleMapProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["showZoom","showPosition","showStreetView","showMapType","mapDragging","mapType"])},_getDefaultStyleName:function(){return"gm1"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.GoogleMapSkin"},_onDataChanged:function(e){if(this._componentLogic){var t=this._data.getValue(),n=this._componentLogic.getDataItem();n.set("address",t.address,!0),n.set("latitude",t.latitude,!0),n.set("longitude",t.longitude,!0),n.set("addressInfo",t.addressInfo,!0),n.fireDataChangeEvent()}},_getAcceptableDataTypes:function(){return["wix:Location"]}}}),define.oldClass({name:"wixapps.integration.proxies.GooglePlusOneProxy",Class:{Extends:"wixapps.integration.proxies.WProxy",createComponent:function(){var e=this._createWixComponent("wysiwyg.viewer.components.WGooglePlusOne",this._createRawData());return e},_createRawData:function(){var e=this._data.getValue();return{size:{type:"string","enum":["small","medium","standard","tall"],"default":"standard",description:"The button size to render"},annotation:{type:"string","enum":["none","bubble","inline"],"default":"inline",description:"The annotation to display next to the button."},width:{type:"string","default":"",description:"If annotation is set to *inline*, the width in pixels to use for the button and its inline annotation. If omitted, a button and its inline annotation use 450px."}}}}}),define.oldClass({name:"wixapps.integration.proxies.HorizontalLineProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.FiveGridLine",undefined,undefined,undefined)},_onComponentWixified:function(){this.parent();if(this._componentLogic&&this._componentLogic.getViewNode){var e=this._componentLogic.getViewNode();e&&e.setStyle("position","relative")}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.FiveGridLineSkin"},_getDefaultStyleName:function(){return"hl1"}}}),define.oldClass({name:"wixapps.integration.proxies.IconProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",createComponent:function(){var e=this._createRawData();return this._createWixComponent("wixapps.integration.components.Icon",e,undefined)},_getDefaultSkinName:function(){return"wixapps.integration.skins.IconSkin"},_createRawData:function(){var e=this._data.getValue();return{type:"Icon",url:this._toAppImageUrl(e.src),width:e.width,height:e.height,title:e.title}},_onDataChanged:function(){this._updateIcon()},_updateIcon:function(){if(this._componentLogic){var e=this._getAppsIconRawData();this._componentLogic.getDataItem().set("url",this._toAppImageUrl(e.src),!1),this._componentLogic.getDataItem().set("width",e.width,!1),this._componentLogic.getDataItem().set("height",e.height,!1),this._componentLogic.getDataItem().set("title",e.title,!1),this._componentLogic.getDataItem().fireDataChangeEvent()}},_toAppImageUrl:function(e){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(e)},_getAcceptableDataTypes:function(){return["wix:Image"]}}}),define.Class("wixapps.integration.proxies.ImageInputProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged","_onFieldReady"]),t.methods({createComponent:function(){var e=this._createRawData(),t=this._createWixComponent("wysiwyg.editor.components.inputs.ImageInput",null,{labelText:"",width:"100%",height:"100%",buttonText:this._def.getChildValue("selectImageLabel"),galleryConfigID:this._def.getChildValue("galleryConfigID"),deleteText:this._def.getChildValue("removeImageLabel")});return t.addEvent(Constants.ComponentEvents.READY,this._onFieldReady),t},_createRawData:function(){if(this._isEmptyData())return null;var e=this._data.getValue();return{type:"Image",uri:this._toAppImageUrl(e.src),title:e.title,width:e.width,height:e.height}},_toAppImageUrl:function(e){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(e)},_isEmptyData:function(){var e=this._getEmptyImage();return e===undefined?!1:e.src===this._data.getChildValue("src")},_getEmptyImage:function(){return this._def.getChildValue("emptyImage")},_onFieldReady:function(){this._componentLogic&&(this._componentLogic.setValue(this._createRawData()),this._componentLogic.addEvent("inputChanged",this._onComponentDataChanged))},_onDataChanged:function(){!this._ignoreUpdate&&this._componentLogic&&this._componentLogic.setValue(this._createRawData())},_onComponentDataChanged:function(){if(this._componentLogic){this._ignoreUpdate=!0;var e=this._componentLogic.getValue();if(e){var t=this._data.getValue();t.width=parseInt(e.width,10),t.height=parseInt(e.height,10),t.src=e.uri,t.title=e.title,this._data.setValue(t)}else this._data.setValue(this._getEmptyImage());this._ignoreUpdate=!1}},_getDefaultSkinName:function(){return"wysiwyg.editor.skins.inputs.ImageInputSkin"},_getAcceptableDataTypes:function(){return["wix:Image"]},dispose:function(){this._componentLogic&&this._componentLogic.removeEvent("inputChanged",this._onComponentDataChanged),this._element.removeEvent(Constants.ComponentEvents.READY,this._onFieldReady),this.parent()}})}),define.oldClass({name:"wixapps.integration.proxies.ImageProxy",imports:[],traits:["wixapps.integration.components.traits.ResizableProxyTrait"],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_handleSizeChange"],createComponent:function(){var e=this._createRawData();return this._createWixComponent("wysiwyg.viewer.components.WPhoto",e)},_toAppImageUrl:function(e){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(e)},getImageMode:function(){return this._def.getChildValue("imageMode")||"fill"},_fixedAspectRatioModes:["fitWidth","fitHeight"],hasFixedAspectRatio:function(){var e=this.getImageMode();return this._fixedAspectRatioModes.contains(e)},getAspectRatio:function(){var e=this._data.getValue();return parseFloat(e.width)/parseFloat(e.height)},_createRawData:function(){var e=this._data.getValue();return{type:"Image",uri:this._toAppImageUrl(e.src),title:e.title,width:e.width,height:e.height}},_onDataChanged:function(){if(this._componentLogic){var e=this._data.getValue();this._componentLogic.getDataItem().set("uri",this._toAppImageUrl(e.src),!1),this._componentLogic.getDataItem().set("title",e.title,!1),this._componentLogic.getDataItem().set("width",e.width,!1),this._componentLogic.getDataItem().set("height",e.height)}},_getPropSchemaName:function(){return"WPhotoProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperty("imageMode","displayMode",function(e){var t=e||"fill";return e=="fitWidth"?t="fitWidthStrict":e=="fitHeight"&&(t="fitHeightStrict"),this._innerElement&&(this._innerElement.style.height=null,this._innerElement.style.width=null),this.resetResizingCache(),t}.bind(this))},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.photo.NoSkinPhoto"},_getDefaultStyleName:function(){return"wp1"},_isLayoutBasedWidth:function(){var e=this.getImageMode();return e=="fitToWidth"?!0:e=="fitToHeight"?!1:this.parent()},_isLayoutBasedHeight:function(){var e=this.getImageMode();return e=="fitToWidth"?!1:e=="fitToHeight"?!0:this.parent()},_checkMinHeight:function(){},getSourceSize:function(){return{width:this.getData().getChildValue("width"),height:this.getData().getChildValue("height")}}}}),define.oldClass({name:"wixapps.integration.proxies.ImageSelectorProxy",imports:[],traits:[],Class:{Extends:"wixapps.integration.proxies.ImageProxy",Binds:["_openReplaceMedia","_onImgSelect","_onImgReset"],createComponent:function(){var e=this.parent();return this._galleryTypeID=this._def.getChildValue("galleryConfigID")||"photos",e.addEvent("click",this._openReplaceMedia),e.setStyle("cursor","pointer"),e.grab(new Element("div")),e},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("defaultImage",function(e){this._refreshResetState()})},_onComponentWixified:function(){this._componentLogic&&(this._resetButton=this._componentLogic.getViewNode().getElement("div[skinpart=reset]"),this._resetButton&&this._resetButton.addEvent("click",this._onImgReset),this._refreshResetState())},_refreshResetState:function(){if(this._componentLogic){var e=this._getDefaultImage(),t=e&&e.src!=this._data.getChildValue("src");this._componentLogic.getViewNode().set("reset",t?"enabled":"disabled")}},_getDefaultImage:function(){return this._def.getChildValue("defaultImage")},_openReplaceMedia:function(){W.EditorDialogs.openMediaDialog(this._onImgSelect,!1,this._galleryTypeID,!1)},_onImgReset:function(){return this._data.setValue(this._getDefaultImage()),this._refreshResetState(),!1},_onImgSelect:function(e){var t=this._data.getValue();t.width=parseInt(e.width,10),t.height=parseInt(e.height,10),t.src=e.uri,t.title=e.title,this._data.setValue(t),this._refreshResetState()},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.ImageSelectorSkin"},_onDataChanged:function(){this.parent(),this._refreshResetState()},dispose:function(){this._resetButton&&(this._resetButton.removeEvent("click",this._onImgReset),this._resetButton=undefined),this.parent()}}}),define.Class("wixapps.integration.proxies.InlineTextInputProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onComponentDataChanged"]),t.methods({createComponent:function(){var e=this._createRawData();return this._createWixComponent("wixapps.integration.components.inputs.InlineTextInput",e)},_getPropSchemaName:function(){return undefined},_createRawData:function(){var e=this._data.getValue(),t=document.createElement("div");return t.innerHTML=e,e=t.innerText||t.text||t.textContent,{type:"Text",text:e}},_onComponentWixified:function(){},_onDataChanged:function(e){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._data.getValue())},_onComponentDataChanged:function(e,t,n){this._ignoreUpdate=!0,this._data.setValue(n.text),this._ignoreUpdate=!1},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.InlineTextInputSkin"}})}),define.oldClass({name:"wixapps.integration.proxies.InlineTextProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.LabelProxy",createComponent:function(){var e=this.parent();return this._addStylesOnElement(e),e},_createRawData:function(){var e=this._data.getValue();return{type:"RichText",text:String(e).trim()}},_setupPropertyHandlers:function(){this.parent(),this._handleProperties(["postfix","disableLinks","lineThrough","underline","singleLine","color","noWrap"],function(){this._element.set("class",""),this._element.set("style",""),this._addStylesOnElement(this._element)})},_getContainerElement:function(){return this._element},_getViewElement:function(){return"span"},_getCompName:function(){return"wixapps.integration.components.InlineText"},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"}}}),define.Class("wixapps.integration.proxies.LabelProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.binds(["_onAppPartResize"]),t.traits(["wixapps.integration.proxies.traits.AppsLinkTrait"]),t.fields({_styleString:""}),t.methods({createComponent:function(){this.useSkinsInsteadOfStyles();var e=this._createRawData();return this._createWixComponent(this._getCompName(),e)},_setupPropertyHandlers:function(){this._handleProperties(["postfix","prefix","disableLinks","lineThrough","underline","singleLine","color","bold","noWrap","style","italic"],function(){this._componentLogic.getDataItem().set("text",this._createFormattedText())})},_createRawData:function(){return{type:"RichText",text:this._createFormattedText()}},_createFormattedText:function(){var e=this._getInnerText(),t=new Element("span");return W.Editor||this._def.getChildValue("disableLinks")?e=e.replace(/<a\b[^>]*>(.*?)<\/a>/ig,"$1"):this._updateLinkDataItems(),this._addStylesOnElement(t),e=this._addStyleOverrides(e),t.set("html",e),t.outerHTML},_getInnerText:function(){var e="",t=this._def.getChildValue("prefix"),n=this._def.getChildValue("postfix");t&&(e+=t);var r;return this._data.getTypeName()=="wix:RichText"?r=this._data.getChildByRef("text").getValue():r=this._data.getValue(),r=r.toString().trim(),this._isSingleLine()&&(r=String(r),r=r.replace(/(<p>|<\/p>|<br\/?>)/ig,"")),e+=r,n&&(e+=n),e},_addStylesOnElement:function(e){e.addClass(Constants.WixApps.TEXT_STYLES[this._def.getChildValue("style")]||this._getDefaultStyleName());var t=this._def.getChildValue("lineThrough");t&&e.addClass("lineThrough");var n=this._def.getChildValue("underline");n&&e.addClass("underline"),this._isSingleLine()&&e.addClass("singleLine"),this._applyColorStyle(e),this._applyLineHeightStyle(e),this._styleString=e.get("class")+" "+e.getStyle("color")},_addStyleOverrides:function(e){var t=[],n=this._def.getChildValue("bold")===!0||this._def.getChildValue("bold")==="true",r=this._def.getChildValue("italic")===!0||this._def.getChildValue("italic")==="true";return n&&t.push("bold"),r&&t.push("italic"),t.length>0?"<span class='"+t.join(" ")+"'>"+e+"</span>":e},_applyColorStyle:function(e){var t=this._def.getChildValue("color");return t&&(this._isCustomColor(t)?e.setStyle("color",t):e.addClass(t)),t},_applyLineHeightStyle:function(e){var t=parseInt(this._def.getChildValue("line-height"),10);return isNaN(t)?e.setStyle("line-height",null):e.setStyle("line-height",t+"em"),t},_isSingleLine:function(){if(this._def==null)return!1;var e=this._def.getChildValue("singleLine");return e===!0||e=="true"},getStyleString:function(){return this._styleString},_onComponentWixified:function(){this._viewContext.getEnvironment().getEventsDispatcher().addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppPartResize),this._onAppPartResize(),window.setTimeout(this._setTooltip.bind(this),100),Browser.firefox&&this._isSingleLine()&&this._element.setStyle("min-width","100%");var e=this._def.getChildValue("noWrap");(e===!0||e==="true")&&this._element.setStyle("white-space","nowrap")},_onDataChanged:function(e){this._componentLogic&&!this._componentLogic.getIsDisposed()&&this._componentLogic.getDataItem().set("text",this._createFormattedText())},_onAppPartResize:function(){this._disposed||this._setTooltip()},_setTooltip:function(){var e=this._getContainerElement();if(!e)return;this._shouldShowTooltip(e)?e.setAttribute("title",this._getInnerText()):e.removeAttribute("title")},_getContainerElement:function(){return this._element&&this._element.children&&this._element.children.length&&this._element.children[0].children&&this._element.children[0].children.length?this._element.children[0].children[0]:null},_shouldShowTooltip:function(e){return(this._def.getChildValue("showTooltip")==="true"||this._def.getChildValue("showTooltip")===!0)&&e.scrollWidth>e.offsetWidth},_isCustomColor:function(e){return e.slice(0,1)=="#"},_getCompName:function(){return"wysiwyg.viewer.components.WRichText"},_getDefaultStyleName:function(){return"font_8"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.WRichTextSkin"},_getAcceptableDataTypes:function(){return["String","wix:RichText","Number"]},getProxyMetaTags:function(){return["text"]}})}),define.oldClass({name:"wixapps.integration.proxies.LinkProxy",imports:[],traits:["wixapps.integration.proxies.traits.AppsLinkTrait"],Class:{Extends:"wixapps.integration.proxies.layout.BoxLayoutProxy",Binds:[],createComponent:function(){var e=this.parent();return this._updateLink(),e},_getDefaultOrientation:function(){return"vertical"},_checkDataValidity:function(){if(!this._viewContext.getEnvironment().getTypesManager().isOf(this._data.getTypeName(),"wix:LinkBase"))throw"Link selector only accepts links of type wix:LinkBase or extending. Received ["+this._data.getTypeName()+"]"},_getContainerElementType:function(){return"a"},_onDataChanged:function(e){this._updateLink()},_updateLink:function(){this._updateAnchorLink(this._element,this._data.getValue())}}}),define.oldClass({name:"wixapps.integration.proxies.LinkSelectorProxy",imports:[],traits:["wixapps.integration.proxies.traits.AppsLinkTrait"],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onClick","_onLinkDialogClosing"],createComponent:function(){var e=this._createRawData();return this._createWixComponent("wixapps.integration.components.LinkSelector",e,{descriptionVisible:this._getDescriptorVisibility()})},_createRawData:function(){return{type:"Text",text:this._getLinkDescription()}},_getDefaultSkinName:function(){return"wixapps.integration.skins.LinkSelectorSkin"},_getDescriptorVisibility:function(){var e=this._def.getChildValue("showDescription");return e===!0||e=="true"},_onDataChanged:function(e){this._componentLogic&&(this._componentLogic.getDataItem().set("text",this._getLinkDescription()),this._componentLogic.setDescriptionVisibility(this._getDescriptorVisibility())),this.parent(e)},_onComponentWixified:function(){this._componentLogic.addEvent(Constants.CoreEvents.CLICK,this._onClick)},_onClick:function(e){var t;if(this._data.getTypeName()=="wix:LinkBase"){var n=this.generateLinkId(this._viewContext.getEnvironment().getProxyFactory().getNameSpace());t=this.injects().Preview.getPreviewManagers().Data.addDataItem(n,{type:"TextLink"}),t.setMeta("isPersistent",!1)}else t=this._createWLink(this._data.getValue(),this.injects().Preview.getPreviewManagers().Data);this.injects().Commands.executeCommand("WEditorCommands.OpenLinkDialogCommand",{position:Constants.DialogWindow.POSITIONS.CENTER,previewComponent:this._previewComponent,data:t,state:t.get("linkType")||Constants.LinkState.NO_LINK,closeCallback:function(e,n,r){this._onLinkDialogClosing(t,e,n,r)}.bind(this)})},_onLinkDialogClosing:function(e,t,n,r){if(r.result==W.EditorDialogs.DialogButtons.CANCEL)return;e.copySchemaFieldsFrom(n);var i=this._createAppsLink(e).getValue();if(t===Constants.LinkState.NO_LINK||!i._type)i={_type:"wix:LinkBase"};this._data.setValue(i)},_getLinkDescription:function(){var e="Click to add link",t=this._data.getValue();switch(t._type){case"wix:PageLink":e="page:"+this.injects().Preview.getPreviewManagers().Data.getDataByQuery("#"+t.pageId,function(){}).get("title");break;case"wix:ExternalLink":e=t.protocol+"://"+t.address;break;case"wix:DocLink":e=t.docName;break;case"wix:MailLink":e="mailto:"+t.email}return e},_getAcceptableDataTypes:function(){return["wix:LinkBase"]}}}),define.Class("wixapps.integration.proxies.ListProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WArrayProxy"),t.binds(["_sequencingHook"]),t.utilize(["wixapps.core.data.DataItemUtils"]),t.fields({_sequencerCompleted:!1,_sequencer:null,_repeaterArgs:{}}),t.methods({initialize:function(e,t,n,r){this.parent(e,t,n,r),this._undisposedChildren=[],this._repeaterArgs.sequencingHook=this._sequencingHook,this._dataItemUtils=new this.imports.DataItemUtils},getRepeaterClass:function(){},setComponentStyles:function(e){},onChildCreate:function(e,t){},createComponent:function(){var e=this._createRawData(),t=this._createWixComponent(this.getRepeaterClass(),e,this._repeaterArgs);return this._childrenLeftToBeReady=this._data.getChildren().length,this.setComponentStyles(t),t},_sequencingHook:function(e,t,n){var r=this._viewContext.getEnvironment().getProxyFactory(),i=this._itemTemplate;t===0&&this._firstTemplate?i=this._firstTemplate:t==n.length-1&&this._lastTemplate&&(i=this._lastTemplate);var s=this._viewContext.newContextForData(e);i=r.createNewEvaluationScope(i,s),this._addPositionInParentVars(s,t,n.length);var o=r.createProxyFromItemDefinition(s,i).proxy,u=o.createComponent();return this._undisposedChildren.push(o),this.onChildCreate(u,t),u},_updateSequencerListeners:function(){this._sequencer===null&&(this._sequencer=this._componentLogic.getSequencer()),this._sequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,function(){this.updateLayoutWhenReady()}.bind(this)),this._sequencer.addEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,function(e){if(e.method=="create"){var t=e.compView.getViewProxy();t.setupProxy()}}.bind(this))},_createRawData:function(){var e=this._data.getChildren();return{type:"ImageList",items:e}},_onDataChanged:function(e){if(e.phase==Constants.DataItemEventPhase.ON_TARGET){var t=this._dataItemUtils.createDataChangeEventList(e,this._data),n=t.some(function(e){return e.type=="add"||e.type=="delete"||e.item.isRef()});if(n){while(this._undisposedChildren.length>0){var r=this._undisposedChildren.pop();r.dispose()}this._dataItem.set("items",[]),this._dataItem.set("items",this._data.getChildren())}}},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def),this._firstTemplate=this._getItemTemplate("first"),this._lastTemplate=this._getItemTemplate("last")},_getItemTemplate:function(e){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(e)},_getDefaultStyleName:function(){return null},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"},_onComponentWixified:function(){this._updateSequencerListeners(),this._componentLogic.getSequencer().isPending()||this.updateLayoutWhenReady()}})}),define.Class("wixapps.integration.proxies.ListProxy2",function(e){var t=e;t.inherits("wixapps.integration.proxies.WArrayProxy"),t.binds([]),t.utilize(["wixapps.core.data.DataItemUtils"]),t.fields({_dataItemUtils:null,_rootElement:null,_childrenTemplateMap:[]}),t.methods({initialize:function(e,t,n,r){this.parent(e,t,n,r),this._dataItemUtils=new this.imports.DataItemUtils},_getLogicClassName:function(){return"mobile.core.components.base.BaseComponent"},_createRawData:function(){return undefined},_getLogicArgs:function(){return undefined},setComponentStyles:function(e){},onChildCreate:function(e,t){},createComponent:function(){var e=this._createWixComponent(this._getLogicClassName(),this._createRawData(),this._getLogicArgs());return this._childrenTemplateMap=[],this._createChildren(),this._createChildComponents(e),this.setComponentStyles(e),this._rootElement=e,e},_onDataChanged:function(e){if(e.phase==Constants.DataItemEventPhase.ON_TARGET){var t=this._dataItemUtils.createDataChangeEventList(e,this._data),n=t.some(function(e){return e.type=="add"||e.type=="delete"||e.item.isRef()});if(n){for(var r=0;r<t.length;r++){var i=t[r];if(!i.item||!i.item.isRef())i.type==="add"?this._addChildAndSetup(i.item,i.path[0],this._children.length+1):i.type==="delete"&&this._removeChild(i.path[0])}this._updateItemTemplates()}}},_updateItemTemplates:function(){var e=this._children.length;for(var t=0;t<e;t++){var n=this._resolveTemplateType(t,e);this._childrenTemplateMap[t]!==n.type&&this._refreshChildAtIndex(t);var r=this._children[t].getViewContext().getEnvironment();r.setVar("positionInParent",t===0?"first":t==e-1?"last":"middle")}},_insertElementAt:function(e,t){var n=this._rootElement.getChildren();if(t<0||t>n.length)throw"Invalid index. cannot insert the element at index "+t+".";t===0?this._rootElement.grab(e,"top"):t===n.length?this._rootElement.grab(e,"bottom"):n[t-1].grab(e,"after")},_refreshChildAtIndex:function(e){var t=this._children[e].getData();this._removeChild(e),this._addChildAndSetup(t,e,this._children.length)},_removeChild:function(e){var t=this._children.splice(e,1);t[0].dispose(),this._childrenTemplateMap.splice(e,1)},_addChildAndSetup:function(e,t,n){var r=this._addChild(e,t,n);this._insertElementAt(r,t);var i=r.getViewProxy();i&&i.setupProxy()},_addChild:function(e,t,n){var r=this._resolveTemplateType(t,n);this._childrenTemplateMap.splice(t,0,r.type);var i=this._viewContext.getEnvironment().getProxyFactory(),s=this._viewContext.newContextForData(e);this._addPositionInParentVars(s,t,n);var o=i.createNewEvaluationScope(r.def,s),u=i.createProxyFromItemDefinition(s,o).proxy,a=u.createComponent();return this._children.splice(t,0,u),this.onChildCreate(a,t),a},_resolveTemplateType:function(e,t){var n=this._itemTemplate,r="item";return e===0&&this._firstTemplate?(n=this._firstTemplate,r="first"):e==t-1&&this._lastTemplate&&(n=this._lastTemplate,r="last"),{def:n,type:r}},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._itemTemplate=this._getItemTemplate("item")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_item",comp:{}},this._def),this._firstTemplate=this._getItemTemplate("first"),this._lastTemplate=this._getItemTemplate("last")},_getItemTemplate:function(e){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(e)},_getDefaultStyleName:function(){return null},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"},_onComponentWixified:function(){}})}),define.oldClass({name:"wixapps.integration.proxies.LocationSelectorProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onComponentDataChanged"],createComponent:function(){var e="wixapps.integration.components.inputs.LocationSelector",t=this._data.getValue(),n={type:"GeoMap",address:t.address,latitude:t.latitude,longitude:t.longitude,addressInfo:t.addressInfo};return this.useSkinsInsteadOfStyles(),this._createWixComponent(e,n)},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.LocationSelectorSkin"},_onDataChanged:function(e){if(!this._userInputChange&&this._componentLogic){var t=this._data.getValue(),n=this._componentLogic.getDataItem();n.set("address",t.address,!0),n.set("latitude",t.latitude,!0),n.set("longitude",t.longitude,!0),n.set("addressInfo",t.addressInfo,!0),n.fireDataChangeEvent()}},_onComponentDataChanged:function(e){var t=this._componentLogic.getDataItem(),n={_type:"wix:Location",address:t.get("address"),latitude:t.get("latitude"),longitude:t.get("longitude"),addressInfo:t.get("addressInfo")};this._userInputChange=!0,this._data.setValue(n),this._userInputChange=!1},_getAcceptableDataTypes:function(){return["wix:Location"]}}}),define.oldClass({name:"wixapps.integration.proxies.MultiColumnListProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.ListProxy",getRepeaterClass:function(){return"wixapps.integration.components.MultiColumnList"}}}),define.oldClass({name:"wixapps.integration.proxies.NumberInputProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.TextInputProxy",createComponent:function(){this.parent();var e=this._createRawData();return this._createWixComponent("wysiwyg.viewer.components.inputs.NumberInput",e)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.NumberInputSkin"},_getDefaultStyleName:function(){return"numi1"},_getPropSchemaName:function(){return"NumberInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["minValue","maxValue"])}}}),define.oldClass({name:"wixapps.integration.proxies.NumericStepperProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onComponentDataChanged"],createComponent:function(){this.parent();var e=this._createRawData();return this._createWixComponent("wysiwyg.viewer.components.inputs.NumberInput",e)},_createRawData:function(){var e=this._data.getValue();return{type:"Text",text:e.value}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.NumberInputSkin"},_createCompProperties:function(){return this._getPropertiesFromData()},_getPropertiesFromData:function(){var e=this._data.getValue();return{type:"NumberInputProperties",minValue:e.minValue,maxValue:e.maxValue}},_onDataChanged:function(e){if(this._componentLogic&&!this._ignoreUpdate){this._componentLogic.getDataItem().set("text",this._data.getValue().value);var t=this._getPropertiesFromData();this._componentLogic.setComponentProperty("minValue",t.minValue),this._componentLogic.setComponentProperty("maxValue",t.maxValue)}},_onComponentDataChanged:function(e,t,n){this._ignoreUpdate=!0;var r=this._data.getValue();r.value=Number(n.text),this._data.setValue(r),this._ignoreUpdate=!1},_getDefaultStyleName:function(){return"numi1"}}}),define.oldClass({name:"wixapps.integration.proxies.OptionListInputProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.TextInputProxy",Binds:["_onComponentDataChanged"],createComponent:function(){var e=this._createRawData();return this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this._createWixComponent("wixapps.integration.components.inputs.TextInput",e)},_getPropSchemaName:function(){return"TextInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["label","placeholder"])},_createRawData:function(){var e=this._data.getValue();return{type:"Text",text:this._getOptionsAsText()}},_getOptionsAsText:function(){var e=this._data.getValue(),t="";for(var n=0;n<e.items.length;n++)t+=e.items[n].text+"\n";return t},_getOptionsFromText:function(e){var t=e.split("\n"),n=[];for(var r=0;r<t.length;r++)t[r].length>0&&n.push({_type:"Option",value:r,text:t[r]});return n},_onComponentWixified:function(){},_onDataChanged:function(e){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._getOptionsAsText())},_onComponentDataChanged:function(e,t,n){this._ignoreUpdate=!0,this._data.getChildByRef("items").setValue(this._getOptionsFromText(n.text)),this._ignoreUpdate=!1},_getDefaultStyleName:function(){return"ti1"},_getDefaultSkinName:function(){return"wixapps.integration.skins.TextAreaSkin"}}}),define.oldClass({name:"wixapps.integration.proxies.OptionsListProxy",imports:[],traits:["wixapps.integration.proxies.traits.WDataExchangeTrait"],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onComponentDataChanged","_onValidation"],Static:{listType:{text:{compType:"wysiwyg.viewer.components.inputs.TextOption",compSkin:"wixapps.integration.skins.ecommerce.options.TextOptionSkin"},color:{compType:"wysiwyg.viewer.components.inputs.ColorOption",compSkin:"wixapps.integration.skins.ecommerce.options.ColorOptionSkin"}}},initialize:function(e,t,n,r){this.parent(e,t,n,r),this._listType=this._data.getChildValue("optionType")||"text",this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){return this.useSkinsInsteadOfStyles(),this._createWixComponent("wysiwyg.common.components.inputs.OptionsListInput",this._createRawData(),this.listType[this._listType])},_createRawData:function(){var e=this._data.getChildByRef("items").getValue(),t=e.map(this._getOptionWDataItem);return{type:"SelectableList",items:t,selected:null}},_getOptionWDataItem:function(e){var t={type:"SelectOption",value:e.value,text:e.text,enabled:e.enabled,description:e.description},n=W.Data.addDataItemWithUniqueId("apps",t).dataObject;return n.setMeta("isPersistent",!1),n},_onDataChanged:function(e){if(this._componentLogic&&!this._ignoreUpdate){var t=null,n=this.getData().getChildValue("selectedValue"),r=this._componentLogic.getDataItem().get("items"),i=this.getData().getChildValue("items");for(var s=0;s<r.length;s++){var o=r[s].get("value");o==n&&(t=r[s]);var u=i[s].enabled;r[s].set("enabled",u)}this._componentLogic.getDataItem().set("selected",t),!t&&this._componentLogic._selectedItem&&this._refreshComponentData()}},_onComponentDataChanged:function(e,t,n){t=="selected"&&n.selected&&(this._ignoreUpdate=!0,this.getData().getChildByRef("selectedValue").setValue(n.selected.get("value")),this._ignoreUpdate=!1)},_setupPropertyHandlers:function(){this._handleProperties(["align","margin","label","href","target","linkType","icon"],function(){this._refreshComponentData()})},_onValidation:function(e){if(!this._componentLogic||!e)return;this._componentLogic.setValidationState(e.valid)},_refreshComponentData:function(){if(!this._componentLogic)return;var e=this._createRawData(),t=this._componentLogic.getDataItem(),n=this._convertWItemDataToRawData(t);this._rawDataEquals(this._convertWItemDataToRawData(e),n)||(t.setData(e),t.setMeta("isPersistent",!1))},_replaceAllTable:function(){var e=this._element,t=this.createComponent();e.parentNode.replaceChild(t,e),this.setupProxy()},_getDefaultSkinName:function(){return"wixapps.integration.skins.ecommerce.options.OptionsListInputSkin"}}}),define.oldClass({name:"wixapps.integration.proxies.ProxyMap",imports:["wixapps.integration.proxies.VerticalLineProxy","wixapps.integration.proxies.HorizontalLineProxy","wixapps.integration.proxies.SwitchProxy","wixapps.integration.proxies.LabelProxy","wixapps.integration.proxies.ClippedParagraphProxy","wixapps.integration.proxies.DateProxy","wixapps.integration.proxies.DateSelectorProxy","wixapps.integration.proxies.TimeSelectorProxy","wixapps.integration.proxies.InlineTextProxy","wixapps.integration.proxies.TextInputProxy","wixapps.integration.proxies.InlineTextInputProxy","wixapps.integration.proxies.NumberInputProxy","wixapps.integration.proxies.NumericStepperProxy","wixapps.integration.proxies.RichTextEditorProxy","wixapps.integration.proxies.RichTextEditorInlineProxy","wixapps.integration.proxies.FormattedPriceProxy","wixapps.integration.proxies.ImageProxy","wixapps.integration.proxies.ImageSelectorProxy","wixapps.integration.proxies.ImageInputProxy","wixapps.integration.proxies.VerticalListProxy","wixapps.integration.proxies.FlowListProxy","wixapps.integration.proxies.MultiColumnListProxy","wixapps.integration.proxies.ButtonProxy","wixapps.integration.proxies.LinkProxy","wixapps.integration.proxies.LinkSelectorProxy","wixapps.integration.proxies.layout.CssLayoutProxy","wixapps.integration.proxies.layout.BoxLayoutProxy","wixapps.integration.proxies.layout.StackLayoutProxy","wixapps.integration.proxies.layout.FieldProxy","wixapps.integration.proxies.layout.FieldBoxProxy","wixapps.integration.proxies.layout.TextFieldProxy","wixapps.integration.proxies.SpacerProxy","wixapps.integration.proxies.GalleryProxy","wixapps.integration.proxies.SuperFlowProxy","wixapps.integration.proxies.VerticalListEditorProxy","wixapps.integration.proxies.DraggableListItemProxy","wixapps.integration.proxies.TableProxy","wixapps.integration.proxies.OptionsListProxy","wixapps.integration.proxies.OptionListInputProxy","wixapps.integration.proxies.ComboBoxProxy","wixapps.integration.proxies.RadioGroupProxy","wixapps.integration.proxies.CheckBoxGroupProxy","wixapps.integration.proxies.TabMenuProxy","wixapps.integration.proxies.TextAreaProxy","wixapps.integration.proxies.AreaProxy","wixapps.integration.proxies.SliderGalleryProxy","wixapps.integration.proxies.VideoProxy","wixapps.integration.proxies.VideoThumbProxy","wixapps.integration.proxies.ExpanderProxy","wixapps.integration.proxies.IconProxy","wixapps.integration.proxies.VideoSelectorProxy","wixapps.integration.proxies.ExpanderProxy","wixapps.integration.proxies.ToggleProxy","wixapps.integration.proxies.DeckProxy","wixapps.integration.proxies.ContainerProxy","wixapps.integration.proxies.ZoomLinkProxy","wixapps.integration.proxies.AppLinkProxy","wixapps.integration.proxies.layout.ZoomLayoutProxy2","wixapps.integration.proxies.layout.FixedRatioLayoutProxy","wixapps.integration.proxies.CheckBoxProxy","wixapps.integration.proxies.CheckBoxViewProxy","wixapps.integration.proxies.GoogleMapProxy","wixapps.integration.proxies.LocationSelectorProxy","wixapps.integration.proxies.EmptyProxy","wixapps.integration.proxies.TextProxy","wixapps.integration.proxies.ListProxy2"],traits:[],Class:{registerComponentProxies:function(e){e.registerProxy("Label",this.imports.LabelProxy,"String",[{forType:"String",forMode:"view"},{forType:"Number",forMode:"view"},{forType:"wix:RichText",forMode:"view"}]),e.registerProxy("ClippedParagraph",this.imports.ClippedParagraphProxy,"String"),e.registerProxy("Date",this.imports.DateProxy,"wix:Date"),e.registerProxy("DateEdit",this.imports.DateSelectorProxy,"wix:Date"),e.registerProxy("TimeEdit",this.imports.TimeSelectorProxy,"wix:Date"),e.registerProxy("InlineText",this.imports.InlineTextProxy,"String"),e.registerProxy("InlineTextInput",this.imports.InlineTextInputProxy,"String"),e.registerProxy("TextInput",this.imports.TextInputProxy,"String",[{forType:"String",forMode:"edit"}]),e.registerProxy("NumberInput",this.imports.NumberInputProxy,"Number",[{forType:"Number",forMode:"edit"}]),e.registerProxy("NumericStepper",this.imports.NumericStepperProxy,"Number",[{forType:"NumberInRange",forMode:"edit"}]),e.registerProxy("CheckBox",this.imports.CheckBoxProxy,"Boolean",[{forType:"Boolean",forMode:"edit"}]),e.registerProxy("CheckBoxViewProxy",this.imports.CheckBoxViewProxy,"Boolean",[{forType:"Boolean",forMode:"view"}]),e.registerProxy("RichTextEditor",this.imports.RichTextEditorProxy),e.registerProxy("RichTextEditorInline",this.imports.RichTextEditorInlineProxy,"wix:RichText",[{forType:"wix:RichText",forMode:"edit"}]),e.registerProxy("Price",this.imports.FormattedPriceProxy,"Price",[{forType:"Price",forMode:"view"}]),e.registerProxy("Image",this.imports.ImageProxy,"wix:Image",[{forType:"wix:Image",forMode:"view"}]),e.registerProxy("Video",this.imports.VideoProxy,"wix:Video",[{forType:"Video",forMode:"view"},{forType:"wix:Video",forMode:"view"}]),e.registerProxy("VideoSelector",this.imports.VideoSelectorProxy,"wix:Video",[{forType:"Video",forMode:"edit"},{forType:"wix:Video",forMode:"edit"}]),e.registerProxy("VideoThumb",this.imports.VideoThumbProxy,""),e.registerProxy("ImageSelector",this.imports.ImageSelectorProxy,"wix:Image",[{forType:"wix:Image",forMode:"edit"}]),e.registerProxy("ImageInput",this.imports.ImageInputProxy,""),e.registerProxy("VerticalList",this.imports.VerticalListProxy,"Array",[{forType:"Array",forMode:"view"},{forType:"Array",forMode:"edit"}]),e.registerProxy("FlowList",this.imports.FlowListProxy,""),e.registerProxy("MultiColumn",this.imports.MultiColumnListProxy,""),e.registerProxy("VerticalListEditor",this.imports.VerticalListEditorProxy,""),e.registerProxy("DraggableListItem",this.imports.DraggableListItemProxy,""),e.registerProxy("Gallery",this.imports.GalleryProxy,""),e.registerProxy("Box",this.imports.BoxLayoutProxy,""),e.registerProxy("VBox",this.imports.BoxLayoutProxy,""),e.registerProxy("HBox",this.imports.BoxLayoutProxy,""),e.registerProxy("Field",this.imports.FieldProxy,""),e.registerProxy("FieldBox",this.imports.FieldBoxProxy,""),e.registerProxy("TextField",this.imports.TextFieldProxy,""),e.registerProxy("Stack",this.imports.StackLayoutProxy,""),e.registerProxy("Css",this.imports.CssLayoutProxy,""),e.registerProxy("VSpacer",this.imports.SpacerProxy,""),e.registerProxy("HSpacer",this.imports.SpacerProxy,""),e.registerProxy("InlineSpacer",this.imports.SpacerProxy,""),e.registerProxy("HorizontalLine",this.imports.HorizontalLineProxy,""),e.registerProxy("VerticalLine",this.imports.VerticalLineProxy,""),e.registerProxy("Switch",this.imports.SwitchProxy,""),e.registerProxy("SuperFlow",this.imports.SuperFlowProxy,""),e.registerProxy("Button",this.imports.ButtonProxy,""),e.registerProxy("Table",this.imports.TableProxy,""),e.registerProxy("Expander",this.imports.ExpanderProxy,""),e.registerProxy("Deck",this.imports.DeckProxy,""),e.registerProxy("TabMenu",this.imports.TabMenuProxy,""),e.registerProxy("Icon",this.imports.IconProxy,""),e.registerProxy("Toggle",this.imports.ToggleProxy,""),e.registerProxy("Link",this.imports.LinkProxy,"wix:LinkBase",[{forType:"wix:LinkBase",forMode:"view"}]),e.registerProxy("LinkSelector",this.imports.LinkSelectorProxy,"wix:LinkBase",[{forType:"wix:LinkBase",forMode:"edit"}]),e.registerProxy("OptionsList",this.imports.OptionsListProxy,"OptionsList",[{forType:"OptionsList",forMode:"view"}]),e.registerProxy("OptionsListInput",this.imports.OptionListInputProxy,"OptionsList",[{forType:"ComboOptionsList",forMode:"edit"},{forType:"OptionsList",forMode:"edit"}]),e.registerProxy("ComboBox",this.imports.ComboBoxProxy,"ComboOptionsList",[{forType:"ComboOptionsList",forMode:"view"}]),e.registerProxy("RadioGroup",this.imports.RadioGroupProxy,"ComboOptionsList",[{forType:"ComboOptionsList",forMode:"view"}]),e.registerProxy("CheckBoxGroup",this.imports.CheckBoxGroupProxy,"MultiOptionsList",[{forType:"MultiOptionsList",forMode:"view"}]),e.registerProxy("TextArea",this.imports.TextAreaProxy,"String"),e.registerProxy("Area",this.imports.AreaProxy),e.registerProxy("SliderGallery",this.imports.SliderGalleryProxy,"Array",[{forType:"Array<wix:Image>",forMode:"view"}]),e.registerProxy("Container",this.imports.ContainerProxy,""),e.registerProxy("ZoomLink",this.imports.ZoomLinkProxy,""),e.registerProxy("AppLink",this.imports.AppLinkProxy,""),e.registerProxy("ZoomLayout",this.imports.ZoomLayoutProxy2,""),e.registerProxy("FixedRatioLayout",this.imports.FixedRatioLayoutProxy,""),e.registerProxy("GoogleMap",this.imports.GoogleMapProxy,"wix:Location"),e.registerProxy("LocationSelector",this.imports.LocationSelectorProxy,"wix:Location"),e.registerProxy("Empty",this.imports.EmptyProxy,"",[]),e.registerProxy("List2",this.imports.ListProxy2,"Array",[{forType:"Array",forMode:"view"},{forType:"Array",forMode:"edit"}])}}}),define.oldClass({name:"wixapps.integration.proxies.RadioGroupProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.ComboBoxProxy",Binds:["_onComponentDataChanged"],createComponent:function(){var e=Number.random(0,99999).toString(36),t="radio_group_"+e;return this._createWixComponent("wysiwyg.viewer.components.inputs.RadioGroupInput",this._createRawData(),{radioGroupName:t,selectedValue:this._data.getChildValue("selectedValue")})},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.input.RadioGroupInputSkin"},_getDefaultStyleName:function(){return"wa_rg1"}}}),define.oldClass({name:"wixapps.integration.proxies.RichTextEditorInlineProxy",imports:[],traits:["wixapps.integration.proxies.traits.AppsLinkTrait"],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onComponentDataChanged","_linkIdGenerator"],createComponent:function(){var e=this._createRawData(),t=W.Data;return W.Editor&&(t=W.Preview.getPreviewManagers().Data),this._updateLinkDataItems(t),this._createWixComponent("wysiwyg.editor.components.richtext.WRichTextEditor",e,{fixedHeight:this._def.getChildValue("height"),toolbarDocked:!0,persistantLinks:!1,generateLinkIdFunc:this._linkIdGenerator})},_getDefaultSkinName:function(){return"wysiwyg.editor.skins.WRichTextEditorSkin"},_getDefaultStyleName:function(){return"wrte1"},_createRawData:function(){var e=this._data.getChildValue("text");return{type:"RichText",text:e}},_onComponentWixified:function(){this._componentLogic.setState("dialogPart");var e=function(e){if(e.data&&(e.data.className=="cke_styles"||e.data.className=="cke_button_textcolor")){var t=e.data._.panel,n=t.element.$;n.className.indexOf("z-dialog")==-1&&(n.className=n.className+" z-dialog")}}.bind(this);this._componentLogic.createEditor(this._dataItem,null,e)},_onComponentDataChanged:function(e){var t=this._componentLogic.getDataItem().get("text"),n=t.match(/dataQuery="[^"]*/ig)||[],r=[];for(var i=0;i<n.length;i++){var s=n[i].split('"')[1],o=W.Preview.getPreviewManagers().Data.getDataByQuery(s);r.push(this._createAppsLink(o))}this._data.getChildByRef("links").setValue(r),this._data.getChildByRef("text").setValue(t)},_linkIdGenerator:function(){return this.generateLinkId(this._viewContext.getEnvironment().getProxyFactory().getNameSpace())},_onDataChanged:function(e){this._componentLogic&&this._componentLogic.getDataItem().set("text",this._data.getChildValue("text"))}}}),define.dataItem.multi({WIXAPPS_EDITOR_STYLES:{type:"map",items:{h1:{tag:"h1",cssClass:"font_3"},h2:{tag:"h2",cssClass:"font_4"},h3:{tag:"h3",cssClass:"font_5"},h4:{tag:"h4",cssClass:"font_6"},h5:{tag:"h5",cssClass:"font_7"},h6:{tag:"h6",cssClass:"font_8"},address:{tag:"address",cssClass:"font_9"},div:{tag:"div",cssClass:"font_10"},p:{tag:"p",cssClass:"font_8",label:"default",seoTag:"hatul"}}}}),define.Class("wixapps.integration.proxies.RichTextEditorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.LabelProxy"),t.binds(["_linkIdGenerator","_onPreviewClicked","_onEditorDataChanged","_closeEditor"]),t.fields({_editorElement:undefined,_editorData:undefined,_editorLogic:undefined,_onEditorReady:[],_ignoreEditorDataChange:undefined}),t.methods({_onPreviewClicked:function(e){this.getRichTextEditor(function(e){this._componentLogic.getSkinPart("richTextContainer").setStyle("visibility","hidden");var t=this._createRawData();this._ignoreEditorDataChange=!0,this._editorData.set("text",t.text),this._ignoreEditorDataChange=!1,this._openEditor()}.bind(this))},_linkIdGenerator:function(){return this.generateLinkId("appbuilder")},_onComponentWixified:function(){var e=this._def.getChildValue("height");this._componentLogic.setHeight(e);var t=this._componentLogic.getSkinPart("frame");t.setStyle("height",e+"px"),t.addEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked)},_onEditorDataChanged:function(){if(this._ignoreEditorDataChange)return;var e=this._getCleanedHtml(),t=e.match(/dataQuery="[^"]*/ig)||[],n=[];for(var r=0;r<t.length;r++){var i=t[r].split('"')[1],s=W.Preview.getPreviewManagers().Data.getDataByQuery(i);n.push(this._createAppsLink(s))}var o={_type:"wix:RichText",links:n,text:e};console.log("setting value: ["+e+"]"),this._data.setValue(o)},getRichTextEditor:function(e){this._editorElement?this._editorLogic?e(this._editorLogic):this._registerToEditorReadyNotification(e):(this._registerToEditorReadyNotification(e),this._createEditor())},_createRawData:function(){var e='<span class="font_8 defaultStyle">'+this._data.getChildValue("text")+"</span>";return{type:"RichText",text:e}},_getInnerText:function(){var e=new Element("div");return e.set("html",this._data.getChildValue("text")),e.get("text")},_registerToEditorReadyNotification:function(e){this._onEditorReady.push(e)},_notifyEditorReady:function(){while(this._onEditorReady.length>0){var e=this._onEditorReady.shift();e(this._editorLogic)}},_createEditor:function(){var e=W.Data;W.Editor&&(e=W.Preview.getPreviewManagers().Data),this._updateLinkDataItems(e),this._editorData=W.Data.createDataItem(this._createRawData()),this._editorData.setMeta("isPersistent",!1),this._editorData.addEvent(Constants.DataEvents.DATA_CHANGED,this._onEditorDataChanged);var t=this._getContainerForEditor(),n=new Element("DIV");n.setStyles({position:"fixed",top:"0",left:"0",width:"100%",height:"100%","background-color":"transparent"}),this._blockingLayer=n,this._blockingLayer.addEvent(Constants.CoreEvents.CLICK,this._closeEditor),t.grab(this._blockingLayer);var r=new Element("DIV");r.set("comp","wysiwyg.editor.components.richtext.WRichTextEditor"),r.set("skin","wysiwyg.editor.skins.WRichTextEditorSkin"),r.set("pos",""),r.setStyles({position:"absolute",top:0,bottom:0,left:0,right:0,margin:3}),this._editorElement=r,this._editorElement.addEvent(Constants.ComponentEvents.WIXIFIED,function(){}.bind(this)),this._editorElement.addEvent(Constants.ComponentEvents.READY,function(){this._editorLogic=r.getLogic(),this._modifyCKEditorSettings_xoxo(this._editorLogic),this._notifyEditorReady()}.bind(this)),t.grab(r);var i={fixedHeight:this._def.getChildValue("height"),persistantLinks:!1,generateLinkIdFunc:this._linkIdGenerator};this._editorElement.wixify(i,this._editorData)},_modifyCKEditorSettings_xoxo:function(e){var t=e._getCkEditorSettings;e._getCkEditorSettings=function(){var n=t.call(e);return n.startupFocus=!0,n}},_openEditor:function(){if(this._editorLogic){var e=this._element.getPosition(this._editorElement.parentNode),t=this._element.getWidth()-8,n=this._def.getChildValue("height");this._editorLogic.setPositioning(e,t,n),this._blockingLayer.uncollapse(),this._editorLogic.getViewNode().uncollapse(),this._editorLogic.createEditor(this._editorData,function(){this._editorLogic.getSkinPart("toolbar").setStyles({left:e.x,top:e.y-40})}.bind(this))}},_closeEditor:function(){this._blockingLayer&&this._blockingLayer.collapse(),this._editorLogic&&(this._editorLogic.destroy(),this._componentLogic.getSkinPart("richTextContainer").setStyle("visibility","inherit"),this._editorLogic.getViewNode().collapse())},_getContainerForEditor:function(){var e=this._getDialogLayer();for(var t=0;t<e.children.length;t++)if(e.children[t].getElementById(this._element.get("id")))return e.children[t];return e},_getDialogLayer:function(){return document.getElementById("dialogLayer")},_getCleanedHtml:function(){var e=this._editorLogic.getSkinPart("editor"),t=new Element("div");t.set("html",e.get("html")),t.children.length===1&&e.children[0].tagName.toLowerCase()==="p"&&!e.children[0].className&&!e.children[0].dir&&(t=t.children[0]);var n=function(e){while(e.childNodes.length>0)e.parentNode.insertBefore(e.childNodes[0],e);e.parentNode.removeChild(e)},r=t.getElements(".defaultStyle");for(var i=0;i<r.length;i++)n(r[i]);var s=t.getElements("span");for(var o=0;o<s.length;o++)s[o].className||n(s[o]);var u=!0;for(var a=0;a<t.children.length;a++){var f=t.children[a];f.tagName.toLowerCase()==="p"&&f.get("text").replace(/[\s\u200B]/ig,"").length===0&&!f.className&&u?(f.parentNode.removeChild(f),a--):u=!1}return t.get("html")},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.RichTextEditorSkin"},_getAcceptableDataTypes:function(){return["wix:RichText"]},dispose:function(){this._blockingLayer&&(this._blockingLayer.removeEvent(Constants.CoreEvents.CLICK,this._closeEditor),this._blockingLayer.destroy()),this._componentLogic&&this._componentLogic.getSkinPart("richTextContainer").removeEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._editorLogic&&this._editorLogic.dispose()}})}),define.oldClass({name:"wixapps.integration.proxies.SliderGalleryProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",createComponent:function(){this.useSkinsInsteadOfStyles();var e=this._createWixComponent("wysiwyg.viewer.components.SelectableSliderGallery",this._createRawData(),null);return e.setStyle("position","relative"),e},_createRawData:function(){var e=this._data.getChildren(),t=[];return e.forEach(function(e){t.push(this._getWImage(e.getValue()))},this),{type:"ImageList",items:t}},_getWImage:function(e){var t={type:"Image",title:"",uri:e.src,description:"",height:e.height,width:e.width,borderSize:"",alt:""},n=W.Data.createDataItem(t);return n.setMeta("isPersistent",!1),n},_getPropSchemaName:function(){return"SliderGalleryProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["showAutoplay","loop","showCounter","expandEnabled"])},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.galleryselectableslider.SelectableSliderGalleryDefaultSkin"}}}),define.oldClass({name:"wixapps.integration.proxies.SpacerProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",_spacerType:"",_spacerSize:10,_sizePropMap:{HSpacer:"width",VSpacer:"height",InlineSpacer:"word-spacing"},getSpacerType:function(){return this._spacerType},createComponent:function(){var e=this._createElement("div");return this._updateSpacerSize(e),e},isBoxFlexEnabled:function(){return this._spacerType!=="InlineSpacer"},getSpacerSize:function(){return this._spacerSize},_setupPropertyHandlers:function(){this._handleProperty("size",function(e){this._updateSpacerSize(this._element)})},_updateSpacerSize:function(e){var t;this._spacerType=this._def.getChildValue("name");var n={};this._spacerType==="InlineSpacer"?(this._spacerType="InlineSpacer",n.display="inline",this._element.set("text"," ")):e.setStyle("display","box");var r=this._def.getChildValue("size");r!==undefined&&(this._spacerSize=r),t=this._sizePropMap[this._spacerType];var i=t==="width"?"height":"width";n[i]=0,this._spacerSize==="*"?(n[t]=0,n["box-flex"]="1"):t&&(n[t]=parseInt(this._spacerSize,10)+"px",n["box-flex"]="none"),e.setStyles(n)},getProxyMetaTags:function(){var e=["spacer"];return this._spacerType==="InlineSpacer"&&e.push("inline"),e}}}),define.oldClass({name:"wixapps.integration.proxies.SuperFlowProxy",imports:["wixapps.core.layouts.SuperFlowLayout"],Class:{Extends:"wixapps.integration.proxies.WCompositeProxy",_components:[],_layout:null,_layoutModel:null,createComponent:function(){var e=this.setWidth;this.setWidth=function(t){e.apply(this,[t]),this._setWidth(t)}.bind(this);var t=this._createWixComponent("core.components.Container");return this._layout=new this.imports.SuperFlowLayout,this._buildLayoutModel(),this._createChildComponents(t),this._components.forEach(function(e){e.setStyle("position","absolute")}),t},_buildLayoutModel:function(){var e=this._def.getValue(),t={items:[]};e.regions&&(t.regions=Object.clone(e.regions)),e.items.forEach(function(e){var n={};e.layout&&Object.each(e.layout,function(e,t){n[t]=e}),t.items.push(n)}),this._layoutModel=t},applyLayout:function(){this._layout.setModel(this._layoutModel,this._children),this._layout.positionElements(),this._element.setStyle("height",this._layout.getHeight())},_setWidth:function(e){this._layoutModel.minWidth=e,this.applyLayout()},_onDefinitionsChanged:function(){this.applyLayout()},_getDefaultStyleName:function(){return"c1"},_getDefaultSkinName:function(){return"mobile.core.skins.InlineSkin"}}}),define.oldClass({name:"wixapps.integration.proxies.SwitchProxy",imports:[],traits:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:[],_child:null,_prevCaseId:null,initialize:function(e,t,n,r){this.parent(e,t,n,r)},_setupPropertyHandlers:function(){this.parent(),this._handleProperties(["cases"],function(){this._updateSwitchState()&&(this._child.setupProxy(),this._child.updateLayoutWhenReady())})},_updateSwitchState:function(){var e=!1,t=this._data?this._data.getValue().toString():"";if(t!==this._prevCaseId){this._prevCaseId=t,this._child&&(this._child.dispose(),this._child=null);if(this._def.getChildByRef("cases")){var n=this._def.getChildByRef("cases").getChildByRef(t)||this._def.getChildByRef("cases").getChildByRef("default");if(n&&n.getValue()==="NO_PROXY")this._element.collapse();else{this._element.uncollapse(),this._child=this._viewContext.getEnvironment().getProxyFactory().createProxyFromItemDefinition(this._viewContext,n).proxy;var r=this._child.createComponent();if(r){this._element.adopt(r);var i=n.getChildValue("layout")||{};this._applyStyle(r,i),e=!0}}}}return e},setupProxy:function(e){this.parent(),this._child?this._child.setupProxy(e):e&&e()},createComponent:function(){var e=this._createElement();return e.setStyles({"flex-direction":"column",display:"flex"}),this._updateSwitchState(),e},_onDataChanged:function(){this._updateSwitchState()&&(this._child.setupProxy(),this._child.updateLayoutWhenReady())},dispose:function(){this._child&&(this._child.dispose(),this._child=null)}}}),define.oldClass({name:"wixapps.integration.proxies.TabMenuProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onSelectionChanged","_onSelectionChangeRequested"],createComponent:function(){return this._initialSelectedIndex=this.getViewDefinition().getChildValue("initialSelectedIndex")||0,this._selectionRequestEvent=this.getViewDefinition().getChildValue("selectionRequestEvent"),this._selectionRequestEventScope=this.getViewDefinition().getChildValue("selectionRequestScope")||"any",this._titleExpression=this._def.getChildValue("titleExpression")||"this",this._selectionChangedEvent=this.getViewDefinition().getChildValue("selectionChangedEvent"),this._createWixComponent("wixapps.integration.components.TabMenu",this._createRawData(),{initialSelectedIndex:this._initialSelectedIndex})},_createRawData:function(){var e=this._data.getChildren(),t=[];for(var n=0;n<e.length;n++)t.push(e[n].evaluatePath(this._titleExpression).getValue(0));return{type:"TextList",items:t}},setSelectedIndex:function(e){this._componentLogic&&this._componentLogic.setSelectedIndex(e)},_onComponentWixified:function(){this._componentLogic.addEvent("selectionChanged",this._onSelectionChanged),this._selectionRequestEvent&&this.addEventFilteredByScope(this._selectionRequestEventScope,this._selectionRequestEvent,this._onSelectionChangeRequested);var e=this._getInitialSelection();e>=0&&this.setSelectedIndex(e)},_onSelectionChanged:function(){this._selectionChangedEvent&&this.fireEvent(this._selectionChangedEvent,{sender:this,data:this.data.getChildren()[this._componentLogic.getSelectedIndex()],context:this.getViewContext(),def:this.getViewDefinition()})},_onSelectionChangeRequested:function(e){var t=e.data;if(!t)return;var n=this._data.getChildren();for(var r=0;r<n.length;r++){var i=n[r];if(i==t){this.setSelectedIndex(r);return}}},_setupPropertyHandlers:function(){this._handleProperty("initialSelectedIndex",function(e){e=e||0,e!=this._initialSelectedIndex&&(this._initialSelectedIndex=e,this.setSelectedIndex(e))})},_getDefaultSkinName:function(){return"wixapps.integration.skins.TabMenuSkin"},_getAcceptableDataTypes:function(){return["Array"]},dispose:function(){this._selectionRequestEvent&&this.removeEvent(this._selectionRequestEvent,this._onSelectionChangeRequested),this._componentLogic&&this._componentLogic.removeEvent("selectionChanged",this._onSelectionChanged),this.parent()}}}),define.oldClass({name:"wixapps.integration.proxies.TableProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_bodyCellHookMethod","_headerAndFooterCellHookMethod"],initialize:function(e,t,n,r){this.parent(e,t,n,r),this._proxyFactory=this._viewContext.getEnvironment().getProxyFactory(),this._columnsDefinition=this._getColumnsDef()},createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.TableComponent",this._createRawData(),{SequencingHook:this._bodyCellHookMethod,HeaderFooterSequencingHook:this._headerAndFooterCellHookMethod})},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperty("minHeight"),this._handleProperties(["rowsDataArray","columns"],function(){this._columnsDefinition=this._getColumnsDef(),this._refreshComponentData()})},_bodyCellHookMethod:function(e){var t=this._columnsDefinition[e.index].getChildByRef("item");return this._getCellElement(e.data,t)},_headerAndFooterCellHookMethod:function(e){return e.data?this._getCellElement(this._viewContext,e.data):null},_getCellElement:function(e,t){var n=this._proxyFactory.createProxyFromItemDefinition(e,t).proxy,r=n.createComponent();return n.setupProxy(function(){n.updateLayoutWhenReady()}),r},_createRawData:function(){var e=this._getColumnsDef(),t=this._getRowsListRawData(this._getRowsDataArray(),e),n=this._getHeaderOrFooterRawData(e,"header"),r=this._getHeaderOrFooterRawData(e,"footer");return{type:"Table",items:t,header:n,footer:r}},_getRowsDataArray:function(){var e=this._viewContext;if(this._def.getChildByRef("rowsDataArray")){var t=this._def.getChildValue("rowsDataArray");e=this._data.getChildByRef(t)}return e},_onDataChanged:function(e){this.parent(e),e.phase==Constants.DataItemEventPhase.ON_TARGET&&this._refreshComponentData()},_refreshComponentData:function(){if(!this._dataItem)return;var e=this._createRawData();this._dataItem.setData(e),this._dataItem.setMeta("isPersistent",!1)},_getColumnsDef:function(){return this._def.getChildByRef("columns").getChildren()},_getRowsListRawData:function(e,t){var n=[];return e.getChildren().forEach(function(e){var r=[];for(var i=0;i<t.length;i++)r[i]={data:this._viewContext.newContextForData(e),index:i,styleData:t[i].getChildValue("item").styleData};n.push(r)}.bind(this)),n},_getHeaderOrFooterRawData:function(e,t){var n=!1,r=[];return e.forEach(function(e,i){var s=e.getChildByRef(t);s?(n=!0,r.push({data:s,index:i})):r.push({data:null,index:i})}),n?r:null},_getPropSchemaName:function(){return"TableComponentProperties"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.table.TableComponentDefaultSkin"},_getDefaultStyleName:function(){return"tblc1"}}}),define.oldClass({name:"wixapps.integration.proxies.TextAreaProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.TextInputProxy",Binds:["_onValidation"],initialize:function(e,t,n,r){this.parent(e,t,n,r),this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation)},createComponent:function(){var e=this._createRawData(),t={maxLength:this._def.getChildValue("maxLength")};return this._createWixComponent("wysiwyg.viewer.components.inputs.TextAreaInput",e,t)},_onValidation:function(e){if(!this._componentLogic||!e)return;if(e.valid)this._componentLogic.setValidationState(!0);else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.setError(t)}this._componentLogic.setValidationState(e.valid)},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.input.TextAreaInputSkin",style:"wa_tai1"},ecomTextArea:{skin:"wixapps.integration.skins.ecommerce.inputs.TextAreaInputSkin",style:""}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style}}}),define.oldClass({name:"wixapps.integration.proxies.TextInputProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onComponentDataChanged","_onValidation"],createComponent:function(){var e=this._createRawData(),t=document.createElement("div");return t.innerHTML=e.text,e.text=t.innerText||t.text||t.textContent,this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this._createWixComponent("wixapps.integration.components.inputs.TextInput",e)},_getPropSchemaName:function(){return"TextInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["label","placeholder"])},_createRawData:function(){var e=this._data.getValue();return{type:"Text",text:e}},_onComponentWixified:function(){},_onDataChanged:function(e){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._data.getValue())},_onComponentDataChanged:function(e,t,n){this._ignoreUpdate=!0,this._data.setValue(n.text),this._ignoreUpdate=!1},_onValidation:function(e){if(!this._componentLogic)return;if(e.valid)this._componentLogic.resetInvalidState();else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.showValidationMessage(t)}},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.appinputs.AppsTextInputSkin",style:"wa_ti1"},ecomTextInput:{skin:"wysiwyg.viewer.skins.appinputs.EcomTextInputSkin",style:"ecom_ti1"}},_getDefaultSkinName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].skin},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style}}}),define.Class("wixapps.integration.proxies.TextProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.WProxy"),t.utilize([]),t.traits(["wixapps.integration.proxies.traits.AppsLinkTrait","wixapps.integration.components.traits.ResizableProxyTrait"]),t.binds(["_onAppPartResize"]),t.statics({PROXY_MODE_LABEL:"proxy_mode_label",PROXY_MODE_CLIPPED_PARAGRAPH:"proxy_mode_paragraph"}),t.fields({_styleString:"",_proxyMode:""}),t.methods({createComponent:function(){this.useSkinsInsteadOfStyles();var e=this._createRawData();return this._createWixComponent(this._getCompName(),e)},_checkProxyMode:function(){var e=this._proxyMode;return this._isLayoutBasedHeight()?this._proxyMode=this.PROXY_MODE_CLIPPED_PARAGRAPH:this._proxyMode=this.PROXY_MODE_LABEL,this._proxyMode!==e},_isLayoutBasedHeight:function(){return this._def.getChildValue("maxLines")===0?!0:this.parent()},_setupPropertyHandlers:function(){this._handleProperties(["postfix","prefix","disableLinks","lineThrough","underline","singleLine","color","bold","noWrap","style","italic","minLines","pack"],function(){this._refreshAll()}),this._handleProperty("maxLines",function(e){this._checkProxyMode()?this._goBellyUp():this._componentLogic.setComponentProperty(e,e)}),this._mapToCompProperties(["showTooltip"])},_refreshAll:function(){this._checkProxyMode()?this._goBellyUp():this._componentLogic.getDataItem().set("text",this._createFormattedText())},_createRawData:function(){return{type:"RichText",text:this._createFormattedText()}},_createFormattedText:function(){var e=this._getInnerText(),t=new Element("span");return W.Editor||this._def.getChildValue("disableLinks")?e=e.replace(/<a\b[^>]*>(.*?)<\/a>/ig,"$1"):this._updateLinkDataItems(),t.set("html",e),this._addStylesOnElement(t),t.outerHTML},_getInnerText:function(){var e="",t=this._def.getChildValue("prefix"),n=this._def.getChildValue("postfix");t&&(e+=t);var r;return this._data.getTypeName()=="wix:RichText"?r=this._data.getChildByRef("text").getValue():r=this._data.getValue(),this._isSingleLine()&&(r=r.replace(/(<p>|<\/p>|<br\/?>)/ig,"")),e+=r,n&&(e+=n),e},_addStylesOnElement:function(e){e.addClass(Constants.WixApps.TEXT_STYLES[this._def.getChildValue("style")]||this._getDefaultStyleName());var t=this._def.getChildValue("lineThrough");t&&e.addClass("lineThrough");var n=this._def.getChildValue("underline");n&&e.addClass("underline"),this._isSingleLine()&&e.addClass("singleLine"),this._applyColorStyle(e),this._applyBoldStyle(e),this._applyItalicStyle(e),this._applyLineHeightStyle(e),this._styleString=e.get("class")+" "+e.getStyle("color")},_applyColorStyle:function(e){var t=this._def.getChildValue("color");return t&&(this._isCustomColor(t)?e.setStyle("color",t):e.addClass(t)),t},_applyBoldStyle:function(e){var t=this._def.getChildValue("bold")===!0||this._def.getChildValue("bold")==="true";return t?e.addClass("bold"):e.removeClass("bold"),t},_applyItalicStyle:function(e){var t=this._def.getChildValue("italic")===!0||this._def.getChildValue("italic")==="true";return t?e.addClass("italic"):e.removeClass("italic"),t},_applyLineHeightStyle:function(e){var t=parseInt(this._def.getChildValue("line-height"),10);return isNaN(t)?e.setStyle("line-height",null):e.setStyle("line-height",t+"em"),t},_isSingleLine:function(){if(this._def==null)return!1;var e=this._def.getChildValue("singleLine");return e===!0||e=="true"},getStyleString:function(){return this._styleString},_onComponentWixified:function(){this._viewContext.getEnvironment().getEventsDispatcher().addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._onAppPartResize),this._onAppPartResize(),window.setTimeout(this._setTooltip.bind(this),100),Browser.firefox&&this._isSingleLine()&&this._element.setStyle("min-width","100%");var e=this._def.getChildValue("noWrap");(e===!0||e==="true")&&this._element.setStyle("white-space","nowrap")},_onDataChanged:function(e){this._componentLogic&&!this._componentLogic.getIsDisposed()&&this._componentLogic.getDataItem().set("text",this._createFormattedText())},_onAppPartResize:function(){this._disposed||(this._refreshAll(),this._setTooltip())},_setTooltip:function(){var e=this._getContainerElement();if(!e)return;this._shouldShowTooltip(e)?e.setAttribute("title",this._getInnerText()):e.removeAttribute("title")},_getContainerElement:function(){return this._element&&this._element.children&&this._element.children.length&&this._element.children[0].children&&this._element.children[0].children.length?this._element.children[0].children[0]:null},_shouldShowTooltip:function(e){return(this._def.getChildValue("showTooltip")==="true"||this._def.getChildValue("showTooltip")===!0)&&e.scrollWidth>e.offsetWidth},_isCustomColor:function(e){return e.slice(0,1)=="#"},_getCompName:function(){return this._proxyMode==this.PROXY_MODE_LABEL?"wysiwyg.viewer.components.WRichText":"wixapps.integration.components.ClippedParagraph"},_getPropSchemaName:function(){return this._proxyMode==this.PROXY_MODE_CLIPPED_PARAGRAPH?"ClippedParagraphProperties":undefined},_getDefaultStyleName:function(){return"font_8"},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.WRichTextSkin"},_getAcceptableDataTypes:function(){return["String","wix:RichText","Number"]},getProxyMetaTags:function(){return["text"]}})}),define.oldClass({name:"wixapps.integration.proxies.TimeSelectorProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_onComponentDataChanged","_onValidation"],createComponent:function(){this._data.addEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation);var e="wixapps.integration.components.inputs.TimeInput";this.useSkinsInsteadOfStyles();var t=this._getIsoDate();return this._createWixComponent(e,{type:"Text",text:t})},_getPropSchemaName:function(){return"TimeInputProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["resolution","hourFormat","allowEmpty"])},_getDefaultSkinName:function(){return"wixapps.integration.skins.inputs.TimeInputSkin"},_getIsoDate:function(){var e=this._data.getValue(),t=new Date(e.iso);return!this._allowEmpty()&&(isNaN(t.getTime())||t.getDate()==(new Date(0)).getDate())&&(e.iso=(new Date).toISOString(),this._data.setValue(e)),e.iso},_onDataChanged:function(e){!this._userInputChange&&this._element&&this._element.getLogic()&&this._element.getLogic().getDataItem().set("text",this._getIsoDate())},_onComponentDataChanged:function(e){var t=this._element.getLogic().getDataItem().get("text");this._userInputChange=!0,this._data.setValue({_type:"wix:Date",iso:t}),this._userInputChange=!1},_onValidation:function(e){if(!this._componentLogic)return;if(e.valid)this._componentLogic.resetInvalidState();else{var t=e.validationMessage||this._def.getValue().validationMessage;this._componentLogic.showValidationMessage(t)}},_allowEmpty:function(){return this._def.getChildValue("allowEmpty")!==!1&&this._def.getChildValue("allowEmpty")!=="false"},_getAcceptableDataTypes:function(){return["wix:Date"]}}}),define.oldClass({name:"wixapps.integration.proxies.ToggleProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",Binds:["_handlePeerToggleEvent","toggle"],initialize:function(e,t,n,r){this.parent(e,t,n,r),this._loadTemplates()},createComponent:function(){var e=this._viewContext.getEnvironment().getProxyFactory();this._initialState=this.getViewDefinition().getChildValue("initialState")||"off";var t=e.createProxyFromItemDefinition(this._viewContext,this._onTemplate).proxy,n=e.createProxyFromItemDefinition(this._viewContext,this._offTemplate).proxy;this._childrenLeftToBeReady=1;var r=function(e){e.grab(t.createComponent()),t.setupProxy(this._onChildReady)}.bind(this),i=function(e){e.grab(n.createComponent()),n.setupProxy(this._onChildReady)}.bind(this);this._toggleTriggerEvent=this._def.getChildValue("toggleTriggerEvent");var s=this._createWixComponent("wixapps.integration.components.Toggle",undefined,{createOnHook:r,createOffHook:i,initialState:this._initialState,listensToPartsClick:!this._toggleTriggerEvent});if(this._toggleTriggerEvent){var o=this._def.getChildValue("toggleTriggerScope")||"same";this.addEventFilteredByScope(o,this._toggleTriggerEvent,this.toggle)}return s},_onComponentWixified:function(){this._componentLogic.addEvent("wix:toggle",function(e){this.fireEvent("wix:toggle",{state:e.state,toggleGroup:this.getToggleGroup()}),this._viewContext.getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),this._viewContext.getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE)}.bind(this)),this.addEventFilteredByScope(this.getToggleScope(),"wix:toggle",this._handlePeerToggleEvent)},getToggleGroup:function(){return this.getViewDefinition().getChildValue("toggleGroup")},getToggleScope:function(){return this.getViewDefinition().getChildValue("toggleScope")},turnOff:function(){this._componentLogic.turnOff()},turnOn:function(){this._componentLogic.turnOn()},toggle:function(){this._componentLogic.toggle()},_setupPropertyHandlers:function(){this._handleProperties(["initialState"],function(){this._loadTemplates();var e=this.getViewDefinition().getChildValue("initialState")||"off";e!=this._initialState&&(this._initialState=e,e=="on"?this.turnOn():this.turnOff())})},_loadTemplates:function(){var e=this._viewContext.getEnvironment();this._onTemplate=this._getItemTemplate("on")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_on",comp:{}},this._def),this._offTemplate=this._getItemTemplate("off")||e.getDataItemFactory().createDataItem({id:this.getFieldId()+"_template_off",comp:{}},this._def)},_getItemTemplate:function(e){return this._def.getChildByRef("templates")&&this._def.getChildByRef("templates").getChildByRef(e)},_handlePeerToggleEvent:function(e){var t=e.state,n=e.toggleGroup;if(e.sender==this)return;t=="on"&&n&&n==this.getToggleGroup()&&this.turnOff()},_getDefaultSkinName:function(){return"wixapps.integration.skins.ToggleSkin"},dispose:function(){this._toggleTriggerEvent&&this.removeEvent(this._toggleTriggerEvent,this.toggle),this.removeEvent("wix:toggle",this._handlePeerToggleEvent),this.parent()}}}),define.oldClass({name:"wixapps.integration.proxies.VerticalLineProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WProxy",createComponent:function(){return this._createWixComponent("wysiwyg.viewer.components.VerticalLine",undefined,undefined,undefined)},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.VerticalLineSkin"},_getDefaultStyleName:function(){return"vl1"}}}),define.oldClass({name:"wixapps.integration.proxies.VerticalListEditorProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.VerticalListProxy",Binds:["onDragItemCopyCreated","disposeDragItemCopy"],initialize:function(e,t,n,r){this.parent(e,t,n,r);var i=n.getChildValue("dragEnabled");this._repeaterArgs.dragEnabled=i!=="false"&&this._dragEnabled!==!1,this._repeaterArgs.dragEventHandler=this,this._repeaterArgs.maxDragIndex=n.getChildValue("maxDragIndex")},onDragItemCopyCreated:function(e){var t=e.getViewProxy();t.setupProxy()},disposeDragItemCopy:function(e){var t=e.getViewProxy();this._undisposedChildren.erase(t),t.dispose()},getRepeaterClass:function(){return"wixapps.integration.components.VerticalListEditor"},_getDefaultStyleName:function(){return undefined},_getDefaultSkinName:function(){return"wixapps.integration.skins.editor.VerticalListEditorSkin"}}}),define.oldClass({name:"wixapps.integration.proxies.VerticalListProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.ListProxy",getRepeaterClass:function(){return"wysiwyg.viewer.components.VerticalRepeater"},setComponentStyles:function(e){return e.setStyles({display:"flex","flex-direction":"column"}),e},_stylesMap:{"default":{style:"vr1"},ecomOptionsList:{style:null}},_getDefaultStyleName:function(){var e=this._def.getChildValue("styleNS")||"default";return this._stylesMap[e].style},_onComponentWixified:function(){this.parent(),this._componentLogic.getSkinPart("inlineContent").setStyles({display:"flex","flex-direction":"column"})}}}),define.oldClass({name:"wixapps.integration.proxies.VideoProxy",imports:[],traits:["wixapps.integration.components.traits.ResizableProxyTrait"],Class:{Extends:"wixapps.integration.proxies.WProxy",createComponent:function(){var e=this._createRawData(this._data.getValue()),t={type:"Video"};return this._createWixComponent("wysiwyg.viewer.components.Video",e,undefined,t)},_createRawData:function(e){var t={type:"Video",videoId:e.videoId,videoType:e.videoType};return t},_getPropSchemaName:function(){return"VideoProperties"},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["autoplay","loop","showinfo","lightTheme","showControls"])},_onDataChanged:function(e){if(this._componentLogic&&!this._ignoreUpdate){var t=this._data.getValue(),n=this._componentLogic.getDataItem();n.set("videoId",t.videoId,!0),n.set("videoType",t.videoType,!0),n.fireDataChangeEvent()}},_getDefaultSkinName:function(){return"wysiwyg.viewer.skins.video.VideoDefault"},_getDefaultStyleName:function(){return"vl"}}}),define.Class("wixapps.integration.proxies.VideoSelectorProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.TextInputProxy"),t.binds(["_onComponentDataChanged","_onInputBlur"]),t.traits(["wysiwyg.viewer.components.traits.VideoUtils"]),t.methods({_onComponentWixified:function(){this._componentLogic.addEvent(Constants.CoreEvents.BLUR,this._onInputBlur)},_onInputBlur:function(e){this._componentLogic&&(this._ignoreUpdate=!0,this._componentLogic.getDataItem().set("text",this._getVideoUrlForInput()),this._ignoreUpdate=!1)},_createRawData:function(){return{type:"Text",text:this._getVideoUrlForInput()}},_onDataChanged:function(e){this._componentLogic&&!this._ignoreUpdate&&this._componentLogic.getDataItem().set("text",this._getVideoUrlForInput())},_onComponentDataChanged:function(e,t,n){if(this._ignoreUpdate)return;this._ignoreUpdate=!0;var r=this._getDefaultVideo();if(e.get("text").trim().length===0&&r)this._data.setValue(r);else{var i=this._getVideoDataFromVideoUrl(e.get("text"));i&&i.videoType&&i.videoId&&(i._type="wix:Video",this._data.setValue(i))}this._ignoreUpdate=!1},_getVideoUrlForInput:function(){var e=this._getDefaultVideo(),t=this._data.getValue(),n=e&&t.videoId===e.videoId&&t.videoType===e.videoType;return n?"":this._getVideoUrlFromVideoData(this._data.getValue())},_getDefaultVideo:function(){return this._def.getChildValue("defaultVideo")}})}),define.oldClass({name:"wixapps.integration.proxies.VideoThumbProxy",imports:[],traits:["wysiwyg.viewer.components.traits.VideoUtils"],Class:{Extends:"wixapps.integration.proxies.ImageProxy",Binds:["_showPic"],_createRawData:function(){var e=this._data.getValue(),t=this._getServices()[e.videoType],n="84770f_7ce1ddb86000aefa86f1a05553079857.jpg_256";return n=t.getPreviewUrl(e.videoId,this._showPic)||n,{type:"Image",uri:n,title:"",width:480,height:360}},_onDataChanged:function(){var e=this._createRawData();this._showPic(e.uri)},_showPic:function(e){this._componentLogic?this._componentLogic.getDataItem().set("uri",e):this._videoThumbUrl=e},_onComponentWixified:function(){this._element.addClass("videoIndicator"),this._showPic(this._videoThumbUrl),this.parent()}}}),define.oldClass({name:"wixapps.integration.proxies.WArrayProxy",imports:[],traits:["wixapps.integration.proxies.WIntegrationTrait","wixapps.integration.proxies.traits.ProxyPropertyChangeTrait"],Class:{Extends:"wixapps.core.views.proxies.ArrayProxy"}}),define.oldClass({name:"wixapps.integration.proxies.WCompositeProxy",imports:[],traits:["wixapps.integration.proxies.WIntegrationTrait","wixapps.integration.proxies.traits.ProxyPropertyChangeTrait"],Class:{Extends:"wixapps.core.views.proxies.CompositeProxy"}}),define.Class("wixapps.integration.proxies.WIntegrationTrait",function(e){var t=e;t.utilize(["wixapps.integration.utils.flex.BoxFlexPolyfill"]),t.binds(["_onStyleChangeInternal","_onSkinChange","_onAutoSizeChange"]),t.fields({_dataItem:null,_element:null,_initArgs:null,_componentLogic:null,_applyAfterWixifiedActions:[],_prefix:"",_onReadyCallback:null,_childrenLeftToBeReady:0,_useSkinsInsteadOfStyles:!1,_cssPropDict:{},_lifecycleManager:null,_nativeEventHandlers:[]}),t.methods({initialize:function(){W&&W.Viewer&&W.Editor&&this.useSkinsInsteadOfStyles();var e=String(this.injects().Utils.getCSSBrowserFeature("boxOrient")||"");e&&(this._prefix=e.match(/^\-[a-z]+\-/)[0]||"")},_createElement:function(e){var t,n=this;this._lifecycleManager=this._viewContext.getEnvironment().getLifecycleManager();var r=this._viewContext.getEnvironment();t=new Element(e||this._getViewElement()),t.getViewProxy=function(){return n},t.$viewProxy=n,t.setAttribute("hasProxy","true"),t.setAttribute("vctype",r.getForType()),t.setAttribute("vcview",r.getViewName()),t.setAttribute("vcfield",this.getFieldId()),t.setAttribute("pos",this._getDefaultPosition()),this._element=t,this.imports.BoxFlexPolyfill.applyBoxFlexPolyfill(this._element);var i=this._def.getChildValue("cssClass");i&&(t.addClass(i),this._cssClass=i);var s=this._def.getChildValue("hidden");return(s=="true"||s===!0)&&t.collapse(),this._nativeEventHandlers.forEach(function(e){t.addEvent(e.type,e.handler)}),t},_createWixComponent:function(e,t,n){n=n||{},this._initArgs=n,this._isWixificationPending=!0;var r,i,s,o=this._createCompProperties()||{};i=this._def.getChildValue("style")||this._getDefaultStyleName(),r=this._def.getChildValue("skin")||this._getDefaultSkinName(),this._styleNameSpace=this._def.getChildValue("styleNS")||this._getDefaultStyleNameSpace(),this._initArgs.styleNameSpace=this._styleNameSpace;var u=this._createElement();this._lifecycleManager.notifyComponentCreated(u),u.setAttribute("comp",e),i&&!this._useSkinsInsteadOfStyles&&u.setAttribute("styleid",i),u.setAttribute("skin",r),t&&(this._dataItem=W.Data.createDataItem(t),this._dataItem.setMeta("isPersistent",!1),this._dataItem.addEvent(Constants.DataEvents.DATA_CHANGED,this._onComponentDataChanged));if(o.type){var a=W.ComponentData.addDataItemWithUniqueId("wixApps",o);a&&(a.dataObject.setMeta("isPersistent",!1),u.setAttribute("propertyquery","#"+a.id))}return u.addEvent(Constants.ComponentEvents.WIXIFIED,function(){this._onWixComponentWixifiedInternal(u),this._isWixificationPending=!1}.bind(this)),u.addEvent(Constants.ComponentEvents.READY,function(){this._defferedDataChangeEvent&&this._onDataChanged(this._defferedDataChangeEvent),this._lifecycleManager.notifyComponentReady(u)}.bind(this)),u},useSkinsInsteadOfStyles:function(){this._useSkinsInsteadOfStyles=!0},updateLayoutWhenReady:function(e){this._lifecycleManager.performAction(e||this._lifecycleManager.getDefaultInvalidateLayoutAction())},setupProxy:function(){this._applyCssNode(this._element),this._children&&this._children.each(function(e){e.setupProxy()}.bind(this)),this._element.wixify&&this._element.get("comp")?this._element.wixify(this._initArgs,this._dataItem,"vwprxy"):this._element.wixifySubElement&&this._element.wixifySubElement(this._initArgs,this._dataItem,"vwprxy");var e=this;window.requestAnimFrame(function(){e._disposed||e._onProxySetup()})},_onReady:function(){},_onWixComponentWixifiedInternal:function(e){this._componentLogic=e.getLogic(),this._updateComponentState(),this._onComponentWixified(),this._registerStyleChangeHandler(),this._applyAfterWixifiedActions.forEach(function(e){e.apply(this)}.bind(this)),this._applyAfterWixifiedActions=[],this._componentLogic.addEvent("autoSizeChange",this._onAutoSizeChange)},_onAutoSizeChange:function(e){this._viewContext.getEnvironment().getEventsDispatcher().fireEvent("innerCompResize",this._componentLogic)},_registerProxyEvents:function(e,t){e.indexOf("dom:")===0?this._nativeEventHandlers.push({type:e.slice(4),handler:t}):this._applyAfterWixified(function(){this._componentLogic.addEvent(e,t)}.bind(this))},_applyAfterWixified:function(e){this._componentLogic?e.apply(this):this._applyAfterWixifiedActions.push(e)},_onComponentWixified:function(){},_onComponentDataChanged:function(e,t,n){},_onDataChangedInternal:function(e){if(this._isWixificationPending===!0){this._defferedDataChangeEvent=e;return}this.parent(e),this._componentLogic&&!this._componentLogic.getIsDisplayed()&&this._componentLogic.invalidateComponent&&this._componentLogic.invalidateComponent()},_onProxySetup:function(){},setWidth:function(e){this._element.setStyle("width",e)},getWidth:function(){return this._element.getWidth()},getHeight:function(){return this._element.getHeight()},setPos:function(e,t){this._element.setStyles({left:e,top:t})},_getViewElement:function(){return"div"},_getDefaultStyleName:function(){return""},_getDefaultSkinName:function(){return""},_getDefaultStyleNameSpace:function(){return null},refreshSize:function(){},_onLayoutChange:function(){},_applyStyle:function(e,t){if(!e)return;var n={};Object.each(t,function(e,t){(t=="width"||t=="height")&&typeOf(e)=="string"&&!String.contains(e,"%")&&(e=parseInt(e,10)),n[t]=e}.bind(this)),e.setStyles(n)},_registerStyleChangeHandler:function(){this._styleObj&&(this._styleObj.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChangeInternal),this._styleObj.removeEvent(Constants.StyleEvents.SKIN_CHANGED,this._onSkinChange)),this._styleObj=this._componentLogic.getStyle(),this._styleObj&&(this._styleObj.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChangeInternal),this._styleObj.addEvent(Constants.StyleEvents.SKIN_CHANGED,this._onSkinChange))},_onStyleChangeInternal:function(e){this._onStylePropertiesChange(e.properties)},_onSkinChange:function(e){},_onStylePropertiesChange:function(e){},_isLayoutBasedWidth:function(){var e=this._def.getParent().getChildValue("layout");if(this._getImplicitDimensions().contains("width"))return!1;if(e&&("width"in e||"zoomExpand"in e))return!0;var t=this.getParentProxy(),n=t&&t.getLayoutOrientation?t.getLayoutOrientation():"";return n==="vertical"?!0:n==="horizontal"?Boolean(e&&("box-flex"in e||"flex"in e)):!1},_isLayoutBasedHeight:function(){var e=this._def.getParent().getChildValue("layout");if(this._getImplicitDimensions().contains("height"))return!1;if(e&&"height"in e)return!0;var t=this.getParentProxy(),n=t&&t.getLayoutOrientation?t.getLayoutOrientation():"";return n==="horizontal"?t?t._isLayoutBasedHeight():!0:n==="vertical"?e&&("box-flex"in e||"flex"in e):!1},_isCompBasedWidth:function(){return!this._isLayoutBasedWidth()},_isCompBasedHeight:function(){return!this._isLayoutBasedHeight()},_getImplicitDimensions:function(){return[]},_getParentLayoutOrientation:function(){var e=this.getParentProxy();return e&&e.getLayoutOrientation?e.getLayoutOrientation():undefined},getParentProxy:function(){var e=this._element.parentNode;while(e){if(e.hasAttributes("hasproxy"))return e.$viewProxy;e=e.parentNode}return null},getProxyMetaTags:function(){return[]},hasMetaTag:function(e){return this.getProxyMetaTags().contains(e)},_getDefaultPosition:function(){return""},getCompLogic:function(){return this._componentLogic},getElement:function(){return this._element},getSourceSize:function(){return undefined},hasFixedAspectRatio:function(){return!1},getAspectRatio:function(){return NaN},dispose:function(){if(this._disposed)return;this._isWixificationPending=!1,this._dataItem&&this._dataItem.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onComponentDataChanged),this._children&&this._children.forEach(function(e){e.dispose()}),this._componentLogic&&this._componentLogic.dispose(),this._deactivateResizeMechanism&&this._deactivateResizeMechanism(this._element),this._styleObj&&(this._styleObj.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChangeInternal),this._styleObj.removeEvent(Constants.StyleEvents.SKIN_CHANGED,this._onSkinChange),this._styleObj=null),this._nativeEventHandlers.forEach(function(e){this._element.removeEvent(e.type,e.handler)}.bind(this)),this._nativeEventHandlers=null,this._dataItem=null,this._componentLogic=null,this._element.destroy(),this._element=null,this.parent()}})}),define.oldClass({name:"wixapps.integration.proxies.WProxy",imports:[],traits:["wixapps.integration.proxies.WIntegrationTrait","wixapps.integration.proxies.traits.ProxyPropertyChangeTrait"],Class:{Extends:"wixapps.core.views.proxies.Proxy"}}),define.oldClass({name:"wixapps.integration.proxies.ZoomLinkProxy",imports:[],traits:[],Class:{Extends:"wixapps.integration.proxies.layout.BoxLayoutProxy",Binds:["_onClicked"],createComponent:function(){var e=this.parent();return e.addEvent("click",this._onClicked),e},_getContainerElementType:function(){return"a"},_dispose:function(){this._element&&this._element.removeEvent("click",this._onClicked)},_onClicked:function(){var e=this._data,t=this._def.getChildValue("listExpression"),n=t?this._viewContext.evaluatePath(t).getChildren():[e],r=this._def.getChildValue("idField")||"_iid",i=this._def.getChildValue("titleField")||"title",s=this._getZoomParams(n,e,i,r);return this.fireEvent("wix:zoom-link:open-zoom",{zoomParams:s}),!1},_getZoomParams:function(e,t,n,r){n=n||"title",r=r||"_iid";var i=t.getChildByRef(r).getValue(),s=e.map(function(e){return{id:e.getChildByRef(r).getValue(),title:e.getChildByRef(n).getValue()}}),o=s.getIndexByField("id",i);return{list:s,selectedIndex:o}}}}),define.oldClass({name:"wixapps.integration.proxies.layout.BoxLayoutProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.layout.CssLayoutProxy",_prefix:"",_orientation:"vertical",_spacers:[],_alignPropMap:{vertical:{left:"start",center:"center",right:"end"},horizontal:{top:"start",middle:"center",bottom:"end",left:"start",center:"center",right:"end",baseline:"baseline"}},createComponent:function(){var e=this.parent();return this._applyBoxStyles(e),e},_applyBoxStyles:function(e){this._orientation=this._def.getChildValue("orientation")||this._getDefaultOrientation(),e.setStyles({display:"box","box-orient":this._orientation}),this._updateBoxAlign()},getLayoutOrientation:function(){return this._orientation},_getDefaultOrientation:function(){return this._def.getChildValue("name")==="HBox"?"horizontal":"vertical"},_reloadProxy:function(){this._spacers.forEach(function(e){e!==undefined&&Object.each(e,function(e,t){e.onRemove()})}),this._spacers=[],this._applyBoxStyles(this._element),this.parent()},_setupPropertyHandlers:function(){this.parent(),this._handleProperty("box-align",this._updateBoxAlign),this._handleProperty("orientation",function(e){this._orientation=e,this._reloadProxy()})},_updateBoxAlign:function(){var e=this._def.getChildValue("box-align");e&&this._getLayoutRootElement().setStyle("box-align",this._translateBoxAlignValues(this._orientation,e))},_translateBoxAlignValues:function(e,t){return this._alignPropMap[e][t]},_processChildLayoutDef:function(e,t){return this._processSpacers(this._components[t],e,t),e},_processSpacers:function(e,t,n){this._processSpacer(e,t,n,"before"),this._processSpacer(e,t,n,"after")},_processSpacer:function(e,t,n,r){var i=r=="before"?"spacerBefore":"spacerAfter",s=t[i]!==undefined?t[i]:t.spacer;s===undefined&&(s="none");var o=this._spacers[n]||{},u=this._getLayoutRootElement();if(!e)s="none";else if(e.getViewProxy){var a=e.getViewProxy().isHidden();if(a===!0||a==="true")s="none"}if(o[r]&&s=="none")o[r].onRemove(),delete o[r];else if(!o[r]&&s!="none"){var f=e.getViewProxy(),l=this._children[n].getFieldId()+"_spacer_"+r,c={id:l,comp:{name:this._orientation=="vertical"?"VSpacer":"HSpacer",hidden:!1,size:s},layout:{}};f.hasClassAncestor("wixapps.integration.components.InlineText")&&(c.comp.name="InlineSpacer");var h=this._viewContext.getEnvironment(),p=h.getDataItemFactory().createDataItem(c),d=h.getProxyFactory().createProxyFromItemDefinition(this._viewContext,p).proxy,v=d.createComponent();v.updateSize=function(e){p.getChildByRef("comp").getChildByRef("size").setValue(e)},v.onProxyDefChange=function(){p.getChildByRef("comp").getChildByRef("hidden").setValue(f.isHidden())},v.onRemove=function(){f.getViewDefinition().removeEvent(Constants.DataItemEvents.CHANGE,v.onProxyDefChange),v.destroy()},f.getViewDefinition().addEvent(Constants.DataItemEvents.CHANGE,v.onProxyDefChange),o[r]=v;if(r=="before")u.insertBefore(v,this._components[n]);else{var m=this._components[n].nextSibling;m?u.insertBefore(v,m):u.appendChild(v)}var g=p.getChildValue("layout");v.setStyles(g),d.setupProxy(),this.updateLayoutWhenReady()}else{if(!o[r]&&s=="none")return;o[r].updateSize(s)}this._spacers[n]=o},_onChildLayoutPropertyChange:function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.path[0],i=parseInt(n.path[2],10);if(!isNaN(i)){var s={};s[r]=n.item.getValue(),r=="spacer"||r=="spacerBefore"?this._processSpacer(this._components[i],s,i,"before"):r=="spacer"||r=="spacerAfter"?this._processSpacer(this._components[i],s,i,"after"):(this._applyStyle(this._components[i],s),this.getViewContext().getEnvironment().getEventsDispatcher().fireEvent(Constants.WixAppEvents.PROXY_SIZE_INVALID,{proxy:this}))}}this.parent(e)},_finalizeLayout:function(){}}}),define.oldClass({name:"wixapps.integration.proxies.layout.CssLayoutProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.WCompositeProxy",_nativeEvents:[],createComponent:function(){var e=this._createElement(this._getContainerElementType());return this._nativeEvents.forEach(function(t){e.addEvent(t.type,t.fn)}),this._createChildComponents(e),e},_createChildComponents:function(e){this._createChildProxies(),e.set("html",""),this.parent(e);var t=this._def.getChildByRef("items");if(t)var n=t.getChildren();this._children.forEach(function(e,t){var r=n[t].getChildValue("layout");if(r){var i=this._components[t];r.hasOwnProperty("width")&&!String(r.width).contains("%")&&i.setAttribute("width",parseInt(r.width,10)),r.hasOwnProperty("height")&&!String(r.height).contains("%")&&i.setAttribute("height",parseInt(r.height,10))}}.bind(this))},_getContainerElementType:function(){return"div"},_onProxySetup:function(){var e=this._getLayoutRootElement();e&&this._setupBox(e),this.updateLayoutWhenReady()},_setupBox:function(e){this._applyLayoutsAsCss(e)},_applyLayoutsAsCss:function(e){var t={};this._def.getParent().getParent()||(t=this._def.getParent().getChildValue("layout")||{}),t=this._processLayoutDef(t)||t,this._applyStyle(e,t);var n=this._def.getChildValue("childLayout")||{};this._components.forEach(function(e){this._applyStyle(e,n)}.bind(this));var r=this._def.getChildByRef("items");if(r){var i=r.getChildren();this._children.forEach(function(e,t){var n=i[t].getChildValue("layout")||{};n=this._processChildLayoutDef(n,t)||n,this._applyStyle(this._components[t],n)}.bind(this))}},_processLayoutDef:function(e){return e},_processChildLayoutDef:function(e,t){return e},_registerProxyEvents:function(e,t){this.parent(e,t),this._nativeEvents.push({type:e,fn:t})},_reloadProxy:function(){this.parent(),this._createChildComponents(this._getLayoutRootElement()),this.setupProxy()},_onChildLayoutPropertyChange:function(e){if(this._getLayoutRootElement()){var t;for(var n=0;n<e.length;n++){var r=e[n],i=r.path[0],s=parseInt(r.path[2],10);t={},t[i]=r.item.getValue(),this._applyStyle(this._components[s],t)}}},_getLayoutRootElement:function(){return this._element}}}),define.Class("wixapps.integration.proxies.layout.FieldBoxProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),t.methods({_rewriteDefinition:function(e,t,n,r){var i={},s=t.orientation||"vertical";i.name="Box",i.orientation=s=="vertical"?"vertical":"horizontal",i.items=t.items||[],i.events=t.events||{};for(var o=0;o<i.items.length;o++){var u=i.items[o];if(["Field","TextField"].contains(u.comp.name)){u.comp.orientation=s;var a=n.getEnvironment().getProxyFactory().getProxyClassByName(u.comp.name);if(a.getLayoutDefinitions){var f=a.getLayoutDefinitions(u.comp);u.layout=u.layout||{},u.layout=Object.merge({},u.layout,f)}}}var l=s=="vertical"?"VSpacer":"HSpacer",c={id:r+"_pack_start",comp:{name:l,size:0}},h={id:r+"_pack_end",comp:{name:l,size:0}};return i.items.unshift(c),i.items.push(h),t.pack==="center"&&(c.comp.size="*",h.comp.size="*"),t.pack==="end"&&(c.comp.size="*"),i}})}),define.Class("wixapps.integration.proxies.layout.FieldProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),t.statics({getLayoutDefinitions:function(e){var t={};return e.spacers&&e.spacers.before!==undefined&&(t.spacerBefore=e.spacers.before),e.spacers&&e.spacers.after!==undefined&&(t.spacerAfter=e.spacers.after),t},_isEmptyValue:function(e){var t=this._typeEmptyCheckers[e.getTypeName()];return t&&t(e)},_typeEmptyCheckers:{"wix:Image":function(e){return e.getChildValue("src")==="http://images/noimage.png"},"wix:Video":function(e){return e.getChildValue("videoType")==="YOUTUBE"&&e.getChildValue("videoId")==="xLk7JoPDx4Q"}}}),t.methods({_rewriteDefinition:function(e,t,n,r){if(!t.items||t.items.length!==1)throw"field proxy accepts exactly one child";var i={},s=t.orientation||"vertical",o=t.heightMode||"manual";i.name="Box",i.hidden=t.hidden===!0||t.hidden==="true"||this._isEmptyValue(e),i.orientation=s=="vertical"?"horizontal":"vertical",i.items=[],i.events=t.events||{};var u=t.items[0];u.layout=u.layout||{},u.layout.spacerBefore=t.spacers&&t.spacers["xax-before"]||0,u.layout.spacerAfter=t.spacers&&t.spacers["xax-after"]||0;var a=t["box-align"]||"start",f=s=="vertical"?"VSpacer":"HSpacer",l={id:r+"_box_align_spacer_before",comp:{name:f,size:0}},c={id:r+"_box_align_spacer_after",comp:{name:f,size:0}};i.items.push(l),i.items.push(u),i.items.push(c);switch(a){case"center":l.comp.size="*",c.comp.size="*";break;case"end":l.comp.size="*"}var h=t.width!==undefined?t.width:100,p=t.height!==undefined?t.height:100;return u.layout.width=h,o=="manual"&&(u.layout.height=p),i},getInnerProxy:function(){return this._children&&this._children.length==3&&this._children[1]}})}),define.oldClass({name:"wixapps.integration.proxies.layout.FixedRatioLayoutProxy",imports:[],traits:[],Class:{Extends:"wixapps.integration.proxies.layout.BoxLayoutProxy",Binds:["_onAppResize"],_onAppResize:function(){this._updateLayoutSize()},_onAppViewCreated:function(){this._updateLayoutSize()},getAspectRatio:function(){return this._def.getChildValue("aspectRatio")||1},hasFixedAspectRatio:function(){return!0},_updateLayoutSize:function(){var e=this.getAspectRatio(),t=parseFloat(e);e=="golden"&&(t=1.61803);var n=this._element.getSize();if(this._isLayoutBasedWidth()){var r=Math.floor(n.x/t);this._element.setStyle("height",r)}else{var i=Math.floor(n.y*t);this._element.setStyle("width",i)}}}}),define.Class("wixapps.integration.proxies.layout.RewriteBoxProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.BoxLayoutProxy"),t.binds(["_updateOnOriginalDefinitionChange"]),t.fields({_origName:null,_origDef:null,_flaggedToReloadAfterRewrite:!1}),t.methods({initialize:function(e,t,n,r){this._origDef=n;var i=this._rewriteDefinition(t,n.getValue(0),e,r),s=e.getEnvironment().getDataItemFactory().createDataItem(i);s.getParent=function(){return n.getParent()},this._origName=n.getChildValue("name"),this.parent(e,t,s,r),this._origDef.addEvent(Constants.DataItemEvents.CHANGE,this._updateOnOriginalDefinitionChange)},_onDataChanged:function(e){this.parent(),this._updateOnOriginalDefinitionChange()},_updateOnOriginalDefinitionChange:function(){var e=this._origDef.getValue(0);if(e.name!=this._origName)return;var t=this._rewriteDefinition(this._data,e,this._viewContext,this._fieldId);this._def.setValue(t),this._element.$flexPolyfill.updateGeometry(),this._flaggedToReloadAfterRewrite&&(this._flaggedToReloadAfterRewrite=!1,this._reloadProxy())},_rewriteDefinition:function(e,t,n,r){throw"not implemented (should return the manipulated json definition)"},_requestReloadAfterNextRewrite:function(){this._flaggedToReloadAfterRewrite=!0},dispose:function(){this._origDef.removeEvent(Constants.DataItemEvents.CHANGE,this._updateOnOriginalDefinitionChange),this._origDef=undefined,this.parent()}})}),define.oldClass({name:"wixapps.integration.proxies.layout.StackLayoutProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.layout.CssLayoutProxy",_processLayoutDef:function(e){e.position="relative"},_processChildLayoutDef:function(e,t){var n="absolute";t===0&&(n=this._def.getChildValue("stackType")=="layout"?"absolute":"static"),e.position=e.position||n,e.left=e.left||"0px",e.top=e.top||"0px"}}}),define.Class("wixapps.integration.proxies.layout.TextFieldProxy",function(e){var t=e;t.inherits("wixapps.integration.proxies.layout.RewriteBoxProxy"),t.statics({defaultManualWidth:150,defaultManualHeight:150,getLayoutDefinitions:function(e){var t={};return e.orientation==="horizontal"&&(t["max-width"]=e.width!==undefined?parseInt(e.width,10):this.defaultManualWidth),e.spacers&&e.spacers.before!==undefined&&(t.spacerBefore=e.spacers.before),e.spacers&&e.spacers.after!==undefined&&(t.spacerAfter=e.spacers.after),t}}),t.fields({_lastWidthMode:undefined}),t.methods({_rewriteDefinition:function(e,t,n,r){if(!t.items||t.items.length!==1)throw"field proxy accepts exactly one child";var i=t["width-mode"]||"auto";this._lastWidthMode===undefined&&(this._lastWidthMode=i),this._lastWidthMode!==i&&(this._lastWidthMode=i,this._requestReloadAfterNextRewrite());var s={},o=t.orientation||"vertical";s.name="Box",s.hidden=this._shouldHide(e,t),s.orientation=o=="vertical"?"horizontal":"vertical",s.events=t.events||{},s.items=[];var u=t.items[0],a=i==="manual";u.layout=u.layout||{},u.layout.spacerBefore=t.spacers&&t.spacers["xax-before"]||0,u.layout.spacerAfter=t.spacers&&t.spacers["xax-after"]||0;var f=t["box-align"]||"start";!a&&o==="vertical"&&(f="start");var l=o=="vertical"?"VSpacer":"HSpacer",c={id:r+"_box_align_spacer_before",comp:{name:l,size:0}},h={id:r+"_box_align_spacer_after",comp:{name:l,size:0}};s.items.push(c),s.items.push(u),s.items.push(h);switch(f){case"center":c.comp.size="*",h.comp.size="*";break;case"end":c.comp.size="*"}var p=t["height-mode"]!==undefined?t["height-mode"]:"auto",d=parseInt(t["min-lines"],10)||0,v=parseInt(t["max-lines"],10)||0;return v>0&&v<d&&(v=d),u.layout=u.layout||{},a&&(u.layout.width=t.width!==undefined?parseInt(t.width,10):this.defaultManualWidth),!a&&o=="vertical"&&(u.layout["box-flex"]=1),u.comp.name="Label",p=="auto"?u.comp.singleLine=!1:p=="lines"&&d===0&&v===1?u.comp.singleLine=!0:p=="lines"&&(d>0||v>1)?(u.comp.name="ClippedParagraph",u.comp.minLines=d,u.comp.maxLines=v):p=="pixels"&&(u.comp.name="ClippedParagraph",u.comp.minLines=0,u.comp.maxLines=0,u.layout.height=t.height!==undefined?parseInt(t.height,10):this.defaultManualHeight),s},_isHiddenInDef:function(e){return e.hidden===!0||e.hidden==="true"},_shouldHide:function(e,t){if(this._isHiddenInDef(t))return!0;var n=e.getTypeName()=="String"&&!e.getValue()||e.getTypeName()=="wix:RichText"&&!e.getChildValue("text"),r=parseInt(t["min-lines"],10)||0;return n&&r===0},getInnerProxy:function(){return this._children&&this._children.length==3&&this._children[1]}})}),define.oldClass({name:"wixapps.integration.proxies.layout.ZoomLayoutProxy",imports:[],Class:{Extends:"wixapps.integration.proxies.layout.CssLayoutProxy",initialize:function(e,t,n,r){e&&t&&n&&this.parent(e,t,n,r)},renderZoomLayout:function(e,t){var n=this;e=e||window.innerWidth-200,t=t||window.innerHeight-82,this._element.setStyles({position:"absolute"}),this.updateLayoutWhenReady(function(){window.requestAnimFrame(function(){n._expandElements(n._element,e,t,function(){n.updateLayoutWhenReady(function(){var e=n._viewContext.getEnvironment().getEventsDispatcher();e.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),e.fireEvent(Constants.WixAppEvents.APP_ZOOM_READY)})})})})},_expandElements:function(e,t,n,r){var i,s,o=this,u=o._getExpandingElements(e)[0];u?(o._deactivateChildResizeMechanism(u),i=Math.max(parseInt(t*.5,10),parseInt(n*.5,10)),s=Math.max(parseInt(t,10),parseInt(n,10)),o._setElementSize(u,i),window.requestAnimFrame(function(){var a=e.getSize();o._setElementSize(u,s),window.requestAnimFrame(function(){var f=e.getSize(),l=o._calculateSize(u,t,n,i,a,s,f);o._approximateSize(e,u,t,n,l,0,[],function(){o._activateChildResizeMechanism(u),r&&r()})})})):(e.setStyles({"max-width":t,"max-height":n}),r&&r())},_approximateSize:function(e,t,n,r,i,s,o,u){isNaN(i)?this._finishApproximation(t,n,r,o,u):(this._setElementSize(t,i),window.requestAnimFrame(function(){var a=e.getSize();o=o.concat({containerSize:a,trialWidth:i}),s<10&&(a.x>n||a.y>r)?this._approximateSize(e,t,n,r,parseInt(i*.9,10),s+1,o,u):this._finishApproximation(t,n,r,o,u)}.bind(this)))},_finishApproximation:function(e,t,n,r,i){var s=this._chooseBestSize(r,t,n)||r[r.length-1];this._setElementSize(e,s.trialWidth),i()},_chooseBestSize:function(e,t,n){return e.filter(function(e){return e.containerSize.x<=t}).sort(function(e,t){return e.containerSize.y-t.containerSize.y})[0]},_calculateSize:function(e,t,n,r,i,s,o){var u=this._solveLinearEq(r,i.x,s,o.x),a=this._solveLinearEq(r,i.y,s,o.y),f=this._getAspectRatio(e),l;return u.a===0?l=t:f>1?l=parseInt((t-u.b)/u.a,10):l=parseInt(Math.min((t-u.b)/u.a,(n-a.b)*f),10),l},_activateChildResizeMechanism:function(e){if(e.getViewProxy){var t=e.getViewProxy();t&&t._activateResizeMechanism&&t._activateResizeMechanism()}},_deactivateChildResizeMechanism:function(e){if(e.getViewProxy){var t=e.getViewProxy();t&&t._deactivateResizeMechanism&&t._deactivateResizeMechanism(e)}},_solveLinearEq:function(e,t,n,r){var i=(r-t)/(n-e),s=t-e*i;return{a:i,b:s}},_getExpandingElements:function(e){return e.getElements("[hasproxy]").filter(this._getElementExpandProp)},_getElementExpandProp:function(e){var t=0,n=e.getViewProxy(),r=n.getViewDefinition(),i=r.getParent().getChildValue("layout");return i&&i.zoomExpand&&(t=parseFloat(i.zoomExpand)),t},_getAspectRatio:function(e){var t=1.5,n=e.getViewProxy&&e.getViewProxy();return n.getAspectRatio&&(t=n.getAspectRatio()),t},_setElementSize:function(e,t){var n=this._getAspectRatio(e);if(e.getViewProxy){var r=this._getDataSizeInfo(e.getViewProxy());r&&(t=Math.min(t,r.width))}e.setStyle("width",t);var i=e.getSize().x,s=i/n;e.setStyle("height",s)},_getDataSizeInfo:function(e){var t=e.getViewContext().getData().getValue();return"width"in t&&"height"in t?t:undefined}}}),define.oldClass({name:"wixapps.integration.proxies.layout.ZoomLayoutProxy2",imports:["wixapps.integration.utils.LayoutGeometryMap"],Class:{Extends:"wixapps.integration.proxies.layout.CssLayoutProxy",_geometryMap:null,_childProxiesWithAspectRatioCache:null,_resizableProxiesCache:null,_richContentListCache:null,_richContentProxies:["wixapps.integration.proxies.ImageProxy","wixapps.integration.proxies.VideoProxy"],initialize:function(e,t,n,r){e&&t&&n&&(this.parent(e,t,n,r),this._geometryMap=new this.imports.LayoutGeometryMap)},renderZoomLayout:function(e,t){var n=this;this._resetCaches(),e=e||window.innerWidth-200,t=t||window.innerHeight-82;var r=this._element.children[0],i=this._element.getParents('[skinpart="blockingLayer"]')[0]||this._element;this._getResizableProxies(r).each(this._deactivateChildResizeMechanism),this._limitSizeToNative(r),this._element.setStyles({position:"absolute"}),i.setStyle("overflow","hidden"),this.updateLayoutWhenReady(function(){window.requestAnimFrame(function(){n._contractContainer(r,e,t,function(){n.updateLayoutWhenReady(function(){n._getResizableProxies(r).each(n._activateChildResizeMechanism);var e=n._viewContext.getEnvironment().getEventsDispatcher();e.fireEvent(Constants.WixAppEvents.APP_VIEW_READY),e.fireEvent(Constants.WixAppEvents.APP_ZOOM_READY),i.setStyle("overflow","auto")})})})})},_resetCaches:function(){this._childProxiesWithAspectRatioCache=null,this._resizableProxiesCache=null,this._richContentListCache=null},_contractContainer:function(e,t,n,r){var i=this,s=7,o=4;i._childProxiesWithAspectRatioCache=null,i._checkContainerSizes(e,0,t,s,function(s){var u=i._findBestFit(s,t,n);i._checkContainerSizes(e,u[0].appliedWidth,u[1].appliedWidth,o,function(s){var o=i._findBestFit(s,t,n);i._setContainerWidth(e,o[0].appliedWidth),window.requestAnimFrame(function(){i._recalcChildProxiesAspectRatio(e),r()})})})},_checkContainerSizes:function(e,t,n,r,i){var s=Math.floor((n-t)/r);s===0?i([{width:t},{width:n}]):this._checkContainerSizesRecursive(e,n,s,r,[],i)},_checkContainerSizesRecursive:function(e,t,n,r,i,s){var o=this;this._setContainerWidth(e,t),window.requestAnimFrame(function(){o._recalcChildProxiesAspectRatio(e),window.requestAnimFrame(function(){o._geometryMap.updateMap(e);var u=o._geometryMap.get(e),a=i.concat({appliedWidth:t,width:u.width,height:u.height,richContentArea:o._calcRichContentArea(e,u.width,u.height),overflowCount:o._getOverflowCount(e),index:i.length});r>0?o._checkContainerSizesRecursive(e,t-n,n,r-1,a,s):s(a)})})},_findBestFit:function(e,t,n){var r=e.slice(0).sort(this._getSizeInfoCmpFunc(t,n)),i=r[0],s=i.index<e.length-1?i.index+1:i.index-1,o=e[s];return[i,o]},_getSizeInfoCmpFunc:function(e,t){var n=e/t;return function(e,r){var i=0;if(e.height>t&&r.height<=t)i=1;else if(r.height>t&&e.height<=t)i=-1;else if(i===0)if(e.height<=t&&r.height<=t){i=e.overflowCount-r.overflowCount;if(i===0)if(e.richContentArea>0&&r.richContentArea>0)i=r.richContentArea-e.richContentArea,i===0&&(i=e.width-r.width);else{var s=e.width/e.height,o=r.width/r.height;i=Math.abs(s-n)-Math.abs(o-n)}}else i=e.height-r.height,i===0&&(i=e.width-r.width);return i}},_setContainerWidth:function(e,t){e.setStyle("width",t)},_recalcChildProxiesAspectRatio:function(e){this._getChildProxiesWithAspectRatio(e).each(function(e){var t=e.getElement(),n=t.getSize(),r=Math.round(n.x/e.getAspectRatio());t.setStyle("height",r)})},_getChildProxiesWithAspectRatio:function(e){return this._childProxiesWithAspectRatioCache||(this._childProxiesWithAspectRatioCache=e.getElements("[hasproxy]").map(function(e){return e.getViewProxy()}).filter(function(e){return e.hasFixedAspectRatio()})),this._childProxiesWithAspectRatioCache},_getResizableProxies:function(e){return this._resizableProxiesCache||(this._resizableProxiesCache=e.getElements("[hasproxy]").filter(function(e){return Boolean(e.getViewProxy()._activateResizeMechanism)})),this._resizableProxiesCache},_getRichContentList:function(e){return this._richContentListCache||(this._richContentListCache=e.getElements("[hasproxy]").filter(function(e){return this._richContentProxies.contains(e.getViewProxy().getOriginalClassName())}.bind(this))),this._richContentListCache},_calcRichContentArea:function(e,t,n){var r=this;return this._getRichContentList(e).reduce(function(e,i){var s=r._geometryMap.get(i);return s.left=Math.max(0,s.left),s.right=Math.min(t,s.right),s.top=Math.max(0,s.top),s.bottom=Math.min(n,s.bottom),e+(s.right-s.left)*(s.bottom-s.top)},0)},_getOverflowCount:function(e){return e.getElements("[hasproxy]").reduce(function(t,n){return this._isOverflowElement(e,n)===!0?t+1:t}.bind(this),0)},_isOverflowElement:function(e,t){var n=t.getParents("[hasproxy]"),r=n.indexOf(e);if(r>-1)return n.slice(0,r+1).some(function(e){var n=this._geometryMap.get(e),r=this._geometryMap.get(t),i=this._isCoordIntersection(n,r);return i}.bind(this))},_isCoordIntersection:function(e,t){return!(t.left>=e.left&&t.right<=e.right&&t.top>=e.top&&t.bottom<=e.bottom)},_activateChildResizeMechanism:function(e){if(e.getViewProxy){var t=e.getViewProxy();t&&t._activateResizeMechanism&&t._activateResizeMechanism()}},_deactivateChildResizeMechanism:function(e){if(e.getViewProxy){var t=e.getViewProxy();t&&t._deactivateResizeMechanism&&t._deactivateResizeMechanism(e)}},_limitSizeToNative:function(e){var t=this,n=e.getElements("[hasproxy]").map(function(e){return{element:e,nativeSize:e.getViewProxy().getSourceSize()}}).filter(function(e){return e.nativeSize!==undefined});n.each(function(e){e.element.setStyle("max-width",e.nativeSize.width)})}}}),define.oldTrait({name:"wixapps.integration.proxies.traits.AppsLinkTrait",trait:{_updateLinkDataItems:function(e){if(this._data.getTypeName()!="wix:RichText")return;var t=this._data.getChildValue("links");for(var n=0;n<t.length;n++)W.Data.getDataByQuery("#"+t[n].linkId,function(){})||this._createWLink(t[n],e)},_updateAnchorLink:function(e,t){var n=this._createWLink(t);e.set("href",n.get("href"));var r=n.get("target");W.Viewer.isPublicMode()&&r?e.set("target",r):e.set("target",t._type.match(/^wix:(PageLink|MailLink)$/)?"_self":"_blank")},_createWLink:function(e,t){var n={type:"TextLink"};t=t||W.Data;switch(e._type){case"wix:PageLink":var r=t.getDataByQuery("#"+e.pageId,function(){});n.linkType="PAGE",n.target="_self",n.href=r?"#!"+r.get("pageUriSEO")+"/"+e.pageId:"";break;case"wix:ExternalLink":n.linkType="WEBSITE",n.target=e.target,n.href=e.protocol+"://"+e.address;break;case"wix:DocLink":n.linkType="DOCUMENT",n.href=W.Config.getServiceTopologyProperty("staticMediaUrl").replace("/media","/ugd")+"/"+e.docId,n.text=e.docName,n.target="_blank";break;case"wix:MailLink":n.linkType="EMAIL",n.target="_self",n.href="mailto:"+e.email,n.text=e.subject}var i=t.addDataItem(e.linkId,n);return i.setMeta("isPersistent",!1),i},_createAppsLink:function(e){var t=this._viewContext.getEnvironment().getDataItemFactory(),n={linkId:e.get("id")},r;switch(e.get("linkType")){case"PAGE":n._type="wix:PageLink",n.pageId=e.get("href").split("/")[1];break;case"WEBSITE":n._type="wix:ExternalLink",n.target=e.get("target"),r=e.get("href").split("://"),n.protocol=r[0],n.address=r[1];break;case"DOCUMENT":n._type="wix:DocLink",r=e.get("href").split("/"),n.docId=r[r.length-1],n.docName=e.get("text");break;case"EMAIL":n._type="wix:MailLink",n.email=e.get("href").split(":")[1],n.subject=e.get("text")}return t.createDataItem(n)},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),generateLinkId:function(e){var t=this._CHARS,n=[],r=0,i;for(var s=0;s<8;s++)r<=2&&(r=33554432+Math.random()*16777216|0),i=r&15,r>>=4,n[s]=t[s==19?i&3|8:i];var o=n.join("");return e+"_"+o}}}),define.oldTrait({name:"wixapps.integration.proxies.traits.ProxyPropertyChangeTrait",trait:{Binds:[],_propHandlers:{},_compProperties:[],initialize:function(){this._setupDefaultHandlers(),this._setupPropertyHandlers()},_handleProperty:function(e,t){this._propHandlers[e]=t},_handleProperties:function(e,t){e.forEach(function(e){this._handleProperty(e,function(){t.call(this)})}.bind(this))},_mapToCompProperty:function(e,t,n){t=t||e,this._compProperties.push({propName:e,compPropName:t,setterFunc:n}),this._handleProperty(e,function(e){this._componentLogic.setComponentProperty(t,n?n(e):e)})},_mapToCompProperties:function(e){e.forEach(function(e){this._mapToCompProperty(e)}.bind(this))},_setupPropertyHandlers:function(){},_setupDefaultHandlers:function(){this._handleProperty("name",function(e){this._goBellyUp()}),this._handleProperty("enabled",function(e){this._updateComponentState()}),this._handleProperty("style",function(e){this._updateCompStyle()}),this._handleProperty("css",function(e){this._applyCssNode(this._element)}),this._handleProperty("hidden",function(e){e=="true"||e===!0?this._element.collapse():(this._element.uncollapse(),this.updateLayoutWhenReady())}),this._handleProperty("cssClass",function(e){var t=this._cssClass;e!=t&&(this._cssClass=e,t&&this._element.removeClass(t),e&&this._element.addClass(e))})},_onDefPropertyChanged:function(e){var t,n;this._propHandlers["*"]&&this._propHandlers["*"].call(this);for(var r=0;r<e.length;r++)n=e[r].path[0],t=this._propHandlers[n],t&&t.call(this,this._def.getChildValue(n))},isHidden:function(){if(this._disposed)return!0;var e=this._def.getChildValue("hidden");return e===!0||e==="true"},_createCompProperties:function(){var e=this._getPropSchemaName(),t={};return e&&(t={type:e}),this._compProperties.forEach(function(e){var n=this._def.getChildValue(e.propName);t[e.compPropName]=e.setterFunc?e.setterFunc(n):n}.bind(this)),t},_updateCompProperties:function(e){var t=this._getPropMap(),n=this._def;e.forEach(function(e){var r=e.path[0],i=t[r];i&&this._componentLogic.setComponentProperty(i,this._processPropValue(r,n.getChildValue(r)))}.bind(this))},_processPropValue:function(e,t){return t},_getPropMap:function(){return{}},_getPropSchemaName:function(){},_updateCompStyle:function(){var e=this._def.getChildValue("style")||this._getDefaultStyleName();e&&!this.getProxyMetaTags().contains("text")&&Constants.WixApps.TEXT_STYLES[e]===undefined&&W.Theme.getStyle(e,function(e){e&&(this._componentLogic.setStyle(e),this._registerStyleChangeHandler())}.bind(this),this._getDefaultSkinName())},_updateComponentState:function(){var e=this._def.getChildValue("enabled");e!==undefined&&(e==="false"||e===!1?this._componentLogic.disable():this._componentLogic.enable())},_applyCssNode:function(e){var t=this._def.getChildValue("css");t&&this._applyStyle(e,t)},_goBellyUp:function(){this.fireEvent(Constants.WixAppEvents.PROXY_IRRECOVERABLE,{})}}}),define.oldTrait({name:"wixapps.integration.proxies.traits.WDataExchangeTrait",trait:{initialize:function(){},_convertWItemDataToRawData:function(e){var t=["metaData"],n={array:Array,object:Object},r=function(e){var i=typeOf(e);if(i=="array"||i=="object"){var s=n[i],o=e;i=="object"&&e.hasOwnProperty("_data")&&(o=e._data);var u=s.filter(o,function(e,n){return!t.contains(n)});return s.map(u,function(e){return r(e)})}return e};return r(e)},_rawDataEquals:function(e,t){return JSON.stringify(e)==JSON.stringify(t)}}}),define.dataSchema("AppBuilderComponent",{appInnerID:"string",appPartName:"string"}),define.dataSchema("AppPage",{title:"string",hideTitle:"boolean",icon:"string",windowTitle:"string",descriptionSEO:"string",metaKeywordsSEO:"string",pageTitleSEO:"string",pageUriSEO:"string",hidePage:"boolean",underConstruction:"boolean",tpaApplicationId:"number",pageSecurity:{type:"object","default":{requireLogin:!1,passwordDigest:""}},appPageId:"string",appInnerID:"number"}),define.dataSchema("AppPart",{appInnerID:"string",appLogicParams:"object",appLogicCustomizations:"array",appPartName:"string",viewName:"string"}),define.dataSchema("ClippedParagraphProperties",{minLines:{type:"number","default":0},maxLines:{type:"number","default":0},pack:{type:"string","enum":["top","bottom","middle","none"],"default":"none"},showTooltip:{type:"boolean","default":!1}}),define.dataSchema("Icon",{url:"string",width:"number",height:"number",title:"string"}),define.dataSchema("MultiSelectableList",{items:"refList",selected:"refList"}),define.skin("wixapps.integration.skins.DropTargetSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"$BorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"webThemeDir",type:"themeUrl",defaultTheme:"WEB_THEME_DIRECTORY"}]),t.html('<div skinPart="inlineContent"></div>'),t.css(["{cursor:pointer; [$BorderRadius] position:relative; [box] height:34px; line-height:34px; border:dashed 1px #A0A0A0; background:#f8f8f8; }","%inlineContent%{ margin:0px 10px 10px 10px; line-height:30px; }","%inlineContent% .disabled { opacity: 0.4; }"])}),define.skin("wixapps.integration.skins.ExpanderSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"sel",type:Constants.SkinParamTypes.OTHER,defaultValue:"-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;"}]),t.html('<div skinPart="icon"></div><div skinPart="summary" class="label"></div><div skinPart="content"></div>'),t.css(["{ width: 100%; height: 100%; }","%icon% {cursor: pointer;  height: 10px; width:10px;  display:inline-block; vertical-align: 50%; margin-right: 5px}",'[state="collapsed"] > %icon% { background: transparent url([tdr]arrow-left.png) no-repeat; }','[state="expand"] > %icon% { background: transparent url([tdr]arrow-down.png) no-repeat; }',"%summary% { display:inline-block; cursor: pointer; [sel]; width: 90%}",'[state="collapsed"] > %content% { display: none;}','[state="expand"] > %content% { display: block; margin-top: 3px;}'])}),define.oldSkin({name:"wixapps.integration.skins.IconSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_html:'<img skinPart="img"></img>',_css:[]}}),define.skin("wixapps.integration.skins.LinkSelectorSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"}]),t.html('<p skinPart="description"></p>'),t.css(["%description% { background:transparent url([baseThemeDir]wix_apps/link-selector-button.png) left center no-repeat; cursor:pointer; padding-bottom: 3px; padding-left:20px; min-width:1px; min-height:16px; }"])}),define.skin("wixapps.integration.skins.TextAreaSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.3"}]),t.html('<div class="clearfix"><label skinpart="label"></label><textarea skinpart="input" ></textarea><div skinpart="message"></div></div>'),t.css(["%.clearfix% {height:100%}","%input% {width:100%; height:100%; padding:12px; line-height: 1.3em;  font-size:1em; border: 1px solid #e3e3e3; box-shadow: 0 1px 1px 0 [shadowColor] inset;}","%input%:hover{border-color: #a3d9f6; }","%input%:focus{border-color: #19a0e9; }",'[state~="hasLabel"] %label% {display:block; padding-bottom: 5px;}',"[disabled] %label% {opacity:0.5}",'[state~="invalid"] input%input%{background: #f6e0dd; border-color: #de4c3a}','[state~="invalid"] %message% {color: #de4c3a; font-size: .916em;}',"input%input%.isPlaceholder{color: #999;}"])}),define.skin("wixapps.integration.skins.ToggleSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"tdr",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"},{id:"sel",type:Constants.SkinParamTypes.OTHER,defaultValue:"-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;"}]),t.html('<div skinPart="on" class="label"></div><div skinPart="off"></div>'),t.css(["{ width: 100%; height: 100%; }",'[state="on"] > %off% { display: none;}','[state="off"] > %off% { display: block; margin-top: 3px; cursor: pointer; } ','[state="on"] > %on% { display: block; margin-top: 3px; cursor: pointer; }','[state="off"] > %on% { display: none;}'])}),define.skin("wixapps.integration.skins.dialogs.AddFieldDialogSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"}]),t.compParts({nameYourFieldInput:{skin:"wysiwyg.editor.skins.inputs.InputSkin"},positionYourFieldInput:{skin:"wysiwyg.editor.skins.inputs.ComboBoxSkin"}}),t.html('<div class="clearfix"><div class="compsPerFieldTypeLayout"><strong skinPart="contentLabel"></strong><div skinPart="content"><strong class="sectionTitle"></strong></div></div><div class="previewContainer"><div class="preview"><div skinPart="fieldDescription"></div></div><div skinPart="newFieldSettings"><div skinPart="nameYourFieldContainer"><label skinPart="nameYourFieldLabel"></label><div skinPart="nameYourFieldInput"></div></div><div skinPart="positionYourFieldContainer"><label skinPart="positionYourFieldLabel"></label><div skinPart="positionYourFieldInput"></div></div></div></div></div>'),t.css(["{position: relative;}","%.compsPerFieldTypeLayout% {float:left; width:160px;}","%contentLabel% {line-height:22px;}","%content% {overflow:auto; height:200px; margin-bottom: 5px; background-color:white; border:1px solid #b4b4b4; border-top:1px solid #ccc; [borderRadius]; padding:4px 15px 10px 15px}","%content%:hover{border-color: #a3d9f6; }","%content% .sectionTitle{ display: block; line-height: 20px; color: #4c4c4c; padding-top:6px;}","%fieldDescription% {padding:10px 20px 0}","%.previewContainer% {float:left; margin-left: 0px; padding-top: 19px; width:318px;}","%.preview% {text-align:left; margin:0 auto; max-height: 280px;}","%newFieldSettings% { }","%nameYourFieldContainer% {padding:10px 20px 0;}","%positionYourFieldContainer% {padding:10px 20px 0;}","%nameYourFieldLabel% {line-height:22px;}","%positionYourFieldLabel% {line-height:22px;}","%nameYourFieldInput% {padding-top:5px}"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDataPanelSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"noShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 0 0 #000"},{id:"$panelBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 0 5px 0"},{id:"$closeBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"$topBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"innerPanelMaxHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"550px"},{id:"panelWidth",type:Constants.SkinParamTypes.OTHER,defaultValue:"300px"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="topBar"><div skinPart="panelIcon"></div><strong skinPart="panelLabel"></strong><div skinPart="help" class="help"><span>&nbsp;</span></div><div skinPart="close"><span>&nbsp;</span></div></div><div skinPart="panelDescription"></div><div skinPart="inlineContent"></div>'),t.css(["{background:#f7f7f7; width:[panelWidth]; [$panelBorderRadius] [noShadow]}","[state=expanded] { [$contentAreaShadow] }","%topBar% {width:100%; height:40px; [$topBorderRadius]; border-bottom:1px solid #dddddd; cursor:move; position:relative}","[state=expanded] %panelIcon% {position:absolute; top:0; left:0; height:40px; width:40px; background:url([webThemeDir]lists/appbuilder_sprite.png) -144px -10px no-repeat; cursor:pointer; }","[state=expanded] %panelIcon%:hover {background:url([webThemeDir]lists/appbuilder_sprite.png) -244px -10px no-repeat;}","[state=expanded] %panelIcon%:active {background:url([webThemeDir]lists/appbuilder_sprite.png) -194px -10px no-repeat;}","[state=collapsed] %panelIcon% {position:absolute; top:0; left:0; height:40px; width:40px; background:url([webThemeDir]lists/appbuilder_sprite.png) -194px -10px no-repeat; cursor:pointer; }","[state=collapsed] %panelIcon%:hover {background:url([webThemeDir]lists/appbuilder_sprite.png) -244px -10px no-repeat;}","[state=collapsed] %panelIcon%:active {background:url([webThemeDir]lists/appbuilder_sprite.png) -144px -10px no-repeat;}","%panelLabel% {display:inline-block; font-size:[titleFontSize]; padding:0 0 0 8px; overflow:hidden; margin: 0 40px; text-overflow:ellipsis; width:180px; height:40px; line-height:40px; }","%panelDescription% {font-size: 14px; padding:15px; line-height:1.2em; border-top:1px solid #fff; color:#444}","%close% {position:absolute; top:1px; right:0; height:38px; width:34px; border-left:1px solid #ccc; cursor:pointer; [$closeBorderRadius]}",'%close% span {position:absolute; left:8px; top:11px; width:15px; height:15px; display:block; background:url("[webThemeDir]icons/top-bar-icons.png") 0 0 no-repeat}',"%close%:hover span {background-position:0 -140px}","%.help% {width:35px; height:38px; position:absolute; right:35px; top:1px; cursor:default;}","%.help% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:11px; cursor:pointer}","%.help% span:hover { background-position: 0 -16px}","%.help% span:active { background-position: 0 -33px}","%inlineContent% { top:10px; padding:0; }"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDialogExpandablePanelSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"noShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 0 0 #000"},{id:"$panelBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 0 0 5px"},{id:"$closeBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"$topBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"innerPanelMaxHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"550px"},{id:"innerPanelMinHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"150px"},{id:"panelWidth",type:Constants.SkinParamTypes.OTHER,defaultValue:"300px"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="topBar"><div class="topBarActions"></div><h4 skinPart="panelLabel"></h4></div><div skinPart="panelDescription"></div><div skinPart="inlineContent"></div>'),t.css(["{background:#f7f7f7; width:[panelWidth]; height:600px; [$panelBorderRadius] [$contentAreaShadow] position:relative; }","%topBar% {width:100%; height: 40px; [$topBorderRadius]; border-bottom:1px solid #dddddd; cursor:move;}","%panelLabel% {display:block; font-size:[titleFontSize]; padding:0 12px; margin-left: 8px; width:200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; height:40px; line-height:40px; }","%panelDescription% {font-size: 14px; margin:21px 15px; line-height:1.2em; border-top:1px solid #fff; color:#444; height:34px; overflow-y:auto; }","%.topBarActions% {position:absolute; width:100%; right:0; top:0; [$BorderTopRightRadius]}","%.panelIcon% {position:absolute; top:0; left:0; height:40px; width:36px; background:url([webThemeDir]lists/appbuilder_sprite.png) -84px -10px no-repeat; border-right:1px solid #ccc; cursor:pointer; [$closeBorderRadius]}","%.panelIcon%:hover {background:#ddd url([webThemeDir]lists/appbuilder_sprite.png) -24px -10px no-repeat;}","%inlineContent% { padding-bottom:25px; margin: 0 0 35px 0; font-size: 12px; line-height: 1.2em;}"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDialogPanelSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"$panelBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 0 5px 0"},{id:"$closeBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"$topBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0 5px 0 0"},{id:"innerPanelMaxHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"550px"},{id:"innerPanelMinHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"150px"},{id:"panelWidth",type:Constants.SkinParamTypes.OTHER,defaultValue:"300px"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="topBar"><strong skinPart="panelLabel"></strong><div skinPart="help" class="help"><span>&nbsp;</span></div><div skinPart="close"><span>&nbsp;</span></div></div><div skinPart="panelDescription"></div><div skinPart="inlineContent"></div>'),t.css(["{background:#f7f7f7; width:[panelWidth]; [$panelBorderRadius] [$contentAreaShadow]}","%topBar% {width:100%; height:40px; [$topBorderRadius]; border-bottom:1px solid #dddddd; cursor:move; position:relative}","[state=expanded] %panelIcon% {position:absolute; top:0; left:0; height:40px; width:40px; background:url([webThemeDir]lists/appbuilder_sprite.png) -144px -10px no-repeat; cursor:pointer; }","%panelLabel% {display:inline-block; font-size:[titleFontSize]; padding:0 0 0 8px; overflow:hidden; margin: 0 40px 0 0; text-overflow:ellipsis; width:180px; height:40px; line-height:40px; }","%panelDescription% {font-size: 14px; margin:21px 15px; line-height:1.2em; border-top:1px solid #fff; color:#444; height:58px; overflow-y:auto; }","%close% {position:absolute; top:1px; right:0; height:38px; width:34px; border-left:1px solid #ccc; cursor:pointer; [$closeBorderRadius]}",'%close% span {position:absolute; left:8px; top:11px; width:15px; height:15px; display:block; background:url("[webThemeDir]icons/top-bar-icons.png") 0 0 no-repeat}',"%close%:hover span {background-position:0 -140px}","%.help% {width:35px; height:38px; position:absolute; right:35px; top:1px; cursor:default;}","%.help% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:11px; cursor:pointer}","%.help% span:hover { background-position: 0 -16px}","%.help% span:active { background-position: 0 -33px}","%inlineContent% { top:10px; padding:0 0 0 12px; margin: 0 0 35px 0; font-size: 12px; line-height: 1.2em; }"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderDialogWindowSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"26px"},{id:"nameFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"14px"},{id:"appIconHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"50px"}]),t.html('<div class="z-dialog" skinPart="blockLayer"></div><div class="z-dialog" skinPart="dialogBox"><div class="dialogLayout"><div class="z-dialog" skinPart="dragArea"></div><strong skinPart="dialogTitle"></strong><span skinPart="dialogSubTitle"></span><div skinPart="dialogDescription"></div><div skinPart="helplet"></div><div skinPart="xButton"><div skinPart="x"></div></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="buttonContainer" class="buttons"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),t.css(["{ position:relative; }","%dialogTitle% {display:none;}","%dialogSubTitle% {display:none;}","%dialogDescription% {display:none;}","%xButton% {display:none;}","%x% {display:none;}","%helplet% {display:none;}","%buttonContainer% {display:none;}","%.tabs% { height:42px; position:relative; display:none; }",".tab {height:22px; padding-top:10px; margin-right:3px; width:135px; float:left; border: solid 1px #dedede; border-bottom:none; background:#fff; color:#4c4c4c; text-align:center; [tabRadius] cursor:pointer;  }",".selectedTab { background:#7d53db; border-color:#7d53db; color:#fff; cursor:default; }"])}),define.skin("wixapps.integration.skins.dialogs.AppBuilderManageDialogSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"10px 10px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"overBorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"tabsShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 50px  rgba(0, 0, 0, 0.5)"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"26px"},{id:"nameFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"14px"},{id:"appIconHeight",type:Constants.SkinParamTypes.OTHER,defaultValue:"50px"},{id:"transTabs",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"width 0.7s ease 0s"},{id:"transPanel",type:Constants.SkinParamTypes.TRANSITION,defaultValue:"left 0.7s ease 0s"}]),t.compParts({manageItemsPane:{skin:"wixapps.integration.skins.dialogs.AppBuilderDialogExpandablePanelSkin"},itemDataPane:{skin:"wixapps.integration.skins.dialogs.AppBuilderDataPanelSkin"},customizeItemTemplatePane:{skin:"wixapps.integration.skins.dialogs.AppBuilderDialogPanelSkin"}}),t.html('<div class="shadow left"></div><div class="shadow right"></div><div skinPart="manageItemsPane" class="panel"></div><div skinPart="customizeItemTemplatePane" class="panel"></div><div skinPart="itemDataPane" class="panel"></div><div skinPart="tabs"><div rel="dataPane" class="tab selectedTab">Tab A</div><div rel="templatePane" class="tab">Tab B</div></div>'),t.css(["{ position:relative; }","%.panel% { position:absolute; top:42px; height:600px; width:300px; }","%.shadow% { height:42px; width:135px; position:absolute; top:0; left:0; [tabsShadow] [tabRadius] }","%.right% { left:140px; }","%tabs% { height:42px; position:absolute; top:0; left:0; [transTabs] }","[state*=expanded] %tabs% { width:600px; }","[state*=collapsed] %tabs% { width:300px;}",'[state*=dataPane]  %tabs%:before {content:""; position:absolute; bottom:0; right:0; left:0; height:10px; [$closeRadius]  background:#7d53db url([webThemeDir]lists/appbuilder_sprite.png) left 6px repeat-x; }'," .tab {height:22px; padding-top:10px; margin-right:3px; width:135px; float:left; border: solid 1px #7d53db; border-bottom:none; background:#fff; color:#000; text-align:center; [tabRadius] cursor:pointer;  }"," .tab:hover { color:#09f;}"," .selectedTab,  .selectedTab:hover { background:#7d53db; border-color:#7d53db; color:#fff; cursor:default; }","[state*=templatePane] %tabs% { width:300px; }",'[state*=templatePane]  %tabs%:before {content:""; position:absolute; bottom:0; left:0; width:300px; height:10px; [$closeRadius]  background:#7d53db url([webThemeDir]lists/appbuilder_sprite.png) left 6px repeat-x; }',"[state*=templatePane] %manageItemsPane% {display: none; }","[state*=templatePane] %itemDataPane% {display: none;}","[state*=templatePane] %customizeItemTemplatePane% {display: inline-block;}","[state*=dataPane] %manageItemsPane% {}","[state*=dataPane][state*=expanded] %itemDataPane% { left:300px; [transPanel] }","[state*=dataPane][state*=collapsed] %itemDataPane% {left:0; [transPanel] }","[state*=dataPane] %customizeItemTemplatePane% {display:none;}"])}),define.skin("wixapps.integration.skins.dialogs.ChooseTemplateDialogWindowSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$blockBg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"0,0,0,0.5"},{id:"$tabRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 0 0"},{id:"$closeRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 5px 0 0"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px 5px 5px 5px"},{id:"$borderRadiusBottom",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px 0px 5px 5px"},{id:"$contentAreaShadow",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"-3px 0 50px #000"},{id:"titleFontSize",type:Constants.SkinParamTypes.OTHER,defaultValue:"16px"}]),t.html('<div skinPart="blockLayer"></div><div skinPart="dialogBox"><div class="dialogLayout"><div skinPart="dragArea"></div><strong skinPart="dialogTitle"></strong><div class="dialogDescriptionWrapper"><div skinPart="dialogDescription"></div><div skinPart="helplet"></div></div><div skinPart="xButton"><div skinPart="x"></div></div><div class="dialogToolbar clearfix" skinPart="dialogToolbar"><div class="tabs" skinPart="tabs"></div></div><div class="dialogContent clearfix" skinPart="innerDialog"></div><div skinPart="buttonContainer"><div skinPart="cancelContainer" class="leftButton"></div><div skinPart="okContainer" class="rightButton"></div></div></div></div>'),t.css(["{position:absolute;width:850px;height:100%;}","%.dialogLayout% {background:#fdfdfd; padding-bottom: 10px; [$borderRadius] [$contentAreaShadow]}","[state~=modal]      %blockLayer% {[$blockBg]; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1; }","[state~=nonModal]   %blockLayer% {display:none}","[state~=semiModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","[state~=transparentModal]  %blockLayer% {background: url([webThemeDir]transparent.gif) repeat; display:block; position:fixed; top:0; bottom:0; left:0; right:0; visibility:visible; zoom:1;}","%dragArea%{position:absolute; left:0px; top:0px; height:34px; width:85%; cursor:move; background: url([webThemeDir]transparent.gif) repeat;}","[state~=modal] %dragArea%{cursor: default}","%dialogBox% {position:relative; zoom:0; top:0px; left:0px;}","%xButton% {position:absolute; top:0; right:0; width:34px; height:34px; cursor:pointer; border-left:1px solid #ccc; [$closeRadius]}","%xButton%:hover {background:#ddd;}","%xButton%:hover %x% {background-position:50% -140px;}","%x% {background:url([webThemeDir]icons/top-bar-icons.png) 50% 0; width:16px; height:16px; position:absolute; top: 50%; left: 50%; margin: -8px 0 0 -8px; }","%xButton%[disabled]:hover{cursor: default; background:none;}","%xButton%[disabled] %x%{cursor: default; background-position:50% 0; opacity: .5;}","%buttonContainer% {clear:both; overflow:hidden; padding:15px 10px 5px; background:#fdfdfd; [$borderRadiusBottom]}","%buttonContainer% .leftButton {float:left;}","%buttonContainer% .rightButton {float:right;}","%buttonContainer% .rightButton >div {float:right;margin-left:5px;}","%dialogTitle% {font-size:[titleFontSize]; display:block; padding:0 20px; border-bottom:1px solid #ccc; line-height:34px; }","%.dialogDescriptionWrapper% {border-top:1px solid #fff; padding:20px 45px}","%dialogDescription% {margin-bottom:4px;}","%helplet% {margin-top:10px; cursor:pointer; color:#09f; font-size:90%; }","%helplet%:hover {text-decoration:underline}","[state~=topHelpLocation] %helplet%{position:absolute;right:32px;top:12px;}","%.dialogToolbar% .tabs {top:1px; left:1px; height:45px; margin:0 10px 0; position:relative}","%.dialogToolbar% .tab {font-size:12px; padding:15px 25px; margin-top:1px; margin-right:3px; float:left; position:relative; cursor:pointer; border:1px solid #ccc; border-bottom:none; [$tabRadius]}","%.dialogToolbar% .selectedTab {background-color:#fdfdfd; border-bottom:none;position:relative;top:1px; font-weight:bold;}","%.dialogToolbar% .controlBtn {float:right;margin-top:8px; margin-right:10px}","%innerDialog% {margin:1px 11px 0; overflow:hidden;}","%helpButton% {position:absolute; top:0; right:35px; width:35px; height:35px; cursor:pointer;}","%helpButton%:hover {background:#ddd;}","%helpButton% span {background:url([webThemeDir]icons/help_sprite.png) no-repeat 0 1px; width:19px; height:18px; position:absolute; right:8px; top:10px; cursor:pointer}","%helpButton% span:hover { background-position: 0 -16px}","%helpButton% span:active { background-position: 0 -33px}"])}),define.skin("wixapps.integration.skins.dialogs.InputGroupSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"$BorderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"webThemeDir",type:"themeUrl",defaultTheme:"WEB_THEME_DIRECTORY"}]),t.html('<div skinPart="inlineContent"></div>'),t.css(["{ height:30px; border:1px solid #c8e5f7; border-top-color:#bfdbf0; [$BorderRadius]}","%inlineContent%{ margin:0px 10px 10px 10px; line-height:30px; }"])}),define.skin("wixapps.integration.skins.ecommerce.inputs.ComboBoxInputSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams(),t.html('<select skinpart="collection"></select>'),t.css(["{position:relative;}",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center;bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px;color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:"►"; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.skin("wixapps.integration.skins.ecommerce.inputs.TextAreaInputSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"box",type:Constants.SkinParamTypes.OTHER,defaultValue:"box-sizing:border-box; -webkit-box-sizing:border-box -moz-box-sizing:border-box;"},{id:"bg",type:Constants.SkinParamTypes.BG_COLOR,defaultValue:"#ffffff",enableEdit:!0},{id:"brd",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#e3e3e3",enableEdit:!0},{id:"brw",type:Constants.SkinParamTypes.SIZE,defaultValue:"1px"},{id:"brdh",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#a3d9f6",enableEdit:!0},{id:"brdf",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"#19a0e9",enableEdit:!0},{id:"txt",type:Constants.SkinParamTypes.COLOR,defaultValue:"#000000",enableEdit:!0},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"0px"}]),t.html('<textarea skinPart="textarea"></textarea><p skinPart="errorMessage"></p>'),t.css(["{ position:relative;}","%textarea% {text:[txt] [box] [bg] [rd] resize: none; width:100%  !important; min-height:100px; height:100%; overflow:auto; font-size:14px; border:[brw] solid [brd]; box-shadow: 0 1px 1px 0 rgba(0,0,0,.3) inset; }","%textarea%:hover {border-color: [brdh]; }","%textarea%:focus {border-color: [brdf]; }",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center; bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px; color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:"►"; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.skin("wixapps.integration.skins.ecommerce.options.ColorOptionSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams(),t.html('<div skinPart="tooltip" skin="wixapps.integration.skins.ecommerce.options.InfoTipSkin"></div><div class="olo"></div>'),t.css(["%.olo% { height:20px; position:relative; }",'[state~="selected"] %.olo%:after { content:"▼"; position:absolute; left:50%; bottom:-10px; margin-left:-6px; color:#444; font-weight:bold; font-size:12px; font-family:Arial; line-height:1;  }','[state~="disabled"] { display:none; }',"%tooltip%           { min-width:100px !important; margin:-4px 0 0 14px; font-size:12px; text-transform:uppercase; text-align:center; }",'%tooltip%:after     { content:"▼"; position:absolute; left:50%; bottom:-10px; margin-left:-6px;  color:#fffedf; font-size:12px; font-family:Arial; line-height:1; text-shadow:0 1px 2px rgba(0, 0, 0, 0.5); }'])}),define.skin("wixapps.integration.skins.ecommerce.options.InfoTipSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"bgcolor",type:Constants.SkinParamTypes.OTHER,defaultValue:"#fffedf"},{id:"txtcolor",type:Constants.SkinParamTypes.OTHER,defaultValue:"#656565"},{id:"fnt",type:Constants.SkinParamTypes.OTHER,defaultValue:'font-family: "Helvetica Neue", Helvetica, Arial,sans-serif; font-size:12px; line-height:16px; '},{id:"shd",type:Constants.SkinParamTypes.BOX_SHADOW,defaultValue:"0 1px 4px rgba(0, 0, 0, 0.6);"},{id:"rd",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"5px"},{id:"max",type:Constants.SkinParamTypes.OTHER,defaultValue:"min-height:10px; min-width:10px; max-width:300px;"}]),t.html('<div class="toolTipContainer"><p skinPart="content"></p></div>'),t.css(["{  [fnt][rd][shd][max] color:[txtcolor]; background:[bgcolor]; position:absolute;  padding:5px; top:0px; left: 0px;}","p {display:block; margin:0 0 5px 0; }","strong, b, i, big { font-size:12px; }",'[state~="hidden"] {visibility:hidden!important;}'])}),define.oldSkin({name:"wixapps.integration.skins.ecommerce.options.OptionsListInputSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_params:[],_html:"",_css:["{position:relative;}"," > div { border:1px solid #444; display:inline-block; min-width:26px; line-height:20px; height:20px; margin:0 3px; text-align:center; text-transform:uppercase; cursor:pointer; }"," > div:first-child { margin-left:0; }"," > div:last-child { margin-right:0; }",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center;bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px;color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:"►"; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }']}}),define.oldSkin({name:"wixapps.integration.skins.ecommerce.options.TextOptionSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_params:[],_html:'<div skinPart="tooltip" skin="wixapps.integration.skins.ecommerce.options.InfoTipSkin"></div><div skinPart="size"/>',_css:["{ background:#fff;  }","%size% {  position:relative; }",'[state~="selected"] %size%:after { content:"▼"; position:absolute; left:50%; bottom:-10px; margin-left:-6px; color:#444; ont-weight:bold; font-size:12px;  font-family:Arial; line-height:1;  }','[state~="disabled"] { display:none; }',"%tooltip%           { min-width:100px !important; margin:-4px 0 0 14px; font-size:12px; text-transform:uppercase; text-align:center; }",'%tooltip%:after     { content:"▼"; position:absolute; left:50%; bottom:-10px; margin-left:-6px;  color:#fffedf; font-size:12px; font-family:Arial; line-height:1; text-shadow:0 1px 2px rgba(0, 0, 0, 0.5); }']}}),define.skin("wixapps.integration.skins.inputs.ComboBoxInputSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"webThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"WEB_THEME_DIRECTORY"},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"4px"},{id:"borderColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#c4c4c4"},{id:"borderColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#89a4af"},{id:"bgColor",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f9fafc"},{id:"bgColorOver",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f2f3f5"},{id:"bgColorPressed",type:Constants.SkinParamTypes.COLOR,defaultValue:"#f3f3f3"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.2"},{id:"shadowInsetColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.7"},{id:"shadowInsetColorOver",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"255,255,255,.7"}]),t.html('<select skinpart="collection"></select>'),t.css(['::after{content: "▾"; position: absolute;right: 3px ;top: 2px; color:#3095CB; font-size:25px;}',"%collection% {width: 200px; border: none; -webkit-appearance: none; background-color: transparent; padding: 5px;  cursor:pointer;}","{width:200px; border: 1px solid [borderColor]; [$borderRadius] background:[bgColor] url([webThemeDir]button/button-gradient.png) repeat-x 0 50%; position:relative; text-align:center;}",":hover {border:1px solid [borderColorOver]; background:[bgColorOver] none; box-shadow:0 2px 3px 0 [shadowColor], 0 1px 2px 0 [shadowInsetColorOver] inset; }",'[state~="invalid"]:before { content:"!"; position:absolute; text-align:center;bottom:50%; left:-20px; width:20px; height:20px; line-height:20px !important; margin-bottom:-11px;color:#fff; background:#f00; border:2px solid #fff; border-radius:50%; box-shadow:0 1px 3px rgba(0, 0, 0, 0.5); font-size:12px; font-weight:bold; }','[state~="invalid"]:after { content:"►"; position:absolute; bottom:50%; left:3px; margin:0 0 -7px -2px;color:#fff; text-shadow:1px 1px 3px rgba(0, 0, 0, 0.5); font-size:10px; }'])}),define.oldSkin({name:"wixapps.integration.skins.inputs.InlineTextInputSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_tags:[],_params:[],_html:'<div><div skinpart="preview"></div><input skinpart="input" type="text"></div></div>',_css:['[state~="preview"] %input% { display: none; }','[state~="input"] %preview% { display: none; }',"%preview%:hover { border:1px solid #C3C3C3; padding:1px 3px; }"]}}),define.skin("wixapps.integration.skins.inputs.LocationSelectorSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"baseThemeDir",type:Constants.SkinParamTypes.URL,defaultTheme:"BASE_THEME_DIRECTORY"}]),t.html('<div class="clearfix"><div skinpart="container"><input skinpart="address" type="text" /><div skinpart="viewMode"></div></div><div skinpart="message"></div></div>'),t.css(["%container% { height:30px; line-height:30px; padding-right:35px; position:relative; }","%address% { width:100% }","%viewMode% { width:30px; height:30px; position:absolute; right:0px; top:0px; }",'[state~="loading"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/loading.gif) center center no-repeat; }','[state~="error"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/icon_x.png) center center no-repeat; }','[state~="found"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/icon_v.png) center center no-repeat; }','[state~="search"] %viewMode% { background:transparent url([baseThemeDir]wix_apps/spy_glass.png) center center no-repeat; cursor:pointer; }','[state~="invalid"] %message% { height:20px; line-height:20px; color:#d00; font-size:12px; }'])}),define.skin("wixapps.integration.skins.inputs.RichTextEditorSkin",function(e){var t=e;t.inherits("mobile.core.skins.BaseSkin"),t.skinParams([{id:"f0",type:"cssFont",defaultTheme:"font_0",name:"",usedInLogic:!0},{id:"f1",type:"cssFont",defaultTheme:"font_1",name:"",usedInLogic:!0},{id:"f2",type:"cssFont",defaultTheme:"font_2",name:"",usedInLogic:!0},{id:"f3",type:"cssFont",defaultTheme:"font_3",name:"",usedInLogic:!0},{id:"f4",type:"cssFont",defaultTheme:"font_4",name:"",usedInLogic:!0},{id:"f5",type:"cssFont",defaultTheme:"font_5",name:"",usedInLogic:!0},{id:"f6",type:"cssFont",defaultTheme:"font_6",name:"",usedInLogic:!0},{id:"f7",type:"cssFont",defaultTheme:"font_7",name:"",usedInLogic:!0},{id:"f8",type:"cssFont",defaultTheme:"font_8",name:"",usedInLogic:!0},{id:"f9",type:"cssFont",defaultTheme:"font_9",name:"",usedInLogic:!0},{id:"f10",type:"cssFont",defaultTheme:"font_10",name:"",usedInLogic:!0},{id:"$borderRadius",type:Constants.SkinParamTypes.BORDER_RADIUS,defaultValue:"3px"},{id:"shadowColor",type:Constants.SkinParamTypes.COLOR_ALPHA,defaultValue:"0,0,0,.1"}]),t.html('<div skinPart="frame"><div skinPart="richTextContainer" class="richTextContainer"></div></div>'),t.css(["%frame% { [$borderRadius]; border: 1px solid #b4b4b4; box-shadow: 0 1px 1px 0 [shadowColor] inset; padding:2px }","%richTextContainer% { position:relative; width:100%; height:100%; overflow-y:auto; word-wrap: break-word; }"])}),define.oldSkin({name:"wixapps.integration.skins.inputs.TextLinkSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_tags:[],_params:[{id:"f0",type:"cssFont",defaultTheme:"font_0",name:"",usedInLogic:!0},{id:"f1",type:"cssFont",defaultTheme:"font_1",name:"",usedInLogic:!0},{id:"f2",type:"cssFont",defaultTheme:"font_2",name:"",usedInLogic:!0},{id:"f3",type:"cssFont",defaultTheme:"font_3",name:"",usedInLogic:!0},{id:"f4",type:"cssFont",defaultTheme:"font_4",name:"",usedInLogic:!0},{id:"f5",type:"cssFont",defaultTheme:"font_5",name:"",usedInLogic:!0},{id:"f6",type:"cssFont",defaultTheme:"font_6",name:"",usedInLogic:!0},{id:"f7",type:"cssFont",defaultTheme:"font_7",name:"",usedInLogic:!0},{id:"f8",type:"cssFont",defaultTheme:"font_8",name:"",usedInLogic:!0},{id:"f9",type:"cssFont",defaultTheme:"font_9",name:"",usedInLogic:!0},{id:"f10",type:"cssFont",defaultTheme:"font_10",name:"",usedInLogic:!0}],_html:'<p skinPart="richTextContainer" class="richTextContainer"></p>',_css:["%richTextContainer% { position:relative; cursor:pointer; color:#09f; width:100%; height:100%; word-wrap: break-word; }","%richTextContainer% span { color:#09f; }","%richTextContainer%:hover span { text-decoration:underline }"]}}),define.oldSkin({name:"wixapps.integration.skins.inputs.TimeInputSkin",Class:{Extends:"mobile.core.skins.BaseSkin",_tags:[],_params:[],_html:'<div class="clearfix"><select skinpart="hours24"></select><select skinpart="hours12"></select><select skinpart="minutes"></select><select skinpart="seconds"></select><select skinpart="ampm"></select><div skinpart="message"></div></div>',_css:['[state~="24h"] %hours24% { display: inline; }','[state~="24h"] %hours12% { display: none; }','[state~="24h"] %ampm% { display: none; }','[state~="12h"] %hours24% { display: none; }','[state~="12h"] %hours12% { display: inline; }','[state~="12h"] %ampm% { display: inline; }','[state~="hours"] %minutes% { display: none; }','[state~="hours"] %seconds% { display: none; }','[state~="half-hour"] %seconds% { display: none; }','[state~="quarter-hour"] %seconds% { display: none; }','[state~="minutes"] %minutes% option { display: inline; }','[state~="minutes"] %seconds% { display: none; }','[state~="allowEmpty"] option.empty { display: inline; }','[state~="hideEmpty"] option.empty { display: none; }',"%message% { visibility:hidden; height:20px; line-height:20px; color:#d00; font-size:12px; }",'[state~="invalid"] %message% { visibility:visible; }']}}),define.oldTrait({name:"wixapps.integration.utils.FlexBoxIESupport",trait:{Binds:["_ie_recalcFlexes","_ie_onAppPartResize","_ie_resizeHandler"],Static:{_boxProxies:[]},initialize:function(){},_boxFlexes:[],_boxFlexList:[],_ie_boxAlignCssMap:{vertical:{start:"left",center:"center",end:"right"},horizontal:{start:"top",center:"middle",end:"bottom",baseline:"baseline"}},applyIESupport:function(){this._applyDisplayStyle=this._ie_applyDisplayStyle,this._processBoxFlex=this._ie_processBoxFlex,this._finalizeLayout=this._ie_recalcFlexes,this._ie_replaceResizeEventMechanism(this._element),Array.forEach(this._element.children,function(e){this._ie_replaceResizeEventMechanism(e)}.bind(this)),this._registerResizeListeners();var e=this._getParentBoxProxies();e.length===0&&(this.addEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._ie_onAppPartResize),this._finalizeLayout=this._ie_onAppPartResize),window._boxProxies=window._boxProxies||[],window._boxProxies.push({proxy:this,depth:e.length})},_ie_replaceResizeEventMechanism:function(e){e.onresize||(e.onresize=function(){e.fireEvent("resize")})},_ie_onAppPartResize:function(){if(this._element){var e=window._boxProxies.sort(function(e,t){return e.depth-t.depth});e.reverse().forEach(function(e){e.proxy._ie_onResize()}),e.forEach(function(e){e.proxy._ie_onResize()})}},_registerResizeListeners:function(){this._element.addEvent("resize",this._ie_resizeHandler),Array.forEach(this._element.children,function(e){e.addEvent("resize",this._ie_resizeHandler)}.bind(this))},_ie_resizeHandler:function(){this._ie_onResize()},_ie_onResize:function(){this._element&&(this._orientation==="horizontal",this._ie_recalcFlexes())},_ie_applyDisplayStyle:function(e,t){var n=e=="horizontal"?"inline-block":"block",r=e=="horizontal"?"height":"width",i={display:n},s=this._def.getChildValue("box-align"),o=s?this._translateBoxAlignValues(e,s):"start";e==="horizontal"?i["vertical-align"]=this._ie_boxAlignCssMap[e][o]:i["text-align"]=this._ie_boxAlignCssMap[e][o],this._applyToChildren(function(e){e.setStyles(i)}),r==="height"&&o=="start"&&this._ie_stretchChildrenVertically()},_ie_resetChildrenToStretch:function(){this._childrenToStretch&&this._childrenToStretch.forEach(function(e){e.style.height="",e.style["min-height"]="0"})},_ie_stretchChildrenVertically:function(){var e=this._element.getSize().y;this._ie_resetChildrenToStretch(),e>0&&(this._childrenToStretch=this._ie_getChildrenToStretch(),this._ie_getChildrenToStretch().forEach(function(t){t.setStyle("min-height",e-2),t.setStyle("height","100%")}.bind(this)))},_ie_getChildrenToStretch:function(){return Array.filter(this._element.children,function(e){return!e.style.height})},_ie_processBoxFlex:function(e,t){t["box-flex"]!==undefined&&!this._boxFlexList.contains(e)&&(this._element.setStyle("white-space","nowrap"),t["white-space"]===undefined&&(t["white-space"]="normal"),this._boxFlexList.push(e),this._boxFlexes.push({element:e,flex:t["box-flex"]})),delete t["box-flex"]},_applyToChildren:function(e){for(var t=0;t<this._element.children.length;t++)e.call(this,this._element.children[t],t,this._element.children.length)},_ie_recalcFlexes:function(){var e=0,t=0,n=0,r=0,i;this._applyToChildren(function(t){this._boxFlexList.contains(t)||(e+=this._getSize(t,!0))}.bind(this)),t=this._getSize(this._element,!1)-e,this._boxFlexes.forEach(function(e){r+=parseInt(e.flex,10)}),n=t/r,this._boxFlexes.forEach(function(e){this._setSize(e.element,Math.floor(n*e.flex)-1)}.bind(this))},_getSize:function(e,t){var n=e.getSize(),r,i=t===!0?this._getExtraSpace(e,this._orientation):0;return this._orientation=="horizontal"?r=n.x+i:r=n.y+i,r},_setSize:function(e,t){var n,r=0;r=this._getExtraSpace(e,this._orientation),this._orientation=="horizontal"?n="width":n="height";var i=Math.max(t-r,0),s=e.getStyle(n),o=s.contains("%")?Infinity:parseInt(s,10);Math.abs(i-o)>1&&e.setStyle(n,i+"px")},_getExtraSpace:function(e,t){var n;return t=t||this._orientation,t=="horizontal"?n=(parseInt(e.getComputedStyle("margin-left"),10)||0)+(parseInt(e.getComputedStyle("margin-right"),10)||0):n=(parseInt(e.getComputedStyle("margin-top"),10)||0)+(parseInt(e.getComputedStyle("margin-bottom"),10)||0),n},_getParentBoxProxies:function(){var e=Array.filter(this._element.getParents("[hasproxy]"),function(e){return e.getViewProxy().className.contains("BoxLayoutProxy")});return e.reverse()},dispose:function(){this.removeEvent(Constants.WixAppEvents.APP_PART_RESIZE,this._ie_onAppPartResize),this._element.removeEvent("resize",this._ie_resizeHandler),Array.forEach(this._element.children,function(e){e.removeEvent("resize",this._ie_resizeHandler)}.bind(this)),this.parent()}}}),define.Class("wixapps.integration.utils.FunctionCallThrottle",function(e){var t=e;t.statics({createThrottle:function(e,t){var n=!1,r=null;return function(){var i=Array.from(arguments);n?r={args:i,that:this}:(e.apply(this,i),n=!0,window.setTimeout(function(){n=!1,r!==null&&(e.apply(r.that,r.args),r=null)},t))}},debounceFunction:function(e,t){var n=!1,r=null,i=null;return function(){n=!0,r={args:Array.from(arguments),that:this},i!==null&&(window.clearTimeout(i),i=null),i=window.setTimeout(function(){r!==null&&(e.apply(r.that,r.args),r=null),n=!1,i=null},t)}}})}),define.Class("wixapps.integration.utils.GeometryUtils",function(e){var t=e;t.fields({}),t.utilize(["wixapps.core.utils.Map"]),t.methods({calculateBoundaryOverflowSum:function(e,t){var n={width:0,height:0};return this.getOverflowRegions(e,t).forEach(function(e){n.width+=e.left+e.right,n.height+=e.top+e.bottom}),n},getOverflowRegions:function(e,t){var n=new this.imports.Map,r=Array.slice(e.getElementsByTagName("*"));return r.unshift(e),r.forEach(function(e){if(e.nodeType==1&&e.getAttribute("hasproxy")){var r=t.get(e),i=t.get(e.parentNode),s=n.get(e.parentNode);s||(s={container:e.parentNode,left:0,top:0,right:0,bottom:0},n.put(e.parentNode,s));if(r.width>0||r.height>0)r.left<i.left&&(s.left=Math.max(s.left,i.left-r.left)),r.right>i.right&&(s.right=Math.max(s.right,r.right-i.right)),r.top<i.top&&(s.top=Math.max(s.top,i.top-r.top)),r.bottom>i.bottom&&(s.bottom=Math.max(s.bottom,r.bottom-i.bottom))}}.bind(this)),n.getValues().filter(function(e){return Boolean(e.left||e.right||e.top||e.bottom)})}})}),define.Class("wixapps.integration.utils.LayoutGeometryMap",function(e){var t=e;t.utilize(["wixapps.core.utils.Map"]),t.fields({_container:null,_elementMap:null}),t.methods({initialize:function(){this._elementMap=new this.imports.Map},setContainer:function(e){this._container=e,this._elementMap.clear()},get:function(e){var t=this._elementMap.get(e);return t===undefined&&(t=this._createInfo(this._container,e),this._elementMap.put(e,t)),t},updateMap:function(e){this._elementMap.clear();var t=[e].append(e.getElementsByTagName("*"));t.forEach(function(e){e.getAttribute("hasproxy")&&this._elementMap.get(e)}.bind(this))},reset:function(){this._elementMap.clear()},_createInfo:function(e,t){return t.getCoordinates(e)},dispose:function(){this._container=null,this._elementMap.clear()}})}),define.Class("wixapps.integration.utils.ParagraphClipping",function(e){var t=e;t.fields({_reusable:!1,_lastTextContent:null,_lineRectCache:null,_spanList:null,_cache:[],_ellipsisSpan:null,_container:null,_maxWidth:NaN,_maxHeight:NaN,_lastCropIndex:-1,_ellipsisShown:!1}),t.methods({clipParagraph:function(e,t,n,r){if(this._maxWidth!==n||this._maxHeight!==r||e!==this._lastTextContent){this._container=t,this._lastTextContent!==e&&(this._lastTextContent=e,this.resetCache());var i=n-this._maxWidth,s=r-this._maxHeight;this._reusable||(this._reusable=!0,this._prepareContent(e,t),this._createEllipsisSpan(t),this._cache=[]),i!==0&&(this._cache=[]),this._maxWidth=n,this._maxHeight=r,isNaN(i)||i>.1*n||s>.1*r?this._cropParagraph(this._spanList,function(){return this._searchBinary(0,this._spanList.length-1)}.bind(this)):i>0||i===0&&s>0?this._cropParagraph(this._spanList,function(){return this._searchSequentially(this._lastCropIndex,1)}.bind(this)):this._cropParagraph(this._spanList,function(){return this._searchSequentially(this._lastCropIndex,-1)}.bind(this))}},getLastTextContent:function(){return this._lastTextContent},resetCache:function(){this._reusable=!1,this._maxWidth=NaN,this._maxHeight=NaN,this._lastCropIndex=-1},isClipped:function(){return this._ellipsisShown},showEllipsis:function(){this._ellipsisSpan&&this._ellipsisSpan.setStyles({display:"inline"})},hideEllipsis:function(){this._ellipsisSpan&&this._ellipsisSpan.setStyles({display:"none"})},_prepareContent:function(e,t){var n=this._wrapWordsInSpans(e);t.set("html",n),this._spanList=t.getElements("span").filter(function(e){return e.childNodes.length==1&&e.firstChild.nodeType==3&&e!==this._ellipsisSpan}.bind(this))},_createEllipsisSpan:function(e){this._ellipsisSpan=new Element("span"),this._ellipsisSpan.setStyles({position:"absolute"}),this._spanList[this._spanList.length-1].getParent().adopt(this._ellipsisSpan)},_showSpan:function(e){e.setStyle("visibility","visible")},_hideSpan:function(e){e.setStyle("visibility","hidden")},_getSpanRect:function(e){return this._cache[e]||(this._cache[e]=this._spanList[e].getContentRect(this._container)),this._cache[e]},_testPoint:function(e){var t;if(e>=0&&e<this._spanList.length){var n=this._getSpanRect(e);t=n.bottom<=this._maxHeight}else t=!1;return t},_searchSequentially:function(e,t){if(this._testPoint(e)&&!this._testPoint(e+1))return e;var n=e+t;return n>=0&&n<this._spanList.length?this._searchSequentially(e+t,t):-1},_searchBinary:function(e,t){var n=Math.floor((e+t)/2),r=this._testPoint(n);return r&&!this._testPoint(n+1)?n:r?this._searchBinary(n,t):this._searchBinary(e,n)},_cropParagraph:function(e,t){var n;this._testPoint(0)===!1?n=0:this._testPoint(e.length-1)?n=e.length-1:n=t(),n!==-1&&(n=this._addEllipsis(n),this._lastCropIndex=n,e.forEach(function(e,t){t<n?this._showSpan(e):this._hideSpan(e)}.bind(this)),!this._ellipsisShown&&this._spanList[n]&&this._showSpan(this._spanList[n]))},_addEllipsis:function(e){if(e>=0&&e<this._spanList.length-1){this._ellipsisShown=!0;var t=this._spanList[e];this._ellipsisSpan.set("text",String(t.firstChild.nodeValue)+"...");var n=t.getContentRect(this._container),r=this._getFontStyleShorthand(t);console.log("WHAT?",n),this._ellipsisSpan.setStyles({visibility:"visible",left:n.left,top:n.top,font:r});if(this._ellipsisSpan.getContentRect(this._container).right>this._maxWidth)return this._addEllipsis(e-1)}else this._ellipsisShown=!1,this._ellipsisSpan.setStyles({visibility:"hidden"});return e},_getFontStyleShorthand:function(e){var t=e.getStyle("font");return t?t.replace(/\/\S+/,"/normal"):Array.reduce(["font-style","font-variant","font-weight","font-size","line-height","font-family"],function(t,n){var r=e.getStyle(n);return n=="line-height"?t+"/normal ":t+" "+r},[])},_wrapWordsInSpans:function(e){var t=e.replace(/</g," <").replace(/>/g,"> "),n=t.split(/\s+/),r=this._joinHtmlTags(n);return r.map(function(e){return e=e.trim(),e&&e.charAt(0)!="<"?"<span>"+e+"</span>":e}).join(" ")},_joinHtmlTags:function(e){var t,n=[],r="",i="";for(t=0;t<e.length;t++){r=e[t];if(r.length===0)continue;if(/<\/\w+>/.test(r)){n[n.length-1]+=r;continue}if(r.substr(0,1)==="<"&&!r.contains(">")){i=r;continue}if(r.substr(-1)===">"){i+=" "+r,n.push(i),i="";continue}if(i.length){i+=" "+r;continue}n.push(r)}return n}})}),define.Class("wixapps.integration.utils.ParagraphLinesMap",function(e){var t=e;t.fields({_lineMap:[],_maxWidth:0,_maxLines:NaN}),t.methods({updateMap:function(e){this._lineMap=this.getContainerRectList(e),this._containerTop=e.getContentRect().top},getLineNum:function(){return this._lineMap.length},getParagraphHeight:function(e){var t=Math.min(this._lineMap.length,e);return t>0?this._lineMap[t-1].bottom-this._containerTop+1:0},getContainerRectList:function(e){var t,n=e.getElements("*").filter(function(e){return e.getStyle("display")=="block"});n.length===0&&(n=[e]);var r=n.reduce(function(e,t){return e.concat(Array.slice(t.children,0))},[]);r.length>0?t=r.reduce(function(e,t){return e.concat(Array.slice(t.getClientRects(),0))},[]):t=n.reduce(function(e,t){return e.concat(Array.slice(t.getClientRects(),0))},[]),t.length===0&&(t=Array.slice(e.getClientRects()));var i=t.reduce(function(e,t){if(e.length===0)return[t];var n=e.indexOfByPredicate(function(e){var n=t.top<=e.top&&t.bottom>=e.bottom,r=e.top<=t.top&&e.bottom>=t.bottom;return n||r});return n===-1?e.concat(t):(e[n].height<t.height&&(e[n]=t),e)},[]);return i}})}),define.Class("wixapps.integration.utils.PerformanceTracker",function(e){var t=e,n=0,r={},i=[];t.methods({startTracking:function(e,t){var s=n++;return r[s]={label:e,start:(new Date).getTime()},this._markTimeline(this._createStartString(s)),t&&console.profile&&(console.profile(e),r[s].cpuProfileOn=!0),i.push(s),s},endTracking:function(e){var t=r[e];if(!t)return;t.end=(new Date).getTime(),this._markTimeline(this._createEndString(e)),t.cpuProfileOn&&console.profileEnd()},_createEndString:function(e){var t=r[e],n=t.end-t.start;return"[ END ] [ "+t.label+" ][ "+n+"ms ][ "+e+" ] "},_createStartString:function(e){var t=r[e],n=t.end-t.start;return"[ START ] [ "+t.label+" ][ "+e+" ] "},_markTimeline:function(e){console.markTimeline?console.markTimeline(e):console.timeStamp&&console.timeStamp(e)},printReport:function(e){for(var t=0;t<i.length;t++){var n=i[t],s=r[n];if(s){if(e&&s.label!=e)return;var o=s.end-s.start;console.log(n+"[ "+s.label+"] took "+o)}}},clearTimeTracking:function(){var e=0,t={},n=[]}})}),define.oldClass({name:"wixapps.integration.utils.ProxySelector",imports:[],Class:{Static:{SELECTION_ACTION:"selectionAction",ACTION_MOUSE_DOWN:"actionMouseDown",ACTION_DOUBLE_CLICK:"actionDoubleClick",ACTION_ROLL_OVER:"actionRollOver"},Extends:"bootstrap.utils.Events",Binds:["_onMouseMove","_onContentSelectorDblClick","_onContentSelectorDown"],_editedComponent:null,_selectionFilter:null,_editBoxView:null,initialize:function(){},activateProxySelector:function(e,t){this._editedComponent=e,this._selectionFilter=t;var n=this._getEditingLayer();n.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onContentSelectorDown),n.addEvent("dblclick",this._onContentSelectorDblClick)},deactivateProxySelector:function(){var e=this._getEditingLayer();e.removeEvent(Constants.CoreEvents.MOUSE_DOWN,this._onContentSelectorDown),e.removeEvent("dblclick",this._onContentSelectorDblClick),this._editedComponent=null,this._selectionFilter=null},deactivateProxySelectorIfActivated:function(){var e=this._getEditingLayer();e&&this.deactivateProxySelector()},_getEditingLayer:function(){return $$("#editorUI")[0].getLogic().getSkinPart("componentEditBox").getViewNode()},_getRelatedComponents:function(e){var t=e.getViewProxy().getViewDefinition(),n=this._editedComponent.getSkinPart("inlineContent").getElements("[hasproxy]");return n.filter(function(e){return e.getViewProxy().getViewDefinition()===t})},_calcComponentCoordinates:function(e){return e.getCoordinates()},_isInside:function(e,t){return e.x>=t.left&&e.x<=t.right&&e.y>=t.top&&e.y<=t.bottom},_filterByPosition:function(e,t){var n=this._calcComponentCoordinates(t);if(t.get("tag")==="span"){var r=t.getClientRects(),i=window.getScroll();return Array.map(r,function(e){return e=Object.clone(e),e.top+=i.y,e.bottom+=i.y,e}).some(function(t){return this._isInside(e,t)}.bind(this))}return this._isInside(e,n)},_listElements:function(e,t){var n=[],r=t.getChildren();return Array.forEach(r,function(t){var r=!1;if(this._filterByPosition(e,t))n.push(t),r=!0;else if(t.getStyle("position")==="absolute"||t.get("tag")=="a")r=!0;r&&(n=n.concat(this._listElements(e,t)))}.bind(this)),n},_findComponents:function(e){var t=this._listElements(e,this._editedComponent.getSkinPart("inlineContent"));return t.reverse().filter(function(e){return e.hasAttribute("hasproxy")}).map(function(e){return e.getViewProxy()}).filter(this._selectionFilter)},_onMouseMove:function(e){this._handleMouseAction(e,this.ACTION_ROLL_OVER)},_onContentSelectorDown:function(e){this._handleMouseAction(e,this.ACTION_MOUSE_DOWN)},_onContentSelectorDblClick:function(e){this._handleMouseAction(e,this.ACTION_DOUBLE_CLICK)},_handleMouseAction:function(e,t){var n=this.injects().Preview.editorToPreviewCoordinates(e.client),r=this._findComponents(n);r.length>0&&this._sendNotification(t,r)},_sendNotification:function(e,t){this.fireEvent(this.SELECTION_ACTION,{action:e,proxyList:t})}}}),define.oldClass({name:"wixapps.integration.utils.RichTextClippingUtils",imports:[],Class:{findClippedText:function(e,t,n,r){this._findClippedTextCommon(e,t,function(e){return this._isAcceptableSize(e,n,r)}.bind(this))},findClippedTextByLines:function(e,t,n,r){this._findClippedTextCommon(e,t,function(e){return this._isAcceptableByLines(e,n,r)}.bind(this))},_findClippedTextCommon:function(e,t,n){var r=e.replace(/</g," <").replace(/>/g,"> "),i=r.split(/\s+/),s=this._joinHtmlTags(i);this._findClippedTextRecursive(s,t,n,0,s.length,0)},_joinHtmlTags:function(e){var t,n=[],r="",i="";for(t=0;t<e.length;t++){r=e[t];if(r.length===0)continue;if(/<\/\w+>/.test(r)){n[n.length-1]+=r;continue}if(r.substr(0,1)==="<"&&!r.contains(">")){i=r;continue}if(r.substr(-1)===">"){i+=" "+r,n.push(i),i="";continue}if(i.length){i+=" "+r;continue}n.push(r)}return n},_findClippedTextRecursive:function(e,t,n,r,i,s){var o=Math.floor((r+i)/2),u=Boolean(o<e.length-1),a=u?e.slice(0,o):e,f;while(/<.+>/.test(a[a.length-1]))f=a.pop(),f.charAt(0)!=="<"&&a.push(f.split("<")[0]);var l=a.join(" ").concat(u?"...":"");t.set("html",l);if(s<15){var c=n(t);if(c==1){this._findClippedTextRecursive(e,t,n,r,o,s+1);return}if(c==-1){this._findClippedTextRecursive(e,t,n,o,i,s+1);return}}t.get("text")=="..."&&t.set("text","")},_isAcceptableSize:function(e,t,n){var r=0,i=this.getContainerRectList(e);if(i.length>0){var s=i[i.length-1].bottom-i[0].top,o=i[i.length-1].width;s>n?r=1:n-s>20?r=-1:o/t<.9&&(r=-1)}return r},_isAcceptableByLines:function(e,t,n){var r=0,i=this.getContainerRectList(e);if(i.length>0){var s=i[i.length-1].width;i.length>n?r=1:i.length<n?r=-1:s/t<.9&&(r=-1)}return r},getMinimalHeight:function(e,t){var n=this.getContainerRectList(e);if(n.length>=t)return n[t-1].bottom-n[0].top;var r=(n[n.length-1].bottom-n[0].top)/n.length;return Math.round(r*t)},getContainerRectList:function(e){var t,n=e.getElements("*").filter(function(e){return e.getStyle("display")=="block"});n.length===0&&(n=[e]);var r=n.reduce(function(e,t){return e.concat(Array.slice(t.children,0))},[]);r.length>0?t=r.reduce(function(e,t){return e.concat(Array.slice(t.getClientRects(),0))},[]):t=n.reduce(function(e,t){return e.concat(Array.slice(t.getClientRects(),0))},[]),t.length===0&&(t=Array.slice(e.getClientRects()));var i=t.reduce(function(e,t){if(e.length===0)return[t];var n=e.indexOfByPredicate(function(e){var n=t.top<=e.top&&t.bottom>=e.bottom,r=e.top<=t.top&&e.bottom>=t.bottom;return n||r});return n===-1?e.concat(t):(e[n].height<t.height&&(e[n]=t),e)},[]);return i}}}),define.oldClass({name:"wixapps.integration.utils.SelectionMarker",imports:[],traits:[],Class:{Extends:Object,Binds:[],initialize:function(){},_markedElements:[],markSelectedSubComponent:function(e){this.markSingleComponent(e),this._tooltipShown===!1&&(this._tooltipShown=!0)},unmarkSelectedSubComponent:function(){this._markedElements.forEach(this.unMarkSingleComponent),this._markedElements=[]},getMarkedElements:function(){return this._markedElements},markSingleComponent:function(e,t){var n=2;e.getStyle("display")==="inline"&&(n=0),e.setStyles({"outline-style":"dashed","outline-width":"1px","outline-color":t===!0?this._selectionEditColor:this._selectionRollOverColor,"outline-offset":n+"px"}),this._markedElements.push(e)},unMarkSingleComponent:function(e){e.setStyles({outline:"none"})},initUIColors:function(e,t){var n=e.getPropertiesAccordingToType("color"),r=n.map(function(t){return e.getProperty(t)}),i=this._getParentCompBgColor(e,t)||this._getDocumentBgColor(e);if(i){var s=this._getHighlightColors(i,r);this._selectionRollOverColor=s[0],this._selectionEditColor=s[1]}else this._selectionRollOverColor="#999",this._selectionEditColor="#333"},_getParentCompBgColor:function(e,t){var n="",r=t.getParentComponent();if(r&&r.getStyle()){var i=r.getStyle(),s=(i.get||i.getProperty).call(r.getStyle(),"bg");if(s){var o=i.getPropertySource("bg");o=="theme"?n=e.getProperty(s):o=="value"&&(n=s)}}return n},_getDocumentBgColor:function(e){var t=e.getProperty("siteBg"),n;return t&&(n=t.getColorReference()),e.getProperty(n||"color_0")},_getHighlightColors:function(e,t){var n=this,r=t.map(function(t){return{color:t,contrast:n._getContrastValue(t,e)}}).sort(function(e,t){return t.contrast-e.contrast}).map(function(e){return e.color.toString()}).filter(function(e,t,n){return!n.slice(0,t).contains(e)});return[r[2],r[4]]},_getContrastValue:function(e,t){return Math.abs(e._l-t._l)}}}),define.Class("wixapps.integration.utils.flex.BoxFlexPolyfill",function(e){var t=e;t.utilize(["wixapps.integration.utils.flex.ComputedFlex","wixapps.integration.utils.flex.NativeFlex","wixapps.integration.utils.flex.WebkitFlex","wixapps.integration.utils.flex.FirefoxFlex","wixapps.integration.utils.flex.MSIEFlex"]),t.statics({forceComputedFlex:undefined,forceLegacyFlex:!1,applyBoxFlexPolyfill:function(e){this.forceComputedFlex===undefined&&(this.forceComputedFlex=W.Utils.getQueryParam("forceComputedFlex")==="true");var t=this.createFlexPolyfill(e);this._applyPolyfillToElement(e,t)},_applyPolyfillToElement:function(e,t){e.$flexPolyfill=t,e.setStyle("box-sizing","border-box");var n=e.setStyle.bind(e);e.setStyle=function(e,r){t.setStyle(e,r,n)}},createFlexPolyfill:function(e){var t;if(this.forceComputedFlex||!Modernizr.flexbox&&!Modernizr.flexboxlegacy)t=new this.prototype.imports.ComputedFlex(e);else{var n=this.forceLegacyFlex===!0||!Boolean(Modernizr.flexbox);Browser.chrome||Browser.safari?t=new this.prototype.imports.WebkitFlex(n):Browser.firefox?t=new this.prototype.imports.FirefoxFlex(n):Browser.ie?t=new this.prototype.imports.MSIEFlex:t=new this.prototype.imports.NativeFlex}return t}})}),define.Class("wixapps.integration.utils.flex.ComputedFlex",function(e){var t=e;t.utilize(["wixapps.integration.utils.flex.FlexGeometry"]),t.fields({_element:null,_direction:"column",_flexSuperNode:null,_depth:0,_flexGeometry:null,_flexValue:NaN,_alignment:"",_styleCache:{},_box0:null}),t.methods({initialize:function(e){this._element=e},setStyle:function(e,t,n){this._styleCache[e]=t,e!=="display"||t!=="box"&&t!=="flex"?e==="box-orient"?this._setFlexDirection(t==="horizontal"?"row":"column"):e==="flex-direction"?this._setFlexDirection(t):e==="box-flex"||e==="flex"?this.setFlexValue(t):e=="align-items"||e=="box-align"?this._setAlignment(t):n(e,t):this._isFlexDisplay=!0},getCachedStyle:function(e){return this._styleCache[e]},hasCachedStyle:function(e){return this._styleCache[e]!==undefined},getFlexValue:function(){return this._flexValue},setFlexValue:function(e){e=parseInt(e,10);if(!e&&this._flexValue){var t=this._element.parentNode.$flexPolyfill.getDirection();t==="row"?this._element.style.width="initial":t==="column"&&(this._element.style.height="",this._element.style["min-height"]="")}this._flexValue=e},getDirection:function(){return this._direction},updateGeometry:function(){this._flexGeometry=this._flexGeometry||new this.imports.FlexGeometry,this._flexGeometry.clear(),this._updateChildrenStyles();var e=this._updateDescendants();this._traverseDescendants(this._element,function(e){e.parentNode&&e.parentNode.$flexPolyfill&&this._flexGeometry.registerNodeFlexInfo(e,e.$flexPolyfill.getFlexValue(),e.parentNode.$flexPolyfill.getDirection())}.bind(this)),this._flexGeometry.recalculateFlexNodes(),e.reverse().forEach(function(e){e.$flexPolyfill.updateAutoHeight()}),e.length>0&&this._flexGeometry.recalculateFlexNodes()},_updateDescendants:function(){var e=[];return this._traverseDescendants(this._element,function(t){t.$flexPolyfill&&(t.$flexPolyfill._updateChildrenStyles(),t.$flexPolyfill.isAutoHeight()&&(t.style.height="",e.push(t)))}),e},_traverseDescendants:function(e,t){var n=e.getElementsByTagName("*");for(var r=0;r<n.length;r++){var i=n[r];i.$flexPolyfill&&t(i)}},_setFlexDirection:function(e){e==="horizontal"&&(e="row"),this._direction=e},_setAlignment:function(e){e.indexOf("flex-")===0&&(e=e.substring(5)),this._alignment=e},_updateChildrenStyles:function(){this._updateBox0(),this._isFlexDisplay&&this._element.setStyle("white-space",this._direction==="row"?"nowrap":"normal");var e=this._getChildCss();Array.forEach(this._element.children,function(t){t!==this._box0&&t.setStyles&&t.style&&(this._applyCrossAxisStretch(t),t.setStyles(e),t.$flexPolyfill&&t.setStyle("white-space","normal"))}.bind(this))},isAutoHeight:function(){return this._direction==="row"&&!this.hasCachedStyle("height")},updateAutoHeight:function(){this._element.style.height=this._element.getContentRect().height+"px"},_getChildCss:function(){var e={};return this._isFlexDisplay&&(e=this._getAlignmentCss(),e.display=this._direction==="row"?"inline-block":"block"),e},_getAlignmentCss:function(){var e={};if(this._direction==="column")switch(this._alignment){case"start":e["margin-left"]="0",e["margin-right"]="auto";break;case"center":e["margin-left"]="auto",e["margin-right"]="auto";break;case"end":e["margin-left"]="auto",e["margin-right"]="0";break;default:e["margin-left"]="",e["margin-right"]=""}else if(this._direction==="row")switch(this._alignment){case"start":e["vertical-align"]="top";break;case"center":e["vertical-align"]="middle";break;case"end":e["vertical-align"]="bottom";break;case"baseline":e["vertical-align"]="baseline";break;default:e["vertical-align"]="top"}return e},_updateBox0:function(){var e=!this._box0&&this._element.children.length>0||this._box0&&this._element.children.length>1,t=this._direction==="row"&&e;if(t){if(!this._box0){this._box0=new Element("div");var n=Object.merge({display:"inline-block",width:0},this._getAlignmentCss());n["vertical-align"]==="middle"&&(n["vertical-align"]="baseline"),this._box0.setStyles(n),this._element.insertBefore(this._box0,this._element.children[0])}this._box0.setStyle("height",this._determineBox0Height())}else this._box0&&(this._element.removeChild(this._box0),this._box0=null)},_determineBox0Height:function(){switch(this._alignment){case"center":return"50%";case"end":return"100%";default:return"0"}},_applyCrossAxisStretch:function(e){var t=this._direction=="row"?"height":"width",n=e.$flexPolyfill?e.$flexPolyfill.hasCachedStyle(t):!0,r=this._alignment==="baseline";(this._alignment==="stretch"||!n&&!r)&&e.setStyle(t,"100%")}})}),define.Class("wixapps.integration.utils.flex.FirefoxFlex",function(e){var t=e;t.inherits("wixapps.integration.utils.flex.NativeFlex"),t.fields({}),t.methods({initialize:function(e){var t;e?t={display:{box:"-moz-box",flex:"-moz-box"},"box-orient":{_propName_:"-moz-box-orient"},"flex-direction":{_propName_:"-moz-box-orient",column:"vertical",row:"horizontal"},"box-flex":{_propName_:"-moz-box-flex",none:0},flex:{_propName_:"-moz-box-flex"},"align-items":{_propName_:"-moz-box-align","flex-start":"start",center:"center","flex-end":"end","flex-baseline":"baseline"},"box-align":{_propName_:"-moz-box-align"}}:t={display:{box:"-moz-flex",flex:"-moz-flex"},"box-orient":{_propName_:"-moz-flex-direction",horizontal:"row",vertical:"column"},"flex-direction":{_propName_:"-moz-flex-direction"},"box-flex":{_propName_:"-moz-flex"},flex:{_propName_:"-moz-flex"},"align-items":{_propName_:"-moz-align-items"},"box-align":{_propName_:"-moz-align-items",start:"flex-start",center:"center",end:"flex-end",baseline:"flex-baseline"}},this.parent(t)}})}),define.Class("wixapps.integration.utils.flex.FlexGeometry",function(e){var t=e;t.utilize(["wixapps.core.utils.Map"]),t.fields({_nodeMap:null,_containerMap:null}),t.methods({initialize:function(){this._nodeMap=new this.imports.Map,this._containerMap=new this.imports.Map},clear:function(){this._nodeMap.clear(),this._containerMap.clear()},registerNodeFlexInfo:function(e,t,n){t=parseInt(t,10);if(t){var r={element:e,flexValue:t};this._nodeMap.put(e,r);var i=e.parentNode,s=this._containerMap.get(i);s===undefined&&(s={element:i,depth:this._getElementDepth(i),direction:n},this._containerMap.put(i,s)),r.containerInfo=s,r.flexProperties=this._getFlexProperties(s)}else this._removeNodeFromMap(e)},_getElementDepth:function(e){return e.parentNode?this._getElementDepth(e.parentNode)+1:0},_removeNodeFromMap:function(e){this._nodeMap.remove(e);var t=e.parentNode;this._nodeMap.getValues().some(function(e){return e.containerInfo.element===t})||this._containerMap.remove(t)},_getFlexProperties:function(e){var t=e.direction;return t==="column"?["height","min-height"]:["width"]},recalculateFlexNodes:function(){this._containerMap.getValues().forEach(function(e){e.extraSpace=NaN,e.flexSubTotal=0});var e=this._nodeMap.getValues().sort(function(e,t){return e.containerInfo.depth-t.containerInfo.depth});e.forEach(function(e){e.containerInfo.flexSubTotal+=e.flexValue,e.flexProperties.forEach(function(t){e.element.setStyle(t,"")})}),e.forEach(function(e){var t=e.containerInfo.direction;isNaN(e.containerInfo.extraSpace)&&(e.containerInfo.extraSpace=this._getContainerExtraSpace(e.containerInfo.element,t));var n=Math.floor(e.flexValue/e.containerInfo.flexSubTotal*e.containerInfo.extraSpace);e.flexProperties.forEach(function(t){e.element.setStyle(t,n)})}.bind(this))},_getContainerExtraSpace:function(e,t){var n=t==="row"?"x":"y",r=Array.filter(e.children,function(e){return!this._nodeMap.containsKey(e)}.bind(this)).reduce(function(e,t){return e+t.getSize()[n]},0);return Math.max(0,e.getSize()[n]-r)}})}),define.Class("wixapps.integration.utils.flex.MSIEFlex",function(e){var t=e;t.inherits("wixapps.integration.utils.flex.NativeFlex"),t.fields({}),t.methods({initialize:function(){var e={display:{box:"-ms-flexbox",flex:"-ms-flexbox"},"box-orient":{_propName_:"msFlexDirection",horizontal:"row",vertical:"column"},"flex-direction":{_propName_:"msFlexDirection"},"box-flex":{_propName_:"msFlex"},flex:{_propName_:"msFlex"},"align-items":{_propName_:"msFlexAlign","flex-start":"start","flex-end":"end"},"box-align":{_propName_:"msFlexAlign"}};this.parent(e)}})}),define.Class("wixapps.integration.utils.flex.NativeFlex",function(e){var t=e;t.fields({_cssPropMap:{display:{box:"flex"},"box-orient":{_propName_:"flex-direction",horizontal:"row",vertical:"column"},"box-flex":{_propName_:"flex"},"box-align":{_propName_:"align-items",start:"flex-start",end:"flex-end"}}}),t.methods({initialize:function(e){e&&(this._cssPropMap=e)},setStyle:function(e,t,n){var r,i,s=this._cssPropMap[e];s?(r=s.hasOwnProperty("_propName_")?s._propName_:e,i=s.hasOwnProperty(t)?s[t]:t,n(r,i)):n(e,t)},updateGeometry:function(){}})}),define.Class("wixapps.integration.utils.flex.WebkitFlex",function(e){var t=e;t.inherits("wixapps.integration.utils.flex.NativeFlex"),t.fields({}),t.methods({initialize:function(e){var t;e?t={display:{box:"-webkit-box",flex:"-webkit-box"},"box-orient":{_propName_:"-webkit-box-orient"},"flex-direction":{_propName_:"-webkit-box-orient",column:"vertical",row:"horizontal"},"box-flex":{_propName_:"-webkit-box-flex"},flex:{_propName_:"-webkit-box-flex"},"align-items":{_propName_:"-webkit-box-align","flex-start":"start",center:"center","flex-end":"end",baseline:"baseline"},"box-align":{_propName_:"-webkit-box-align"}}:t={display:{box:"-webkit-flex",flex:"-webkit-flex"},"box-orient":{_propName_:"-webkit-flex-direction",horizontal:"row",vertical:"column"},"flex-direction":{_propName_:"-webkit-flex-direction"},"box-flex":{_propName_:"-webkit-flex"},flex:{_propName_:"-webkit-flex"},"align-items":{_propName_:"-webkit-align-items"},"box-align":{_propName_:"-webkit-align-items",start:"flex-start",center:"center",end:"flex-end",baseline:"baseline"}},this.parent(t)},setStyle:function(e,t,n){(e==="flex"||e==="box-flex")&&n("min-width",0),this.parent.apply(this,arguments)}})});