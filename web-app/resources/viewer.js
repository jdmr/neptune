define.Class("wysiwyg.viewer.managers.PageManager",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.utilize(["core.managers.serverfacade.CorsRESTClient"]),t.binds(["_getPagesList","_createPageElements","createPage","_loadAllPages","_createMasterPage","_handleSinglePageData"]),t.methods({initialize:function(){W.Managers&&W.Managers.list&&W.Managers.list.push({target:"Pages"}),this._restClient=new this.imports.CorsRESTClient},isReady:function(){return!0},clone:function(){return new this.$class},_getPagesList:function(){if(!window.publicModel||!window.publicModel.pageList)return undefined;var e=window.publicModel.pageList;return e.pages=e.pages.map(this._handleSinglePageData),e},_handleSinglePageData:function(e){return e},getMainPage:function(){return this._getPagesList().mainPageId},getMasterPageData:function(e){this._requestPageJson(this._getPagesList().masterPage,e)},getPageData:function(e,t){if(!e||!e.urls)throw"page is not listed in the pages list or it does not have url";if(typeof t!="function")throw"callback ["+t+"] supplied is not a function";this._requestPageJson(e.urls,t)},_requestPageJson:function(e,t){this._restClient.get(e[0],undefined,{onSuccess:t,onError:this._getErrorCallbackForUrl(e,t)})},_getErrorCallbackForUrl:function(e,t){if(e.length==1)return function(){LOG.reportError(wixErrors.ALL_PAGE_RETRIEVAL_ATTEMPTS_FAILED,"PageManager","_requestPageJson")};var n=e.clone();return n.splice(0,1),function(){LOG.reportError(wixErrors.SINGLE_PAGE_RETRIEVAL_ATTEMPT_FAILED,"PageManager","_requestPageJson",n[0]),this._requestPageJson(n,t)}.bind(this)},_buildComponentProperties:function(e){if(!e)return{};var t={id:e.id,comp:e.componentType,skin:e.componentType=="wysiwyg.viewer.components.PagesContainer"?"wysiwyg.viewer.skins.screenwidthcontainer.BlankScreen":e.skin,styleId:e.styleId};return e.dataQuery&&(t.dataQuery=e.dataQuery.indexOf("#")!=0?"#"+e.dataQuery:e.dataQuery),e.propertyQuery&&(t.propertyQuery=e.propertyQuery.indexOf("#")!=0?"#"+e.propertyQuery:e.propertyQuery),e.layout&&(t.width=e.layout.width,t.height=e.layout.height,t.x=e.layout.x,t.y=e.layout.y),t},_addAnchors:function(e){if(e&&e.id&&e.layout&&e.layout.anchors){var t={};t[e.id]=e.layout.anchors,W.Layout.appendSavedAnchor(t)}},_createElement:function(e){var t=new Element("div");return t.set(this._buildComponentProperties(e)),this._addAnchors(e),t},_createPageElements:function(e){var t=this._createElement(e);return e.components&&e.components.each(function(e){t.grab(this._createPageElements(e))}.bind(this)),t},createPage:function(e){var t=this._getJsonForString(e),n=t.data||t.payload.data;this._setInitData(n);var r=t.structure||t.payload.structure,i=this._createPageElements(r);this._attachPage(i),this.fireEvent("PAGE_LOADED",r.id)},_setInitData:function(e){var t=this.dataFixer.fix(e);W.Data.addDataItems(t.document_data),W.ComponentData.addDataItems(t.component_properties),W.Theme.addDataItems(t.theme_data)},_attachPage:function(e){$("SITE_PAGES").grab(e,"bottom")},_attachMasterPage:function(e){$$("body")[0].grab(e,"top")},_createSiteStructureNode:function(){var e=new Element("div");return e.set({id:"SITE_STRUCTURE",comp:"wysiwyg.viewer.components.WSiteStructure",skin:"mobile.core.skins.InlineSkin","class":"SITE_STRUCTURE"}),e},_getJsonForString:function(e){return typeof e=="string"?JSON.decode(e):e},_createMasterPage:function(e){var t=this._getJsonForString(e),n=t.data||t.payload.data;this._setInitData(n);var r=this._createSiteStructureNode(),i=t.structure||t.payload.structure;i.children.each(function(e){r.grab(this._createPageElements(e))}.bind(this)),this._attachMasterPage(r),this.fireEvent("MASTER_PAGE_WAS_LOADED")},_loadSinglePage:function(e){this.getPageData(e,this.createPage)},_loadAllPages:function(){var e=[];this.addEvent("PAGE_LOADED",function(t){e.erase(t),e.length===0&&(this._allPagesAreLoaded=!0)}.bind(this)),Object.each(this._getPagesList().pages,function(t){e.push(t.pageId),this._loadSinglePage(t)}.bind(this))},_isOldPageVersion:function(){return!this._getPagesList()},isPageLoadingCompleted:function(){return!!this._allPagesAreLoaded},loadSite:function(){this._isOldPageVersion()?W.Data.getDataByQuery("#SITE_STRUCTURE",function(e){var t=viewMode!="preview";W.Viewer.setSite($("SITE_STRUCTURE"),e,t)}):resource.getResources(["dataFixer"],function(e){this.dataFixer=e.dataFixer,this._loadSiteNewVersion()}.bind(this))},_loadSiteNewVersion:function(){this.addEvent("MASTER_PAGE_WAS_LOADED",this._loadAllPages),this.getMasterPageData(this._createMasterPage)}})}),define.oldClass({name:"wysiwyg.viewer.managers.SiteMembersManager",Class:{Extends:"bootstrap.managers.BaseManager",Resources:["W.Viewer"],Binds:["_initializeAPI","openSiteMembersPopup","closeSiteMembersPopup"],Static:{AUTH_STATES:{AUTH:"auth token and cookie exist",NO_AUTH_WITH_COOKIE:"no auth token, cookie exist",NO_AUTH_WITHOUT_COOKIE:"no auth token, cookie doesnt exist"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},API_ERRORS:{API_NOT_LOADED:"Site Members API was not loaded",TOKEN_IS_INVALID:"Authentication Token is invalid"}},initialize:function(){var e=this.resources.W.Viewer.getAppDataHandler().getSiteMembersData();this.setData(e)},isReady:function(){return!0},setData:function(e){this._smData=e,e&&this._loadScriptAndInitAPI()},_loadScriptAndInitAPI:function(){if(!window.SiteMembers){var e=window.serviceTopology.scriptsLocationMap,t=e.sitemembers;this.injects().Viewer.loadExternalScript(t+"/SiteMembers.js",function(){this._initializeAPI(),this._checkQueryStringForFormOpen(),this._preloadMemberDetails()}.bind(this))}else this._initializeAPI()},_initializeAPI:function(){var e=W.Config.getServiceTopologyProperty("siteMembersUrl"),t="siteMembers",n=window.SiteMembers,r=this.getCollectionId();if(r){var i=W.Config.getMetaSiteId();window[t]=new n(r,e,t,i),this._api=window[t],this._token=this.getData().smtoken,this._apiReady=!0}else LOG.reportError("Site members - collection Id is undefined? ["+r+"]",this.$className,"_initializeAPI")},_checkQueryStringForFormOpen:function(){var e=this.injects().Utils,t=e.getQueryParam("intent");if(t&&!this._queryStringHandled){if(!this.injects().Viewer.isSiteReady()||!this.isApiReady()){e.callLater(this._checkQueryStringForFormOpen,[],this,500);return}this.openSiteMembersPopup({intent:t}),this._queryStringHandled=!0}},_preloadMemberDetails:function(){this.getMemberDetails(function(e){this._memberDetails=e}.bind(this))},getData:function(){return this._smData||{}},getCollectionId:function(){return this.getData().smcollectionId||this.getData().id},getCollectionOwner:function(){return this.getData().owner},getCollectionType:function(){return this.getData().collectionType||this.getData().type},isServiceProvisioned:function(){return!!this._smData},isApiReady:function(){return this._apiReady},login:function(e,t,n,r,i){this._apiReady?this._api.login(e,t,n,r,i):i&&i({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},register:function(e,t,n,r){this._apiReady?this._api.register(e,t,n,r):r&&r({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},updateMemberDetails:function(e,t,n){this._apiReady?this._token?this._api.updateMemberDetails(this._token,e,t,n):n&&n({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):n&&n({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},getMemberDetails:function(e,t){this._memberDetails?e(this._memberDetails):this._apiReady?this._token?this._api.getMemberDetails(this._token,e,t):t&&t({code:"TOKEN_IS_INVALID",description:this.API_ERRORS.TOKEN_IS_INVALID}):t&&t({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},applyForMembership:function(e,t,n,r){this._apiReady?this._api.apply(e,t,n,r):r&&r({code:"API_NOT_LOADED",description:this.API_ERRORS.API_NOT_LOADED})},logout:function(){if(!this._apiReady)return;return delete this._token,this._api.logout()},getToken:function(){return this._token},isLoggedIn:function(){var e=this._getAuthenticationState();return e==this.AUTH_STATES.AUTH},isNotAuthenticatedWithCookie:function(){if(this.isLoggedIn())return!1;var e=this._getAuthenticationState();return e==this.AUTH_STATES.NO_AUTH_WITH_COOKIE},_getAuthenticationState:function(){var e=!!this._token,t=this._api?this._api.isSessionValid():!1;if(e)return this.AUTH_STATES.AUTH;if(!e&&t)return this.AUTH_STATES.NO_AUTH_WITH_COOKIE;if(!e&&!t)return this.AUTH_STATES.NO_AUTH_WITHOUT_COOKIE},openSiteMembersPopup:function(e){var t=e&&e.intent,n=e&&e.authCallback;t||(this.isNotAuthenticatedWithCookie()?t=this.INTENTS.LOGIN:t=this.INTENTS.REGISTER);var r=[this.INTENTS.LOGIN,this.INTENTS.REGISTER];if(r.contains(t)&&this.isLoggedIn())this.injects().SiteMembers.getMemberDetails(function(e){this.reportAuthStatusChange(n,!0,e)}.bind(this));else{var i=this.injects().SiteMembers;this._siteMembersContainer&&this.closeSiteMembersPopup(),i.isApiReady()&&!this._siteMembersContainer&&W.Components.createComponent("wysiwyg.viewer.components.sm.SMContainer","wysiwyg.viewer.skins.sm.SMContainerSkin",null,e,function(){},function(e){this._siteMembersContainer=e;var t=e.getViewNode();t.setStyle("opacity","0.0");var n=this.injects().Viewer.getSiteNode();t.insertInto(n);var r=(new Fx.Tween(t,{duration:"short",link:"ignore"})).start("opacity","1.0")}.bind(this))}},closeSiteMembersPopup:function(){if(this._siteMembersContainer){var e=this._siteMembersContainer.getViewNode(),t=new Fx.Tween(e,{duration:"short",link:"chain"});t.addEvent("complete",function(){t.removeEvent("complete",arguments.callee),e.removeFromDOM()}.bind(this)),t.start("opacity","0.0"),delete this._siteMembersContainer}},reportAuthStatusChange:function(e,t,n){e&&e({authResponse:t,data:n})}}}),define.Class("wysiwyg.viewer.managers.TPAManager",function(e){var t=e;t.inherits("bootstrap.managers.BaseManager"),t.utilize(["wysiwyg.viewer.managers.tpa.URLBuilder","wysiwyg.viewer.managers.tpa.TPAComponentRegistrar"]),t.resources(["W.Commands","W.CommandsNew"]),t.binds(["_onAppAvailableTimeoutExpires"]),t.statics({TPA_MESSAGE:"TPA",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",APP_MARKET_MESSAGE:"APP_MARKET",APP_MARKET_URL:"http://market.apps.wix.com",PINGPONG_PREFIX:"pingpong:",LOAD_TIMEOUT:20,MessageTypes:{CHANGE_APP_SIZE:"changeAppSize",RESIZE_WINDOW:"resizeWindow",REFRESH_APP:"refreshApp",APP_IS_ALIVE:"appIsAlive",APP_STATE_CHANGED:"appStateChanged",CLOSE_POPUP:"closePopup",CLOSE_WINDOW:"closeWindow",OPEN_POPUP:"openPopup",OPEN_RELATIVE_POPUP:"openRelativePopup",OPEN_MODAL:"openModal",OPEN_MEDIA_DIALOG:"openMediaDialog",OPEN_BILLING_PAGE:"openBillingPage",GET_SITE_PAGES:"getSitePages",GET_SITE_COLORS:"getSiteColors",NAVIGATE_TO_PAGE:"navigateToPage",POST_MESSAGE:"postMessage",SM_REQUEST_LOGIN:"pingpong:smRequestLogin",SM_CURRENT_MEMBER:"pingpong:smCurrentMember",SITE_INFO:"pingpong:siteInfo",EVENT_LISTENER_ADDED:"pingpong:addEventListener",HEIGHT_CHANGED:"heightChanged",APP_SETTINGS_CHANGED:"appSettingsChanged",APP_SETTINGS_CLOSE:"appSettingsClose",APP_SHOW_POPUP:"appShowPopup"}}),t.methods({initialize:function(){this._setAppMarketUrl(),this._urlBuilder=new this.imports.URLBuilder,this._componentRegistrar=new this.imports.TPAComponentRegistrar,this._addPostMessageCallback(function(e){this.handlePostMessage(e,function(e){var t=$(e);return t&&t.getLogic()})}.bind(this)),this._testAppsDefIds=this._getTestAppsDefIds()},_setAppMarketUrl:function(){if(serviceTopology.baseDomain){var e=serviceTopology.baseDomain.indexOf("wixpress")>1;e&&serviceTopology.baseDomain.indexOf("burger")>-1&&(this.APP_MARKET_URL="http://market.burger.wixpress.com")}},isReady:function(){return!0},_addPostMessageCallback:function(e){this._callbacks=this._callbacks||[],this._callbacks.push(e),window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e)},handlePostMessage:function(e,t){if(typeof e.data!="string")return;var n="";try{n=JSON.parse(e.data)}catch(r){return}var i=n.type;n&&n.intent&&(n.intent===this.TPA_MESSAGE&&i?this._handleTPAMessage(n,i,t):n.intent===this.APP_MARKET_MESSAGE?this._handleAppMarketMessage(n):n.intent===this.TPA_MESSAGE2&&i&&this._handleTPAMessage2(n,i,t))},_handleTPAMessage2:function(e,t,n){var r=e.compId,i=n(r);if(!i)return;if(Object.contains(this.MessageTypes,t)){var s=this._getHandlerFunctionName(t),o=i[s];o?o.apply(i,[{msgData:e.data,callback:function(n){var s=i.getIFrame();s.contentWindow.postMessage(JSON.stringify({intent:this.TPA_RESPONSE,compId:r,callId:e.callId,type:t,res:n,status:!0}),"*")}.bind(this)}]):LOG.reportError("Handler function not found - "+t,"wysiwyg.viewer.managers.TPA","handlePostMessage2")}else LOG.reportError("Unknown post message type - "+t,"wysiwyg.viewer.managers.TPA","handlePostMessage")},_handleTPAMessage:function(e,t,n){var r=e.compId,i=n(r);if(!i)return;if(Object.contains(this.MessageTypes,t)){var s=this._getHandlerFunctionName(t),o=i[s];o?this._isPingPongMessage(t)?o.apply(i,[{msgData:e.data,callback:function(e){var n=i.getIFrame();n.contentWindow.postMessage(JSON.stringify({intent:this.TPA_MESSAGE,compId:r,type:t,data:e}),"*")}.bind(this)}]):o.apply(i,[e.data]):LOG.reportError("Handler function not found - "+t,"wysiwyg.viewer.managers.TPA","handlePostMessage")}else LOG.reportError("Unknown post message type - "+t,"wysiwyg.viewer.managers.TPA","handlePostMessage")},_handleAppMarketMessage:function(e){switch(e.cmd){case"ADD_APP_TO_SITE":this.resources.W.Commands.executeCommand("WEditorCommands.AddApp",e.params,this),this.resources.W.Commands.executeCommand(Constants.EditorUI.CLOSE_PANEL);break;case"ADD_COMPONENT_TO_SITE":e.params&&e.params.compType==="addLoginButton"?this.resources.W.Commands.executeCommand("WEditorCommands.AddSMDependantComponent",{compType:"addLoginButton",styleId:""},this):this.resources.W.CommandsNew.executeCommand("WEditorCommands.AddComponent",e.params,this),this.resources.W.Commands.executeCommand(Constants.EditorUI.CLOSE_PANEL);break;case"OPEN_MARKET_POPUP":this.resources.W.Commands.executeCommand("WEditorCommands.openMarketPopup",e.params,this);break;case"CLOSE_MARKET_POPUP":this.resources.W.Commands.executeCommand("WEditorCommands.closeMarketPopup",e.params,this);break;case"GET_INSTALLED_APPS":var t=W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppsData(),n={eventType:"ON_COMMAND_RESPONSE",callerId:e.id,params:t};this._marketPanelWindow.postMessage(JSON.stringify(n),this.APP_MARKET_URL);break;case"GET_TEST_APPS":this.getTestApps(function(t){var n={eventType:"ON_COMMAND_RESPONSE",callerId:e.id,params:t};this._marketPanelWindow.postMessage(JSON.stringify(n),this.APP_MARKET_URL)}.bind(this))}},setMarketPanelWindow:function(e){this._marketPanelWindow=e},_getHandlerFunctionName:function(e){return this._isPingPongMessage(e)&&(e=e.replace(this.PINGPONG_PREFIX,"")),"handle"+e.capitalize()},_isPingPongMessage:function(e){return e.indexOf(this.PINGPONG_PREFIX)==0},getURLBuilder:function(){return this._urlBuilder},getComponentRegistrar:function(){return this._componentRegistrar},getSectionURL:function(e){var t=this._componentRegistrar.getPageId(e);if(t===null)return null;var n=W.Data.getDataByQuery("#"+t),r=n&&n.get("title"),i=this.getPageState(t),s=this.injects().Viewer.isPublicMode(),o=location.href.replace(location.hash,"");o=s?window.publicModel&&window.publicModel.externalBaseUrl||o:o;var u=o+"#!"+this.injects().Utils.hash.getHashPartsString(t,r);return u=u.charAt(u.length-1)=="/"?u:u+"/",u},_getTestAppsDefIds:function(){var e=[],t=W.Utils.getQueryParam("appDefinitionId");t&&e.push(t);var n=window.editorModel&&window.editorModel.runningApps||{},r="~";return Object.each(n,function(t,n){if(t.toUpperCase()=="ON"){var i=n.lastIndexOf(r),s=i+1;if(n.length>s||i>0){var o=n.substr(s);e.push(o.trim())}}}.bind(this)),e},getTestApps:function(e){e(this._testAppsDefIds)},reportLoadStart:function(e){this._waitForAppAlive(e)},_waitForAppAlive:function(e){e.isAppAlive()||e.callLater(this._onAppAvailableTimeoutExpires,[e],this.LOAD_TIMEOUT*1e3)},_onAppAvailableTimeoutExpires:function(e){e.isAppAlive()||this.showAppNotAvailable(e)},showAppNotAvailable:function(e){e.isRendered()&&e.showErrorPage(),LOG.reportError(wixErrors.APPS_OPEN_TIMEOUT,this.$className,"showAppNotAvailable",e._appData.appDefinitionName)},setPageState:function(e,t){this._stateByPage||(this._stateByPage={}),this._stateByPage[e]=t},getPageState:function(e){var t=this._stateByPage&&this._stateByPage[e];return t||""},getAppDefinitionId:function(e){var t=W.Preview.getPreviewManagers().Viewer.getAppDataHandler().getAppData(e);return t.appDefinitionId},dispose:function(){var e;while(this._callbacks&&this._callbacks.length)e=this._callbacks.pop(),window.removeEventListener?window.removeEventListener("message",e):window.detachEvent&&window.detachEvent("onmessage",e);this.parent()},postMessageEvent:function(e,t){var n=t||this._marketPanelWindow,r=location.protocol+"//"+location.host,i={eventType:e,origin:r};n.postMessage(JSON.stringify(i),this.APP_MARKET_URL)},clone:function(e){return this.parent(e)}})}),define.oldClass({name:"wysiwyg.viewer.managers.tpa.TPAComponentRegistrar",Class:{Static:{SECTION:"section",WIDGETS:"widgets",SECTION_PAGE_ID:"pageId",APPLICATION_ID_KEY:"tpaApplicationId"},initialize:function(){this._componentsByType={},this._componentsByCompId={}},register:function(e,t){t=e.getApplicationId()||t;var n=this._getDataObjectByApplicationId(t);if(e&&e.getOriginalClassName()=="wysiwyg.viewer.components.tpapps.TPASection")n[this.SECTION]=e;else{var r=this._getWidgets(t);r.push(e)}this._componentsByCompId[e.getComponentId()]=e},unregister:function(e,t){t=e.getApplicationId()||t;var n=this._getDataObjectByApplicationId(t);if(e&&e.getOriginalClassName()=="wysiwyg.viewer.components.tpapps.TPASection")delete n[this.SECTION];else{var r=this._getWidgets(t),i=r.indexOfByPredicate(function(t){return t===e}.bind(this));r.splice(i,1)}delete this._componentsByCompId[e.getComponentId()]},getPageId:function(e){var t=W.Data.getDataMap(),n=Object.filter(t,function(t){return t.get("type")=="Page"&&t.get(this.APPLICATION_ID_KEY)==e}.bind(this)),r=Object.values(n);return r.length>0?r[0].get("id")||null:null},_getDataObjectByApplicationId:function(e){return this._componentsByType[e]||(this._componentsByType[e]={}),this._componentsByType[e]},_getByApplicationId:function(e){var t=[].concat(this._getWidgets(e)),n=this.getSection(e);return n&&t.push(n),t},each:function(e,t){var n=this._getByApplicationId(e);Array.each(n,function(e){t(e)})},_getWidgets:function(e){var t=this._getDataObjectByApplicationId(e);return t[this.WIDGETS]||(t[this.WIDGETS]=[]),t[this.WIDGETS]},getSection:function(e){var t=this._getDataObjectByApplicationId(e);return t[this.SECTION]},getComponents:function(){return this._componentsByCompId}}}),define.oldClass({name:"wysiwyg.viewer.managers.tpa.URLBuilder",Class:{buildStateLessUrl:function(e,t,n,r){return this._buildUrlInternal(e,!1,t,n,r)},buildUrl:function(e,t,n,r){return this._buildUrlInternal(e,!0,t,n,r)},_buildUrlInternal:function(e,t,n,r,i){if(!e)return null;var s=function(e){switch(e){case"app-state":return this._getCurrentState();case"instance":return i.instance;case"section-url":var t=r.getSectionURL();return!t||this.injects().Viewer.isPublicMode()?t:o;case"target":var t=r.getSectionURL();return this.injects().Viewer.isPublicMode()?t?"_top":null:"_self";case"width":return r.getViewNode().getWidth();case"locale":return W.Config.getLanguage();case"viewMode":var n=window.viewMode==="site"?W:parent.W,s=n.Viewer.getViewMode()||"unknown";return s;case"origCompId":return this.injects().Editor.getEditedComponent().getComponentId();case"compId":return r.getComponentId();case"cacheKiller":return this._getCacheKiller()}}.bind(this),o="",u=[];return o=e,t&&(o+=this._getCurrentState()),String.contains(o,"?")?o+="&":o+="?",n.push("compId"),Array.each(n,function(e){u.push(e+"="+encodeURIComponent(s(e)))}),o+u.join("&")},_getCacheKiller:function(){return(new Date).getTime().toString()},_getCurrentState:function(){var e=W.Utils.hash.getHashParts(location.hash);return"/"+(e.extData||"")}}}),define.oldClass({name:"wysiwyg.viewer.utils.ComponentSequencer",Class:{Binds:[],Extends:"bootstrap.utils.Events",_pendingElements:[],_createdElements:[],_reusedElements:[],_notifiedOnReady:[],_preExistingElements:[],initialize:function(){},resolveItem:function(e,t,n){},createComponents:function(e,t){this._resolveRefList(t,function(t){this._createCompsFromDataList(e,t)}.bind(this))},reset:function(){this._pendingElements.forEach(function(e){e.removeEvent(Constants.ComponentEvents.READY)}),this._pendingElements=[],this._createdElements=[],this._reusedElements=[],this._preExistingElements=[],this._notifiedOnReady=[]},_resolveRefList:function(e,t){var n=typeOf(e)==="array"?e:e.get("items"),r=[],i=n.length;if(n.length)for(var s=0;s<n.length;s++)this._resolveCompData(n[s],s,function(e,n){r[n]=e,i--,i===0&&t(r)});else t([])},_resolveCompData:function(e,t,n){typeOf(e)==="string"?W.Data.getDataByQuery(e,function(e){n(e,t)}):n(e,t)},_createCompsFromDataList:function(e,t){this._preExistingElements=e.getChildren().slice(0),this._allSetup=!1,this._pendingElements=[],this._createdElements=[],this._reusedElements=[],this._notifiedOnReady=[];for(var n=0;n<t.length;n++)this._setupComponent(e,n,t);this._preExistingElements.forEach(function(e){this._reusedElements.contains(e)||this._removeElement(e)}.bind(this)),this._createdElements.forEach(function(t){e.appendChild(t)}),this._allSetup=!0,this._checkIfAllDone()},_setupComponent:function(e,t,n){var r=n[t],i,s,o=this._findReusableComponent(this._preExistingElements,r);o?(i="reuse",this._reusedElements.push(o)):(i="create",o=this.createComponent(e,r,t,n)),this._createdElements.push(o),this._notifyOnComponentReadyIfNeeded(i,o,t)},createComponent:function(e,t,n,r){var i,s=this.resolveItem(t,n,r),o=typeOf(s),u=this._getCompStyle(e);return o==="element"?(i=s,!i.getLogic&&!i.hasAttribute("comp")&&this._supplyMinimalLogic(i,t),e.adopt(i)):(i=new Element("div"),i.setAttribute("comp",s.comp),i.setAttribute("skin",s.skin),"data"in s&&(t=s.data),this._pendingElements.push(i),this._listenToInnerComponentReady(i,n),e.adopt(i),i.wixify(s.args||{},t,undefined,undefined,u)),i},_notifyOnComponentReadyIfNeeded:function(e,t,n){!this._notifiedOnReady.contains(t)&&!this._pendingElements.contains(t)&&(this._notifiedOnReady.push(t),this.fireEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_COMP_SETUP,{method:e,compView:t,index:n}))},_supplyMinimalLogic:function(e,t){var n={getDataItem:function(){return t},getIsDisplayed:function(){return!0},dispose:function(){t=null}};e.getLogic=function(){return n}},_onAllComponentsReady:function(){var e=this._createdElements.slice(0);this._createdElements=[],this._reusedElements=[],this._preExistingElements=[],this.fireEvent(Constants.ComponentEvents.COMPONENT_SEQUENCER_PRODUCTION_FINISHED,{elements:e})},_removeElement:function(e){e.getLogic&&e.getLogic().dispose(),e.destroy()},_findReusableComponent:function(e,t){var n;for(var r=0;r<e.length;r++){n=e[r];if(n.getLogic&&this._dataItemsIdentical(t,n.getLogic().getDataItem()))return n}},_dataItemsIdentical:function(e,t){if(e===t)return!0;if(e.get&&t.get&&e.hasField("id")&&t.hasField("id")){var n=e.get("id"),r=t.get("id");return n&&r&&n===r}return!1},_getCompStyle:function(e){var t;if(!this._style){t=e;while(t&&!t.getLogic)t=t.getParent();if(t&&t.getLogic&&t.getLogic()&&t.getLogic().getStyle)return t.getLogic().getStyle()}},_listenToInnerComponentReady:function(e,t){e.addEvent(Constants.ComponentEvents.READY,function(){this._pendingElements.erase(e),this._notifyOnComponentReadyIfNeeded("create",e,t),this._checkIfAllDone()}.bind(this))},isPending:function(){return this._pendingElements.length>0},_checkIfAllDone:function(){this._allSetup===!0&&!this.isPending()&&this._onAllComponentsReady()}}}),define.oldClass({name:"wysiwyg.viewer.utils.GalleryUtils",Class:{createActionQueue:function(e,t){var n=[];return function(r){r&&n.push(r);while(n.length>0&&e()===!0){n.length>t&&n.splice(0,n.length-t);var i=n.shift();i&&i.call()}}},createMinimalGalleryDisplayer:function(e,t){var n=Number.random(0,99999).toString(36),r={getViewNode:function(){return e},getRef:function(){return n},getDataItem:function(){return t},setOwner:function(){},invalidateSize:function(){},setSize:function(t,n){var r={width:t,height:n};e.setStyles(r)},dispose:function(){e.destroy(),e=null}};e.getLogic=function(){return r}}}}),define.oldClass({name:"wysiwyg.viewer.utils.MatrixTransitions",imports:["wysiwyg.viewer.utils.TransitionUtils"],Class:{Binds:["_matrixCrossFade","_crossFade","_shrinkFade","_vertSwipe","_horizSwipe","_transitionSequence","_transitionSequenceGenerator","_generalTransition","_destroyHolder","_rotateDiagonalTiming","_noTransition","_timingDiagonalWave"],_transitionUtils:null,_sequenceIndex:0,_positioningFunc:null,_itemsContainer:null,initialize:function(){this._transitionUtils=new this.imports.TransitionUtils},setupTransitionMap:function(e,t){this._positioningFunc=e,this._itemsContainer=t;var n={crossFadeAllAtOnce:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingAllAtOnce)),crossFadeSequential:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),crossFadeHorizWave:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),crossFadeVertWave:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),crossFadeDiagonal:this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingDiagonalWave)),shrinkFadeAllAtOnce:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingAllAtOnce)),shrinkFadeSequential:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),shrinkFadeHorizWave:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),shrinkFadeVertWave:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),shrinkFadeDiagonal:this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingDiagonalWave)),vertSwipeAllAtOnce:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),vertSwipeWave:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),vertSwipeAlternate:this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),horizSwipeAllAtOnce:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),horizSwipeWave:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),horizSwipeAlternate:this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),seq_crossFade_All:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingAllAtOnce)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingHorizontalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingVerticalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_shrink_All:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingAllAtOnce)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingHorizontalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingVerticalWave))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),swipe_horiz_All:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),swipe_vert_All:this._transitionSequence([this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),seq_crossFade_Horiz:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingHorizontalWave)))]),seq_crossFade_Vert:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingVerticalWave)))]),seq_crossFade_Seq:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._reverseTiming(this._timingSequential)))]),seq_crossFade_Diagonal:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._matrixCrossFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_shrink_Horiz:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingHorizontalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingHorizontalWave)))]),seq_shrink_Vert:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingVerticalWave)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingVerticalWave)))]),seq_shrink_Seq:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._timingSequential)),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._reverseTiming(this._timingSequential)))]),seq_shrink_Diagonal:this._transitionSequence([this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,0))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,1))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,2))),this._generalTransition(this._matrixCrossFadePrepare,this._shrinkFade(this._rotateDiagonalTiming(this._timingDiagonalWave,3)))]),seq_swipe_alternate:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeAllAtOnce,this._swipeAlternate))]),seq_swipe_vert_wave:this._transitionSequence([this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._vertSwipePrepare,this._vertSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection))]),seq_swipe_horiz_wave:this._transitionSequence([this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._timingSwipeWave,this._swipeSingleDirection)),this._generalTransition(this._horizSwipePrepare,this._horizSwipe(this._reverseTiming(this._timingSwipeWave),this._swipeSingleDirection))])};n.none=this._generalTransition(this._matrixCrossFadePrepare,this._noTransition),this._transitionMap=n,n.seq_random=this._transitionSequenceGenerator(this._transitionRandomPicker(this.getTransitionList()))},getTransition:function(e){return this._transitionMap[e]},getTransitionList:function(){var e=[];for(var t in this._transitionMap)e.push(t);return e},_generalTransition:function(e,t){return function(n,r,i,s,o,u,a){var f=e(n,r,i,s,this._itemsContainer,this._positioningFunc);t(f,i,s,o,u,a)}.bind(this)},_transitionSequence:function(e){return function(t,n,r,i,s,o,u){this._sequenceIndex=this._sequenceIndex<e.length?this._sequenceIndex:0;var a=e[this._sequenceIndex++],f=typeOf(a)==="function"?a:transMap[a];f(t,n,r,i,s,o,u)}.bind(this)},_transitionSequenceGenerator:function(e){return function(t,n,r,i,s,o,u){var a=e(this._sequenceIndex);a(t,n,r,i,s,o,u)}.bind(this)},_transitionRandomPicker:function(e){return function(){var t=e[parseInt(Math.random()*e.length)];return this._transitionMap[t]}.bind(this)},_destroyHolder:function(e,t){var n=e.children[0];if(n){this._itemsContainer.adopt(n);var r=this._positioningFunc(t);n.setStyles({position:"absolute",left:r.left+"px",top:r.top+"px"})}e.destroy()},_matrixCrossFadePrepare:function(e,t,n,r,i,s){var o=[],u,a,f,l;i.empty();var c=n*r;for(var h=0;h<c;h++)u=new Element("div"),i.adopt(u),a=e[h]||new Element("div"),f=t[h]||new Element("div"),u.adopt(f,a),e[h]||f.setStyles({opacity:"0.0"}),a.setStyles({left:"0px",top:"0px"}),f.setStyles({left:"0px",top:"0px"}),o.push(u),l=s(h),u.setStyles({position:"absolute",left:l.left+"px",top:l.top+"px"});return o},_noTransition:function(e,t,n,r,i,s){e.forEach(this._destroyHolder),s()},_crossFade:function(e,t){var n=this;return function(r,i,s,o,u,a){var f=r.length;for(var l=0;l<r.length;l++)(function(){var o=l;setTimeout(function(){var t=r[o].children[1],i=r[o].children[0];e(t,i,0,u,function(){n._destroyHolder(r[o],o),f--,f<=0&&a()})},t(o,u*1e3,i,s))})()}},_matrixCrossFade:function(e){return this._crossFade(this._transitionUtils.getTransition(Constants.TransitionTypes.CROSS_FADE),e)},_shrinkFade:function(e){return this._crossFade(this._transitionUtils.getTransition(Constants.TransitionTypes.SHRINK_FADE),e)},_vertSwipePrepare:function(e,t,n,r,i,s){var o=[],u,a,f,l,c,h,p,d,v;i.empty(),v=s(r*n).top;var m=n*r;for(var g=0;g<n;g++){u=new Element("div"),i.adopt(u),p=new Element("div"),u.adopt(p),d=new Element("div"),u.adopt(d),p.setStyles({position:"absolute",top:"0px",height:v+"px"}),d.setStyles({position:"absolute",top:v+"px",height:v+"px"});for(var y=0;y<r;y++)c=y*n+g,h=s(c),a=e[c]||new Element("div"),f=t[c]||new Element("div"),d.adopt(f),p.adopt(a),a.setStyles({left:"0px",top:h.top+"px"}),f.setStyles({left:"0px",top:h.top+"px"});o.push(u),l=s(g),u.setStyles({position:"absolute",left:l.left+"px"})}return o},_horizSwipePrepare:function(e,t,n,r,i,s){var o=[],u,a,f,l,c,h,p,d,v;i.empty(),h=s(n-1),v=h.left+h.width;var m=n*r;for(var g=0;g<r;g++){u=new Element("div"),i.adopt(u),p=new Element("div"),u.adopt(p),d=new Element("div"),u.adopt(d),p.setStyles({position:"absolute",left:"0px",width:v+"px"}),d.setStyles({position:"absolute",left:v+"px",width:v+"px"});for(var y=0;y<n;y++)c=g*n+y,h=s(c),a=e[c]||new Element("div"),f=t[c]||new Element("div"),d.adopt(f),p.adopt(a),a.setStyles({top:"0px",left:h.left+"px"}),f.setStyles({top:"0px",left:h.left+"px"});o.push(u),l=s(g*n),u.setStyles({position:"absolute",top:l.top+"px"})}return o},_vertSwipe:function(e,t){var n=this._transitionUtils.getTransition(Constants.TransitionTypes.SWIPE_VERTICAL),r=this;return function(i,s,o,u,a,f){var l=i.length;for(var c=0;c<i.length;c++)(function(){var o=c;setTimeout(function(){t(n,i,o,u,a,function(){var e=i[o].children[1].children;for(var t=e.length-1;t>=0;t--){var n=e[t];r._itemsContainer.adopt(n);var u=r._positioningFunc(t*s+o);n.setStyles({position:"absolute",left:u.left+"px",top:u.top+"px"})}i[o].destroy(),l--,l<=0&&f()})},e(o,a*1e3,i.length))})()}},_horizSwipe:function(e,t){var n=this._transitionUtils.getTransition(Constants.TransitionTypes.SWIPE_HORIZONTAL),r=this;return function(i,s,o,u,a,f){var l=i.length;for(var c=0;c<i.length;c++)(function(){var o=c;setTimeout(function(){t(n,i,o,u,a,function(){var e=i[o].children[1].children;for(var t=e.length-1;t>=0;t--){var n=e[t];r._itemsContainer.adopt(n);var u=r._positioningFunc(o*s+t);n.setStyles({position:"absolute",left:u.left+"px",top:u.top+"px"})}i[o].destroy(),l--,l<=0&&f()})},e(o,a*1e3,i.length))})()}},_swipeSingleDirection:function(e,t,n,r,i,s){e(t[n].children[0],t[n].children[1],r,i,s)},_swipeAlternate:function(e,t,n,r,i,s){n%2===0?e(t[n].children[0],t[n].children[1],r,i,s):(r=r==0?1:0,e(t[n].children[0],t[n].children[1],r,i,s))},_timingAllAtOnce:function(e,t,n,r){return 0},_timingSequential:function(e,t,n,r){return e/(n*r)*t},_timingHorizontalWave:function(e,t,n,r){var i=e%n,s=Math.floor((e-i)/n);return i/n*t},_timingVerticalWave:function(e,t,n,r){var i=e%n,s=Math.floor((e-i)/n);return s/r*t},_reverseTiming:function(e){return function(t,n){return n-e.apply(this,arguments)}},_standardDiagonalDistFunc:function(e,t){return Math.sqrt(e*e+t*t)},_timingDiagonalWave:function(e,t,n,r,i){i=i||this._standardDiagonalDistFunc;var s=e%n,o=Math.floor((e-s)/n),u=i(s,o,n,r),a=Math.sqrt(n*n+r*r);return u/a*t},_timingSwipeAllAtOnce:function(e,t,n){return 0},_timingSwipeWave:function(e,t,n){return(.6+e*.4/n)*t},_rotateDiagonalTiming:function(e,t){var n,r=this;return t<=0||t>3?n=this._standardDiagonalDistFunc:t==1?n=function(e,t,n,i){return r._standardDiagonalDistFunc(n-e,t)}:t==2?n=function(e,t,n,i){return r._standardDiagonalDistFunc(n-e,i-t)}:n=function(e,t,n,i){return r._standardDiagonalDistFunc(e,i-t)},function(t,r,i,s){return e(t,r,i,s,n)}}}}),define.Class("wysiwyg.viewer.utils.MessageViewController",function(e){var t=e;t.binds(["_showMessageBox","_messageBoxClosed"]),t.inherits("bootstrap.managers.BaseManager"),t.methods({initialize:function(){this._messagesQueue=[],this.BETWEEN_MESSAGES_DELAY=700},_initIfNeededMessageView:function(e){this._messageBox?e&&e():this._messageBox=W.Components.createComponent("wysiwyg.viewer.components.MessageView","wysiwyg.viewer.skins.MessageViewSkin",null,null,function(e){$$("body").adopt(this._messageBox),this._messageBox.getLogic().addEvent("complete",this._messageBoxClosed)}.bind(this),e)},showError:function(e,t){var n={};n.msgTitle=e,n.msgBody=t,this._messagesQueue.push(n),this._initIfNeededMessageView(this._showMessageBox)},showMessage:function(e,t,n){var r={};r.msgTitle=e,r.msgBody=t,r.cb=n,this._messagesQueue.push(r),this._initIfNeededMessageView(this._showMessageBox)},_showMessageBox:function(){this._messagesQueue.length>0&&!this._messageBox.getLogic().visible()&&this._messageBox.getLogic().showMessage(this._messagesQueue.shift())},_messageBoxClosed:function(){setTimeout(function(){this._showMessageBox()}.bind(this),this.BETWEEN_MESSAGES_DELAY)},kill:function(){this._messageBox&&(this._messageBox.dispose(),this._messageBox.removeFromDOM())},isReady:function(){return!0},clone:function(e){return this.parent(e)}})}),define.oldClass({name:"wysiwyg.viewer.utils.TransitionUtils",Class:{Binds:["_swipeHorizontalTransition","_swipeHorizontalTransitionFullScreen","_swipeVerticalTransition","_swipeVerticalTransitionFullScreen","_noTransition","_inOutTransition","_crossFadeTransition","_shrinkFadeTransition","_trackCallback"],_useCSS3:!1,initialize:function(){this._Tween=W.Utils.Tween},getTransition:function(e){switch(e){case Constants.TransitionTypes.SWIPE_HORIZONTAL:return this._swipeHorizontalTransition;case Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN:return this._swipeHorizontalTransitionFullScreen;case Constants.TransitionTypes.SWIPE_VERTICAL:return this._swipeVerticalTransition;case Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN:return this._swipeVerticalTransitionFullScreen;case Constants.TransitionTypes.CROSS_FADE:return this._crossFadeTransition;case Constants.TransitionTypes.SHRINK_FADE:return this._shrinkFadeTransition;case Constants.TransitionTypes.OUT_IN:return this._inOutTransition;case Constants.TransitionTypes.NONE:default:return this._noTransition}},_noTransition:function(e,t,n,r,i){i()},_swipeHorizontalTransition:function(e,t,n,r,i){var s=e.getWidth();this._swipeHorizontalTransitionCommon(e,t,n,r,s,i)},_swipeHorizontalTransitionFullScreen:function(e,t,n,r,i){var s=e.getContentRect(),o=Math.max($(document).getSize().x-s.left,s.right),u=o-t.getContentRect(t).left;this._swipeHorizontalTransitionCommon(e,t,n,r,u,i)},_swipeHorizontalTransitionCommon:function(e,t,n,r,i,s){var o=e.getParent(),u=this.injects().Utils.getCSSBrowserFeature("animation"),a=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),f={};e.setStyles({position:"absolute"}),t.setStyles({position:"absolute"}),n!==0&&(i=-i),t.setStyle("left",i+"px"),this._useCSS3&&u?(f.left=i+"px",f["margin-left"]=String(-i)+"px",f[u]="swipeHoriz "+r+"s",f[a]="ease-in-out",o.setStyles(f),setTimeout(function(){o.setStyle(u,""),o.setStyles({left:"0px","margin-left":"0px"}),t.setStyles({left:"0px"}),s()},1e3*r)):this._Tween.to(o,r,{left:String(-i),ease:"strong_easeInOut",onComplete:function(){t.setStyles({left:"0px"}),o.setStyles({top:"0px",left:"0px"}),s()}})},_swipeVerticalTransition:function(e,t,n,r,i){var s=e.getHeight();this._swipeVerticalTransitionCommon(e,t,n,r,s,i)},_swipeVerticalTransitionFullScreen:function(e,t,n,r,i){var s=e.getCoordinates().top+t.getHeight();this._swipeVerticalTransitionCommon(e,t,n,r,s,i)},_swipeVerticalTransitionCommon:function(e,t,n,r,i,s){var o=e.getParent(),u=this.injects().Utils.getCSSBrowserFeature("animation"),a=this.injects().Utils.getCSSBrowserFeature("animation-timing-function"),f={};e.setStyles({position:"absolute"}),t.setStyles({position:"absolute"}),n!==0&&(i=-i),t.setStyle("top",i+"px"),this._useCSS3&&u?(f.top=i+"px",f["margin-top"]=String(-i)+"px",f[u]="swipeVert "+r+"s",f[a]="ease-in-out",o.setStyles(f),setTimeout(function(){o.setStyle(u,""),o.setStyles({top:"0px","margin-top":"0px"}),t.setStyles({top:"0px"}),s()},1e3*r)):this._Tween.to(o,r,{top:String(-i),ease:"strong_easeInOut",onComplete:function(){t.setStyles({top:"0px"}),o.setStyles({top:"0px",left:"0px"}),s()}})},_crossFadeTransition:function(e,t,n,r,i){var s=this.injects().Utils.getCSSBrowserFeature("animation");e.setStyles({position:"absolute"}),t.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0"}),this._useCSS3&&s?(e.setStyle(s,"fadeOut "+r+"s"),t.setStyle(s,"fadeIn "+r+"s"),setTimeout(function(){t.setStyle(s,""),e.setStyle(s,""),t.setStyles({position:"absolute"}),i()},1e3*r)):(e.setStyles({opacity:"1.0"}),t.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(e,r,{opacity:0,ease:"swing"}),this._Tween.to(t,r,{opacity:1,ease:"swing",onComplete:function(){i()}}))},_shrinkFadeTransition:function(e,t,n,r,i){var s=e.getCoordinates(),o=e.getParent();e.setStyles({position:"absolute",top:"0px",left:"0px"}),t.setStyles({position:"absolute",top:"0px",left:"0px"});var u=new Element("div");u.setStyles({position:"absolute",width:s.width+"px",height:s.height+"px",overflow:"hidden"}),o.adopt(u),u.adopt(e),this._Tween.to(u,r,{top:parseInt(s.height/2)+"px",left:parseInt(s.width/2)+"px",width:"0px",height:"0px",ease:"swing",onComplete:function(){u.getParent().adopt(e),u.destroy(),i()}})},_inOutTransition:function(e,t,n,r,i){var s=this.injects().Utils.getCSSBrowserFeature("animation");e.setStyles({position:"absolute"}),t.setStyles({position:"relative",top:"0px",left:"0px",opacity:"0.0",visibility:"visible"}),this._useCSS3&&s?(e.setStyle(s,"fadeOut "+r+"s"),t.setStyle(s,"fadeIn "+r+"s "+r+"s"),setTimeout(function(){e.setStyle(s,""),e.setStyles({opacity:"0.0"}),setTimeout(function(){t.setStyle(s,""),t.setStyles({opacity:"1.0"}),t.setStyles({position:"absolute"}),i()},1e3*r)},1e3*r)):(e.setStyles({opacity:"1.0"}),t.setStyles({opacity:"0.0",visibility:"visible"}),this._Tween.to(e,r*1.2,{opacity:0,ease:"strong_easeOut"}),this._Tween.to(t,r,{opacity:1,ease:"strong_easeIn",onComplete:function(){i()}}))},_frameRateTrackingActive:!1,_frameRateCount:0,_trackStartTime:0,_startTracking:function(){this._frameRateTrackingActive=!0,this._frameRateCount=0,this._trackStartTime=(new Date).getTime(),window.requestAnimFrame(this._trackCallback)},_stopTracking:function(){this._frameRateTrackingActive=!1;var e=((new Date).getTime()-this._trackStartTime)/1e3},_trackCallback:function(){this._frameRateCount++,this._frameRateTrackingActive&&window.requestAnimFrame(this._trackCallback)}}}),define.oldComponent({name:"wysiwyg.viewer.components.AdminLogin",imports:[],skinParts:{blockingLayer:{type:"htmlElement"},passwordInput:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},submitButton:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.PasswordLogin.Close"},favIcon:{type:"htmlElement"},header:{type:"htmlElement"},dialog:{type:"htmlElement"}},Class:{Extends:"wysiwyg.viewer.components.PasswordLogin",Binds:["centerDialog","_onSubmit","_reportError","_invalidateErrorState","_onKeyPress"],Static:{},_states:["normal","confirm"],initialize:function(e,t,n){this.isVolatile=!0,!window.userApi&&window.UserApi?this._userApi=window.UserApi.getInstance().init({orgDocID:"",usersDomain:window.usersDomain||'https://users.wix.com/wix-users";',corsEnabled:!0,dontHandShake:!0,urlThatUserRedirectedFrom:""}):this._userApi=window.userApi,this.parent(e,t,n),this.VIEWER_STRINGS.LOGIN_HEADER="Login to edit your site",this.ERR_MAP={9975:this.VIEWER_STRINGS.LOGIN_ERR_GENERAL,9972:this.VIEWER_STRINGS.LOGIN_ERR_WRONG_PASSWORD}},_validatePassword:function(e,t,n){var r=this._validateInput(e);if(!r){var i=window.rendererModel,s=i.metaSiteId,o=i.siteId,u=window.siteHeader.userId,a=this.injects().Config.getServiceTopologyProperty("serverName"),f=!1,l=this.injects().Config.getServiceTopologyProperty("htmlEditorUrl")+"/editor/web/renderer/edit/"+o+"?metaSiteId="+s;if(!this._userApi){this._reportError(this.VIEWER_STRINGS.LOGIN_ERR_GENERAL);return}this._userApi.loginByGuid(u,e,f,function(e){n(this.VIEWER_STRINGS.LOGIN_ERR_GENERAL)}.bind(this),function(e){var r=e.success;if(r)t(),(this.injects().Viewer.isPublicMode()||this._debugMode)&&window.open(l,"_blank");else{var i=this.ERR_MAP[e.errorCode]||this.ERR_MAP[9975];n(i)}}.bind(this))}else n(r)},_onSubmit:function(){this.injects().Viewer.isPublicMode()?this.parent():this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this._skinParts.submitButton},this)},_validateInput:function(e){var t=e.length;return t<4||t>15?this.ERR_MAP[9972]:e.test(/^[a-zA-Z0-9_\-!@#$%^&*]+$/)==0?this.ERR_MAP[9972]:null},getAcceptableDataTypes:function(){return["Text"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.AdminLoginButton",skinParts:{label:{type:"htmlElement"},link:{type:"htmlElement"}},propertiesSchemaName:"ButtonProperties",traits:["wysiwyg.common.components.traits.LinkableComponent"],Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0}},Extends:"wysiwyg.viewer.components.SiteButton",initialize:function(e,t,n){this.parent(e,t,n)}}}),define.component("wysiwyg.viewer.components.AudioPlayer",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.binds(["_play","_pause","_stop","_setVolume","_onApiLoaded","_createAudioPlayer","_soundManagerReady"]),t.resources(["scriptLoader","W.Config"]),t.skinParts({playButton:{type:"htmlElement"},stopButton:{type:"htmlElement"},pauseButton:{type:"htmlElement"}}),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"AUDIO_REPLACE_AUDIO",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"audio"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"audio"},commandParameterDataRef:"SELF"}}}),t.states(["loading","stopped","playing"]),t.dataTypes(["AudioPlayer"]),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.setState("loading"),this._loadApi()},_onAllSkinPartsReady:function(e){this.$class._audioManagerWasLoaded&&this.setState("stopped"),this._createAudioPlayer()},_createAudioPlayer:function(){if(!this.$class._audioManagerWasLoaded){W.Utils.callLater(this._createAudioPlayer,null,this,10);return}this._skinParts.playButton.addEvent("click",this._play),this._skinParts.stopButton.addEvent("click",this._stop),this._skinParts.pauseButton.addEvent("click",this._pause),this.injects().Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange),this.$class._audioManagerWasLoaded&&(this._audio=this._createAudioObject()),!this.injects().Viewer.getPreviewMode()&&this.getIsDisplayed()&&this._data.get("autoPlay")&&this._play()},_onModeChange:function(e){this._isInPreviewMode(e)&&this.getIsDisplayed()&&this._data.get("autoPlay")&&this._fileWasSet()?this._play():this._stop()},_fileWasSet:function(){return this._data.get("uri").length>0},_isInPreviewMode:function(e){return e.toLowerCase()===Constants.ViewManager.VIEW_MODE_PREVIEW.toLowerCase()},_play:function(){if(this._fileWasSet()){this.setState("playing");var e={volume:this._data.get("volume")};this._data.get("loop")&&(e.onfinish=this._play),this._audio&&this._audio.play(e)}},_pause:function(){this._fileWasSet()&&(this.setState("stopped"),this._audio.pause())},_stop:function(){this._fileWasSet()&&this._audio&&(this.setState("stopped"),this._audio.stop(),this._audio.destruct(),this._audio=this._createAudioObject())},_createAudioObject:function(){return soundManager.createSound({id:this._view.getAttribute("id"),url:this._getFullUrl(this._data.get("uri"))})},_getFullUrl:function(e){if(e.indexOf("http://")===-1){var t=window.serviceTopology.staticAudioUrl;return t[t.length-1]!=="/"&&(t+="/"),t+=e,t}return e},_setVolume:function(e){var t=e.value||100;this._audio.volume=t/100},_onDataChange:function(e){this.parent(e),this._stop()},_getSoundManagerFolder:function(){var e=this.resources.W.Config.getServiceTopologyProperty("scriptsRoot");return e[e.length-1]!=="/"&&(e+="/"),e+="resources/wysiwyg/media/soundmanager2/",e},_onApiLoaded:function(){soundManager=new SoundManager,soundManager.setup({url:this._getSoundManagerFolder(),onready:this._soundManagerReady}),soundManager.beginDelayedInit()},_soundManagerReady:function(){this.$class._audioManagerWasLoaded=!0,this.$class._soundManagerReadyCallbacks&&this.$class._soundManagerReadyCallbacks.forEach(function(e){e()})},_loadApi:function(){SM2_DEFER=!0,this.$class.audioApiLoaded||(this.$class.audioApiLoaded=!0,this.resources.scriptLoader.loadResource({url:this._getSoundManagerFolder()+"soundmanager2-nodebug-jsmin.js"},{onLoad:this._onApiLoaded,onFailed:function(){LOG.reportError("failed to load soundmanager2")}})),this.$class._soundManagerReadyCallbacks=this.$class._soundManagerReadyCallbacks||[],this.$class._soundManagerReadyCallbacks.push(this.setState.bind(this,"stopped"))},onPageVisibilityChange:function(e){if(window.viewMode==="editor")return;!e&&this.getState()==="playing"?this._pause():e&&this._data.get("autoPlay")&&this.getState()!=="playing"&&this._play()}})}),define.oldComponent({name:"wysiwyg.viewer.components.ClipArt",skinParts:{link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*"}},propertiesSchemaName:"WPhotoProperties",traits:["wysiwyg.common.components.traits.LinkableComponent"],Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"CLIP_ART_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"clipart"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"clipart"}}},Extends:"wysiwyg.viewer.components.WPhoto",initialize:function(e,t,n){this.parent(e,t,n),this.setComponentProperty("displayMode","stretch")}}}),define.oldComponent({name:"wysiwyg.viewer.components.ContactForm",skinParts:{nameLabel:{type:"htmlElement"},name:{type:"htmlElement"},emailLabel:{type:"htmlElement"},email:{type:"htmlElement"},subjectLabel:{type:"htmlElement"},subject:{type:"htmlElement"},messageLabel:{type:"htmlElement"},message:{type:"htmlElement"},notifications:{type:"htmlElement"},send:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onButtonClick","_sendEmailCompleted"],_states:["editing","errors","processing"],initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this._lists={enabled:!1,storeId:null,accessToken:null},this._metaSiteId=null,this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]},Resources:{en:{CONTACT_FORM_LABEL_NAME:"Name",CONTACT_FORM_LABEL_EMAIL:"Email",CONTACT_FORM_LABEL_SUBJECT:"Subject",CONTACT_FORM_LABEL_MESSAGE:"Message",CONTACT_FORM_LABEL_SENDING:"Sending...",CONTACT_FORM_LABEL_SENT_SUCCESSFULLY:"Your email was sent successfully!",CONTACT_FORM_BUTTON_SEND:"Send",CONTACT_FORM_ERROR_NAME_MISSING:"Please add your name",CONTACT_FORM_ERROR_EMAIL_INVALID:"Please add a valid email",CONTACT_FORM_ERROR_MESSAGE_MISSING:"Please add a message",CONTACT_FORM_ERROR_OWNER_NOT_DEFINED:"Owner email address not set",CONTACT_FORM_ERROR_GENERAL:"Error sending email, please try again later",CONTACT_FORM_EMAIL_SUBJECT:"New message via your Wix website, from - ",CONTACT_FORM_EMAIL_SUBSTITUTE_NO_SUBJECT:"<no subject>",CONTACT_FORM_EMAIL_HTML_TEMPLATE:"<strong>You have a new message</strong><br/>via: WIX___THE_CURRENT_WEBSITE___<br/><br/><strong>Message details:</strong><br/>From: WIX___SENDER_NAME___<br/>Email: WIX___SENDER_EMAIL___<br/>Date: WIX___FORMATTED_DATE___<br/>Subject: WIX___MESSAGE_SUBJECT___<br/><br/><strong>Message:</strong><br/>WIX___MESSAGE_BODY___<br/><br/><br/>Thank you for using Wix.com!",CONTACT_FORM_EMAIL_TEXT_TEMPLATE:"You have a new message\nvia: WIX___THE_CURRENT_WEBSITE___\n\nMessage details:\nFrom: WIX___SENDER_NAME___\nEmail: WIX___SENDER_EMAIL___\nDate: WIX___FORMATTED_DATE___\nSubject: WIX___MESSAGE_SUBJECT___\n\nMessage:\nWIX___MESSAGE_BODY___\n\n\nThank you for using Wix.com!",PREMIUM_CONTACT_FORM_LABEL_NAME:"Name",PREMIUM_CONTACT_FORM_LABEL_EMAIL:"Email",PREMIUM_CONTACT_FORM_LABEL_SUBJECT:"Subject",PREMIUM_CONTACT_FORM_LABEL_MESSAGE:"Message",PREMIUM_CONTACT_FORM_LABEL_SENDING:"Sending...",PREMIUM_CONTACT_FORM_LABEL_SENT_SUCCESSFULLY:"Your email was sent successfully!",PREMIUM_CONTACT_FORM_BUTTON_SEND:"Send",PREMIUM_CONTACT_FORM_ERROR_NAME_MISSING:"Please add your name",PREMIUM_CONTACT_FORM_ERROR_EMAIL_INVALID:"Please add a valid email",PREMIUM_CONTACT_FORM_ERROR_MESSAGE_MISSING:"Please add a message",PREMIUM_CONTACT_FORM_ERROR_OWNER_NOT_DEFINED:"Owner email address not set",PREMIUM_CONTACT_FORM_ERROR_GENERAL:"Error sending email, please try again later",PREMIUM_CONTACT_FORM_EMAIL_SUBJECT:"New message via your website, from - ",PREMIUM_CONTACT_FORM_EMAIL_SUBSTITUTE_NO_SUBJECT:"<no subject>",PREMIUM_CONTACT_FORM_EMAIL_HTML_TEMPLATE:"<strong>You have a new message</strong><br/>via: WIX___THE_CURRENT_WEBSITE___<br/><br/><strong>Message details:</strong><br/>From: WIX___SENDER_NAME___<br/>Email: WIX___SENDER_EMAIL___<br/>Date: WIX___FORMATTED_DATE___<br/>Subject: WIX___MESSAGE_SUBJECT___<br/><br/><strong>Message:</strong><br/>WIX___MESSAGE_BODY___<br/><br/><br/>Thank you!",PREMIUM_CONTACT_FORM_EMAIL_TEXT_TEMPLATE:"You have a new message\nvia: WIX___THE_CURRENT_WEBSITE___\n\nMessage details:\nFrom: WIX___SENDER_NAME___\nEmail: WIX___SENDER_EMAIL___\nDate: WIX___FORMATTED_DATE___\nSubject: WIX___MESSAGE_SUBJECT___\n\nMessage:\nWIX___MESSAGE_BODY___\n\n\nThank you!"},get:function(e,t){return this.en[t]}},_onAllSkinPartsReady:function(){function e(e){this.set("placeholder",e);if(window.Modernizr&&!window.Modernizr.input.placeholder){var t=function(){var e=this;e.get("value")==""&&e.get("placeholder")&&(e.addClass("isPlaceholder"),e.set("value",e.get("placeholder")))}.bind(this),n=function(){var e=this;e.hasClass("isPlaceholder")&&(e.removeClass("isPlaceholder"),e.set("value",""))}.bind(this);this.hasPlaceholder||(this.hasPlaceholder=!0,this.addEvent("focus",n),this.addEvent("blur",t)),t()}}this.setHeight(this._skin._height||180),this.setState("editing"),this._skinParts.send.addEvent("click",this._onButtonClick),this._skinParts.send.enable=function(){this.removeProperty("disabled")}.bind(this._skinParts.send),this._skinParts.send.disable=function(){this.set("disabled","true")}.bind(this._skinParts.send),this._skinParts.name.setPlaceholder=e.bind(this._skinParts.name),this._skinParts.email.setPlaceholder=e.bind(this._skinParts.email),this._skinParts.subject.setPlaceholder=e.bind(this._skinParts.subject)},render:function(){this._skinParts.nameLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_NAME"))),this._skinParts.emailLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_EMAIL"))),this._skinParts.subjectLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SUBJECT"))),this._skinParts.messageLabel.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_MESSAGE"))),this._skin.hidePlaceholders!==!0&&(this._skinParts.name.setPlaceholder(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_NAME"))),this._skinParts.email.setPlaceholder(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_EMAIL"))),this._skinParts.subject.setPlaceholder(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SUBJECT")))),this._skinParts.send.set("text",this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_BUTTON_SEND")))},_prepareForRender:function(){try{this._metaSiteId=rendererModel.metaSiteId,this._metaSiteId||(this._metaSiteId="dc853130-4fb2-464f-878d-3b6667dc4f97");if(this._lists.enabled){var e=rendererModel.serviceMappings;for(var t in e)if(e[t].applicationType=="WixLists"){this._lists.storeId=e[t].idInApp;break}}}catch(n){}return this.parent()},_onButtonClick:function(){try{var e={name:this._skinParts.name.get("value").trim(),email:this._skinParts.email.get("value").trim(),subject:this._skinParts.subject.get("value").trim(),message:this._skinParts.message.get("value").trim()};this._validateForm(e),this._submitForm(e,this._metaSiteId,this._getWebsiteUrl(),new Date)}catch(t){this._skinParts.send.enable(),this.setState("errors"),this._setNotificationMessage(t.type=="validation-error"?t.message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_GENERAL")))}},_getWebsiteUrl:function(){var e=window.location.origin||window.location.href.substring(0,window.location.href.indexOf(window.location.pathname));return this._isPreviewMode()?e:window.publicModel&&publicModel.externalBaseUrl||e},_isPreviewMode:function(){return this.injects().Viewer.getViewMode()!="site"},_addPremiumPrefixToIdIfNeeded:function(e){return this.injects().Viewer.isPremiumUser()&&(e="PREMIUM_"+e),e},_validateForm:function(e){if(e.name.length<1)throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_NAME_MISSING"))};var t=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!t.test(e.email))throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_EMAIL_INVALID"))};if(e.message.length<1)throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_MESSAGE_MISSING"))};var n=this._data.get("toEmailAddress");if(!n||n.trim()==0)throw{type:"validation-error",message:this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_OWNER_NOT_DEFINED"))}},_submitForm:function(e,t,n,r){this.setState("processing"),this._setNotificationMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SENDING"))),this._skinParts.send.disable(),e.subject.length==0&&(e.subject=this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_SUBSTITUTE_NO_SUBJECT")));var i=this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_SUBJECT")),s=this._formatMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_HTML_TEMPLATE")),e,n,!0,r),o=this._formatMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_EMAIL_TEXT_TEMPLATE")),e,n,!1,r),u=this._data.get("toEmailAddress"),a=this._data.get("bccEmailAddress");i+=u,this.sendEmail([{address:u,personal:u}],[],a?[{address:a,personal:a}]:[],{address:e.email,personal:e.name},i,s,o,t,this._sendEmailCompleted);try{this._createListEntry(e)}catch(f){}},_sendEmailCompleted:function(e,t){this._skinParts.send.enable(),e?(this.setState("editing"),this._setNotificationMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_LABEL_SENT_SUCCESSFULLY"))),this._cleanForm()):(this.setState("errors"),this._setNotificationMessage(this.Resources.get("VIEWER_LANGUAGE",this._addPremiumPrefixToIdIfNeeded("CONTACT_FORM_ERROR_GENERAL"))))},_cleanForm:function(){this._skinParts.name.set("value",""),this._skinParts.email.set("value",""),this._skinParts.subject.set("value",""),this._skinParts.message.set("value","")},_formatMessage:function(e,t,n,r,i){var s=function(e){return e?String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},o=function(e){return r?s(e):e},u=e;return u=u.replace(/WIX___THE_CURRENT_WEBSITE___/g,n),u=u.replace("WIX___SENDER_NAME___",o(t.name)),u=u.replace("WIX___SENDER_EMAIL___",t.email),u=u.replace("WIX___MESSAGE_SUBJECT___",o(t.subject)),u=u.replace("WIX___MESSAGE_BODY___",o(t.message)),u=u.replace("WIX___FORMATTED_DATE___",this._formatDate(i)),u},_formatDate:function(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],n=e.getDate(),r=e.getMonth(),i=e.getFullYear();return(n<10?"0":"")+n+" "+t[r]+" "+i},_setNotificationMessage:function(e){this._skinParts.notifications.set("text",e),e.trim()==""?this._skinParts.notifications.collapse():this._skinParts.notifications.uncollapse()},sendEmail:function(e,t,n,r,i,s,o,u,a){var f={to:e,cc:t,bcc:n,from:r,subject:i,htmlMessage:s,plainTextMessage:o,metaSiteId:u},l=this.injects(),c=l.Config.getServiceTopologyProperty("emailServer"),h=this._isPreviewMode();h&&(c+="Secured");var p=[];p.push(c),p.push("?accept=json&contentType=json"),p.push("&appUrl="+encodeURIComponent(window.location.href)),h&&p.push("&wixSession="+l.CookiesManager.getCookie("wixSession")),this._sendJsonCORS(p.join(""),f,"POST",a)},_sendJsonCORS:function(url,data,method,onComplete){var createXHR=function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?(n.open(e,t,!0),n.withCredentials="true"):typeof XDomainRequest!="undefined"&&(n=new XDomainRequest,n.open(e,t),n.setRequestHeader=function(e,t){}),n},parseResponseJSON=function(responseText){if(!xhr.responseText)return{success:!1,errorDescription:"Invalid ajax response, no responseText",errorCode:-9001};var parser=JSON.parse?JSON.parse:eval;try{return parser(responseText)}catch(e){return{success:!1,errorDescription:"Invalid JSON object",errorCode:-9e3}}},errorToString=function(e){return e.errorDescription+" ("+e.errorCode+")"},xhr=createXHR(method,url);xhr.onabort=function(){onComplete(!1,"request aborted")},xhr.ontimeout=function(){onComplete(!1,"request timeout")},xhr.onerror=function(){onComplete(!1,errorToString(parseResponseJSON(xhr.responseText)))},xhr.onload=function(){var e=parseResponseJSON(xhr.responseText);onComplete(e.success,e.success?e:errorToString(e))},xhr.setRequestHeader("Content-Type","application/json"),xhr.send(JSON.encode(data))},_createListEntry:function(e){if(!this._lists.enabled||!this._lists.storeId)return;var t=window.location.origin||window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)),n="/apps/lists/1/stores/"+this._lists.storeId+"/collections/ContactForms,online",r={_type:"BasicForms.ContactForm",name:e.name,email:e.email,subject:e.subject,message:e.message,createdAt:(new Date).getTime(),sourceForm:this._view.get("id")},i=function(){var e=function(e){}.bind(this),i=new Request.JSON({url:t+n,urlEncoded:!1,headers:{"If-Modified-Since":"Sat, 1 Jan 2005 00:00:00 GMT","Content-Type":"application/json; charset=utf-8",Accept:"application/json",AccessToken:this._lists.accessToken},onSuccess:e,onFailure:e});i.post(JSON.encode(r))}.bind(this);this._validateListAccessToken(i)},_validateListAccessToken:function(e){if(!this._lists.enabled)return;if(this._lists.accessToken){e();return}var t=window.location.origin||window.location.href.substring(0,window.location.href.indexOf(window.location.pathname)),n="/apps/lists/1/auth/contact-forms?storeId="+this._lists.storeId,r=function(t){try{t.success&&(this._lists.accessToken=t.payload,e())}catch(n){}}.bind(this),i=function(e){},s=new Request.JSON({url:t+n,urlEncoded:!1,headers:{"If-Modified-Since":"Sat, 1 Jan 2005 00:00:00 GMT",Accept:"application/json"},onSuccess:r,onFailure:i});s.get()},getAcceptableDataTypes:function(){return["ContactForm"]}}}),define.component("wysiwyg.viewer.components.Displayer",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({image:{type:"core.components.Image",dataRefField:"*",optional:!1},imageWrapper:{type:"htmlElement",optional:!1},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1},rolloverHitArea:{type:"htmlElement",optional:!0}}),t.binds(["_onMouseOver","_onMouseOut","_onZoomClick","_onImageStateChange","_onOwnerPropsChanged"]),t.traits(["wysiwyg.common.components.traits.LinkableComponent","wysiwyg.common.components.traits.SelectableOption"]),t.states({general:["loading","normal","rollover"],transitionPhase:["noTransition","transIn","transOut"],linkableComponent:["link","noLink"],selectState:["selected","unselected"]}),t.dataTypes(["Image"]),t.fields({_renderTriggers:[Constants.DisplayEvents.SKIN_CHANGE],_parentList:null,_owner:null,_expandEnabled:!0,_debugMode:!1,_lastSetSizeParams:null}),t.methods({initialize:function(e,t,n){this._NO_LINK_PROPAGATION=!0,t.setStyle("visibility","hidden"),this.parent(e,t,n)},render:function(){this._refreshImage(),this.parent()},setOwner:function(e){this._owner&&this._owner.getComponentProperties().removeEvent(Constants.DataEvents.DATA_CHANGED,this._onOwnerPropsChanged),this._owner=e,this._parentList=this._owner.getDataItem(),this._owner.getComponentProperties().addEvent(Constants.DataEvents.DATA_CHANGED,this._onOwnerPropsChanged),this._onOwnerPropsChanged();if(this._debugMode){var t=this._data.get("id"),n=this._parentList.getData().items.indexOf("#"+t),r=new Element("div");this._debugMode=!1,r.set("text",String(n)),r.setStyles({position:"relative",top:"-20px"}),this.getViewNode().adopt(r)}},_onOwnerPropsChanged:function(){if(this._isDisposed||this._owner&&this._owner._isDisposed)return;this._owner.getComponentProperties().hasField("galleryImageOnClickAction")?this._galleryImageOnClickAction=this._owner.getComponentProperty("galleryImageOnClickAction"):this._galleryImageOnClickAction=this._owner.getComponentProperty("expandEnabled")===!0?"zoomMode":"disabled",this._skinParts.link.set("text",this._owner.getComponentProperty("goToLinkText")),!this._isImageClickable()&&this.getState().indexOf("rollover")!=-1&&this.setState("rollover","general"),this._updateParts()},setParentList:function(e){this._parentList=e},_setupParts:function(){var e=this._skinParts.rollOverHitArea||this._view,t=this._skinParts.zoom||this._skinParts.imageWrapper;this._skinParts.image.addEvent("stateChange",this._onImageStateChange),t.addEvent(Constants.CoreEvents.CLICK,this._onZoomClick),e.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onMouseOver),e.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onMouseOut);var n={overflow:"hidden","text-overflow":"ellipsis"};this._skinParts.title.setStyles(n),this._skinParts.description.setStyles(n)},_updateParts:function(){var e;if(this._skinParts){this._skinParts.title.set("text",this._data.get("title")),this._skinParts.description.set("text",this._data.get("description"));var t=this._skinParts.zoom||this._skinParts.imageWrapper;t.setStyle("cursor",this._isImageClickable()?"pointer":"default"),this._galleryImageOnClickAction==="goToLink"||!this._isImageLinked()?this._skinParts.link.setStyle("display","none"):this._skinParts.link.setStyle("display","block")}},_onImageStateChange:function(e){switch(e.newState){case"loading":this.setState("loading","general");break;case"loaded":this.setState("normal","general")}},_onMouseOver:function(){this._isImageClickable()&&this.getState().indexOf("normal")!=-1&&this.setState("rollover","general")},_onMouseOut:function(){this._isImageClickable()&&this.getState().indexOf("rollover")!=-1&&this.setState("normal","general")},_onZoomClick:function(e){if(e.rightClick!==!1)return;if(this._galleryImageOnClickAction=="zoomMode"){var t=this._data.get("id"),n=this._parentList.getData().items.indexOf("#"+t);this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._parentList,currentIndex:n,getDisplayerDivFunction:this.injects().Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.injects().Viewer.getDefaultGetHashPartsFunction("Image")})}else if(this._galleryImageOnClickAction=="goToLink")if(this._skinParts.link.click)this._skinParts.link.click();else{var r=document.createEvent("HTMLEvents");r.initEvent("click",!0,!0),this._skinParts.link.dispatchEvent(r)}},setSize:function(e,t,n){var r,i,s,o,u=0;if(this._lastSetSizeParams&&this._lastSetSizeParams[0]===e&&this._lastSetSizeParams[1]===t&&this._lastSetSizeParams[2]===n)return;if(this._componentReady&&this._skinParts){this._skinParts.image.checkVisibility(),s=this._skin.widthDiff||0,o=this._skin.heightDiff||0,n=n||"clipImage";switch(n){case"clipImage":this._clipImage(e,t,s,o);break;case"flexibleHeight":this._setFlexibleHeight(e,t,s,o);break;case"flexibleWidth":this._setFlexibleWidth(e,t,s,o,!0);break;case"flexibleWidthFixed":this._setFlexibleWidth(e,t,s,o,!1)}this._refreshImage(),this._lastSetSizeParams=[arguments[0],arguments[1],arguments[2]]}},invalidateSize:function(){this._lastSetSizeParams=null},getWidthDiff:function(){return this._skin.widthDiff||0},getHeightDiff:function(){return this._skin.heightDiff||0},_refreshImage:function(){this._componentReady&&(this._skinParts.image._invalidate("size"),this._skinParts.image._renderIfReady())},_clipImage:function(e,t,n,r){n=this._skin.widthDiff||0,r=this._skin.heightDiff||0;var i=e-n,s=t-r;this._setWrapperSize(i,s),this._setDisplayerSize(e,t)},_setFlexibleHeight:function(e,t,n,r){n=this._skin.widthDiff||0,r=this._skin.heightDiff||0;var i=e-n,s=Math.floor(i/this._getAspectRatio());this._setWrapperSize(i,s-r),this._setDisplayerSize(e,s)},_setFlexibleWidth:function(e,t,n,r,i){n=this._skin.widthDiff||0,r=this._skin.heightDiff||0;var s,o=0,u=0,a=t-r,f=a*this._getAspectRatio();!i&&f>e-n&&(s=(e-n)/f,f=e-n,a=s*a),i||(o=Math.floor((e-f-n)/2),u=Math.floor(t-a-r)/2),this._view.setStyle("width",String(f+n)+"px"),this._setWrapperSize(f,a,o,u),i?this._setDisplayerSize(f,t):this._setDisplayerSize(e,t)},_getAspectRatio:function(){var e=this._skinParts.image.getDataItem(),t=parseInt(e.get("width"))/parseInt(this._data.get("height"));return t},_setWrapperSize:function(e,t,n,r){n=n||0,r=r||0;var i=t<0?0:t,s=e<0?0:e;this._skinParts.imageWrapper.setStyles({width:String(s)+"px",height:String(i)+"px","margin-left":String(n)+"px","margin-right":String(n)+"px","margin-top":String(r)+"px","margin-bottom":String(r)+"px"})},_setDisplayerSize:function(e,t){this._view.setStyles({width:String(e)+"px",height:String(t)+"px"}),this.setWidth(e),this.setHeight(t),this.fireEvent("autoSized")},_onDataChange:function(e){this.parent(),this._updateParts()},_onAllSkinPartsReady:function(){this.parent(),this._view.setStyle("visibility","visible"),this._updateParts(),this._setupParts()},_onResize:function(){this.parent(),this._refreshImage()},getImageRef:function(){var e="";return this._skinParts&&(e=String(this._skinParts.image.getDataItem().get("id"))),e},isImageLoading:function(){var e=!1;return this._componentReady&&(e=this._skinParts.image.getState().indexOf("loading")!=-1),e},dispose:function(){this._owner&&this._owner.getComponentProperties().removeEvent(Constants.DataEvents.DATA_CHANGED,this._onOwnerPropsChanged),this.parent()},_isImageLinked:function(){var e=this.getDataItem().get("href");return!!e},_isImageClickable:function(){return this._galleryImageOnClickAction==="goToLink"?this._isImageLinked():this._galleryImageOnClickAction!=="disabled"},setSelected:function(e){this.setState(e?"selected":"unselected","selectState")}})}),define.component("wysiwyg.viewer.components.EbayItemsBySeller",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({iFrameHolder:{type:"htmlElement"}}),t.propertiesSchemaType("EbayItemsBySellerProperties"),t.binds(["_applyThemeColors"]),t.states(["hasContent","noContent"]),t.dataTypes(["EbayItemsBySeller"]),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!0}},_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED]}),t.methods({initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this.addEvent("resizeEnd",this._onResizeEnd),this._iframe=null},options:{width:0,height:0,url:""},render:function(){var e=this._data.get("sellerId");this.setState(e?"hasContent":"noContent");if(e){var t=this._createUrl(e,this._data.get("registrationSite"),this._prepareOptions()),n=this._createIFrame(t.width,t.height);this.injects().Utils.prepareIFrameForWrite(n,function(e,n){n.write('<html><body style="margin:0px;"><div><script type="text/javascript" src="'+t.url+'"></script></div></body></html>'),e.setStyles({height:t.height,width:t.width})})}},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},dispose:function(){this._style.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors),this.parent()},_applyThemeColors:function(e){var t=["fontColor","borderColor","headerColor","backgroundColor","linkColor"];for(var n in e.properties)if(t.indexOf(n)>-1){this._renderIfReady();return}},_onResizeEnd:function(){this._renderIfReady()},_prepareOptions:function(){var e=this.injects().Skins,t=this._skin.className,n=e.getSkinParamValue(t,"fontColor",this._style).getHex(!1),r=e.getSkinParamValue(t,"borderColor",this._style).getHex(!1),i=e.getSkinParamValue(t,"headerColor",this._style).getHex(!1),s=e.getSkinParamValue(t,"backgroundColor",this._style).getHex(!1),o=e.getSkinParamValue(t,"linkColor",this._style).getHex(!1);return{width:this._view.getWidth(),height:this._view.getHeight(),headerImage:this.getComponentProperty("headerImage"),fontColor:n.replace("#",""),borderColor:r.replace("#",""),headerColor:i.replace("#",""),backgroundColor:s.replace("#",""),linkColor:o.replace("#","")}},_createUrl:function(e,t,n){var r=Math.floor((n.height-100)/70),i={Australia:"15",Austria:"16",Belgium_Dutch:"123",Belgium_French:"23",Canada:"2",CanadaFrench:"210",China:"223",eBayMotors:"100",France:"71",Germany:"77",HongKong:"201",India:"203",Ireland:"205",Italy:"101",Malaysia:"207",Netherlands:"146",Philippines:"211",Poland:"212",Singapore:"216",Spain:"186",Sweden:"218",Switzerland:"193",Taiwan:"196",UK:"3",US:"0",findId:function(e){var t=this[e];return t||(t=0),t}},s=this.urlCreator("http://lapi.ebay.com/ws/eBayISAPI.dll").addParam("EKServer").addParam("ai","aj|kvpqvqlvxwkl").addParam("bdrcolor",n.borderColor).addParam("fntcolor",n.fontColor).addParam("hdrcolor",n.headerColor).addParam("hdrimage",n.headerImage).addParam("lnkcolor",n.linkColor).addParam("tbgcolor",n.backgroundColor).addParam("si",e).addParam("sid",e).addParam("num",r).addParam("width",n.width).addParam("cid","0").addParam("eksize","1").addParam("encode","UTF-8").addParam("endcolor","FF0000").addParam("endtime","y").addParam("fbgcolor","FFFFFF").addParam("fs","0").addParam("hdrsrch","n").addParam("img","y").addParam("logo","6").addParam("numbid","n").addParam("paypal","n").addParam("popup","y").addParam("prvd","9").addParam("r0","3").addParam("shipcost","y").addParam("siteid",i.findId(t)).addParam("sort","MetaEndSort").addParam("sortby","endtime").addParam("sortdir","asc").addParam("srchdesc","n").addParam("title","").addParam("tlecolor","FFFFFF").addParam("tlefs","0").addParam("tlfcolor","000000").addParam("toolid","10004").addParam("track","5335838312");return n.url=s.toString(),n},_createIFrame:function(e,t){var n=new IFrame;return n.width=this.options.width,n.height=this.options.height,this._iframe?n.replaces(this._iframe):n.insertInto(this._skinParts.iFrameHolder),this._iframe=n,n},urlCreator:function(e){return{_baseUrl:e,_params:[],addParam:function(e,t){return this._params.push({key:e,value:t}),this},toString:function(){var e=[];e.push(this._baseUrl),this._params.length>0&&e.push("?");for(var t=0;t<this._params.length;t++){var n=this._params[t];t>0&&e.push("&"),e.push(n.key),n.value&&(e.push("="),e.push(encodeURIComponent(n.value)))}return e.join("")}}}})}),define.oldComponent({name:"wysiwyg.viewer.components.FiveGridLine",skinParts:{line:{type:"htmlElement"},lineCnt:{type:"htmlElement",optional:!0},leftKnobCnt:{type:"htmlElement",optional:!0},leftKnob:{type:"htmlElement",optional:!0},middleKnobCnt:{type:"htmlElement",optional:!0},middleKnob:{type:"htmlElement",optional:!0},rightKnobCnt:{type:"htmlElement",optional:!0},rightKnob:{type:"htmlElement",optional:!0}},Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0}},Extends:"mobile.core.components.base.BaseComponent",initialize:function(e,t,n){this.parent(e,t,n),this.injects().Theme.setProperty("WEB_THEME_DIRECTORY","viewer"),this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]},render:function(){var e=this.getHeight()},setWidth:function(e){var t=this._getNumberOfKnobs();this.width=e,this.parent(e)},setHeight:function(e){this.parent(e)},_getNumberOfKnobs:function(){var e=0;return this._skinParts&&(this._skinParts.rightKnob&&e++,this._skinParts.leftKnob&&e++,this._skinParts.middleKnob&&e++),e},getAcceptableDataTypes:function(){return[""]}}}),define.oldComponent({name:"wysiwyg.viewer.components.FlashComponent",imports:[],skinParts:{flashContainer:{type:"htmlElement"},link:{type:"htmlElement",optional:!1},mouseEventCatcher:{type:"htmlElement"},noFlashImgContainer:{type:"htmlElement"},noFlashImg:{type:"core.components.Image",dataRefField:"placeHolderImage",argObject:{cropMode:"full"}}},propertiesSchemaName:"FlashComponentProperties",traits:["wysiwyg.common.components.traits.LinkableComponent"],Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"GENERAL_CHANGE",command:"WEditorCommands.OpenFlashDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenFlashDialog"}},Extends:"mobile.core.components.base.BaseComponent",Binds:["_enforceDisplayMode"],_states:{linkableComponent:["link","noLink"]},initialize:function(e,t,n){this.parent(e,t,n),this._noFlashMode=!0,this._params={},this._attributes={},this._params.quality="high",this._params.bgcolor="#FAFAFA",this._params.allowscriptaccess="always",this._params.allowfullscreen="true",this._params.wMode="transparent",this._params.scale="exactFit",this._params.flashVars="",this._attributes.align="middle"},render:function(){this._createFlashEmbed(),this.parent()},_createFlashEmbed:function(e){var t=this._data.get("uri");!t&&!this._uri&&(this._mediaWidth=this._mediaWidth||this.getWidth(),this._mediaHeight=this._mediaHeight||this.getHeight());if(e&&this._uri||t&&t!=this._uri){this._uri=t,this._mediaWidth=this._data.get("width"),this._mediaHeight=this._data.get("height");var n=this.injects().Config.getServiceTopologyProperty("staticMediaUrl")+"/"+this._uri;this._skinParts.flashContainer.empty(),this._embedDivID=W.Utils.getUniqueId("ExtSWF"),this._embedDIV=new Element("DIV",{id:this._embedDivID}),this._skinParts.flashContainer.adopt(this._embedDIV),this._params.play=this.injects().Viewer.isPublicMode()||this._inPreviewMode?"true":"false",this._params.autoplay=this.injects().Viewer.isPublicMode()||this._inPreviewMode?"true":"false",this._flashObj=swfobject.embedSWF(n,this._embedDivID,"100%","100%","10.0.0","playerProductInstall.swf",null,this._params,this._attributes,function(e){e.success&&(this._noFlashMode=!1,this._skinParts.noFlashImgContainer.collapse(),this._embedCreated=!0),this._enforceDisplayMode()}.bind(this))}var r=this.getComponentProperty("displayMode");r!=this._displayMode&&(this._displayMode=r,this._enforceDisplayMode())},_editModeChanged:function(e,t){this._inPreviewMode=e=="PREVIEW",this._createFlashEmbed(!0)},_onResize:function(){this.isReady()&&this._embedCreated&&this._enforceDisplayMode()},_enforceDisplayMode:function(){var e=this._displayMode||this.getComponentProperty("displayMode");e=="fit"?this._width!=this.getWidth()?(this._width=this.getWidth(),this._height=this._width*(this._mediaHeight/this._mediaWidth)):(this._height=this.getHeight(),this._width=this._height*(this._mediaWidth/this._mediaHeight)):e=="stretch"?(this._width=this.getWidth(),this._height=this.getHeight()):(this._width=this._mediaWidth,this._height=this._mediaHeight),this.setWidth(this._width,!0,!1),this.setHeight(this._height,!0,!1),this.getViewNode().setStyles({width:this._width+"px",height:this._height+"px"}),this._noFlashMode&&this._skinParts.noFlashImg.setSize(this._width,this._height,"px"),this._wCheckForSizeChangeAndFireAutoSized(1)},_onDataChange:function(e){this.parent(),this.fireEvent("propertyChanged",e.getData().displayMode)},getAcceptableDataTypes:function(){return["FlashComponent"]}}}),define.component("wysiwyg.viewer.components.FlickrBadgeWidget",function(e){var t=e;t.utilize(["core.utils.css.Color"]),t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({iframe:{type:"htmlElement"},overlay:{type:"htmlElement"},overlayClick:{type:"htmlElement"}}),t.binds(["_applyThemeColors","_updateIframeDimensions"]),t.states([]),t.dataTypes(["FlickrBadgeWidget"]),t.fields({EDITOR_META_DATA:{general:{settings:!0,design:!1}},_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],_backgroundColor:undefined,_backgroundAlpha:undefined,_borderColor:undefined,_borderAlpha:undefined,_currentDimensions:{w:-1,h:-1},_totalSizeSamplingAttempts:10,_sizeSamplingAttemptsCount:0}),t.methods({initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=1e3,this._disableResizeHandlers(),this._resizableSides=[],this._iframeDimensions={w:0,h:0}},_disableResizeHandlers:function(){this._resizableSides=[]},_onStyleReady:function(){this.parent(),this._applyThemeColors({propName:"borderColor"}),this._applyThemeColors({propName:"backgroundColor"}),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},_applyThemeColors:function(e){var t,n,r;for(var i in e.properties)t=this.injects().Skins.getSkinParamValue(this._skin.className,i,this._style),n=t.getHex(!1),r=t.getAlpha(),i=="borderColor"&&(this._borderColor=n,this._borderAlpha=r),i=="backgroundColor"&&(this._backgroundColor=n,this._backgroundAlpha=r);this._tryRender()},render:function(){this._updateFrameSize(),this._clearFrame(),this.callLater(this._fillFrame,[],100)},_onResizeEnd:function(){this._tryRender()},_clearFrame:function(){var e=this._getFrame();e!==undefined&&(e.src="about:blank")},_getFrame:function(){return this._skinParts?this._skinParts.iframe:undefined},_getOverlay:function(){return this._skinParts?this._skinParts.overlayClick:undefined},_updateFrameSize:function(e,t){var n;e=e||this._view.getWidth()-1,t=t||this._view.getHeight()-1,n=this._getFrame(),n&&n.set({width:e,height:t})},_fillFrame:function(){var e={},t;e.userID=this._data.get("userId"),e.userName=this._data.get("userName"),e.tag=this._data.get("tag"),e.imageCount=this._data.get("imageCount"),e.whichImages=this._data.get("whichImages"),e.imageSize=this._data.get("imageSize"),e.layoutOrientation=this._data.get("layoutOrientation");var n=this._getFlickrEmbedCode(e),r=this._getFrame();r!==undefined&&(this.injects().Utils.prepareIFrameForWrite(r,function(e,t){t.write(n)}.bind(this)),t="http://www.flickr.com/photos/"+e.userID+"/",this._getOverlay().set("href",t),this._sizeSamplingAttemptsCount=0,this.callLater(this._updateIframeDimensions,[],1e3))},_updateIframeDimensions:function(){this._sizeSamplingAttemptsCount++;var e=this._sampleIframeDimensions();e&&(e.w!=this._currentDimensions.w||e.h!=this._currentDimensions.h)&&(this._currentDimensions.w=e.w,this._currentDimensions.h=e.h,this.setWidth(this._currentDimensions.w+5),this.setHeight(this._currentDimensions.h+5),this._updateFrameSize(this._currentDimensions.w+5,this._currentDimensions.h+5),this._wCheckForSizeChangeAndFireAutoSized(0)),this._sizeSamplingAttemptsCount<this._totalSizeSamplingAttempts&&this.callLater(this._updateIframeDimensions,[],500)},_sampleIframeDimensions:function(){var e,t,n=this._getFrame();if(n!=undefined){if(Browser.ie){var r=this._data.get("imageSize")+this._data.get("layoutOrientation");switch(r){case"sv":e=130,t=83+this._data.get("imageCount")*75;break;case"tv":e=130,t=83+this._data.get("imageCount")*67;break;case"mv":e=260,t=83+this._data.get("imageCount")*160;break;case"sh":e=55+this._data.get("imageCount")*75,t=130;break;case"th":e=55+this._data.get("imageCount")*100,t=122;break;case"mh":e=55+this._data.get("imageCount")*240,t=215}}else{var i=n.contentWindow.document.getElementById("flickr_badge_uber_wrapper");i&&(e=i.clientWidth,t=i.clientHeight)}isNaN(e)==0&&isNaN(t)==0&&(this._iframeDimensions.w=e,this._iframeDimensions.h=t)}return this._iframeDimensions},_rgbToHex:function(e){var t;return t=new this.imports.Color(e),t.getHex(!1)},_getFlickrEmbedCode:function(e){var t,n,r="";return e.tag!==undefined&&e.tag!==""?(n="user_tag",t="&tag="+e.tag):(n="user",t=""),Browser.ie&&(r="a:link{color:"+this._backgroundColor+"}a:visited{color:"+this._backgroundColor+"}"),'<style type="text/css">#flickr_badge_source_txt {padding:0; font: 11px Arial, Helvetica, Sans serif; color:#666666;}#flickr_badge_source_txt {padding:0; font: 11px Arial, Helvetica, Sans serif; color:#666666;}#flickr_badge_icon {display:block !important; margin:0 !important; border: 1px solid rgb(0, 0, 0) !important;}#flickr_icon_td {padding:0 5px 0 0 !important;}.flickr_badge_image {text-align:center !important;}.flickr_badge_image img {border: 1px solid black !important;}#flickr_badge_uber_wrapper {width:150px;}#flickr_www {display:block; text-align:center; padding:0 10px 0 10px !important; font: 11px Arial, Helvetica, Sans serif !important; color:#3993ff !important;}#flickr_badge_uber_wrapper a:hover,#flickr_badge_uber_wrapper a:link,#flickr_badge_uber_wrapper a:active,#flickr_badge_uber_wrapper a:visited {text-decoration:none !important; background:inherit !important;}#flickr_badge_wrapper {opacity: '+this._backgroundAlpha+";background-color: "+this._backgroundColor+";border: solid 1px "+this._borderColor+"}"+"#flickr_badge_source {padding:0 !important; font: 11px Arial, Helvetica, Sans serif !important; }"+"body {overflow: hidden;}"+r+"</style>"+'<table id="flickr_badge_uber_wrapper" cellpadding="0" cellspacing="10" border="0"><tr><td><a href="http://www.flickr.com" id="flickr_www">www.<strong style="color:#3993ff">flick<span style="color:#ff1c92">r</span></strong>.com</a><table cellpadding="0" cellspacing="10" border="0" id="flickr_badge_wrapper">'+'<script type="text/javascript" src="http://www.flickr.com/badge_code_v2.gne?show_name=1&count='+e.imageCount+"&display="+e.whichImages+"&size="+e.imageSize+"&layout="+e.layoutOrientation+"&source="+n+"&user="+e.userID+t+'"></script>'+"</table>"+"</td>"+"</tr>"+"</table>"+"</td></tr></table>"}})}),define.oldComponent({name:"wysiwyg.viewer.components.FooterContainer",Class:{Extends:"wysiwyg.viewer.components.SiteSegmentContainer"}}),define.component("wysiwyg.viewer.components.GoogleMap",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({mapContainer:{type:"htmlElement"}}),t.states(["normal","error"]),t.dataTypes(["GeoMap"]),t.propertiesSchemaType("GoogleMapProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.MOVED_IN_DOM,Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED],MIN_SIZE:130}),t.methods({initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this.iframeCreated=!1,this.addEvent("resizeEnd",this._renderGoogleMapsIframe)},_editModeChanged:function(e,t){t=="PREVIEW"&&e=="CURRENT_PAGE"&&this.render()},render:function(){this._renderGoogleMapsIframe()},_renderGoogleMapsIframe:function(){if(!this.isReady())return;!this.iframeCreated||!this._skinParts.mapContainer.hasChildNodes()?(this._createIframe(),this.iframeCreated=!0):this._updateIframe()},_createIframe:function(){var e=new IFrame({src:this.injects().Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/googleMap.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",events:{load:function(){this._iframeCreated=!0,this._updateIframe()}.bind(this)}});this._iframe=e,this._skinParts.mapContainer.empty(),this._skinParts.mapContainer.grab(e)},_updateIframe:function(){var e={address:this._data.get("address"),addressInfo:this._data.get("addressInfo"),mapType:this.getComponentProperty("mapType"),mapDragging:this.getComponentProperty("mapDragging"),showZoom:this.getComponentProperty("showZoom"),showPosition:this.getComponentProperty("showPosition"),showStreetView:this.getComponentProperty("showStreetView"),showMapType:this.getComponentProperty("showMapType"),latVal:this._data.get("latitude"),longVal:this._data.get("longitude")};this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")}})}),define.oldComponent({name:"wysiwyg.viewer.components.HeaderContainer",Class:{Extends:"wysiwyg.viewer.components.SiteSegmentContainer"}}),define.component("wysiwyg.viewer.components.HorizontalMenu",function(e){var t=e;t.inherits("core.components.BaseRepeater"),t.utilize(["core.components.BaseList","core.components.SimpleButton"]),t.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,dataRefField:"pages",container:"itemsContainer",hookMethod:"_changePagesRefData",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"}}),t.binds(["_onButtonDataChange","_onMoreButtonClick","_onThemeChange","_arrangeButtons","_onButtonClick","_onMoreButtonOver","_onMoreButtonOut","_onMoreContainerOver","_onMoreContainerOut","_closeMoreMenu","_onPageChanged"]),t.dataTypes(["Document"]),t.propertiesSchemaType("HorizontalMenuProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages"}],dblClick:{command:"WEditorCommands.Pages"}},_moreButtonClicked:!1,_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}}),t.methods({initialize:function(e,t,n){console.log(">>>>>>>>>>>>>>>>>>>>>>> initialize from component"),this.parent(e,t,n),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionStarted",this._onPageChanged),this._usesExternalData=!0,this._staticWidth=0,this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._hiddenButtonsContainer=new Element("div",{id:"hiddenButtonsContainer",style:"visibility:hidden"}),this._hiddenButtonsContainer.inject(this.getViewNode()),this.getViewNode().setStyle("opacity","0")},_testOverFlow:function(){var e=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth==0&&(this._prevButtonsWidth=e),e!=this._prevButtonsWidth?this._arrangeButtons():(this._testOverFlowCount--,this._testOverFlowCount>0&&(this._overflowID=this.callLater(this._testOverFlow,[],100)))},_onPageChanged:function(e){var t,n;if(this._skinParts==null)return;if(this._allButtons)for(t=0;t<this._allButtons.length;t++)this._allButtons[t]&&this._allButtons[t].getViewNode()&&(n=this._allButtons[t],n.getID()==e?n.setState("selected"):n.removeState("selected"),this.injects().Utils.forceBrowserRepaint(n.getViewNode()))},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._allButtons=[]},_onRepeaterItemReady:function(e,t,n,r){r&&t.addEvent("click",function(){this._onButtonClick(n)}.bind(this)),this._allButtons.push(t),this.parent(e,t,n,r)},_onRepeaterReady:function(e){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._addPartsListeners(),this._arrangeButtons()},_addPartsListeners:function(){this._skinParts.moreButton.addEvent("over",this._onMoreButtonOver),this._skinParts.moreButton.addEvent("out",this._onMoreButtonOut),this._skinParts.moreButton.addEvent("click",this._onMoreButtonClick),this._skinParts.moreContainer.addEvent("mouseover",this._onMoreContainerOver),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut);var e;for(e=0;e<this._allButtons.length;e++)this._allButtons[e]&&this._allButtons[e].getViewNode()&&(this._allButtons[e].getViewNode().uncollapse(),this._allButtons[e].addEvent("dataChanged",this._onButtonDataChange))},render:function(){this.parent(),this._changeTriggeredBy=="styleChange"?this._arrangeButtonsDelayed():this._arrangeButtons()},setSkin:function(e){this._staticWidth=e.staticWidth||0,this.parent(e)},_onButtonDataChange:function(e){this._changeTriggeredBy="dataChange",this.render()},_onDataChange:function(e){this.getComponentProperties().removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent(e)},_applySettings:function(){this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._staticWidth>0?this._preWidthModifier=this._staticWidthModifier:(this.getComponentProperty("sameWidthButtons")&&(this._preWidthModifier=this._sameWidthModifier),this.getComponentProperty("stretchButtonsToMenuWidth")&&(this._postWidthModifier=this._stretchToFillModifier))},_skinSizeChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_skinParamsChange:function(e){this._changeTriggeredBy="styleChange",this.parent(e)},_arrangeButtonsDelayed:function(){this._arrangeWaitID!=-1&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtonsCapture,[],100),this._changeTriggeredBy="",this._skinParts.itemsContainer.setStyle("overflow","hidden")},_arrangeButtonsCapture:function(){this._arrangeButtons(),this._arrangeWaitID!=-1&&this._arrangeButtonsDelayed()},_arrangeButtons:function(){if(this._skinParts==undefined||!this._allButtons||this._allButtons.length==0||!this._isDisplayed||!this.isReady())return;this.getViewNode().setStyle("opacity","1"),this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth=0,this._arrangeWaitID=-1,this._applySettings();var e=this._allButtons[0]&&this._allButtons[0].getViewNode()?this._allButtons[0].getViewNode().getStyle("-webkit-transition-duration"):0;this._initItemsContainer(),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal"),this._initMoreContainer(),this._skinParts.moreButton.setLabel(this.getComponentProperty("moreButtonLabel")),this._skinParts.moreButton.skipMe=!0;var t=this._getDisplayedButtons();if(!t.length)return;t.push(this._skinParts.moreButton);var n=this._getSampleButton();this._sampleButtonBorder(n),this._setMinimumDimensions(n),this._preArrangeButtons(t),this._preWidthModifier(t),this._calculateButtonsAmount(t),this.setMinW(t[0].getViewNode().offsetWidth),this._postWidthModifier(t),this._arrangeMoreContainer(),t=this._getDisplayedButtons(),t.push(this._skinParts.moreButton),this._alignButtonsText(t);var r;for(r=0;r<t.length;r++){var i=t[r];i.getViewNode().setStyle("-webkit-transition-duration",e)}this._skinParts.itemsContainer.setStyle("overflow","visible"),this._skinParts.itemsContainer.setStyle("white-space","nowrap"),this._setListPositions(),this._testOverFlow()},_calculateButtonsAmount:function(e){e=this._arrangementAlgorithm(e),this._skinParts.moreButton.skipMe&&(this._skinParts.moreButton.getViewNode().setStyle("visibility","hidden"),this._skinParts.moreButton.getViewNode().inject(this._skinParts.moreContainer),e[e.length-1]===this._skinParts.moreButton&&e.pop())},_getButtonsWidth:function(){var e=0,t=0;for(i=0;i<this._skinParts.itemsContainer.children.length;i++)e+=this._skinParts.itemsContainer.children[i].getLogic().getWidthOnLayout();return e},_getDisplayedButtons:function(){var e=[],t;for(t=0;t<this._allButtons.length;t++)this._allButtons[t]&&this._allButtons[t].getDataItem()&&!this._allButtons[t].getDataItem()._data.hidePage?e.push(this._allButtons[t]):this._allButtons[t]&&this._allButtons[t].getViewNode()&&(this._allButtons[t].getViewNode().setStyle("visibility","inherit"),this._allButtons[t].getViewNode().inject(this._hiddenButtonsContainer));return e},_setListPositions:function(){var e,t,n;for(e=0;e<this._skinParts.itemsContainer.children.length;e++)t=this._skinParts.itemsContainer.children[e],e==0&&this._setPositionForFirst()?n="first":e==this._skinParts.itemsContainer.children.length-1&&this._setPositionForLast()?n="last":n="center",t.setProperty("listposition",n);for(e=0;e<this._skinParts.moreContainer.children.length;e++)t=this._skinParts.moreContainer.children[e],t.setProperty("listposition","more")},_setPositionForFirst:function(){var e=!1;return this._postWidthModifier==this._stretchToFillModifier?e=!0:this.getComponentProperty("alignButtons")=="left"&&(e=!0),e},_setPositionForLast:function(){var e=!1;return this._postWidthModifier==this._stretchToFillModifier?e=!0:this.getComponentProperty("alignButtons")=="right"&&(e=!0),e},_getSampleButton:function(){return this._allButtons[0]&&this._allButtons[0].getViewNode()&&this._allButtons[0].getViewNode().getStyle("visibility")=="visible"?this._allButtons[0]:this._skinParts.moreButton},_sampleButtonBorder:function(e){e._skinParts.borderWrapper?this._buttonsBorder=this._getBorder(e._skinParts.borderWrapper):this._buttonsBorder=this._getBorder(e.getViewNode())},_setMinimumDimensions:function(e){e._skinParts.label.setStyle("line-height","100%");var t=0;e.getSkin()&&!isNaN(e.getSkin().addToMinH)&&(t=e.getSkin().addToMinH);var n=this._getBorder(this._skinParts.itemsContainer).y+this._buttonsBorder.y;this.setMinH(t+n+parseInt(e._skinParts.label.getComputedStyle("line-height"),10))},_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var e=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y,t=this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x;this._skinParts.itemsContainer.setStyle("height",e+"px"),this._skinParts.itemsContainer.setStyle("width",t+"px")},_initMoreContainer:function(){this._skinParts.moreContainer.setStyle("visibility","hidden"),this._skinParts.moreContainer.setStyle("opacity","0"),this._skinParts.moreContainer.setStyle("width","0px"),this._skinParts.moreContainer.setStyle("left","0px")},_preArrangeButtons:function(e){var t;for(t=0;t<e.length;t++){var n=e[t];n.getViewNode().setStyle("visibility","inherit"),n.getViewNode().setStyle("-webkit-transition-duration","0s"),n.getViewNode().inject(this._skinParts.moreContainer),n._skinParts.bg.setStyle("padding","0px 0px")}},_arrangeMoreContainer:function(){var e=this._skinParts.moreButton.getViewNode().offsetWidth,t,n;for(t=0;t<this._skinParts.moreContainer.children.length;t++)n=this._skinParts.moreContainer.children[t],e=Math.max(e,n.offsetWidth);this._skinParts.moreContainer.setStyle("width",e+"px");for(t=0;t<this._skinParts.moreContainer.children.length;t++)n=this._skinParts.moreContainer.children[t],this._fillWidthByPadding(n,e);var r=this._skinParts.moreButton.getViewNode().offsetLeft;isNaN(r)||this._skinParts.moreContainer.setStyle("left",r+"px")},_alignButtonsText:function(e){var t;for(t=0;t<e.length;t++){var n=e[t].getViewNode(),r=parseInt(n.getLogic()._skinParts.bg.getComputedStyle("padding-left"),10)+parseInt(n.getLogic()._skinParts.bg.getComputedStyle("padding-right"),10);switch(this.getComponentProperty("alignText")){case"left":n.getLogic()._skinParts.bg.setStyle("padding-left","0px"),n.getLogic()._skinParts.bg.setStyle("padding-right",r+"px");break;case"right":n.getLogic()._skinParts.bg.setStyle("padding-left",r+"px"),n.getLogic()._skinParts.bg.setStyle("padding-right","0px")}}},_setPadding:function(e,t){e.getLogic()._skinParts.bg.setStyle("padding","0px "+t+"px")},_fillWidthByPadding:function(e,t){var n=parseInt(e.getLogic()._skinParts.bg.getComputedStyle("padding-left"),10),r=n+Math.floor((t-e.offsetWidth)/2);this._setPadding(e,r)},_arrangementAlgorithm:function(e){var t=!1;while(!t){t=this._arrangementIteration(e);if(!t)if(e.length==1)t=!0;else{this._skinParts.moreButton.skipMe=!1;var n=e.splice(e.length-2,1)[0];n.getViewNode().setStyle("visibility","inherit"),n.getViewNode().inject(this._skinParts.moreContainer,"top")}}return e},_stretchToFillModifier:function(e,t){function a(e,t){if(f>0){var r=Math.floor(o/f),i=parseInt(e._skinParts.bg.getStyle(t),10);n&&(u._buttonsPadding[e]||(u._buttonsPadding[e]={}),u._buttonsPadding[e][t]=i),e._skinParts.bg.setStyle(t,i+r+"px"),f--,o-=r}}t=t||0;var n=!1;t==0&&(n=!0,this._buttonsPadding={});var r=this._getButtonsWidth(),i,s=parseInt(this._skinParts.itemsContainer.getStyle("width"),10),o=s-r-t-1;Browser.ie&&(o-=1),o=Math.max(o,0);var u=this;if(e.length>0){var f=e.length*2;for(i=0;i<e.length/2;i++){var l=e[i],c=e[e.length-i-1];a(l,"padding-left"),a(c,"padding-right"),a(l,"padding-right"),a(c,"padding-left")}}if(this._skinParts.itemsContainer.scrollHeight-e[0].getViewNode().offsetHeight>=e[0].getViewNode().offsetHeight){for(i=0;i<e.length;i++){var h=e[i];h._skinParts.bg.setStyle("padding-left",this._buttonsPadding[h]["padding-left"]),h._skinParts.bg.setStyle("padding-right",this._buttonsPadding[h]["padding-left"])}if(t>20)return;this._stretchToFillModifier(e,t+1)}},_sameWidthModifier:function(e){var t=0,n,r;for(n=0;n<e.length;n++){r=e[n];var i=parseInt(r.getViewNode().offsetWidth-this._buttonsBorder.x,10);isNaN(i)||(t=Math.max(t,i))}if(t>0)for(n=0;n<e.length;n++)r=e[n],this._fillWidthByPadding(r.getViewNode(),t)},_staticWidthModifier:function(e){var t,n;for(t=0;t<e.length;t++)n=e[t],n.offsetWidth<this._staticWidth?this._fillWidthByPadding(n.getViewNode(),this._staticWidth):n.getViewNode().setStyle("width",this._staticWidth+"px")},_nullModifier:function(e){},_arrangementIteration:function(e){var t,n;for(n=0;n<e.length;n++){var r=e[n];if(r.skipMe){r.collapse();continue}r.uncollapse(),r.getViewNode().setStyle("visibility","visible"),r.getViewNode().inject(this._skinParts.itemsContainer),t=parseInt(this._skinParts.itemsContainer.getStyle("height"),10)-this._buttonsBorder.y,r.getViewNode().setStyle("height",t+"px"),r._skinParts.labelPad!=undefined&&(t-=r._skinParts.labelPad.offsetHeight),r._skinParts.label.setStyle("line-height",t+"px"),r._skinParts.label.setStyle("width","auto")}return this._skinParts.itemsContainer.scrollHeight-e[0].getViewNode().offsetHeight<e[0].getViewNode().offsetHeight},_getBorder:function(e){var t=0,n=0;return e&&(t=parseInt(e.getStyle("border-left-width"),10)+parseInt(e.getStyle("border-right-width"),10),n=parseInt(e.getStyle("border-top-width"),10)+parseInt(e.getStyle("border-bottom-width"),10)),{x:t,y:n}},_getMargin:function(e){var t=0,n=0;return e&&(t=parseInt(e.getStyle("margin-left"),10)+parseInt(e.getStyle("margin-right"),10),n=parseInt(e.getStyle("margin-top"),10)+parseInt(e.getStyle("margin-bottom"),10)),{x:t,y:n}},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(e){this.injects().Viewer.goToPage(e.get("id"))},_openMoreMenu:function(){this._skinParts.moreButton.setState("selected"),this._skinParts.moreContainer.setStyle("visibility","visible"),this._skinParts.moreContainer.setStyle("opacity","1"),this._isMoreContainerOpen=!0,this._toCloseMoreMenu=!1,this.injects().Utils.forceBrowserRepaint(this._skinParts.moreButton.getViewNode()),this.injects().Utils.forceBrowserRepaint(this._skinParts.moreContainer)},_closeMoreMenuTimer:function(){this.injects().Utils.clearCallLater(this._closeMoreMenuTimerID),this._closeMoreMenuTimerID=this.injects().Utils.callLater(this._closeMoreMenu,[],this,500)},_closeMoreMenu:function(e){if(e||this._toCloseMoreMenu)this._skinParts.moreButton.removeState("selected"),this._skinParts.moreContainer.setStyle("visibility","hidden"),this._skinParts.moreContainer.setStyle("opacity","0"),this._toCloseMoreMenu=!1,this._isMoreContainerOpen=!1,this._moreButtonClicked=!1},_forceCloseMoreMenu:function(){this._closeMoreMenu(!0)},_onMoreButtonOver:function(){this._toCloseMoreMenu=!1,this._moreButtonClicked||this._openMoreMenu()},_onMoreButtonOut:function(){this._toCloseMoreMenu=!0,this._closeMoreMenuTimer()},_onMoreContainerOver:function(){this._toCloseMoreMenu=!1},_onMoreButtonClick:function(){this._moreButtonClicked=!0,this._isMoreContainerOpen===!1?this._openMoreMenu():this._forceCloseMoreMenu()},_onMoreContainerOut:function(){this._toCloseMoreMenu=!0,this._closeMoreMenuTimer()},dispose:function(){this.injects().Viewer.removeEvent("pageTransitionStarted",this._onPageChanged),this.injects().Theme.removeEvent("propertyChange",this._onThemeChange),this.parent()}})}),define.oldComponent({name:"wysiwyg.viewer.components.HtmlComponent",imports:["core.components.base.SizeLimits"],skinParts:{iFrameHolder:{type:"htmlElement"}},Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1}},Extends:"mobile.core.components.base.BaseComponent",Static:{MAX_HTML_COMPONENT_HEIGHT_DEFAULT:5e3},_states:["hasContent","noContent"],initialize:function(e,t,n){this.parent(e,t,n),this.addEvent("resizeEnd",this._onResizeEnd),this._iframe=null,this._renderOnResize=!1},_onResizeEnd:function(){this._iframe&&(this._iframe.width=this._view.getWidth(),this._iframe.height=this._view.getHeight()),this._renderOnResize&&this._renderIfReady()},render:function(){this._createIFrame(this._view.getWidth(),this._view.getHeight()),this.setState(this.hasContent()?"hasContent":"noContent"),this.hasContent()&&this._setFrameWithSrc(this._iframe)},getSizeLimits:function(){return this._sizeLimits===undefined&&(this._sizeLimits=new this.imports.SizeLimits,this._sizeLimits.minW=this._sizeLimits.minW||this.MINIMUM_WIDTH_DEFAULT,this._sizeLimits.minH=this._sizeLimits.minH||this.MINIMUM_HEIGHT_DEFAULT,this._sizeLimits.maxW=this._sizeLimits.maxW||this.MAXIMUM_WIDTH_DEFAULT,this._sizeLimits.maxH=this._sizeLimits.maxH||this.MAX_HTML_COMPONENT_HEIGHT_DEFAULT,this._originalSizeLimits=this._sizeLimits.clone()),this._sizeLimits},getIFrameSrc:function(){var e=this._data.get("url"),t=/^(ftps|ftp|http|https).*$/;return t.test(e)||(e="http://"+e),e},hasContent:function(){return!!this._data.get("url")},_createIFrame:function(e,t){var n=new IFrame;n.width=e,n.height=t,navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&this._view.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),this._iframe?n.replaces(this._iframe):n.insertInto(this._skinParts.iFrameHolder),this._iframe=n},_setFrameWithSrc:function(e){e.set("src",this.getIFrameSrc())},getAcceptableDataTypes:function(){return["HtmlComponent"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.IFrameComponent",Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_changeSize"],initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this._iframe=null},render:function(){this._renderIframe()},_onResize:function(){this.parent(),this._skinParts&&this._renderIframe()},_renderIframe:function(e){this._iframe?this._updateIframe(e):this._createIframe()},_createIframe:function(){this._iframe=new IFrame({src:"about:blank",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0",scrolling:"no"}),this._setBasicIframeParams(),this._setIframeParams(),this._iframe.insertInto(this._getIframeContainer())},_getIframeContainer:function(){return this._view},_changeSize:function(e,t){var n=this.getWidth(),r=this.getHeight(),i=e.x||e.w||e.width,s=e.y||e.h||e.height;i&&i!=n&&(this.setWidth(i,!1,!s&&t),this._iframe.setStyle("width",i+"px")),s&&s!=r&&(this.setHeight(s,!1,t),this._iframe.setStyle("height",s+"px")),this._wCheckForSizeChangeAndFireAutoSized(1)},_updateIframe:function(e){this._setBasicIframeParams(e),this._setIframeParams()},_setBasicIframeParams:function(e){e=e||!1;var t=this._getUrl(e);(e||this._iframe.src!==t)&&this.setIFrameSrc(t),this._iframe.width=this.getWidth(),this._iframe.height=this.getHeight()},setIFrameSrc:function(e){this._iframe.src=e},_setIframeParams:function(){},_getUrl:function(e){throw new Error("IFrameComponent::_getUrl() must be overridden.")},getIFrame:function(){return this._iframe}}}),define.oldComponent({name:"wysiwyg.viewer.components.ImageLite",imports:["core.components.image.ImageUrl"],Class:{Extends:"mobile.core.components.base.BaseComponent",_currentUri:"",initialize:function(e,t,n){this.parent(e,t,n)},_onAllSkinPartsReady:function(){this._img||(this._img=new Element("img"),this._view.adopt(this._img))},render:function(){var e=this._view.getSize();this.setSize(e.x,e.y)},setOwner:function(){},invalidateSize:function(){},setSize:function(e,t){this._imgWidth=parseInt(this._data.get("width")),this._imgHeight=parseInt(this._data.get("height"));var n={width:parseInt(e),height:parseInt(t),overflow:"hidden"};this._view.setStyles(n);var r=e,i=e*(this._imgHeight/this._imgWidth);i<t&&(i=t,r=t*(this._imgWidth/this._imgHeight));var s=(t-i)/2;s=s<0?s:0;var o=(e-r)/2;o=o<0?o:0;var u=(new this.imports.ImageUrl).getImageUrlFromPyramid({x:parseInt(r),y:parseInt(i)},this._data.get("uri")).url;this._currentUri!==u&&(this._currentUri=u,this._img.setAttribute("src",u));var a={position:"static",width:Math.round(r)+1,height:parseInt(i),"margin-top":parseInt(s),"margin-left":parseInt(o),"box-shadow":"#000 0 0 0","image-rendering":"optimizequality"};this._img.setStyles(a)},getAcceptableDataTypes:function(){return["Image"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.LazySocialPanel",imports:[],skinParts:{placeHolder:{type:"htmlElement"},fbLike:{type:"htmlElement"},twitterShare:{type:"htmlElement"},googlePlus:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["onHover"],initialize:function(e,t,n){this.parent(e,t,n);var r="";this.injects().Viewer.getCurrentPageNode()&&(r=this.injects().Viewer.getCurrentPageNode().getLogic().getDataItem().getData().title);var i=location.href;this._buttons={fbLike:{type:"wysiwyg.viewer.components.WFacebookLike",skin:"skins.core.FacebookLikeSkin",data:null,args:{propObj:{layout:"button_count"}}},twitterShare:{type:"wysiwyg.viewer.components.WTwitterTweet",skin:"mobile.core.skins.TwitterTweetSkin",data:this.injects().Data.createDataItem({defaultText:r+" ~ ",accountToFollow:"",type:"TwitterTweet"},"TwitterTweet"),args:null},googlePlus:{type:"wysiwyg.viewer.components.WGooglePlusOne",skin:"mobile.core.skins.GooglePlusOneSkin",data:null,args:{annotation:"small_bubble",size:"medium",width:{w:50,h:15}}}}},render:function(){this._skinParts.placeHolder.addEvent("mouseover",this.onHover)},onHover:function(){this._skinParts.placeHolder.removeEvent("mouseover",this.onHover),this._skinParts.placeHolder.dispose(),this._addService(this._buttons.twitterShare,this._skinParts.twitterShare),this._addService(this._buttons.fbLike,this._skinParts.fbLike)},_addService:function(e,t){this.injects().Components.createComponent({type:e.type,skin:e.skin,data:e.data,args:e.args}).insertInto(t)},getAcceptableDataTypes:function(){return[""]}}}),define.oldComponent({name:"wysiwyg.viewer.components.LinkBar",skinParts:{imageItem:{type:"wysiwyg.viewer.components.LinkBarItem",repeater:!0,container:"itemsContainer",dataRefField:"items",argObject:{unit:"px"}},itemsContainer:{type:"htmlElement"}},imports:[],propertiesSchemaName:"LinkBarProperties",Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"SOCIAL_BAR_MNG_ICONS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"social_icons"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"social_icons"},commandParameterDataRef:"SELF"}},Extends:"core.components.BaseRepeater",Binds:["_setComponentSize"],initialize:function(e,t,n){this.parent(e,t,n),this._resizableSides=[],this.setMaxH(9999),this.setMaxW(9999)},_onDataChange:function(e){this.parent()},getAcceptableDataTypes:function(){return["ImageList"]},render:function(){this._iconSize=this.getComponentProperty("iconSize")||30,this._orientation=this.getComponentProperty("orientation"),this._spacing=this.getComponentProperty("spacing"),this._bgScale=this.getComponentProperty("bgScale"),this._setComponentSize()},_processDataRefs:function(e){return e},_onRepeaterReady:function(e){this._itemsAmount=e.itemsAmount,this._items=e.readyItemsLogic},_setComponentSize:function(){var e=0,t=0,n=this._orientation=="HORIZ";for(var r=0;r<this._items.length;r++){var i=this._items[r],s=i.getViewNode(),o=this._spacing;r==this._items.length-1&&(o=0),i.setSize(this._iconSize,o,this._bgScale,n);var u=s.offsetWidth,a=s.offsetHeight;n?(s.setStyle("display","inline-block"),t=Math.max(t,a),e+=u):(s.setStyle("display","block"),t+=a,e=Math.max(e,u))}this.setWidth(e+5,!0),this.setHeight(t,!0),this._wCheckForSizeChangeAndFireAutoSized(3)}}}),define.oldComponent({name:"wysiwyg.viewer.components.LinkBarItem",skinParts:{image:{type:"core.components.Image",dataRefField:"*",optional:!1},imageBG:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1}},traits:["wysiwyg.common.components.traits.LinkableComponent"],Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onMouseOver","_onMouseOut","_onLinkMouseDown","_onImageStateChange"],_states:["loading","normal","rollover"],_parentList:null,initialize:function(e,t,n){this.parent(e,t,n)},setParentList:function(e){this._parentList=e},_onImageStateChange:function(e){switch(this._skinParts.image.getState()){case"loading":this.setState("loading");break;case"loaded":this.setState("normal")}},_onMouseOver:function(){this.getState()=="normal"&&this.setState("rollover")},_onMouseOut:function(){this.getState()=="rollover"&&this.setState("normal")},_onLinkMouseDown:function(e){var t=this._data.get("link"),n=this._data.get("target")||"_blank";t&&window.open(t,n)},setSize:function(e,t,n,r){var i,s;r?(i=t,s=0):(i=0,s=t);var o,u={};this._skinParts.image.setSize(e,e,"px"),o=e,u.x=u.y=o/2,this._skinParts.image.getViewNode().setStyles({left:u.x-e/2,top:u.y-e/2}),this.getViewNode().setStyles({width:String(o+i)+"px",height:String(o+s)+"px"})},_onDataChange:function(e){this.parent()},_onAllSkinPartsReady:function(){this.parent()},_onResize:function(){this.parent(),this._skinParts.image&&(this._skinParts.image._invalidate("size"),this._skinParts.image._renderIfReady())},getAcceptableDataTypes:function(){return["Image"]},getImageRef:function(){var e="";return this._skinParts&&(e=String(this._skinParts.image.getDataItem().get("id"))),e}}}),define.oldComponent({name:"wysiwyg.viewer.components.LoginButton",skinParts:{container:{type:"htmlElement"},actionTitle:{type:"htmlElement"},memberTitle:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onStyleChange"],_states:["auth","no_auth"],Static:{SIGN_IN:"Login/Sign up",SIGN_OUT:"Log out",HELLO:"Hello"},initialize:function(e,t,n){this.parent(e,t,n)},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChange)},_onStyleChange:function(){this._centerButton(),this._wCheckForSizeChangeAndFireAutoSized(10)},render:function(){this.parent(),this._updateTextsAndEvents(),this._centerButton()},_updateTextsAndEvents:function(){var e=this._skinParts,t=this.injects().SiteMembers,n=e.actionTitle,r=e.memberTitle,i=this;this.injects().SiteMembers.isLoggedIn()?(n.set("text",this.SIGN_OUT),n.addEvent("click",function(){t.logout(),n.removeEvent("click",arguments.callee),setTimeout(function(){location.reload()},500)}),this.injects().SiteMembers.getMemberDetails(function(e){var t=e.attributes&&e.attributes.name||e.email;r.set("text",this.HELLO+" "+t)}.bind(this)),this.setState("auth")):(n.set("text",this.SIGN_IN),n.addEvent("click",function(){t.openSiteMembersPopup({authCallback:function(e){e.authResponse==1&&i._renderIfReady()}}),n.removeEvent("click",arguments.callee)}.bind(this)),r.set("text",""),this.setState("no_auth"))},_centerButton:function(){var e=this._skinParts.container,t=e.getSize(),n=t.x,r=t.y,i=this.getHeight()-r,s=this.getWidth()-n;e.setStyle("margin-top",i/2),this._skinParts.actionTitle.setStyle("width",this.getWidth()),this._skinParts.memberTitle.setStyle("width",this.getWidth()),this.setMinH(r)},_onResize:function(){this._centerButton(),this.parent()}}}),define.oldComponent({name:"wysiwyg.viewer.components.MatrixGallery",skinParts:{imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items",argObject:{unit:"px"}},itemsContainer:{type:"htmlElement"},showMore:{type:"htmlElement"}},imports:["wysiwyg.viewer.utils.ComponentSequencer"],propertiesSchemaName:"MatrixGalleryProperties",Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"MatrixGallery"},commandParameterDataRef:"SELF"}},Extends:"mobile.core.components.base.BaseComponent",Binds:["_increaseTotalMaxRows","_sequencingHook"],_states:["fullView","hiddenChildren"],_itemsRef:[],_galleryItems:[],_totalMaxRows:0,_numCols:0,_numRows:0,_gap:0,_itemWidth:-1,_itemHeight:-1,_transitionProp:"",_numItems:0,_imageMode:"",_transitionsOn:!0,_Tween:null,_widthDiff:0,_heightDiff:0,_minDisplayerWidth:5,_minDisplayerHeight:5,_renderingPhase:"normal",initialize:function(e,t,n){this.parent(e,t,n),this._transitionProp=this.injects().Utils.getCSSBrowserFeature("transition"),this._Tween=this.injects().Utils.Tween,this.setMaxW(1e4),this.setMaxH(1e4),this._sequencer=new this.imports.ComponentSequencer,n&&n.sequencingHook?this._sequencer.resolveItem=n.sequencingHook:this._sequencer.resolveItem=this._sequencingHook},_sequencingHook:function(){return{comp:"wysiwyg.viewer.components.Displayer",skin:this._skin.compParts.imageItem.skin}},_onDataChange:function(e,t){var n,r,i;this._numItems=this._data.get("items").length,this._numCols=parseInt(this.getComponentProperty("numCols")),this._numRows=this._getRowNumber(),this._gap=parseInt(this.getComponentProperty("margin")),this._imageMode=String(this.getComponentProperty("imageMode")),this._updateState(),this._itemWidth==-1?this._calculateItemSize():this._numItems>0&&(n=Math.round(this._numCols*this._itemWidth+(this._numCols-1)*this._gap),r=Math.round(this._numRows*this._itemHeight+(this._numRows-1)*this._gap),this._setContainerWidth(n),this._setContainerHeight(r),this._positionAllItems(),this.fireEvent("autoSized")),this._updateSizeLimits(),this.parent()},_getRowNumber:function(){var e=parseInt(this.getComponentProperty("numCols")),t=parseInt(this.getComponentProperty("maxRows"));return this._numItems&&this._numItems<t*e?this._normalizeRows(t):t},_updateSizeLimits:function(){this.setMinW(this._numCols*(this._minDisplayerWidth+this._gap)+this._widthDiff-this._gap),this.setMinH(this._numRows*(this._minDisplayerHeight+this._gap)+this._heightDiff-this._gap)},_editModeChanged:function(e,t){this.parent(e),t=="PREVIEW"&&this._setTotalMaxRows(this._getRowNumber())},_setContainerWidth:function(e){var t=e+this._widthDiff;this._skinParts.itemsContainer.setStyle("width",String(e)+"px"),this._view.setStyle("width",String(t)+"px"),this.setWidth(t,!1,!1)},_setContainerHeight:function(e){var t=e+this._heightDiff;this._skinParts.itemsContainer.setStyle("height",String(e)+"px"),this.setHeight(t,!1,!1),this._view.setStyle("height",String(t)+"px")},_updateContainerSize:function(){var e=this._view.getSize();if(e.x==0||e.y==0)e.x=this.getWidth(),e.y=this.getHeight();var t=e.x-this._widthDiff,n=e.y-this._heightDiff;this._skinParts.itemsContainer.setStyles({width:t+"px",height:n+"px"})},_calculateItemSize:function(){if(this._skinParts&&this._data.get("items").length>0){var e=this._view.getSize();if(e.x==0||e.y==0)e.x=this.getWidth(),e.y=this.getHeight();var t=e.x-this._widthDiff,n=e.y-this._heightDiff;this._itemWidth=Math.max(Math.floor((t-(this._numCols-1)*this._gap)/this._numCols),0),this._itemHeight=Math.max(Math.floor((n-(this._numRows-1)*this._gap)/this._numRows),0)}},_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");e==="unset"&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._sequencer.addEvent("componentSetup",function(e){this._onDisplayerCreation(e.compView.getLogic(),e.method,e.index)}.bind(this)),this._sequencer.addEvent("productionFinished",function(e){this._onSequencerFinished(e)}.bind(this)),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.showMore&&(this._skinParts.showMore.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._increaseTotalMaxRows),this._skinParts.showMore.setStyles({"white-space":"nowrap"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0,this._calculateItemSize(),this._updateSizeLimits(),this._setCorrectedComponentSize(),this._updateContainerSize()},getAcceptableDataTypes:function(){return["ImageList"]},render:function(){this._newItems=[],this._sequencer.createComponents(this._skinParts.itemsContainer,this._data.get("items").slice(0,this._numCols*this._numRows))},_onSequencerFinished:function(e){this._renderingPhase="normal",this._galleryItems=e.elements,this._totalMaxRows=this.getComponentProperty("maxRows"),this._positionAllItems(),this._setupAllItems()},_setupItem:function(e){if(e.getLogic){var t=e.getLogic();t.setOwner(this),t.invalidateSize(),t.setSize(this._itemWidth,this._itemHeight,this._imageMode),this._transitionsOn&&parseFloat(e.getStyle("opacity"))<1&&(this._transitionProp?(e.setStyle(this._transitionProp,"opacity 1s"),setTimeout(function(){e.setStyle("opacity","1.0")},150)):this._Tween.to(e,1,{opacity:1}))}},_onDisplayerCreation:function(e,t,n){t=="create"&&this._renderingPhase=="showMore"&&e.getViewNode().setStyle("opacity","0.0")},_normalizeRows:function(e){var t=Math.floor(this._numItems/this._numCols)+(this._numItems%this._numCols>0?1:0);return Math.min(e,t)},_updateState:function(){this._numItems<=this._numRows*this._numCols?this.setState("fullView"):this.setState("hiddenChildren")},_positionAllItems:function(e){e=e||this._galleryItems;for(var t=0;t<e.length;t++){var n=this._calcItemPosition(t);e[t].setStyles({position:"absolute",left:n.left+"px",top:n.top+"px"})}},_calcItemPosition:function(e){var t=e%this._numCols,n=Math.floor((e-t)/this._numCols);return{left:t*(this._itemWidth+this._gap),top:n*(this._itemHeight+this._gap),width:this._itemWidth+this._gap,height:this._itemHeight+this._gap}},_setupAllItems:function(e){e=e||this._galleryItems;for(var t=0;t<e.length;t++)this._setupItem(e[t])},_setCorrectedComponentSize:function(){var e=this.getWidth()-(this.getWidth()-this._widthDiff-this._gap*(this._numCols-1))%this._numCols,t=this.getHeight()-(this.getHeight()-this._heightDiff-this._gap*(this._numRows-1))%this._numRows;this._view.setStyles({width:e,height:t}),this.setWidth(e,!1,!1),this.setHeight(t,!1,!1)},_onResize:function(){this.parent(),this._skinParts&&(this._calculateItemSize(),this._setCorrectedComponentSize(),this._updateContainerSize(),this._positionAllItems(),this._setupAllItems())},_checkExtremeValues:function(){if(this._itemWidth<this._minDisplayerWidth){var e=this.getWidth()-this._widthDiff;this._itemWidth=this._minDisplayerWidth,this._gap=Math.floor((e-this._numCols*this._itemWidth)/(this._numCols-1)),this.setComponentProperty("margin",this._gap)}else if(this._itemHeight<this._minDisplayerHeight){var t=this.getHeight()-this._heightDiff;this._itemHeight=this._minDisplayerHeight,this._gap=Math.floor((t-this._numRows*this._itemHeight)/(this._numRows-1)),this.setComponentProperty("margin",this._gap)}},_increaseTotalMaxRows:function(){this._setTotalMaxRows(this._normalizeRows(this._numRows+parseInt(this.getComponentProperty("incRows"))))},_setTotalMaxRows:function(e){this._numRows=e;var t=Math.floor(this._numRows*this._itemHeight+(this._numRows-1)*this._gap);this._updateState(),this._setContainerHeight(t),this._calculateItemSize(),this.fireEvent("autoSized"),this._renderingPhase="showMore",this.render()},getSequencer:function(){return this._sequencer}}}),define.oldComponent({name:"wysiwyg.viewer.components.MediaZoom",traits:["wysiwyg.viewer.components.traits.ListIterator"],skinParts:{blockingLayer:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},dialogBox:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Close"},virtualContainer:{type:"htmlElement"},itemsContainer:{type:"htmlElement"},counter:{type:"htmlElement"},buttonPrev:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Prev"},buttonNext:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_handleCurrentItemChange","_transitionToCurrentDisplayer"],transitionTime:"normal",initialize:function(e,t,n){this.isVolatile=!0,this.parent(e,t,n);var r=this.injects().Commands;r.registerCommandAndListener("WViewerCommands.MediaZoom.Close",this,this._closeZoom,null,!0),r.registerCommandAndListener("WViewerCommands.MediaZoom.Next",this,this.gotoNext,null,!0),r.registerCommandAndListener("WViewerCommands.MediaZoom.Prev",this,this.gotoPrev,null,!0),r.registerCommandAndListener("WPreviewCommands.WEditModeChanged",this,this._editModeChanged,null,!0),this.addEvent("currentItemChanged",this._handleCurrentItemChange),this.collapse()},_onAllSkinPartsReady:function(){var e=function(e){e.stopPropagation()};this._skinParts.dialogBox.addEvent("click",e),this._skinParts.buttonNext.addEvent("click",e),this._skinParts.buttonPrev.addEvent("click",e),this._skinParts.xButton.addEvent("click",e)},setGallery:function(e,t,n,r,i){if(!this._validateArgs(e,t))return;this._opened=!0,this._getDisplayerDivFunction=n,this._getHashPartsFunction=r,this._extraParams=i||{},this.setDataItem(e),this.setListAndCurrentIndex(e,t),this._setNextPrevVisibility()},setImage:function(e,t,n){var r=this.injects().Data.createDataItem({type:"list",items:[e]});this.setGallery(r,0,t,n)},_lastCurrentItem:null,showZoomImage:function(){if(this._currentItem&&this._currentItem!=this._lastCurrentItem){var e=this.injects().Utils.getWindowSize(),t=this.getSkin().getParams().first(function(e){return e.id==="$marginIncludingArrow"});this._imageMaxWidth=e.width-t.defaultValue*2,this._imageMaxHeight=e.height-60,this._lastCurrentItem=this._currentItem,this._renderCurrentDisplayer(this._transitionToCurrentDisplayer),this._skinParts.counter.set("text",String(this._currentItemIndex+1)+"/"+String(this._numItems)),this.injects().Viewer.enterFullScreenMode(),this.uncollapse()}},_editModeChanged:function(e,t){if(this._isDisposed)return;this._closeZoom(),this.injects().Viewer.removeZoomElement(),this.dispose()},_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._skinParts.virtualContainer.empty(),this._skinParts.itemsContainer.empty(),this._skinParts.dialogBox.setStyles({width:"100px"}),this._opened=!1,this.unlock(),this._lastCurrentItem=null},_handleCurrentItemChange:function(){this.lock();var e=function(e){var t=this.injects().Utils.hash.getHashParts();t.id===e.id&&t.extData===e.extData?this.showZoomImage():this.injects().Utils.hash.setHash(e.id,e.title,e.extData,!0)}.bind(this);this._getHashPartsFunction?this._getHashPartsFunction(this._currentItem,e):this.showZoomImage()},_renderCurrentDisplayer:function(e){var t=this._skinParts.virtualContainer;for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].destroy();var r=this;this._getDisplayerDivFunction(this._currentItem,{container:r._skinParts.virtualContainer,x:this._imageMaxWidth,y:this._imageMaxHeight},function(e){e.getParent('[skinpart="virtualContainer"]')||e.insertInto(r._skinParts.virtualContainer),r._transitionToCurrentDisplayer(e)})},_inTransition:!1,_transitionToCurrentDisplayer:function(e){if(this._inTransition)return;this._inTransition=!0,e.setStyle("opacity","0.0");var t=this._skinParts.itemsContainer,n=this,r=function(){for(var r=0;r<t.childNodes.length;r++)t.childNodes[r].destroy();t.empty();var s=e.getStyles("width","height"),o=n._getTopGap(s.height.replace("px",""));t.adopt(e),n._skinParts.virtualContainer.empty();var u=new Fx.Morph(n._skinParts.dialogBox,{duration:n.transitionTime,link:"chain"});u.addEvent("complete",function(){var t=new Fx.Tween(e,{duration:n.transitionTime,link:"chain"});t.addEvent("complete",function(){n.unlock(),n._inTransition=!1,t.removeEvent("complete",arguments.callee)}),t.start("opacity","1.0"),u.removeEvent("complete",arguments.callee)}),u.start({width:s.width,"min-height":s.height,"margin-top":o+"px"}),i&&i.removeEvent("complete",arguments.callee)};if(t.hasChildNodes()){var i=new Fx.Tween(t.firstChild,{duration:n.transitionTime,link:"chain",property:"opacity"});i.addEvent("complete",r),i.start("0.0")}else r()},_changeImageNoTransition:function(e){var t=this._skinParts.itemsContainer,n=this;for(var r=0;r<t.childNodes.length;r++)t.childNodes[r].destroy();t.empty();var i=e.getStyles("width","height"),s=n._getTopGap(i.height.replace("px",""));t.adopt(e),n._skinParts.virtualContainer.empty(),n._skinParts.dialogBox.setStyles({width:i.width,"min-height":i.height,"margin-top":s+"px"}),n.unlock()},_getTopGap:function(e){var t=this.injects().Utils.getWindowSize(),n=(t.height-e)/2;return n>0?n:0},_validateArgs:function(e,t){if(!e||!typeof t=="number")return!1;var n=e.length;return e.length<1?!1:t<0||t>=n?(LOG.reportError(wixErrors.EDITOR_INDEX_OUT_OF_RANGE,"wysiwyg.viewer.components.MediaZoom","setGallery",t),!1):!0},_setNextPrevVisibility:function(){this._skinParts.buttonNext.uncollapse(),this._skinParts.buttonPrev.uncollapse();if(this.getDataItem().get("items").length<=1||this._extraParams.hideNextPrevBtns)this._skinParts.buttonNext.collapse(),this._skinParts.buttonPrev.collapse()},_getItemId:function(e){var t=typeof e=="string"?e:e.get("id");return t.indexOf("#")==0?t.substr(1):t},_opened:!1,isZoomOpened:function(){return this._opened},validateArgs:function(e,t){if(!e||!typeof t=="number")return!1;var n=e.length;return e.length<1?!1:t<0||t>=n?(LOG.reportError(wixErrors.EDITOR_INDEX_OUT_OF_RANGE,"wysiwyg.viewer.components.MediaZoom","setGallery",t),!1):!0}}}),define.oldComponent({name:"wysiwyg.viewer.components.MediaZoomDisplayer",traits:["wysiwyg.common.components.traits.LinkableComponent"],skinParts:{title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},link:{type:"htmlElement",optional:!0},imageWrapper:{type:"htmlElement",command:"WViewerCommands.MediaZoom.Next"},image:{type:"core.components.Image",dataRefField:"*",optional:!1,hookMethod:"_addImageArgs"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_setCorrectImageSize"],_states:{link:["showLink","hideLink"]},_minWidth:600,_maxWidth:-1,_maxHeight:-1,_imgActualSize:{x:0,y:0},initialize:function(e,t,n){this.parent(e,t,n),this._maxWidth=n.maxWidth,this._maxHeight=n.maxHeight},_tweetHookMethod:function(e){return e.dataItem=this.injects().Data.createDataItem({defaultText:"",accountToFollow:"",type:"TwitterTweet"},"TwitterTweet"),e},_addImageArgs:function(e){this._imageDimensionsClass=this.injects().Classes.get("core.components.image.ImageDimensions"),this._imageDimensions=new this._imageDimensionsClass,this._imageDimensions.setCropMode(this._imageDimensionsClass.settingOptions.crop.FULL);var t=this.getSkin().getParams().first(function(e){return e.id==="imgPadding"});this._maxWidth=this._maxWidth-t.defaultValue*2;var n=this._imageDimensions.getDimensionsForContainerSize({x:this.getDataItem().get("width"),y:this.getDataItem().get("height")},{x:this._getImageWidth(),y:this._getImageHeight()});return this._imgActualSize=n.imageVisibleSize,e.argObject={unit:"px",cropMode:"full",width:this._imgActualSize.x,height:this._imgActualSize.y},e},_onAllSkinPartsReady:function(){this.parent(),this._skinParts.comments&&(this._minWidth=600),this._setCorrectImageSize(this._imgActualSize),this._updateParts()},getAcceptableDataTypes:function(){return["Image"]},_updateParts:function(){this._skinParts&&(this._skinParts.title.set("text",this._data.get("title")),this._skinParts.description.set("text",this._data.get("description")),this.getDataItem().get("href")==""?this.setState("hideLink","link"):this.setState("showLink","link"))},_setCorrectImageSize:function(e){var t=e.y,n=this._getDisplayerWidth(e.x);this._skinParts.imageWrapper.setStyles({width:n+"px",height:t+"px","min-width":"600px"}),this._skinParts.title.setStyles({"max-width":n+"px","word-wrap":"break-word"}),this._skinParts.description.setStyles({"max-width":n+"px","word-wrap":"break-word"})},_getDisplayerWidth:function(e){return e<this._minWidth?this._minWidth:e},_getImageWidth:function(){var e=this._data.get("width");return this._maxWidth<0||e<=this._maxWidth?e:this._maxWidth},_getImageHeight:function(){var e=this._data.get("height");return this._maxHeight<0||e<=this._maxHeight?e:this._maxHeight}}}),define.component("wysiwyg.viewer.components.MessageView",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({blockingLayer:{type:"htmlElement"},okButton:{type:"core.editor.components.EditorButton"},title:{type:"htmlElement"},description:{type:"htmlElement"},dialog:{type:"htmlElement"}}),t.binds(["_closeView"]),t.methods({initialize:function(e,t,n){this.parent(e,t,n)},_onAllSkinPartsReady:function(e){e.okButton.setLabel("OK"),e.okButton.addEvent("buttonClick",this._closeView)},_editModeChanged:function(e,t){this._closeView()},showMessage:function(e){this.uncollapse(),this._skinParts.title.set("html",e.msgTitle||""),this._skinParts.description.set("html",e.msgBody||""),this._visible=!0},visible:function(){return this._visible},_closeView:function(){this.collapse(),this._visible=!1,this.fireEvent("complete")}})}),define.oldComponent({name:"wysiwyg.viewer.components.Modal",skinParts:{blockingLayer:{type:"htmlElement"},close:{type:"htmlElement"},innerComponent:{hookMethod:"_innerComponentDefinition"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onCloseClick","_onBlockingLayerClick","_editModeChanged","_onViewportResize"],_states:{},initialize:function(e,t,n){this.parent(e,t,n),n=n||{},this.disableBlockLayer=n.disableBlockLayer,this._origin=n.innerComponentArgs.argObject.origin,this._viewportSize=window.getSize(),this._innerComponentArgs=n.innerComponentArgs,this._innerComponentsize=null},render:function(){this.setSize();var e=0,t=0;this._skinParts.innerComponent.getTop()=="50%"&&(e=this._skinParts.innerComponent.getHeight()/2),this._skinParts.innerComponent.getLeft()=="50%"&&(t=this._skinParts.innerComponent.getWidth()/2),this._setInnerCompPosition(e,t),this._setClosePosition(e,t)},_onAllSkinPartsReady:function(e){this.parent(),window.addEvent(Constants.CoreEvents.RESIZE,this._onViewportResize),e.close.addEvent(Constants.CoreEvents.CLICK,this._onCloseClick),this.disableBlockLayer?e.blockingLayer.hide():e.blockingLayer.addEvent(Constants.CoreEvents.CLICK,this._onBlockingLayerClick)},_innerComponentDefinition:function(e){return e.type=this._innerComponentArgs.type,e.skin=this._innerComponentArgs.skin,e.dataItem=this._innerComponentArgs.dataItem||this._data,e.argObject=this._innerComponentArgs.argObject,e.argObject.containingComponent=this,e},_onViewportResize:function(e){this._viewportSize=window.getSize(),this._renderIfReady()},_onCloseClick:function(){this.dispose()},_onBlockingLayerClick:function(){this.dispose()},_editModeChanged:function(){this.dispose()},_setClosePosition:function(e,t){var n=this._skinParts.close,r=n.getSize().x/2,i=this._skinParts.innerComponent.getWidth(),s=this._skinParts.innerComponent.getHeight(),o=this._skinParts.innerComponent.getX(),u=this._skinParts.innerComponent.getLeft()!=="auto",a=this._skinParts.innerComponent.getTop()!=="auto",f=u?t?"50%":o+i-r:"auto",l=u?"auto":0,c=a?e?"50%":0:"auto",h=a?"auto":s-r;n.setStyles({left:f,right:l,top:c,bottom:h,"margin-left":t?t-r:0,"margin-top":e?-e-r:0})},_centerModal:function(){var e=this._skinParts.close,t=e.getSize(),n=this._skinParts.innerComponent.getWidth()/2,r=this._skinParts.innerComponent.getHeight()/2;this._skinParts.innerComponent.getViewNode().setStyles({"margin-left":-n,"margin-top":-r}),e.setStyles({left:"50%",top:"50%","margin-left":n-t.x/2,"margin-top":-r-t.y/2})},setSize:function(){var e,t,n,r;this._innerComponentsize=this._innerComponentsize||{width:this._skinParts.innerComponent.getWidth(),height:this._skinParts.innerComponent.getHeight()},n=this._innerComponentsize,r=this._viewportSize,e=Math.min(n.width,r.x),t=Math.min(n.height,r.y);if(this._skinParts.innerComponent.getWidth()!=e||this._skinParts.innerComponent.getHeight()!=t)this._skinParts.innerComponent.setWidth(e),this._skinParts.innerComponent.setHeight(t,!1,!0);this._setClosePosition()},dispose:function(){window.removeEvent(Constants.CoreEvents.RESIZE,this._onViewportResize),this._skinParts.innerComponent&&this._skinParts.innerComponent.dispose(),this.collapse(),this.parent()},_setInnerCompPosition:function(e,t){this._skinParts.innerComponent.getViewNode().setStyles({"margin-left":-t,"margin-top":-e})}}}),define.oldComponent({name:"wysiwyg.viewer.components.PageGroup",skinParts:{grid:{type:"htmlElement"}},propertiesSchemaName:"PageGroupProperties",imports:["wysiwyg.viewer.utils.TransitionUtils","core.components.Page"],Class:{Extends:"core.components.Container",_states:["showGridLines"],Binds:["onCurrentPageResize","_setHorizontalGrid","_setVerticalGrid","toggleGrid","refreshGrid","_resizePage","_onTransitionFinished"],_transitionQueue:[],initialize:function(e,t,n){this.parent(e,t,n),this.setMaxH(this.imports.Page.MAX_HEIGHT),this._runAnimations=!1,this._transitionDurationMap={},this._transitionDurationMap[Constants.TransitionTypes.NONE]=0,this._transitionDurationMap[Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN]=1.1,this._transitionDurationMap[Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN]=1.1,this._transitionDurationMap[Constants.TransitionTypes.CROSS_FADE]=1.2,this._transitionDurationMap[Constants.TransitionTypes.OUT_IN]=1.5},getInlineContentContainer:function(){return this._skinParts.inlineContent},editModeChange:function(e){e!="MASTER_PAGE"&&this._skinParts.overlay.collapse()},_onDataChanged:function(){var e=this.getComponentProperty("transition");e=="slide"&&this.setComponentProperty("transition",Constants.TransitionTypes.SWIPE_HORIZONTAL_FULLSCREEN,!0)},_onAllSkinPartsReady:function(){this._transitionUtils=new this.imports.TransitionUtils,this._Tween=this.injects().Utils.Tween,this._skinParts.overlay.collapse(),this.parent()},gotoPage:function(e){var t=document.getElementById(e);t.getLogic().setWidth(this.getWidth()),this._setVisiblePageCallId=W.Utils.callLater(function(){t.getLogic().wixifyContent(function(){this.actualGotoPage(t)}.bind(this))}.bind(this))},actualGotoPage:function(e){this._transitionQueue.push(e),this._transitionQueue.length==1&&this._executeTransition(this._transitionQueue[0])},_onTransitionFinished:function(){this._currentPage.getLogic().addEvent("resize",this.onCurrentPageResize),this._transitionQueue.shift();if(this._transitionQueue.length>0){var e=this._transitionQueue.pop();this._transitionQueue=[e],this._executeTransition(this._transitionQueue[0])}else{var t=this._currentPage.getLogic().getDataItem().get("id");window.scrollTo(0,0),this._view.fireEvent("pageTransitionEnded",t),this._resizePage()}},_executeTransition:function(e){var t=e.getLogic()._data.get("id");this._view.fireEvent("pageTransitionStarted",t),W.Viewer.fireEvent("pageTransitionStarted",t),e.setStyle("opacity","0.0"),e.getLogic().uncollapse(),e.getLogic().isContentReady()===!0?this._executeTransitionPageReady(e):e.getLogic().addEvent("pageContentReady",function(){e.getLogic().removeEvent("pageContentReady",arguments.callee),this._executeTransitionPageReady(e)}.bind(this))},_executeTransitionPageReady:function(e){var t=this.getComponentProperty("transition"),n=this._transitionDurationMap[t]||0,r=t==Constants.TransitionTypes.SWIPE_VERTICAL_FULLSCREEN?1:0,i=e.getLogic().getHeight();e.setStyles({opacity:"1.0"});if(this._currentPage&&!this._currentPage.getLogic().getIsDisposed()){this._currentPage.getLogic().removeEvent("resize",this.onCurrentPageResize);var s=this._currentPage.getLogic().getHeight();n>0?(this._Tween.execute(s,i,n,{onUpdate:this._resizePage,ease:"strong_easeInOut"}),this._Tween.execute(window.scrollY,0,n,{onUpdate:function(e){window.scrollTo(0,e)},ease:"strong_easeInOut"})):this._resizePage(i);var o=this._transitionUtils.getTransition(t);o(this._currentPage,e,r,n,function(){this._currentPage.getLogic().collapse(),this._currentPage=e,this._onTransitionFinished()}.bind(this))}else this._currentPage=e,this._resizePage(i),this._onTransitionFinished()},onCurrentPageResize:function(e){this._resizePage()},_resizePage:function(e){e||(e=this._currentPage.getLogic().getHeight()),this.setHeight(e),W.Layout.enforceAnchors([this]),this.refreshGrid()},useLayoutOnDrag:function(){return!0},isSelectable:function(){return!1},isContainer:function(){return!1},getAcceptableDataTypes:function(){return[""]},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},isDeleteable:function(){return!1},toggleGrid:function(){this._setVerticalGrid(),this._setHorizontalGrid();var e="showGridLines",t=this.getState()==e;t?this.removeState(e):this.setState(e)},refreshGrid:function(){this.getState()=="showGridLines"&&(this._setVerticalGrid(),this._setHorizontalGrid())},_setHorizontalGrid:function(){var e=window.getSize().x,t=this._view.getSize().x,n=e-t,r=n/2*-1;this._skinParts.gridHeader.setStyle("width",e),this._skinParts.gridFooter.setStyle("width",e),this._skinParts.gridHeader.setStyle("left",r),this._skinParts.gridFooter.setStyle("left",r)},_setVerticalGrid:function(){var e=this._view.getPosition().y,t=window.getSize().y,n=e*-1,r=parseInt(document.id("SITE_STRUCTURE").getStyle("height"));this._skinParts.gridBodyRight.setStyle("height",r),this._skinParts.gridBodyLeft.setStyle("height",r),this._skinParts.gridBodyRight.setStyle("top",n),this._skinParts.gridBodyLeft.setStyle("top",n)},getMinPhysicalHeight:function(){return this._currentPage.getLogic().getHeight()}}}),define.oldComponent({name:"wysiwyg.viewer.components.PagesContainer",imports:["core.components.Page"],Class:{Extends:"wysiwyg.viewer.components.SiteSegmentContainer",initialize:function(e,t,n){this.parent(e,t,n),this.setMaxH(this.imports.Page.MAX_HEIGHT),this._resizableSides=[]},isAnchorable:function(){return{to:{allow:!0,allowBottomBottom:!1,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},isContainer:function(){return!1},layoutMinHeight:function(){return this.injects().Viewer.getCurrentPageNode().getLogic().getHeight()}}}),define.oldComponent({name:"wysiwyg.viewer.components.PaginatedGridGallery",skinParts:{itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement",optional:!0},rolloverHolder:{type:"htmlElement",optional:!0},title:{type:"htmlElement",optional:!1},description:{type:"htmlElement",optional:!1},zoom:{type:"htmlElement",optional:!0},link:{type:"htmlElement",optional:!1}},imports:["wysiwyg.viewer.utils.MatrixTransitions","wysiwyg.viewer.utils.GalleryUtils","bootstrap.utils.LinkUtils"],traits:["wysiwyg.viewer.components.traits.GalleryAutoplay"],propertiesSchemaName:"PaginatedGridGalleryProperties",Class:{Extends:"wysiwyg.viewer.components.MatrixGallery",Binds:["next","prev","_onTransitionComplete","_onRollOut","_onMouseMove","_onClick"],_rolloverSequencer:null,_fixedRowNumber:!1,_states:{rendering:["pending","ready"],itemSelection:["rollover","idle"],linkableComponent:["link","noLink"]},_pageItemsCount:0,_currentItemIndex:0,_displayerDict:{},_transitionPending:!1,_transitionUtils:null,_linkUtils:null,_NO_LINK_PROPAGATION:!0,_hasRollOver:!0,initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this._transitionUtils=new this.imports.MatrixTransitions,this._linkUtils=new this.imports.LinkUtils,this._view.addEvent(Constants.CoreEvents.MOUSE_MOVE,this._onMouseMove),this._view.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onRollOut),"fixedRowNumber"in n&&(this._fixedRowNumber=n.fixedRowNumber===!0),n.sequencingHook===undefined&&(this._sequencer.resolveItem=function(){return{comp:"wysiwyg.viewer.components.ImageLite",skin:"mobile.core.skins.InlineSkin"}}),n.rolloverHook&&(this._rolloverSequencer=new this.imports.ComponentSequencer,this._rolloverSequencer.resolveItem=n.rolloverHook,this._rolloverSequencer.addEvent("componentSetup",this._onRollOverViewCreated))},_onRollOverViewCreated:function(e){this._setupItem(e.compView)},getSequencer:function(){return this._sequencer},_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");e==="unset"&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0),this._updateGalleryImageOnClickAction()),this.parent(),this._skinParts.itemsContainer.setStyles({position:"relative"}),this._skinParts.itemsContainer.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder&&(this._skinParts.rolloverHolder.addEvent(Constants.CoreEvents.CLICK,this._onClick),this._skinParts.rolloverHolder.setStyles({overflow:"hidden"}));var n=this.injects().Utils.getCSSBrowserFeature("user-select"),r={cursor:"pointer"};n&&(r[n]="none"),this._skinParts.buttonPrev.setStyles(r),this._skinParts.buttonNext.setStyles(r),this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.CLICK,function(e){e.stopPropagation(),this.prev()}.bind(this)),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.CLICK,function(e){e.stopPropagation(),this.next()}.bind(this)),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._transitionUtils.setupTransitionMap(this._calcItemPosition.bind(this),this._skinParts.itemsContainer),this._checkSkinPartsVisibility()},_onResize:function(){this.parent(),this._skinParts&&this._resetRollOver()},_onDataChange:function(e,t){this._updateGalleryImageOnClickAction(),this._currentItemIndex=0,this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber()),this._componentReady&&e===this._data&&this._skinParts.itemsContainer.empty(),this._checkSkinPartsVisibility(),this.parent(e,t)},render:function(){var e=this._data.get("items");this._displayerDict={},this._skinParts.counter&&this._skinParts.counter.set("text",this._getCounterText(this._currentItemIndex,e.length)),this._pageItemsCount=parseInt(this.getComponentProperty("numCols")*this._getRowNumber()),this._displayedItems=this._getPageItems(e,this._currentItemIndex);var t=this._displayedItems;e.length>this._pageItemsCount?(this._nextPageItems=this._getPageItems(e,this._getNextPageItemIndex()),this._prevPageItems=this._getPageItems(e,this._getPrevPageItemIndex()),t=t.concat(this._nextPageItems).concat(this._prevPageItems),this._skinParts.buttonNext.setStyles({display:"block"}),this._skinParts.buttonPrev.setStyles({display:"block"})):(this._skinParts.buttonNext.setStyles({display:"none"}),this._skinParts.buttonPrev.setStyles({display:"none"})),this._sequencer.createComponents(this._skinParts.itemsContainer,t)},_getRowNumber:function(){return this._fixedRowNumber===!0?parseInt(this.getComponentProperty("maxRows")):this.parent()},_getPageItems:function(e,t){var n=[],r=Math.min(this._numItems-1,t+this._pageItemsCount-1);for(var i=t;i<=r;i++)n.push(e[i]);return n},_getCounterText:function(e,t){var n=Math.floor(e/this._pageItemsCount),r=this._getTotalPageCount();return r||(r=1),String(n+1)+"/"+String(r)},_translateRefList:function(e){var t,n=[],r,i,s=this._skinParts.itemsContainer.children,o=typeOf(e[0]);e=e.slice(0);for(var u=0;u<s.length;u++)t=s[u],r=t.getLogic().getDataItem(),i=o==="string"?"#"+r.get("id"):r,e.contains(i)&&(n.push(t),e.splice(e.indexOf(i),1));return n},_checkSkinPartsVisibility:function(){this._skinParts&&(this._resetRollOver(),this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"),this._skinParts.rolloverHolder&&this._skinParts.rolloverHolder.setStyle("cursor",this._isImageClickable()?"pointer":"default"),this._skinParts.link.set("text",this.getComponentProperty("goToLinkText")))},_updateState:function(){},_onDisplayerCreation:function(e,t,n){var r=e.getViewNode();this._setupItem(r);var i;e.getRef?i=e.getRef():i="#"+e.getDataItem().get("id"),r.addClass("galleryDisplayer"),this._displayerDict[i]=e,n>=this._displayedItems.length&&r.setStyles({top:-this._itemHeight*1.5,position:"absolute"})},_onSequencerFinished:function(e){e.elements=e.elements.slice(0,this._displayedItems.length),this.parent(e),this._transitionPending=!1,this.fireEvent("transitionFinished")},gotoNext:function(){this.next()},next:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&(this._currentItemIndex=this._getNextPageItemIndex(),this._goto(this._nextPageItems,0))},prev:function(){!this._transitionPending&&this._numItems>this._pageItemsCount&&(this._currentItemIndex=this._getPrevPageItemIndex(),this._goto(this._prevPageItems,1))},_getNextPageItemIndex:function(){var e=this._currentItemIndex+this._pageItemsCount;return e>=this._numItems&&(e=0),e},_getPrevPageItemIndex:function(){var e=this._currentItemIndex-this._pageItemsCount;return e<0&&(e=(this._getTotalPageCount()-1)*this._pageItemsCount),e},_goto:function(e,t){this._transitionPending=!0,this._resetRollOver();var n=this._translateRefList(this._displayedItems),r=this._translateRefList(e),i=this._transitionUtils.getTransition(this.getComponentProperty("transition"));this._setupAllItems(r),i(n,r,this._numCols,this._numRows,t,parseFloat(this.getComponentProperty("transDuration")),function(){this._onTransitionComplete(r)}.bind(this))},_onTransitionComplete:function(){this.render()},_onMouseMove:function(e){if(this._transitionPending===!0)return;var t=this._findDisplayerFromPosition(e.page);if(t&&this._skinParts.rolloverHolder&&this._hasRollOver){if(this._highlightedDisplayer!==t){this._highlightedDisplayer=t;var n=t.getCoordinates(this._skinParts.rolloverHolder.getParent());this._skinParts.rolloverHolder.setStyles({visibility:"visible",position:"absolute",padding:0,left:n.left,top:n.top,width:n.width,height:n.height}),this.setState("idle"),window.requestAnimFrame(function(){if(this._highlightedDisplayer){this._updateDisplayerInfo(t.getLogic().getDataItem());var e=this._getHighlightedDisplayerData();if(e.getType&&e.getType()==="Image"){var n=this.getSkinPart("link");this._linkUtils.linkifyElement(this,n,e,!0)}this._skinParts.rolloverHolder.setStyle("cursor",this._isImageClickable()?"pointer":"default"),this._galleryImageOnClickAction=="goToLink"?this._skinParts.link.setStyle("display","none"):this._skinParts.link.setStyle("display",this._isImageLinked()?"block":"none"),this.setState("rollover")}}.bind(this))}}else this._resetRollOver()},_onRollOut:function(e){e.relatedTarget&&!e.relatedTarget.getParents().contains(this._view)&&this._resetRollOver()},_findDisplayerFromPosition:function(e){var t,n=this._skinParts.itemsContainer.getPosition(),r={x:e.x-n.x,y:e.y-n.y},i=Math.floor(r.x/(this._itemWidth+this._gap)),s=Math.floor(r.y/(this._itemHeight+this._gap));if(i>=0&&s>=0){var o=s*this._numCols+i;o<this._galleryItems.length&&(t=this._galleryItems[o])}return t},_findDisplayer:function(e){while(e){if(e===this._skinParts.itemsContainer)return null;if(this._galleryItems.contains(e))return e;e=e.getParent()}return null},_updateDisplayerInfo:function(e){this._skinParts.rolloverHolder&&this._rolloverSequencer?this._rolloverSequencer.createComponents(this._skinParts.rolloverHolder,[e]):e&&e.getData&&"title"in e.getData()&&"description"in e.getData()&&(this._skinParts.title.set("text",e.get("title")),this._skinParts.description.set("text",e.get("description")))},_hideRollOverHolder:function(){this.setState("idle"),this._skinParts.rolloverHolder.setStyles({visibility:"hidden"})},_resetRollOver:function(){this._hideRollOverHolder(),this._highlightedDisplayer=null},_onClick:function(e){if(e.rightClick!==!1)return;var t;if(this._galleryImageOnClickAction=="zoomMode"){var n=this._highlightedDisplayer||this._findDisplayer(e.target);if(n){t=n.getLogic().getDataItem();var r=t.get("id"),i=this._data.get("items"),s=i.indexOf("#"+r);this.injects().Commands.executeCommand("WViewerCommands.OpenZoom",{itemsList:this._data,currentIndex:s,getDisplayerDivFunction:this.injects().Viewer.getDefaultGetZoomDisplayerFunction("Image"),getHashPartsFunction:this.injects().Viewer.getDefaultGetHashPartsFunction("Image")})}}else this._galleryImageOnClickAction=="goToLink"&&this._isImageLinked()&&this._skinParts.link.click()},_getTotalPageCount:function(){var e=Math.floor(this._numItems/this._pageItemsCount);return this._numItems%this._pageItemsCount>0&&e++,e},_isImageLinked:function(){var e=this._getHighlightedDisplayerData();if(e){var t=e.get("href");return!!t}return!1},_getHighlightedDisplayerData:function(){return this._highlightedDisplayer&&this._highlightedDisplayer.getLogic?this._highlightedDisplayer.getLogic().getDataItem():null},_isImageClickable:function(){return this._galleryImageOnClickAction==="goToLink"?this._isImageLinked():this._galleryImageOnClickAction!=="disabled"},_updateGalleryImageOnClickAction:function(){this.getComponentProperties().hasField("galleryImageOnClickAction")?this._galleryImageOnClickAction=this.getComponentProperty("galleryImageOnClickAction"):this._galleryImageOnClickAction=this.getComponentProperty("expandEnabled")?"zoomMode":"disabled"}}}),define.oldComponent({name:"wysiwyg.viewer.components.PasswordLogin",imports:[],skinParts:{blockingLayer:{type:"htmlElement"},passwordInput:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},submitButton:{type:"htmlElement"},xButton:{type:"htmlElement",command:"WViewerCommands.PasswordLogin.Close"},cancel:{type:"htmlElement"},favIcon:{type:"htmlElement"},faveIconAhref:{type:"htmlElement"},header:{type:"htmlElement"},title:{type:"htmlElement"},dialog:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["centerDialog","_onSubmit","_reportError","_invalidateErrorState","_onKeyPress","_handleCancel","_onPasswordSuccess"],initialize:function(e,t,n){this.isVolatile=!0,this.parent(e,t,n),this.VIEWER_STRINGS={LOGIN_HEADER:"Enter password to view this page",LOGIN_ERR_GENERAL:"Server error - Unable to log in",LOGIN_ERR_WRONG_PASSWORD:"Please enter the correct password",PASSWORD_LABEL:"Password"},this._digestedPassword=n&&n.digestedPassword,this._authCallback=n&&n.authCallback,this._disableCancel=n&&n.disableCancel},centerDialog:function(){var e=this.injects().Utils.getWindowSize(),t=this._skinParts.dialog;t.setPosition({x:e.width/2-t.getSize().x/2,y:e.height/2-t.getSize().y/2})},_onAllSkinPartsReady:function(e){this._disableCancel?(e.xButton.hide(),e.cancel.setStyle("visibility","hidden")):(e.cancel.addEvent("click",this._handleCancel),e.xButton.addEvent("click",this._handleCancel),e.blockingLayer.addEvent("click",function(t){t.target==e.blockingLayer&&this._handleCancel()}.bind(this))),e.submitButton.addEvent("click",this._onSubmit),e.title.set("text",this.VIEWER_STRINGS.LOGIN_HEADER);if(this.injects().Viewer.isPremiumUser()){e.faveIconAhref.removeAttribute("href");var t=window.publicModel&&window.publicModel.favicon;t?e.favIcon.src=this.injects().Config.getMediaStaticUrl(t)+t:e.favIcon.src=W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/viewer/blank-favicon.png"}e.passwordInput.addEvent(Constants.CoreEvents.KEY_UP,this._onKeyPress)},_handleCancel:function(){this.injects().Commands.executeCommand("WViewerCommands.PasswordLogin.Close",null,null),this._reportAuthStatusChange(!1,{cancel:!0})},_reportAuthStatusChange:function(e,t){this._authCallback&&this._authCallback({authResponse:e,data:t})},_editModeChanged:function(e,t){this._handleCancel()},_onKeyPress:function(e){e.code==13&&this._onSubmit(),this._invalidateErrorState()},_onSubmit:function(){this._invalidateErrorState();var e=this._skinParts.passwordInput._data.get("text");this._validatePassword(e,function(){this._invalidateErrorState(),this._onPasswordSuccess()}.bind(this),function(e){this._reportError(e)}.bind(this))},_onPasswordSuccess:function(){this.injects().Commands.executeCommand("WViewerCommands.PasswordLogin.Close",null,null),this._reportAuthStatusChange(!0)},_validatePassword:function(e,t,n){if(this._digestedPassword){var r=W.Utils.hashing.SHA256.b64_sha256(e);r==this._digestedPassword?t():n(this.VIEWER_STRINGS.LOGIN_ERR_WRONG_PASSWORD)}},_reportError:function(e){this._skinParts.passwordInput.setError(e)},_invalidateErrorState:function(){this._skinParts.passwordInput.setValidationState(!0)},_bindPasswordField:function(e){return e.argObject={label:this.VIEWER_STRINGS.PASSWORD_LABEL,passwordField:!0},e.dataItem=this.injects().Data.createDataItem({text:"",type:"Text"},"Text"),e}}}),define.oldComponent({name:"wysiwyg.viewer.components.PayPalButton",imports:[],skinParts:{buttonContainer:{type:"htmlElement"}},propertiesSchemaName:"PayPalButtonProperties",Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1}},Extends:"mobile.core.components.base.BaseComponent",Binds:[],initialize:function(e,t,n){this.parent(e,t,n),this._resizableSides=[]},render:function(){this._createPayPalForm()},_createPayPalForm:function(){this._buttonType=this.getComponentProperty("buttonType");var e=this.getComponentProperty("amount"),t=!e||Number(e)==0,n=this.getComponentProperty("target"),r=this._buttonType=="buy"?"_xclick":"_donations";this._form=new Element("form",{action:"https://www.paypal.com/cgi-bin/webscr",method:"POST"}),this._skinParts.buttonContainer.empty(),this._skinParts.buttonContainer.adopt(this._form),this._form.set("target",n),this._addHiddenInput("cmd",r),this._addHiddenInput("business",this._data.get("merchantID")),this._addHiddenInput("item_name",this._buttonType=="buy"?this.getComponentProperty("itemName"):this.getComponentProperty("organizationName")),this._addHiddenInput("item_number",this._buttonType=="buy"?this.getComponentProperty("itemID"):this.getComponentProperty("organizationID")),this._addHiddenInput("notify_url","https://inventory.wix.com/ecommerce/ipn/paypal");if(n=="_blank"){var i=document.location.href;this._addHiddenInput("return",i),this._addHiddenInput("cancel_return",i)}t||this._addHiddenInput("amount",this.getComponentProperty("amount")),this._addHiddenInput("currency_code",this.getComponentProperty("currencyCode")),this._buttonType=="buy"?this._addHiddenInput("bn","Wix_BuyNow_WPS_IL"):this._addHiddenInput("bn","Wix_Donate_WPS_IL"),this._addSubmitImage(),this._addPixelImage(),this._alignSize(),this._form.addEvent("click",function(e){if(n=="_self"){var t={component:this};this.injects().Commands.executeCommand("linkableComponent.navigateSameWindow",t,this)}}.bind(this))},_alignSize:function(){var e=this.getComponentProperty("showCreditCards"),t=this.getComponentProperty("smallButton"),n,r;t?(n=21,r=this._buttonType=="buy"?86:74):e?(n=47,r=170):(n=26,r=this._buttonType=="buy"?107:92),this.setWidth(r),this.setHeight(n),this._view.setStyle("height",n+"px")},_addSubmitImage:function(){var e=new Element("input",{type:"image",name:"submit",border:0,src:function(){var e=this.getComponentProperty("showCreditCards"),t=this.getComponentProperty("smallButton"),n="en_US",r="https://www.paypalobjects.com/"+n+"/i/btn/btn_";return r+=this._buttonType=="buy"?"buynow":"donate",r+=e&&!t?"CC":"",r+=t?"_SM":"_LG",r+=".gif",r}.bind(this)()});this._form.adopt(e)},_addHiddenInput:function(e,t){var n=new Element("input",{type:"hidden",name:e,value:t});this._form.adopt(n)},_addPixelImage:function(){this._form.adopt(new Element("img",{src:"https://www.paypalobjects.com/en_US/i/scr/pixel.gif",width:"1",height:"1"}))},getAcceptableDataTypes:function(){return["PayPalButton"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.ScreenWidthArea",skinParts:{inlineContent:{type:"htmlElement"},background:{type:"htmlElement"}},Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0}},Extends:"mobile.core.components.base.BaseComponent",getInlineContentContainer:function(){return this._skinParts.inlineContent?this._skinParts.inlineContent:this._view},getLayoutMode:function(){return"BACKGROUND_STRIP"}}}),define.oldComponent({name:"wysiwyg.viewer.components.ScreenWidthContainer",skinParts:{inlineContent:{type:"htmlElement"},screenWidthBackground:{type:"htmlElement"},bg:{type:"htmlElement"},centeredContent:{type:"htmlElement"}},Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0}},Extends:"core.components.Container",Binds:["_onScreenResize","_stretchBackgroundAndCenterContent"],initialize:function(e,t,n){this._pendingSizeUpdates={},this.parent(e,t,n),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM],this._moveDirections=[Constants.BaseComponent.MoveDirections.VERTICAL]},_onScreenResize:function(){this.getIsDisplayed()&&this._stretchBackgroundAndCenterContent()},_onResize:function(){},_stretchBackgroundAndCenterContent:function(){var e=this._view,t=$(document).getSize(),n=e.getSize(),r=this.injects().Viewer.getDocWidth(),i=-Math.round((t.x-r)/2);i>0&&(i=0),this._skinParts.screenWidthBackground.setStyles({position:"absolute",width:t.x+"px",height:n.y+"px",left:i})},render:function(){this.injects().Viewer.addEvent(this.injects().Viewer.SCREEN_RESIZE_EVENT,this._onScreenResize),this._stretchBackgroundAndCenterContent();var e=this.injects().Viewer.getDocWidth();this.setWidth(e),this._onAutoSized()},dispose:function(){this.parent(),this.injects().Viewer.removeEvent(this.injects().Viewer.SCREEN_RESIZE_EVENT,this._onScreenResize)},_onAllSkinPartsReady:function(){this._applyPendingSizeUpdates(!0)},_applyPendingSizeUpdates:function(e){this._pendingSizeUpdates.width!=null?(this.setWidth(this._pendingSizeUpdates.width),this._pendingSizeUpdates.width=null):e&&this.setWidth(this.getWidth(),!0),this._pendingSizeUpdates.height!=null?(this.setHeight(this._pendingSizeUpdates.height),this._pendingSizeUpdates.height=null):e&&this.setHeight(this.getHeight(),!0)},setX:function(){},getX:function(){return 0},setHeight:function(e,t,n){this.parent(e,t,n),this._skinParts?(this._view.setStyle("min-height",e+"px"),this._stretchBackgroundAndCenterContent(),this.flushPhysicalHeightCache(),this._onResize()):this._pendingSizeUpdates.height=e},setWidth:function(e,t,n){this.parent(e,t,n);if(this._skinParts){var r=this.injects().Viewer.getDocWidth(),i=e+"px",s=(r-e)/2+"px";this._skinParts.centeredContent.setStyles({width:i,"margin-left":s})}else this._pendingSizeUpdates.width=e},getSelectableX:function(){var e=$(document).getSize().x;return this.getX()-(e-this.getWidth())/2},getSelectableWidth:function(){var e=$(document).getSize().x;return e},isContainable:function(e){return instanceOf(e,this.constructor)},isDuplicatable:function(){return!0},_getEditBoxReferenceNode:function(){return this._skinParts.inlineContent}}}),define.component("wysiwyg.viewer.components.SelectableSliderGallery",function(e){var t=e;t.skinParts({imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items"},itemsContainer:{type:"htmlElement"},swipeLeftHitArea:{type:"htmlElement"},swipeRightHitArea:{type:"htmlElement"}}),t.inherits("wysiwyg.viewer.components.SliderGallery"),t.fields({_selectedItem:null}),t.methods({initialize:function(e,t,n){this._expandEnabled=!1,this._initialSelectedIndex=0,n.selectedIndex&&(this._initialSelectedIndex=n.selectedIndex),this.parent(e,t,n)},_setupDisplayer:function(e,t){this.parent(e),t===this._initialSelectedIndex&&this.setSelectedState(e),e.addEvent("itemSelected",function(){this.setSelectedState(e),this.fireEvent("imageSelected",e.getDataItem())}.bind(this))},setSelectedState:function(e){if(this._selectedItem){if(this._selectedItem===e)return;this._selectedItem.setSelected(!1)}this._selectedItem=e,this._selectedItem.setSelected(!0)}})}),define.oldComponent({name:"wysiwyg.viewer.components.SiteButton",skinParts:{label:{type:"htmlElement"},link:{type:"htmlElement"}},propertiesSchemaName:"ButtonProperties",traits:["wysiwyg.common.components.traits.LinkableComponent"],Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}]},Extends:"mobile.core.components.base.BaseComponent",_states:["up","over","selected","pressed"],_triggers:["click"],Binds:["_onClick","_onOver","_onOut","_onMouseDown","_onMouseUp"],_canFocus:!0,initialize:function(e,t,n){this.parent(e,t,n),this._userSelectedWidth=0,this._resizeTriggeredByData=!1},_onClick:function(e){LOG.reportEvent(wixEvents.VIEWER_BUTTON_COMPONENT_CLICK,{c1:this._compId,i1:this.isEnabled()?1:0});if(!this.isEnabled())return this._cancelEvent(e);e.target=this.getViewNode(),this.fireEvent(Constants.CoreEvents.CLICK,e);if(this._toggleMode){var t=this.getState()!="selected"?"selected":"over";this.setState(t)}},_onOver:function(e){this.isEnabled()&&this.getState()!="selected"&&(this.fireEvent("over",e),this.setState("over"))},_onOut:function(e){this.isEnabled()&&this.getState()!="selected"&&(this.fireEvent("up",e),this.setState("up"))},_onMouseDown:function(e){if(this.isEnabled()&&this.getState()!="selected")this.setState("pressed"),this.fireEvent(Constants.CoreEvents.MOUSE_DOWN,e);else if(!this.isEnabled())return this._cancelEvent(e)},_cancelEvent:function(e){return e.stopPropagation(),e.preventDefault(),!1},_onMouseUp:function(){this.removeState("pressed")},_onEnabled:function(){var e=this._skinParts.view;e.addEvent(Constants.CoreEvents.CLICK,this._onClick),e.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),e.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),e.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),e.addEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},_onDisabled:function(){var e=this._skinParts.view;e.removeEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),e.removeEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),e.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},render:function(){var e=this._data.get("label");this._skinParts.label.set("text",e),!this._userSelectedWidth&&!e&&(this._userSelectedWidth=parseInt(this._view.getStyle("width"),10)),this._updateMinimumWidth(),this._updateWidthFromText(),this._updateMinimumHeight(),this._setLineHeight(),this._setTextAlignment(),this._wCheckForSizeChangeAndFireAutoSized(0)},_skinParamsChange:function(){this.injects().Utils.callLater(function(){this._renderIfReady()}.bind(this),[],this,0),this.parent()},setHeight:function(e,t,n){this.parent(e,t,n),this._setLineHeight()},_setLineHeight:function(){if(this.isReady()){var e=parseInt(this._view.getStyle("padding-top")),t=parseInt(this._view.getStyle("padding-bottom")),n=this.getHeight()-e-t;this._skinParts.label.setStyle("line-height",n+"px")}},_setTextAlignment:function(){var e=this.getComponentProperty("align");this._skinParts.link.setStyle("text-align",e),this._setTextMargin()},_setTextMargin:function(){var e=this.getComponentProperty("margin"),t=this.getComponentProperty("align"),n=parseInt(this._skinParts.label.offsetWidth),r=this.getWidth();n+e>r&&(e=r-n),t=="left"?(this._skinParts.label.setStyle("margin-right",""),this._skinParts.label.setStyle("margin-left",e+"px")):t=="right"?(this._skinParts.label.setStyle("margin-left",""),this._skinParts.label.setStyle("margin-right",e+"px")):(this._skinParts.label.setStyle("margin-left",""),this._skinParts.label.setStyle("margin-right",""))},_setMinimumWidthAccordingToText:function(){var e=parseInt(this._skinParts.label.offsetWidth),t=parseInt(this._view.getStyle("padding-left")),n=parseInt(this._view.getStyle("padding-right"));this.setMinW(e+t+n)},_setMinimumHeightAccordingToText:function(){var e=parseInt(this._view.getStyle("padding-top")),t=parseInt(this._view.getStyle("padding-bottom"));this._skinParts.label.setStyle("line-height",""),this.setMinH(this._skinParts.label.offsetHeight+e+t)},_updateMinimumHeight:function(){this._setMinimumHeightAccordingToText(),this.setHeight(this.getHeight(),!1,!1)},_updateMinimumWidth:function(){this._setMinimumWidthAccordingToText(),this.setWidth(this.getWidth(),!1,!1)},_updateWidthFromText:function(){this._userSelectedWidth=this._userSelectedWidth==0?this.getWidth():this._userSelectedWidth;var e=Math.max(this.getSizeLimits().minW,this._userSelectedWidth);this.setWidth(e,!1,!1)},_onResize:function(){this.parent(),this._resizeTriggeredByData==0?this._userSelectedWidth=parseInt(this._view.getStyle("width")):this._resizeTriggeredByData=!1;if(!this.isReady())return 0;this._setTextMargin()},_onDataChange:function(e,t,n){this._resizeTriggeredByData=!0,this.parent(e,t,n)},getAcceptableDataTypes:function(){return["SiteButton"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.SiteSegmentContainer",skinParts:{inlineContent:{type:"htmlElement"},screenWidthBackground:{type:"htmlElement"},bg:{type:"htmlElement"},centeredContent:{type:"htmlElement"}},Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0}},Extends:"wysiwyg.viewer.components.ScreenWidthContainer",initialize:function(e,t,n){this.parent(e,t,n),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},useLayoutOnDrag:function(){return!0},useLayoutOnResize:function(){return!0},isDeleteable:function(){return!1},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS}}},canMoveToOtherScope:function(){return!1},isMultiSelectable:function(){return!1},isDraggable:function(){return!1},isDuplicatable:function(){return!1}}}),define.oldComponent({name:"wysiwyg.viewer.components.SlideShowGallery",skinParts:{imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"virtualContainer",moveOldItemsToContainer:!1,dataRefField:"items",argObject:{unit:"px"}},virtualContainer:{type:"htmlElement",optional:!0},itemsContainer:{type:"htmlElement"},buttonPrev:{type:"htmlElement"},buttonNext:{type:"htmlElement"},counter:{type:"htmlElement"},autoplay:{type:"htmlElement"}},propertiesSchemaName:"SlideShowGalleryProperties",imports:["wysiwyg.viewer.utils.TransitionUtils"],traits:["core.components.traits.TouchRollOverSupport","wysiwyg.viewer.components.traits.GalleryAutoplay"],Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SlideShowGallery"},commandParameterDataRef:"SELF"}},Extends:"core.components.BaseRepeater",Binds:["gotoNext","gotoPrev"],_states:{editMode:["showButtons"]},_currentItemIndex:0,_currentItemRef:"",_prevItemIndex:-1,_numItems:-1,_itemHolder:null,_currentDisplayer:null,_locked:!1,_lastCommand:"",_transitionUtils:null,_displayedImages:[],_imageMode:"",_widthDiff:0,_heightDiff:0,_galleryItems:[],_expandEnabled:!0,initialize:function(e,t,n){this.parent(e,t,n),this._Tween=this.injects().Utils.Tween,this._hideIndicatorElement=n&&n.hideIndicatorElement||!1},_onDataChange:function(e,t){this._numItems=this._data.get("items").length,this._imageMode=String(this.getComponentProperty("imageMode")),this._expandEnabled=this.getComponentProperty("expandEnabled")===!0,this._imageMode=="flexibleHeight"?this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT]:this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.BOTTOM,Constants.BaseComponent.ResizeSides.RIGHT],this._checkSkinPartsVisibility(),this.parent()},_checkSkinPartsVisibility:function(){this._skinParts&&(this._skinParts.buttonPrev.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.buttonNext.setStyle("visibility",this.getComponentProperty("showNavigation")?"visible":"hidden"),this._skinParts.counter.setStyle("visibility",this.getComponentProperty("showCounter")?"visible":"hidden"))},_processDataRefs:function(e){var t=[];if(e.length>0){t=[e[this._currentItemIndex]];var n;this._currentItemRef=e[this._currentItemIndex],e.length>1&&(n=this._normalizeIndex(this._currentItemIndex+1),t.push(e[n]),e.length>2&&(n=this._normalizeIndex(this._currentItemIndex-1),t.push(e[n])))}else this._itemHolder.empty();return t},_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");e==="unset"&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._view.setStyle("overflow","hidden"),this._itemHolder=new Element("div"),this._itemHolder.setStyles({position:"absolute",width:"100%",height:"100%"}),this._skinParts.itemsContainer.appendChild(this._itemHolder),this._skinParts.buttonPrev.addEvent(Constants.CoreEvents.MOUSE_DOWN,this.gotoPrev),this._skinParts.buttonNext.addEvent(Constants.CoreEvents.MOUSE_DOWN,this.gotoNext),this._transitionUtils=new this.imports.TransitionUtils,this._skinParts.virtualContainer||(this._skinParts.virtualContainer=new Element("div"),this._view.grab(this._skinParts.virtualContainer,"top"),this._skinParts.virtualContainer.setStyles({visibility:"hidden",display:"block",width:"1px",height:"1px",overflow:"hidden"})),this._widthDiff=this._skin.widthDiff||0,this._heightDiff=this._skin.heightDiff||0;var n={cursor:"pointer"},r=this.injects().Utils.getCSSBrowserFeature("user-select");r&&(n[r]="none"),this._skinParts.buttonPrev.setStyles(n),this._skinParts.buttonNext.setStyles(n),this._checkSkinPartsVisibility(),this._editModeChanged(this._editorMode)},_editModeChanged:function(e){if(this.injects().Viewer.isPublicMode()||this._hideIndicatorElement)return;this._createSlideShowIndicatorElement(),e==="PREVIEW"?this._hideEditModeSlideShowIndicator():this._showEditModeSlideShowIndicator()},_createSlideShowIndicatorElement:function(){if(!this._editorIndicatorElement){var e=this.injects().Theme.getProperty("WEB_THEME_DIRECTORY")+"ico_slide.png";this._editorIndicatorElement=new Element("div",{styles:{position:"absolute",top:"50%",width:"100%",marginTop:"-18px",textAlign:"center"}});var t=new Element("b",{styles:{display:"inline-block",borderRadius:"3px",background:"#222 url("+e+") no-repeat 8px 50%",opacity:"0.6",color:"#ffffff",padding:"0 14px 0 66px",whiteSpace:"nowrap",height:"38px",lineHeight:"39px",fontSize:"12px"}});t.set("text","Slide Show"),t.insertInto(this._editorIndicatorElement)}this._editorIndicatorElement.insertInto(this._view)},_hideEditModeSlideShowIndicator:function(){this.removeState("showButtons","editMode"),this._editorIndicatorElement.collapse()},_showEditModeSlideShowIndicator:function(){this.setState("showButtons","editMode"),this._editorIndicatorElement.uncollapse()},_onRepeaterItemReady:function(e,t,n,r){t.getViewNode().setStyles({position:"relative"})},_onRepeaterReady:function(e){this._galleryItems=e.readyItems},render:function(){var e;for(var t=0;t<this._galleryItems.length;t++)e=this._galleryItems[t].getLogic(),e.invalidateSize(),this._setupDisplayer(e),this._currentItemRef=="#"+e.getDataItem().get("id")?this._insertNewDisplayer(e):e.getViewNode().setStyles({visibility:"hidden",opacity:"1.0"});this._skinParts.counter.set("text",String(this._currentItemIndex+1)+"/"+String(this._numItems)),this._prevItemIndex=this._currentItemIndex},_setupDisplayer:function(e){e.setOwner(this),e.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode)},_insertNewDisplayer:function(e){var t=this._itemHolder,n=this._currentDisplayer,r=e.getViewNode(),i=parseFloat(this.getComponentProperty("transDuration"));this._currentDisplayer=e,n&&n!==e&&t.adopt(n.getViewNode()),t.adopt(e.getViewNode()),r.setStyles({position:"absolute",top:"0px",left:"0px",visibility:"visible"}),e.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode),this._imageMode=="flexibleHeight"&&this._adjustFlexibleHeight(this._currentDisplayer,i);var s=this._currentDisplayer.getImageRef();s&&this._displayedImages.indexOf(s)==-1&&this._displayedImages.push(s),t.children.length>1&&(e.setState("transIn"),n&&n.setState("transOut"),this._locked=!0,this._transitionUtils.getTransition(String(this.getComponentProperty("transition")))(t.children[0],t.children[1],this._getTransitionDirection(),i,function(){t.children.length>1&&(t.children[1].setStyle("position","static"),t.removeChild(t.children[0])),this._locked=!1,n&&n.setState("normal"),e.setState("noTransition"),this.fireEvent("transitionFinished")}.bind(this)))},_adjustFlexibleHeight:function(e,t){var n=e.getHeight()+this._heightDiff;this._Tween.to(this._view,t,{height:n,onUpdate:function(e){this.setHeight(parseInt(e)),this.fireEvent("autoSized")}.bind(this)})},_getTransitionDirection:function(){var e=this.getComponentProperty("bidirectional")===!0,t=this.getComponentProperty("reverse")===!0,n={next:0,prev:1},r=0;return e&&(r=n[this._lastCommand]||0,t&&(r=r==1?0:1)),r},_onResize:function(){var e;this.parent(),this._currentDisplayer&&(this._currentDisplayer.setSize(this.getWidth()-this._widthDiff,this.getHeight()-this._heightDiff,this._imageMode),this._imageMode=="flexibleHeight"?window.requestAnimFrame(function(){e=this._currentDisplayer.getHeight()+this._heightDiff,this._view.setStyle("height",String(e)+"px"),this.setHeight(e),this.fireEvent("autoSized")}.bind(this)):(e=this.getHeight(),this._view.setStyle("height",String(e)+"px"),this.setHeight(e)))},gotoPrev:function(){!this._locked&&this._galleryItems.length>0&&(this._lastCommand="prev",this._currentItemIndex=this._getPrevItemIndex(),this._allRepeatersReady=!1,this._renderIfReady()),this.fireEvent("displayerChanged")},gotoNext:function(){!this._locked&&this._galleryItems.length>0&&(this._lastCommand="next",this._currentItemIndex=this._getNextItemIndex(),this._allRepeatersReady=!1,this._renderIfReady()),this.fireEvent("displayerChanged")},onPageVisibilityChange:function(e){e?W.Utils.callLater(this._updateAutoplayState,[],this,1e3):this._timeoutID!=null&&(clearTimeout(this._timeoutID),this._timeoutID=null)},_getNextItemIndex:function(){return this._normalizeIndex(this._currentItemIndex+1)},_getPrevItemIndex:function(){return this._normalizeIndex(this._currentItemIndex-1)},_normalizeIndex:function(e){return(e%this._numItems+this._numItems)%this._numItems},getAcceptableDataTypes:function(){return["ImageList"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.SliderGallery",skinParts:{imageItem:{type:"wysiwyg.viewer.components.Displayer",repeater:!0,container:"itemsContainer",dataRefField:"items"},itemsContainer:{type:"htmlElement"},swipeLeftHitArea:{type:"htmlElement"},swipeRightHitArea:{type:"htmlElement"}},propertiesSchemaName:"SliderGalleryProperties",traits:["core.components.traits.SwipeSupport"],Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"GALLERY_ORGANIZE_PHOTOS",command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenListEditDialog",commandParameter:{galleryConfigID:"SliderGallery"},commandParameterDataRef:"SELF"}},Extends:"core.components.BaseRepeater",Binds:["gotoNext","gotoPrev","_updateMovementNoLoop","_updateMovementInLoop","_stopMovement"],_states:{},_itemHolder:null,_itemWidth:0,_itemHeight:0,_gap:20,_movementSpeed:0,_shiftOffset:0,_shiftOffsetMax:0,_shiftOffsetMin:0,_maxSpeed:.05,_aspectRatio:0,_movementActive:!1,_debugMode:!1,_imageMode:"",_lastUpdate:NaN,_updateMovementFunc:null,_loop:!1,_itemsHolderSize:0,_contentOverflow:!1,_segment:0,_isZoomed:!1,initialize:function(e,t,n){this.parent(e,t,n),this.addEvent("resizeEnd",this._onResizeEnd),this.injects().Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onChangeMode,null)},_onChangeMode:function(e){e!=="PREVIEW"&&this._stopMovement()},_onResizeEnd:function(){this._recalcItemSize(),this._allRepeatersReady=!1,this._renderIfReady()},_recalcItemSize:function(){this._skinParts&&(this._itemHeight=Math.floor(this._skinParts.itemsContainer.getHeight()),this._itemWidth=Math.floor(this._itemHeight*this._aspectRatio))},_processDataRefs:function(e){return this._loop===!0?e.concat(e):e},_onDataChange:function(e){this._enableMovement(!1),this._aspectRatio=this._parseAspectRatioPreset(this.getComponentProperty("aspectRatioPreset")),this._aspectRatio?this.setComponentProperty("aspectRatio",this._aspectRatio,!0):this._aspectRatio=parseFloat(this.getComponentProperty("aspectRatio")),this._loop=this.getComponentProperty("loop")===!0,this._maxSpeed=parseInt(this.getComponentProperty("maxSpeed")),this._imageMode=String(this.getComponentProperty("imageMode")),this._gap=parseInt(this.getComponentProperty("margin")),this.parent()},_parseAspectRatioPreset:function(e){var t=e.split(":"),n=0;return t.length==2&&(n=parseFloat(t[0])/parseFloat(t[1])),n},_onAllSkinPartsReady:function(){var e=this.getComponentProperty("galleryImageOnClickAction"),t=this.getComponentProperty("expandEnabled");e==="unset"&&(t===!1?this.setComponentProperty("galleryImageOnClickAction","disabled",!0):this.setComponentProperty("galleryImageOnClickAction","zoomMode",!0)),this._itemHolder=this._skinParts.itemsContainer,this._itemHolder.setStyles({position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px","white-space":"nowrap","-webkit-transform":"translateZ(0)"}),this._skinParts.itemsContainer.setStyles({overflow:this._debugMode?"visible":"hidden",border:this._debugMode?"1px solid black":"0"}),this.injects().Commands.registerCommandListenerByName("WViewerCommands.SetMediaZoomImage",this,this._onMediaZoomClicked,null),this.injects().Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed,null),this._skinParts.swipeLeftHitArea.addEvent(Constants.CoreEvents.MOUSE_MOVE,this.gotoPrev),this._skinParts.swipeRightHitArea.addEvent(Constants.CoreEvents.MOUSE_MOVE,this.gotoNext),this._skinParts.swipeLeftHitArea.addEvent(Constants.CoreEvents.MOUSE_OUT,this._stopMovement),this._skinParts.swipeRightHitArea.addEvent(Constants.CoreEvents.MOUSE_OUT,this._stopMovement)},_onMediaZoomClicked:function(){this._isZoomed=!0,this._stopMovement()},_onMediaZoomClosed:function(){this._isZoomed=!1},getAcceptableDataTypes:function(){return["ImageList"]},render:function(){var e;this._recalcItemSize(),this._updateMovementFunc=this._loop===!0?this._updateMovementInLoop:this._updateMovementNoLoop,this._loop===!1&&(this._segment=0),this._shiftOffset=0,this._itemsHolderSize=0;for(e=0;e<this._itemHolder.children.length;e++)this._setupDisplayer(this._itemHolder.children[e].getLogic(),e),this._itemsHolderSize+=this._itemHolder.children[e].getLogic().getWidth()+this._gap;this._checkItemsVisibility(),this._applyShiftOffset()},_checkItemsVisibility:function(){var e=this._itemHolder.children.length/2,t=this._loop===!0?this._itemsHolderSize/2:this._itemsHolderSize;this._contentOverflow=t>this._skinParts.itemsContainer.getWidth(),this._loop===!0&&this._contentOverflow===!1&&(this._segment=0);for(i=0;i<this._itemHolder.children.length;i++)this._loop===!0&&this._contentOverflow===!1&&i>=e?this._itemHolder.children[i].setStyle("opacity","0.0"):this._itemHolder.children[i].setStyle("opacity","1.0")},_setupDisplayer:function(e,t){e.invalidateSize(),e.setSize(this._itemWidth,this._itemHeight,this._imageMode),e.setOwner(this),e.getViewNode().setStyles({position:"static",display:"inline-block","vertical-align":"top","margin-right":String(this._gap)+"px","margin-left":"0px",opacity:"1.0"})},_moveToRight:function(){this._contentOverflow&&(this._setMovementSpeed(this._maxSpeed),this._enableMovement(!0))},_moveToLeft:function(){this._contentOverflow&&(this._setMovementSpeed(-this._maxSpeed),this._enableMovement(!0))},gotoNext:function(){if(this._isZoomed)return;this._contentOverflow&&(this._setMovementSpeed(this._maxSpeed),this._enableMovement(!0))},gotoPrev:function(){this._contentOverflow&&(this._setMovementSpeed(-this._maxSpeed),this._enableMovement(!0))},_enableMovement:function(e){e===!0&&this._movementActive===!1&&window.requestAnimFrame(this._updateMovementFunc),e===!0?this._movementActive||(this._shiftOffsetMin=this._skinParts.itemsContainer.getWidth()+this._gap-this._itemsHolderSize,this._offsetIsOnGapOnly()&&(this._shiftOffsetMin=0),this._movementActive=!0):(this._movementActive=!1,this._movementSpeed=0)},_stopMovement:function(){var e=this.injects().Utils.Tween;e.to(this,1,{_movementSpeed:0,onComplete:function(){this._enableMovement(!1)}.bind(this)})},_setMovementSpeed:function(e){var t=this.injects().Utils.Tween;t.to(this,1,{_movementSpeed:e})},_calcMovementCoeficient:function(){var e=1,t=(new Date).getTime();return isNaN(this._lastUpdate)||(e=(t-this._lastUpdate)/16),this._lastUpdate=t,e},_updateMovementNoLoop:function(){var e=this._calcMovementCoeficient();this._movementActive&&(this._shiftOffset+=-this._movementSpeed*e,this._shiftOffset>this._shiftOffsetMax&&(this._shiftOffset=this._shiftOffsetMax,this._enableMovement(!1)),this._shiftOffset<this._shiftOffsetMin&&(this._shiftOffset=this._shiftOffsetMin,this._enableMovement(!1)),this._applyShiftOffset()),this._movementActive&&window.requestAnimFrame(this._updateMovementFunc)},_updateMovementInLoop:function(){var e=this._calcMovementCoeficient();this._movementActive&&(this._shiftOffset+=-this._movementSpeed*e,this._movementSpeed<0&&(this._segment=0,this._shiftOffset>this._shiftOffsetMax&&(this._shiftOffset-=this._itemsHolderSize/2)),this._movementSpeed>0&&(this._segment=1,this._shiftOffset<0&&(this._shiftOffset+=this._itemsHolderSize/2)),this._applyShiftOffset()),this._movementActive&&window.requestAnimFrame(this._updateMovementFunc)},_applyShiftOffset:function(){var e=this._shiftOffset-this._segment*this._itemsHolderSize/2;this._itemHolder.children.length>0&&this._itemHolder.children[0].setStyle("margin-left",String(Math.floor(e))+"px")},_offsetIsOnGapOnly:function(){return Math.abs(this._shiftOffsetMin)<this._gap&&this._shiftOffsetMin>0}}}),define.oldComponent({name:"wysiwyg.viewer.components.SocialBaseComponent",skinParts:{iFrameHolder:{type:"htmlElement"}},Class:{Extends:"wysiwyg.viewer.components.IFrameComponent",Binds:["_createClickOverlay","_getUrl"],initialize:function(e,t,n){this.parent(e,t),this._resizableSides=[];if(n&&n.propObj)for(var r in n.propObj){var i=n.propObj[r];this.setComponentProperty(r,i)}this._iframeCallback=0},_onResize:function(){this._initialized&&this._renderIframe()},render:function(){this._createClickOverlay(),this._renderComponent(),this._initialized=!0},_renderComponent:function(){this._renderIframe(!1);if(this._getSizeAccordingToProperties){var e=this._getSizeAccordingToProperties();this._changeSize(e)}},_getSizeAccordingToProperties:function(){return{w:225,h:55}},_getUrl:function(){var e=this.injects().Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/",t=this._getUrlParams();return e+this._getPageName()+"?"+Object.toQueryString(t)},_getPageName:function(){},_getUrlParams:function(){return{}}}}),define.component("wysiwyg.viewer.components.SoundCloudWidget",function(e){var t=e;t.inherits("wysiwyg.viewer.components.IFrameComponent"),t.binds(["_stopPlayback","_getSoundCloudUrl"]),t.states(["hasContent","noContent"]),t.dataTypes(["SoundCloudWidget"]),t.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],EDITOR_META_DATA:{general:{settings:!0,design:!1}}}),t.methods({initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this._urlExists=!1,this._view.addEvent(Constants.DisplayEvents.COLLAPSED,this._stopPlayback),this.setMinW(250)},_stopPlayback:function(){this._iframe.set("src","about:blank")},_updateIFrameSize:function(){var e;e=this._iframe,e&&e.set({width:this._view.getWidth()-1,height:this._view.getHeight()-1})},_getUrl:function(){var e=this._getSoundCloudUrl();if(e!=undefined&&e!=""){var t=this.injects().Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/soundcloud.html";e=t+"?src="+encodeURIComponent(e)}return e},_getSoundCloudUrl:function(){var e=this._data.get("url");this._urlExists=!1;if(e!=undefined&&e!=""){e.split("?").length==3&&(e=e.substring(0,e.lastIndexOf("?"))),e=this.injects().Utils.setUrlParam(e,"show_artwork",this._isDataTrue("showArtWork"));var t=this._isDataTrue("autoPlay");this.injects().Viewer.getPreviewMode()&&this._editorMode!="PREVIEW"&&(t=!1),e=this.injects().Utils.setUrlParam(e,"auto_play",t),this._urlExists=!0}return e||""},_isDataTrue:function(e){var t=!1;if(this._data.get(e)===!0||this._data.get(e)==="true")t=!0;return t},_setIframeParams:function(){this._iframe["class"]="html5player",this._iframe.setStyles({position:"absolute"}),this._urlExists===!1?this.setState("noContent"):this.setState("hasContent"),this._updateIFrameSize()},_editModeChanged:function(e,t){(e=="PREVIEW"||t=="PREVIEW")&&this._updateIframe(!0)},setHeight:function(e,t,n){e=Math.max(e,50),this._view.setStyle("height",parseInt(e)+"px"),this.parent(e,t,n)},setWidth:function(e,t,n){e=Math.max(e,200),this._view.setStyle("width",parseInt(e)+"px"),this.parent(e,t,n)}})}),define.component("wysiwyg.viewer.components.TableComponent",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.utilize(["wysiwyg.viewer.utils.ComponentSequencer"]),t.skinParts({tableBody:{type:"htmlElement"},tableHeader:{type:"htmlElement",optional:!0},tableFooter:{type:"htmlElement",optional:!0},table:{type:"htmlElement",optional:!0}}),t.propertiesSchemaType("TableComponentProperties"),t.binds(["_createBodyRow","_createHeaderCell","_createFooterCell","_createBodyCell","_addSpacerRow"]),t.dataTypes(["list","Table"]),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this._rowsSequencer=new this.imports.ComponentSequencer,this._rowsSequencer.resolveItem=this._createBodyRow,this._rowsSequencer.addEvent("productionFinished",this._addSpacerRow),this._bodyCellSequencingHook=n.SequencingHook,this._headerFooterCellSequencingHook=n.HeaderFooterSequencingHook||n.SequencingHook},_onAllSkinPartsReady:function(e){this.parent(e);var t=this.getComponentProperty("minHeight");t&&this.setMinH(t),this.getDataItem()&&this._populateTable()},_onComponentPropertyChange:function(e,t){e==="minHeight"&&this.setMinH(t)},setMinH:function(e){this._skinParts&&this._skinParts.table.setStyle("height",e+"px"),this.parent(e),this.setHeight(e)},_onDataChange:function(e,t,n){this._skinParts&&(t=="minHeight"?this.setMinH(n.minHeight||n):(this._populateTable(),this.fireEvent("autoSized",{ignoreLayout:!1}))),this.parent(e,t,n)},_populateTable:function(){var e=this.getDataItem();this._rowsSequencer.createComponents(this._skinParts.tableBody,e.get("items"));if(e.hasField("header")){var t=this._createRow(e.get("header"),this._createHeaderCell);this._skinParts.tableHeader.empty().adopt(t)}else this._skinParts.tableHeader.removeFromDOM();if(e.hasField("footer")){var n=this._createRow(e.get("footer"),this._createFooterCell);this._skinParts.tableFooter.empty().adopt(n)}else this._skinParts.tableFooter.removeFromDOM()},_createBodyRow:function(e){return this._createRow(e,this._createBodyCell)},_createRow:function(e,t){var n=new Element("tr"),r=new this.imports.ComponentSequencer;return r.resolveItem=t,r.createComponents(n,e),n},_createHeaderCell:function(e,t,n){return this._createCell(e,t,n,"th",this._headerFooterCellSequencingHook)},_createFooterCell:function(e,t,n){return this._createCell(e,t,n,"td",this._headerFooterCellSequencingHook)},_createBodyCell:function(e,t,n){return this._createCell(e,t,n,"td",this._bodyCellSequencingHook)},_createCell:function(e,t,n,r,i){var s=new Element(r),o=i(e,t,n);o&&s.grab(o);var u=e.styleData;if(u)for(var a in u)s.setStyle(a,u[a]);return s},_addSpacerRow:function(){var e=new Element("tr",{"class":"spacer"}),t=new Element("td",{colspan:"100%"});e.adopt(t),this._skinParts.tableBody.adopt(e),this.fireEvent("autoSized",{ignoreLayout:!1})}})}),define.oldComponent({name:"wysiwyg.viewer.components.TwitterFeed",propertiesSchemaName:"TwitterFeedProperties",Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_applyThemeColors","_onResizeEnd"],MIN_SIZE:220,EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"FPP_DESIGN_LABEL",command:"WEditorCommands.AdvancedDesign"}]},initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this.iframeCreated=!1,this.addEvent("resizeEnd",this._onResizeEnd),this._minimumTimeBetweenRenders=2e3},render:function(){this._renderFeed()},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._applyThemeColors)},_applyThemeColors:function(e){var t=["bg","txt1","bg2","txt2","linkColor"];for(var n in e.properties)if(t.indexOf(n)>-1){this._renderFeed();return}},_renderFeedAndDontReload:function(){this._renderFeed(!0)},_renderFeed:function(e){if(!this.isReady())return;this.iframeCreated?this._postMessageToIframe(e):(this._createIframe(),this.iframeCreated=!0)},_createIframe:function(e){var t=new IFrame({src:this.injects().Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/twfeed.html",width:"100%",height:"100%",webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameBorder:"0",scrolling:"no",events:{load:function(){this._iframeCreated=!0,this._postMessageToIframe(e)}.bind(this)}});this._iframe=t,this._view.empty(),this._view.grab(t)},_postMessageToIframe:function(e){var t=this.injects().Skins,n=this._skin.className,r={userName:this._data.get("accountToFollow")||"wix",height:this._view.getHeight()-90,width:this._view.getWidth(),numOfTweets:this.getComponentProperty("numOfTweets")||1,shellBGColor:t.getSkinParamValue(n,"bg",this._style).getHex(!1),shellColor:t.getSkinParamValue(n,"txt1",this._style).getHex(!1),tweetBGColor:t.getSkinParamValue(n,"bg2",this._style).getHex(!1),tweetColor:t.getSkinParamValue(n,"txt2",this._style).getHex(!1),tweetLinkColor:t.getSkinParamValue(n,"linkColor",this._style).getHex(!1),start:!e};this._iframe.contentWindow.postMessage(JSON.stringify(r),"*")},setHeight:function(e){e=Math.max(220,e),this._view.setStyle("height",parseInt(e)+"px"),this.parent(e,!0,!0)},setWidth:function(e){e=Math.max(220,e),this._view.setStyle("width",parseInt(e)+"px"),this.parent(e,!0,!0)},_onResize:function(){this.parent(),this._renderFeedAndDontReload()},_onResizeEnd:function(){this._renderFeed()},getAcceptableDataTypes:function(){return["TwitterFollow"]}}}),define.component("wysiwyg.viewer.components.VerticalLine",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({}),t.binds(["render"]),t.fields({_renderTriggers:[Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0}}}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.injects().Theme.setProperty("WEB_THEME_DIRECTORY","viewer"),this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.BOTTOM]},render:function(){this.setWidth(this.getViewNode().getSize().x)},setHeight:function(e,t,n){var r=this._getNumberOfKnobs();this.height=e,this.parent(e,t,n)},_getNumberOfKnobs:function(){var e=0;return this._skinParts&&(this._skinParts.bottomKnob&&e++,this._skinParts.topKnob&&e++,this._skinParts.middleKnob&&e++),e}})}),define.component("wysiwyg.viewer.components.VerticalMenu",function(e){var t=e;t.inherits("core.components.BaseRepeater"),t.utilize(["core.components.BaseList","core.components.SimpleButton"]),t.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,dataRefField:"pages",container:"itemsContainer",hookMethod:"_changePagesRefData",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"}}),t.binds(["_onMoreButtonClick","_onThemeChange","_arrangeButtons","_onButtonClick","_onMoreButtonOver","_onMoreButtonOut","_onMoreContainerOver","_onMoreContainerOut","_closeMoreMenu","_onPageChanged"]),t.dataTypes(["Document"]),t.propertiesSchemaType("HorizontalMenuProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE]}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionEnded",this._onPageChanged),this._usesExternalData=!0},_onPageChanged:function(e){var t,n;if(this._allButtons)for(t=0;t<this._allButtons.length;t++)n=this._allButtons[t],n.getID()==e?n.setState("selected"):n.removeState("selected")},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._allButtons=[]},_onRepeaterItemReady:function(e,t,n,r){r&&t.addEvent("click",function(){this._onButtonClick(n)}.bind(this)),this._allButtons.push(t),this.parent(e,t,n,r)},_onRepeaterReady:function(e){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._addPartsListeners(),this._arrangeButtons()},_addPartsListeners:function(){this._skinParts.moreButton.addEvent("over",this._onMoreButtonOver),this._skinParts.moreButton.addEvent("out",this._onMoreButtonOut),this._skinParts.moreButton.addEvent("click",this._onMoreButtonClick),this._skinParts.moreContainer.addEvent("mouseover",this._onMoreContainerOver),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut),this._skinParts.moreContainer.addEvent("mouseout",this._onMoreContainerOut);for(var e=0;e<this._allButtons.length;e++)this._allButtons[e].getViewNode().uncollapse(),this._allButtons[e].addEvent("dataChanged",this._arrangeButtons)},render:function(){this.parent(),this._changeTriggeredBy=="styleChange"?this._arrangeButtonsDelayed():this._arrangeButtons(),this._changeTriggeredBy=""},_onDataChange:function(e){this.getComponentProperties().removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent(e)},_skinParamsChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_arrangeButtonsDelayed:function(){this._arrangeWaitID!=-1&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtons,[],50)},_arrangeButtons:function(){if(this._skinParts==undefined||!this._allButtons||this._allButtons.length==0||!this._isDisplayed||!this.isReady())return;this._skinParts.moreButton.getViewNode().collapse(),this._skinParts.moreContainer.collapse(),this._skinParts.itemsContainer.setStyle("width","0px"),this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignText")),this._arrangeWaitID=-1;var e=this._getWidestLabelWidth();this.setMinW(e);var t=Math.max(e,this.getWidth()),n=Math.max(this._allButtons[0]._skinParts.label.offsetHeight,Math.floor(this.getHeight()/this._allButtons.length));for(var r=0;r<this._allButtons.length;r++){var i=this._allButtons[r];i.setWidth(t,!0),i.setHeight(n,!0),i._skinParts.label.setStyle("line-height",n+"px")}this._wCheckForSizeChangeAndFireAutoSized(0)},_getWidestLabelWidth:function(){var e=0;for(var t=0;t<this._allButtons.length;t++){var n=this._allButtons[t],r=parseInt(n._skinParts.label.offsetWidth),i=parseInt(n._view.getStyle("padding-left")),s=parseInt(n._view.getStyle("padding-right"));e=Math.max(e,r+n.getExtraPixels(!0).width)}return e},_setMinimumWidthAccordingToText:function(){this.setMinW(labelWidth+viewNodePaddingLeft+viewNodePaddingRight)},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(e){this.injects().Viewer.goToPage(e.get("id"))},_openMoreMenu:function(){this._skinParts.moreContainer.setStyle("display","block"),!this._isMoreContainerOpen,this._isMoreContainerOpen=!0,this._toCloseMoreMenu=!1},_closeMoreMenuTimer:function(){this._toCloseMoreMenu||(this._toCloseMoreMenu=!0,this.injects().Utils.callLater(this._closeMoreMenu,[],this,500))},_closeMoreMenu:function(e){if(e||this._toCloseMoreMenu)this._skinParts.moreContainer.setStyle("display","none"),this._toCloseMoreMenu=!1,this._isMoreContainerOpen=!1},_forceCloseMoreMenu:function(){this._closeMoreMenu(!0)},_onMoreButtonOver:function(){this._openMoreMenu()},_onMoreButtonOut:function(){this._closeMoreMenuTimer()},_onMoreContainerOver:function(){this._openMoreMenu()},_onMoreButtonClick:function(){this._isMoreContainerOpen===!1?this._openMoreMenu():this._forceCloseMoreMenu()},_onMoreContainerOut:function(){this._closeMoreMenuTimer()}})}),define.oldComponent({name:"wysiwyg.viewer.components.VerticalRepeater",skinParts:{inlineContent:{type:"htmlElement"}},imports:["wysiwyg.viewer.utils.ComponentSequencer"],Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_sequencingHook"],initialize:function(e,t,n){this.parent(e,t,n),this._sequencer=new this.imports.ComponentSequencer,n&&n.sequencingHook?this._sequencer.resolveItem=this._sequencingHookWrapper(n.sequencingHook):this._sequencer.resolveItem=this._sequencingHookWrapper(this._sequencingHook)},_sequencingHookWrapper:function(e){return function(t,n,r){return e(t,n,r)}},getSequencer:function(){return this._sequencer},_sequencingHook:function(){return{comp:"wysiwyg.viewer.components.Displayer",skin:this._skin.compParts.imageItem.skin}},setSequencingHook:function(e){this._sequencer.resolveItem=this._sequencingHookWrapper(e)},_onAllSkinPartsReady:function(){this._sequencer.addEvent("productionFinished",function(e){this._markChildren(e.elements)}.bind(this))},render:function(){if(!this._data)return;this._newItems=[],this._sequencer.createComponents(this._skinParts.inlineContent,this._data.get("items"))},getAcceptableDataTypes:function(){return["","ImageList"]},_markChildren:function(e){e.each(function(e,t,n){e.set("isfirst",t==0?"true":"false"),e.set("iseven",t%2==1?"true":"false"),e.set("islast",t==n.length-1?"true":"false")})}}}),define.component("wysiwyg.viewer.components.Video",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({videoFrame:{type:"htmlElement"},preview:{type:"htmlElement"}}),t.binds(["_stopVideo","_getYouTubeParams","_getVimeoParams","_onResize","_onResizeEnd","_getYouTubePreview","_getViemoPreviewUrl"]),t.states([]),t.dataTypes(["Video"]),t.propertiesSchemaType("VideoProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],EDITOR_META_DATA:{general:{settings:!0,design:!0}},_defaultPlayerParams:{wmode:"transparent"},_options:{videoType:"",videoId:"",resize:[]}}),t.methods({_getServices:function(){return{YOUTUBE:{url:"http://www.youtube.com/embed/",preview:this._getYouTubePreview,getParams:this._getYouTubeParams,hMinSize:200,wMinSize:200},VIMEO:{url:"http://player.vimeo.com/video/",preview:this._getViemoPreviewUrl,getParams:this._getVimeoParams,hMinSize:100,wMinSize:100}}},initialize:function(e,t,n){n=n||{},this.parent(e,t,n),this._iframe=null,this._inPublicMode=this.injects().Viewer.isPublicMode(),this.addEvent("resizeEnd",this._onResizeEnd),this._view.addEvent(Constants.DisplayEvents.COLLAPSED,this._stopVideo)},_stopVideo:function(){this._iframe.set("src","about:blank")},render:function(){this._renderIframe(),this.setMinW(this._getWMinSize()),this.setMinH(this._getHMinSize())},_onResize:function(){this.parent()},_onResizeEnd:function(){this._renderIframe()},_editModeChanged:function(e,t){if(this.injects().Viewer.isPublicMode())return;var n="PREVIEW";this._inPublicMode=e==n,(t==n||e==n)&&this._renderIframe()},setHeight:function(e,t,n){e=Math.max(e,this._getHMinSize()),this._view.setStyle("height",parseInt(e,10)+"px"),this.parent(e,!0,n)},setWidth:function(e,t,n){e=Math.max(e,this._getWMinSize()),this._view.setStyle("width",parseInt(e,10)+"px"),this.parent(e,t,n)},_getHMinSize:function(){var e=this._getVideoType(),t=this._getServices()[e].hMinSize,n=this.getComponentProperty("showControls");return e=="YOUTUBE"&&n=="always_show"&&(t+=20),t},_getWMinSize:function(){var e=this._getVideoType();return this._getServices()[e].hMinSize},_renderIframe:function(){this._options.videoType=this._getVideoType(),this._options.videoId=this._getVideoId();if(!this._options.videoId||!this._options.videoType)return;if(!this._inPublicMode)if(Browser.ie||Browser.firefox&&Browser.Platform.mac){this._createPreview();return}this._skinParts.videoFrame.uncollapse(),this._skinParts.preview.collapse(),!this._iframe||!this._skinParts.videoFrame.hasChildNodes()?this._createIframe(this._getUrl(),this.getWidth(),this.getHeight()):this._updateIframe(this._getUrl(),this.getWidth(),this.getHeight()),this._iframe.setStyles({height:"100%",width:"100%"})},_getContainerIframe:function(){return this.injects().Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/video.html"},_createIframe:function(e,t,n){var r=this._getContainerIframe()+"?url="+encodeURIComponent(e)+"&width="+t+"&height="+n;this._iframe=new IFrame({src:r,webkitAllowFullScreen:"true",mozallowfullscreen:"true",allowfullscreen:"allowfullscreen",frameborder:"0"}),this._iframe.insertInto(this._skinParts.videoFrame)},_updateIframe:function(e,t,n){var r=this._getContainerIframe()+"?url="+encodeURIComponent(e);this._iframe.set({src:r})},_getPlayerParamsAsQueryString:function(){var e=this._getServices()[this._options.videoType].getParams(),t=[];return Object.forEach(e,function(e,n){t.push(n+"="+e)}),t.join("&")},_getYouTubeParams:function(){var e={},t=this.getComponentProperty("showControls"),n=this.injects().Config.isFacebookSite(),r=this.getComponentProperty("autoplay")&&!n,i=this.getComponentProperty("lightTheme"),s=this.getComponentProperty("loop"),o=this.getComponentProperty("showinfo");e.wmode="transparent",this._inPublicMode&&(e.autoplay=r&&this.getIsDisplayed()?"1":"0"),i?e.theme="light":e.theme="dark";switch(t){case"always_show":e.controls="1",e.autohide="0";break;case"always_hide":e.controls="0";break;case"temp_show":e.autohide="1";break;default:}return s?(e.loop="1",e.playlist=this._options.videoId):e.loop="0",e.showinfo=o?"1":"0",e.rel="0",e},_getVimeoParams:function(){var e={};return this._inPublicMode&&(e.autoplay=this.getIsDisplayed()?this.getComponentProperty("autoplay"):0),e.loop=this.getComponentProperty("loop"),e.byline=this.getComponentProperty("showinfo"),e.portrait=this.getComponentProperty("showinfo"),e.title=this.getComponentProperty("showinfo"),e},_getUrl:function(){return this._getServices()[this._options.videoType].url+this._options.videoId+"?"+this._getPlayerParamsAsQueryString()},_getVideoType:function(){return this._data&&this._data.get("videoType")},_getVideoId:function(){return this._data&&this._data.get("videoId")},_createPreview:function(){var e=this._getServices(),t=this._options.videoType,n=e[t].preview;n()},_renderPreviewImage:function(e){var t=this._view.getWidth(),n=this._view.getHeight();this._image?this._updatePreviewImage(e,n,t):this._createPreviewImage(e,n,t)},_createPreviewImage:function(e,t,n){this._image=new Image,this._image.src=e,this._image.setStyles({height:t,width:n}),this._image.insertInto(this._skinParts.preview),this._options.resize.push(this._image),this._skinParts.videoFrame.collapse(),this._skinParts.preview.uncollapse()},_updatePreviewImage:function(e,t,n){this._image.get("src")!=e&&this._image.set("src",e),this._image.setStyles({height:t,width:n}),this._skinParts.videoFrame.collapse(),this._skinParts.preview.uncollapse()},_getYouTubePreview:function(){var e="http://img.youtube.com/vi/[repLace]/0.jpg",t=e.replace("[repLace]",this._options.videoId);this._renderPreviewImage(t)},_getViemoPreviewUrl:function(){var e="http://vimeo.com/api/v2/video/[repLace].json",t=e.replace("[repLace]",this._options.videoId),n=new Request.JSONP({url:t+"?"+"r="+Math.random(),onComplete:this.onVimeoRetrun.bind(this)});n.send()},onVimeoRetrun:function(e){var t=e&&e[0]&&e[0].thumbnail_large;this._renderPreviewImage(t)}})}),define.oldComponent({name:"wysiwyg.viewer.components.WFacebookComment",propertiesSchemaName:"WFacebookCommentProperties",skinParts:{facebook:{type:"htmlElement"}},Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1}},Extends:"mobile.core.components.base.BaseComponent",Binds:["_onResizeEnd","_onFacebookComponentRender","_checkIframeSize","_renderComponentOnViewer","_rebuildFacebookComponent"],_states:{EDITOR:["light","dark"],VIEWER:["scriptLoading","scriptLoaded","loading","idle"]},initialize:function(e,t){this.parent(e,t),this.addEvent("resizeEnd",this._onResizeEnd),this._resizableSides=[Constants.BaseComponent.ResizeSides.RIGHT,Constants.BaseComponent.ResizeSides.LEFT],W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this._iframeOldHeight=0},render:function(){this._createClickOverlay(),this._renderComponent()},_editModeChanged:function(e,t){(e=="PREVIEW"||t=="PREVIEW")&&this._renderComponent()},_onResizeEnd:function(){this._skinParts&&(this.setComponentProperty("width",this.getWidth()),this._renderComponent())},_renderComponent:function(){this.injects().Viewer.isPublicMode()||!Browser.ie?this._renderComponentOnViewer():this._renderComponentOnEditor()},_renderComponentOnEditor:function(){var e=this.getComponentProperty("colorScheme");this.setState(e,"editor")},_renderComponentOnViewer:function(){var e=this.getState("viewer");if(!e)return this.setState("scriptLoading","viewer"),this._loadScript(function(){this.setState("scriptLoaded","viewer")}.bind(this)),this.callRenderLater(),!1;if(e=="loading"||e=="scriptLoading")return this.callRenderLater(),!1;this.setState("loading","viewer"),this._rebuildFacebookComponent()},_rebuildFacebookComponent:function(){var e=this._getFacebookHref();this._skinParts.facebook.empty();var t={"class":"fb-comments","data-href":e,"data-num-posts":this.getComponentProperty("numPosts"),"data-width":this.getComponentProperty("width"),"data-colorscheme":this.getComponentProperty("colorScheme")};this._fbCommentElement=new Element("DIV",t),this._fbCommentElement.insertInto(this._skinParts.facebook),window.FB&&FB.XFBML&&FB.XFBML.parse&&FB.XFBML.parse(this._skinParts.facebook),this.setState("idle","viewer")},_getFacebookHref:function(){var e=location.href;if(W.Viewer.isHomePage()){var t=this.injects(),n=t.Viewer.getCurrentPageId(),r=t.Viewer.getPagesData()[n],i=t.TPA.getPageState(n),s=t.Utils.hash.getHashPartsString(n,r.get("pageUriSEO"),i);t.Utils.strEndsWith(e,"#!"+s)||(t.Utils.strEndsWith(e,"/#")?e+="!"+s:t.Utils.strEndsWith(e,"/")?e+="#!"+s:e+="/#!"+s)}return e},_onFacebookComponentRender:function(){if(!this.isReady())return;var e=this._skinParts.facebook.getSize(),t=e.y;this.setHeight(t),this._wCheckForSizeChangeAndFireAutoSized(1)},dispose:function(){this._iframeAuditor&&clearInterval(this._iframeAuditor),window.FB&&(FB.Event.unsubscribe("xfbml.render",this._onFacebookComponentRender),FB.Event.subscribe("comment.create",this._onFacebookComponentRender),FB.Event.subscribe("comment.remove",this._onFacebookComponentRender)),this.parent()},setWidth:function(e,t,n){var r=400;e>=r?this.parent(e,t,n):this.parent(r,t,n)},_checkIframeSize:function(){if(!this.isReady())return;var e=this._skinParts.facebook.getElement("iframe");if(e){var t=e.getSize().y;this._iframeOldHeight!=t&&(this._iframeOldHeight=t,this._onFacebookComponentRender())}},_loadScript:function(e){var t="236335823061286";this.injects().Viewer.loadExternalScript("//connect.facebook.net/en_US/all.js",function(){FB.Event.subscribe("xfbml.render",this._onFacebookComponentRender),FB.Event.subscribe("comment.create",this._onFacebookComponentRender),FB.Event.subscribe("comment.remove",this._onFacebookComponentRender),this._iframeAuditor=setInterval(function(){this._checkIframeSize()}.bind(this),500),FB.init({appId:t,xfbml:1}),e()}.bind(this))}}}),define.oldComponent({name:"wysiwyg.viewer.components.WFacebookLike",skinParts:{facebook:{type:"htmlElement"}},propertiesSchemaName:"WFacebookLikeProperties",Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1}},Extends:"wysiwyg.viewer.components.SocialBaseComponent",initialize:function(e,t,n){W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this.parent(e,t,n)},render:function(){this._layout=this.getComponentProperty("layout"),this._showFaces=this.getComponentProperty("show_faces"),this._action=this.getComponentProperty("action"),this._colorScheme=this.getComponentProperty("colorScheme"),this._send=this.getComponentProperty("send"),this.parent()},_getPageName:function(){return"fblike.html"},_getUrlParams:function(){return{href:this._getLikeUrl(),layout:this._layout,show_faces:this._showFaces,action:this._action,colorscheme:this._colorScheme,send:this._send,width:this._getSizeAccordingToProperties().x}},_getLikeUrl:function(){if(this.injects().Viewer.isPublicMode()){var e=window.publicModel.externalBaseUrl||location.protocol+"//"+location.host+location.pathname;return this.injects().Viewer.isHomePage()?e:e+location.hash}return"http://www.wix.com/create/website"},_getSizeAccordingToProperties:function(){var e,t;return this._layout=="standard"?(e=250,this._action=="recommend"&&(e+=40),this._showFaces?t=85:t=40):this._layout=="button_count"?(e=90,t=20,this._action=="recommend"&&(e+=40)):this._layout=="box_count"&&(e=55,this._action=="recommend"&&(e+=40),t=65),{w:e,h:t}}}}),define.oldComponent({name:"wysiwyg.viewer.components.WGooglePlusOne",propertiesSchemaName:"WGooglePlusOneProperties",Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1}},Extends:"mobile.core.components.base.BaseComponent",Binds:["_renderComponentOnViewer","_renderComponentOnEditor","_rebuildComponent","_getSizeAccordingToState","_setComponentSize"],_states:{LAYOUT:["small_bubble","small_none","small_inline","medium_bubble","medium_none","medium_inline","standard_bubble","standard_none","standard_inline","tall_bubble","tall_none","tall_inline"],VIEWER:["scriptLoading","scriptLoaded","loading","idle"]},initialize:function(e,t,n){this.parent(e,t,n),W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this._resizableSides=[],this._props=n},render:function(){this._createClickOverlay(),this._size=this.getComponentProperty("size"),this._annotation=this.getComponentProperty("annotation"),this._renderComponent()},_renderComponent:function(){this.setState(this._size+"_"+this._annotation,"LAYOUT"),this.injects().Viewer.isPublicMode()||!Browser.ie?this._renderComponentOnViewer():this._renderComponentOnEditor()},_renderComponentOnEditor:function(){this._setComponentSize()},_renderComponentOnViewer:function(){this._view.setStyles({background:"none"});var e=this.getState("viewer");if(!e||e=="")return this.setState("scriptLoading","viewer"),this._loadScript(function(){this.setState("scriptLoaded","VIEWER")}.bind(this)),this.callRenderLater(),!1;if(e=="loading"||e=="scriptLoading")return this.callRenderLater(),!1;this.setState("loading","VIEWER"),this._rebuildComponent(function(){this.setState("idle","VIEWER")}.bind(this))},_rebuildComponent:function(e){this._skinParts.googlePlus.empty();var t={"class":"googlePlusOne",href:location.href};this._props?t={size:this._props.size||this._size,annotation:this._props.annotation||this._annotation,width:this._props.width||this._view.getWidth()}:t={size:this._size,annotation:this._annotation,width:this._view.getWidth()},this._googlePlusOneElement=new Element("g\\:plusone",t),this._skinParts.googlePlus.adopt(this._googlePlusOneElement),window.gapi&&gapi.plusone&&gapi.plusone.go&&gapi.plusone.go(this._skinParts.googlePlus),this.callLater(this._setComponentSize,null,100),e()},_setComponentSize:function(){var e=this._props&&this._props.width?this._props.width:this._getSizeAccordingToState();this.setHeight(e.h),this.setWidth(e.w),this._wCheckForSizeChangeAndFireAutoSized(5)},_loadScript:function(e){this.injects().Viewer.loadExternalScript("https://apis.google.com/js/plusone.js",function(){e()}.bind(this))},_getSizeAccordingToState:function(){switch(this.getState("LAYOUT")){case"small_bubble":return{w:70,h:15};case"small_none":return{w:24,h:15};case"small_inline":return{w:250,h:15};case"medium_bubble":return{w:90,h:20};case"medium_none":return{w:32,h:20};case"medium_inline":return{w:250,h:20};case"standard_bubble":return{w:106,h:24};case"standard_none":return{w:38,h:24};case"standard_inline":return{w:250,h:24};case"tall_bubble":return{w:50,h:60};case"tall_none":return{w:50,h:20};case"tall_inline":return{w:250,h:20}}}}}),define.component("wysiwyg.viewer.components.WPhoto",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.traits(["wysiwyg.common.components.traits.LinkableComponent"]),t.utilize(["core.components.image.ImageSettings","core.components.image.ImageDimensionsNew"]),t.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*",hookMethod:"_setImageArgs"}}),t.dataTypes(["Image"]),t.propertiesSchemaType("WPhotoProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenImageDialog",commandParameter:{galleryTypeID:"photos"}}}}),t.statics({MIN_IMAGE_HEIGHT:1,MIN_IMAGE_WIDTH:1,_autoSizeStates:{none:1,autoSizeNoLayoutUpdate:2,autoSizeUpdateLayout:3}}),t.methods({initialize:function(e,t,n){this._imageDimensions=new this.imports.ImageDimensionsNew,this._SettingsClass=this.imports.ImageSettings,this.parent(e,t,n),n&&n.props&&this.setComponentProperties(n.props),this._contentPadding={x:0,y:0},this._autoSizeState=this._autoSizeStates.none,this._initialDataChange=!0},_setImageArgs:function(e){return e.argObject={requestExactSize:this.injects().Viewer.getPreviewMode()!==!0},e},_onAllSkinPartsReady:function(e){this.parent(e),this._data&&this._setTitle()},_preventRenderOnDataChange:function(e,t,n){return!t||t=="displayMode"||t=="href"?!1:!0},_onDataChange:function(e,t,n){this._skinParts&&t=="title"&&this._setTitle();if(t=="displayMode"){var r=this._translateDisplayModeToImageCropMode(n.displayMode);this._getImageSettings().setCropMode(r)}!this._initialDataChange&&this._isFitMode()&&(t=="displayMode"||!t)&&(this._autoSizeState=this._autoSizeStates.autoSizeUpdateLayout),this._initialDataChange=!1,this.parent(e,t,n)},setWidth:function(e,t,n,r){if(!e||isNaN(e))return;if(!r&&this._getDisplayMode()=="fitHeightStrict")return;this._getImageSettings().setContainerWidth(e-this._getContentPaddingSize().x),this.parent(e,t,n),r||(this._getImageDisplayMode()==this._SettingsClass.CropModes.FIT_HEIGHT&&this._isDisplayed&&(this._getImageSettings().setCropMode(this._SettingsClass.CropModes.FIT_WIDTH),this._autoSizeState=this._autoSizeStates.autoSizeNoLayoutUpdate),this._renderImage())},setHeight:function(e,t,n,r){if(!e||isNaN(e))return;if(!r&&this._getDisplayMode()=="fitWidthStrict")return;this.parent(e,t,n),this._getImageSettings().setContainerHeight(e-this._getContentPaddingSize().y),r||(this._getImageDisplayMode()==this._SettingsClass.CropModes.FIT_WIDTH&&this._isDisplayed&&(this._getImageSettings().setCropMode(this._SettingsClass.CropModes.FIT_HEIGHT),this._autoSizeState=this._autoSizeStates.autoSizeNoLayoutUpdate),this._renderImage())},getMinPhysicalHeight:function(){return this._getContentPaddingSize().y},render:function(){this._styleChanged(),this._renderImage(),this.parent()},_renderImage:function(){if(!this._layoutInitialized)return;var e=this._skinParts.img;if(!e||!e.getOriginalClassName)return;var t=this._getImageSettings();e.setSettings(t),t.getCropMode()==t.CropModes.FIT_WIDTH?this.setHeight(e.getSize().y+this._getContentPaddingSize().y,!1,!1,!0):t.getCropMode()==t.CropModes.FIT_HEIGHT&&this.setWidth(e.getSize().x+this._getContentPaddingSize().x,!1,!1,!0),this._fireAutoSize()},_fireAutoSize:function(){this._autoSizeState!=this._autoSizeStates.none&&(this.fireEvent("autoSized",{ignoreLayout:this._autoSizeState==this._autoSizeStates.autoSizeNoLayoutUpdate}),this.injects().Layout.notifyPositionChanged(this,"updateSize"),this._autoSizeState=this._autoSizeStates.none)},_styleChanged:function(){var e=this._getContentPaddingSize(!0);this.setMinH(e.y+this.MIN_IMAGE_HEIGHT),this.setMinW(e.x+this.MIN_IMAGE_WIDTH);var t=this._getPhotoInnerSize();this._getImageSettings().setSize(t.x,t.y)},_getContentPaddingSize:function(e){if(!this._contentPadding||e){this._contentPadding={};var t=this.getSkin();this._contentPadding.x=parseInt(t.getParamValue("contentPaddingLeft"),10)+parseInt(t.getParamValue("contentPaddingRight"),10),this._contentPadding.y=parseInt(t.getParamValue("contentPaddingTop"),10)+parseInt(t.getParamValue("contentPaddingBottom"),10),this._contentPadding.x=isNaN(this._contentPadding.x)?0:this._contentPadding.x,this._contentPadding.y=isNaN(this._contentPadding.y)?0:this._contentPadding.y,this.getSizeLimits().minH=this._contentPadding.y,this.getSizeLimits().minW=this._contentPadding.x}return this._contentPadding},_getImageSettings:function(){if(!this._imageSettings){var e=this._getPhotoInnerSize(),t=this._translateDisplayModeToImageCropMode(this._getDisplayMode());this._imageSettings=new this.imports.ImageSettings(t,e.x,e.y)}return this._imageSettings},_getPhotoInnerSize:function(){var e=this._getContentPaddingSize(),t=this.getWidth()-e.x,n=this.getHeight()-e.y;return{x:t,y:n}},_setTitle:function(){var e=this._data.get("title");e&&this._skinParts.view.set("title",e)},_getDisplayMode:function(){return this.getComponentProperty("displayMode")},_getImageDisplayMode:function(){return this._getImageSettings()&&this._getImageSettings().getCropMode()},_translateDisplayModeToImageCropMode:function(e){var t=e;return e=="fitWidthStrict"&&(t=this._SettingsClass.CropModes.FIT_WIDTH),e=="fitHeightStrict"&&(t=this._SettingsClass.CropModes.FIT_HEIGHT),t},allowHeightLock:function(){return!this._isFitMode()},_isFitMode:function(){var e=["fitWidth","fitWidthStrict","fitHeightStrict"];return e.indexOf(this._getDisplayMode())>=0}})}),define.component("wysiwyg.viewer.components.WRichText",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({richTextContainer:{type:"htmlElement"}}),t.binds(["_modeChanged","_updateText"]),t.dataTypes(["RichText","Text"]),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED],EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"EDIT_RICH_TEXT",command:"EditorUI.StartEditRichText"}]}}),t.methods({initialize:function(e,t,n){this.injects().Commands&&this.injects().Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._modeChanged),this.parent(e,t,n),this.setMaxH(5e3)},_onAllSkinPartsReady:function(){var e=this._data.get("text");this.getRichTextContainer().set("html",e),this._modeChanged("VIEW"),this._data.addEvent(Constants.DataEvents.DATA_CHANGED,this._updateText);var t=this._data.getMeta("isPreset");this._data.set("text",this.getRichTextContainer().innerHTML),this._data.setMeta("isPreset",t)},_updateText:function(){var e=this._data.get("text");this.getRichTextContainer().set("html",e)},_modeChanged:function(e){var t;if((e=="PREVIEW"||e=="VIEW")&&this._skinParts){var n=$(this.getRichTextContainer()).getElements("a");for(var r=0;r<n.length;r++){var i=n[r],s=i.getAttribute("dataquery"),o=this;if(s){var u=this.injects().Data.getDataByQuery(s);u=u||this.injects().Data.getDataByQuery("#"+s);if(!u){LOG.reportError(wixErrors.LINK_DATA_ITEM_DOESNT_EXIST,"WRichText","_modeChanged",s);return}var a=u.get("href");i.set("href",a);var f=u.get("linkType");e=="PREVIEW"&&f!="PAGE"?i.set("target","_blank"):(t=u.get("target"),t&&i.set("target",t)),o._sanitizeLink(i)}}}},getRichTextContainer:function(){return this._skinParts?this._skinParts.richTextContainer:null},isEditableInPlace:function(){return!0}})}),define.oldComponent({name:"wysiwyg.viewer.components.WSiteStructure",Class:{Extends:"core.components.Container",Binds:["_onThemePropertyChange","_updateSiteBgPosition","_updateSiteBgSize","_validateBg","_delayedInvalidateBg","_invalidateBg","_setBgAsImageViewMode"],Static:{MAX_SITE_HEIGHT:1e5},initialize:function(e,t,n){this._bgNode=new Element("div",{id:"bgNode"}),this._bgNode.setStyles({position:"absolute",width:"100%"}),this._bgNode.inject(document.body,"top"),this._bgStyle={},this._lastBgStyle={},this.parent(e,t,n),window.onorientationchange&&window.addEvent("orientationchange",this._invalidateBg),window.addEvent("scroll",this._delayedInvalidateBg),window.addEvent("resize",this._delayedInvalidateBg),W.Theme.addEvent("propertyChange",this._onThemePropertyChange),this._updateBgProperty(),this._validateBg(),this.setMaxH(this.MAX_SITE_HEIGHT),W.Viewer.getPreviewMode()&&this._view.setStyle("padding-bottom",100)},render:function(){var e=this.injects().Viewer.getDocWidth();this.setWidth(e),this.parent()},_getReformattedBgColor:function(){return this.parent()},_onThemePropertyChange:function(e){if(e&&e.type=="propertyChange"&&e.name!="siteBg")return;this._updateBgProperty(),this._invalidateBg()},_updateBgProperty:function(){this._siteBgDef=this.injects().Theme.getProperty("siteBg"),this._bgFixed=this._siteBgDef.getAttachment()=="fixed",this._bgStyle["background-image"]=this._siteBgDef.getUrl(),this._bgStyle["background-size"]=this._siteBgDef.getCssSizeValue(),this._bgStyle["background-position"]=this._siteBgDef.getPosition(),this._bgStyle["background-repeat"]=this._siteBgDef.getRepeatUnified(),this._bgStyle["background-color"]=this._siteBgDef.getColor()},_updateSiteBgSize:function(){this._bgFixed?this._bgStyle.height=$(document.body).getSize().y+"px":this._bgStyle.height=Math.max(this._siteHeight||50,$(document.body).getSize().y)+"px"},_updateSiteBgPosition:function(){Modernizr.positionfixed?this._bgStyle.position=this._bgFixed?"fixed":"absolute":this._bgStyle.top=this._bgFixed?document.body.scrollTop+"px":0},_delayedInvalidateBg:function(){this._delayedInvalidateBgTimeout&&clearTimeout(this._delayedInvalidateBgTimeout),this._delayedInvalidateBgTimeout=W.Utils.callLater(this._invalidateBg,null,this,150)},_invalidateBg:function(){this._bgRenderCall||(this._bgRenderCall=this.injects().Utils.callOnNextRender(this._validateBg,10))},_validateBg:function(){delete this._bgRenderCall,this._updateSiteBgSize(),this._updateSiteBgPosition();if(!this._isBgStyleChanged())return;this._lastBgStyle=Object.clone(this._bgStyle),this._bgNode.setStyles(this._bgStyle),Modernizr.backgroundsize||(this._bgStyle["background-image"]==="none"||this._bgStyle["background-size"]!=="contain"&&this._bgStyle["background-size"]!=="cover"?this._bgAsImage&&this._bgAsImage.collapse():(this._bgNode.setStyle("background-image","none"),this._setBgAsImage(this._bgNode)))},_setBgAsImage:function(){this._bgAsImage?(this._setBgAsImageDataItemValues(this._siteBgDef.getImageId(),this._siteBgDef.getImageSize()),this._setBgAsImageViewMode(this._bgAsImage.getLogic())):(this._bgAsImageDataItem=W.Data.createDataItem({type:"Image",uri:this._siteBgDef.getImageId(),width:this._siteBgDef.getImageSize()[0],height:this._siteBgDef.getImageSize()[1],borderSize:0,title:"",description:"",alt:""}),this._bgAsImage=this.injects().Components.createComponent("core.components.Image","mobile.core.skins.ImageSkin",this._bgAsImageDataItem,{width:"100",height:"100",unit:"%"},null,this._setBgAsImageViewMode),this._bgAsImage.insertInto(this._bgNode))},_setBgAsImageDataItemValues:function(e,t){this._bgAsImageDataItem&&this._bgAsImageDataItem.setFields({uri:e,width:t[0],height:t[1]})},_setBgAsImageViewMode:function(e){var t=this._bgStyle["background-size"]==="contain"?"full":"fill",n=this._bgStyle["background-position"].split(" ");e.setCropMode(t),e.setAlign(n[0],n[1]),e.uncollapse()},_isBgStyleChanged:function(){for(var e in this._bgStyle)if(this._bgStyle[e]!=this._lastBgStyle[e])return!0;return!1},setHeight:function(e){if(this._siteHeight==e)return;this._siteHeight=e,this._delayedInvalidateBg(),this.parent(e),this.injects().Viewer.siteHeightChanged(!0)},_getBestFit:function(e,t){return this.parent(e,t)},_getWantedBgSize:function(){return this.parent()},getChildComponents:function(){return this.getViewNode().getChildren("[comp]")},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.ALWAYS,distance:0},from:{allow:!1,lock:Constants.BaseComponent.AnchorLock.NEVER}}},layoutMinHeight:function(){return 0}}}),define.oldComponent({name:"wysiwyg.viewer.components.WTwitterFollow",propertiesSchemaName:"WTwitterFollowProperties",skinParts:{twitter:{type:"htmlElement"}},Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1}},Extends:"wysiwyg.viewer.components.SocialBaseComponent",render:function(){this._showCount=this.getComponentProperty("showCount"),this._showScreenName=this.getComponentProperty("showScreenName");var e=this._data.get("accountToFollow").replace("@","");e||(e="wix"),this._screenName=e,this.parent()},_getPageName:function(){return"twfollow.html"},_getUrlParams:function(){return{screen_name:this._screenName,href:"https://twitter.com/"+this._screenName,show_count:this._showCount,show_screen_name:this._showScreenName,lang:this.getComponentProperty("dataLang"),align:"left"}},_getSizeAccordingToProperties:function(){var e=80,t=20;return this._showCount&&(e+=85),this._showScreenName&&(e+=this._screenName.length*6),{w:e,h:t}},getAcceptableDataTypes:function(){return["TwitterFollow"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.WTwitterTweet",propertiesSchemaName:"WTwitterTweetProperties",skinParts:{twitter:{type:"htmlElement"}},Class:{EDITOR_META_DATA:{general:{settings:!0,design:!1}},Extends:"wysiwyg.viewer.components.SocialBaseComponent",initialize:function(e,t,n){W.Utils.hash.addEvent("change",function(){this.callRenderLater(500)}.bind(this)),this.parent(e,t,n)},_getPageName:function(){return"twtweet.html"},_getUrlParams:function(){return{href:"https://twitter.com/share",count:this.getComponentProperty("dataCount"),lang:this.getComponentProperty("dataLang"),url:location.href,text:this._data.get("defaultText"),related:this._data.get("accountToFollow"),counturl:location.href}},getAcceptableDataTypes:function(){return["TwitterTweet"]},_getSizeAccordingToProperties:function(){var e,t,n=this.getComponentProperty("dataCount");t=20;switch(n){case"none":e=60;break;case"horizontal":e=100;break;case"vertical":e=60,t=62}return{w:e,h:t}}}}),define.component("wysiwyg.viewer.components.WixAds",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({footerLabel:{type:"htmlElement",optional:!1},topRectLabel:{type:"htmlElement",optional:!1},topRectContent:{type:"htmlElement",optional:!1}}),t.binds(["_getAdHeight"]),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED]}),t.methods({initialize:function(e,t,n){this.parent(e,t,n);var r=this.injects().Commands;r.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange),r.registerCommandListenerByName("WViewerCommands.OpenZoom",this,function(){this._showHideAds(!1)}),r.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,function(){this._showHideAds(!this._isPremium())}),this.injects().Viewer.addHeightChangeCallback(this._getAdHeight)},_onAllSkinPartsReady:function(){this.setCollapsed(this.injects().Viewer.getPreviewMode()||this._isPremium()),this._skinParts.view.addEvent("click",function(){var e=!this.injects().Viewer.getPreviewMode(),t=e?adData.adUrl.replace("[site_id]",window.siteId):adData.adUrl,n=!e||this._isFacebook();n?window.open(t,"_blank"):window.location.assign(t)}.bind(this)),this.injects().Viewer.getPreviewMode()&&this._addBiEvent()},_addBiEvent:function(){var e=wixEvents.WIXADS_CLICKED_IN_PREVIEW;this._skinParts.topRectLabel.addEvent("click",function(){LOG.reportEvent(e,{c1:"top-right"})}),this._skinParts.footerLabel.addEvent("click",function(){LOG.reportEvent(e,{c1:"footer"})})},render:function(){this.parent();var e=this.injects().Viewer.getAdData();this._skinParts.topRectLabel.set("html",e.topLabel),this._skinParts.topRectContent.set("html",e.topContent),this._skinParts.footerLabel.set("html",e.footerLabel)},_onModeChange:function(e){this._showHideAds(this._shouldShowAds(e))},_showHideAds:function(e){this.setCollapsed(!e),this.injects().Viewer.siteHeightChanged(!1)},_shouldShowAds:function(e){return this._isInPreviewMode(e)&&!this._isPremium()},_isInPreviewMode:function(e){return e.toLowerCase()===Constants.ViewManager.VIEW_MODE_PREVIEW.toLowerCase()},_isPremium:function(){var e=window.rendererModel||window.editorModel&&window.editorModel.metaSiteData||window.top&&window.top.editorModel&&window.top.editorModel.metaSiteData;if(!e||!e.premiumFeatures)return!1;var t=e.premiumFeatures;return this._isFacebook()?t.contains("NoAdsInSocialSites"):t.contains("AdsFree")||t.contains("ShowWixWhileLoading")},_isFacebook:function(){var e=window.siteHeader.applicationType||window.rendererModel.applicationType;return e==="HtmlFacebook"},_getAdHeight:function(){return this._view.isCollapsed()?0:this._skinParts.footerLabel.getHeight()}})}),define.component("wysiwyg.viewer.components.inputs.CheckBoxInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.skinParts({checkBox:{type:Constants.ComponentPartTypes.HTML_ELEMENT},label:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),t.binds([]),t.states({validation:["valid","invalid"]}),t.dataTypes(["Boolean"]),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validation")}.bind(this)),this._label=n.label||""},_onAllSkinPartsReady:function(e){var t=e.checkBox;t.addEvent(Constants.CoreEvents.CHANGE,function(){this.getDataItem().set("value",t.get("checked")),t.get("checked")&&this.fireEvent("itemSelected",this)}.bind(this)),this.getDataItem().get("value")==1&&t.setAttribute("checked","checked");var n=e.label.parentNode.id+"-check";e.label.setAttribute("for",n),e.checkBox.setAttribute("id",n),e.label.set("text",this._label)},setError:function(e){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",e)},setDisabled:function(){var e=this._skinParts.checkBox;e.set("disabled","disabled")},setSelected:function(e){var t=this._skinParts.checkBox;t.set("checked",e)}})}),define.component("wysiwyg.viewer.components.inputs.ColorOption",function(e){var t=e;t.skinParts({tooltip:{type:"wysiwyg.common.components.InfoTip"}}),t.inherits("wysiwyg.viewer.components.inputs.TextOption"),t.methods({_onAllSkinPartsReady:function(){this.getViewNode().setStyle("background-color",this.getDataItem().get("text")),this._initializeTooTip(this.getViewNode())}})}),define.component("wysiwyg.viewer.components.inputs.ComboBoxInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.statics({PROMPT_OPTION_VALUE:-1}),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),t.binds(["_selectedIndexChanged","_getPromptOptionDataItem"]),t.states({validity:["valid","invalid"]}),t.dataTypes(["SelectableList"]),t.propertiesSchemaType("ComboBoxInputProperties"),t.fields({_optionsData:[]}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validity")}.bind(this))},_preventRenderOnDataChange:function(e,t,n){return t=="selected"},_prepareForRender:function(){return this._createDropDownList(),!0},_onAllSkinPartsReady:function(){this._createDropDownList(),this._skinParts.collection.addEvent(Constants.CoreEvents.CHANGE,this._selectedIndexChanged)},_createDropDownList:function(){var e=function(e){this._optionsData=Object.values(e),this._bindDdlToData(this._skinParts.collection)}.bind(this),t=this.getDataItem().get("items").filter(function(e){return e.get("enabled")});t.length>0&&typeof t[0]=="string"?this.injects().Data.getDataByQueryList(t,e):e(t)},_bindDdlToData:function(e){e.empty();for(var t=0;t<this._optionsData.length;t++){var n=this._optionsData[t];e.options[t]=new Option(n.get("text"),n.get("value"))}var r=this.getDataItem().get("selected");r?this._setSelectedFromData(e,r):this.getComponentProperty("hasPrompt")&&this._addPrompt(e)},_setSelectedFromData:function(e,t){var n=this;typeof t=="string"?this.injects().Data.getDataByQuery(t,function(t){n._setSelected(e,t)}):this._setSelected(e,t)},_setSelected:function(e,t){var n=this._optionsData.indexOf(t);n>-1&&n<e.length&&(e.getSelected()[0].erase("selected"),e[n].set("selected","selected"))},_selectedIndexChanged:function(){this._hasPrompt&&this._removePrompt();var e=this._getSelectedIndex();this.setValidationState(!0),this.getDataItem().set("selected",this._optionsData[e]),this.fireEvent("selectionChanged",this._optionsData[e])},_getSelectedIndex:function(){return this._skinParts.collection.selectedIndex},setError:function(e){this.setValidationState(!1),this._skinParts.errorMessage&&this._skinParts.errorMessage.set("text",e)},_addPrompt:function(e){var t=this.getComponentProperty("promptText");e.options.add(new Option(t,this.PROMPT_OPTION_VALUE,!0,!0),0),this._optionsData.splice(0,0,this._getPromptOptionDataItem(t)),this._hasPrompt=!0},_removePrompt:function(){var e=this._skinParts.collection;e.getFirst().value==this.PROMPT_OPTION_VALUE&&(e.options.remove(0),this._optionsData.splice(0,1),this._hasPrompt=!1)},_getPromptOptionDataItem:function(e){var t={type:"SelectOption",value:this.getComponentProperty("promptValue"),text:e,enabled:!0,description:""},n=W.Data.createDataItem(t);return n.setMeta("isPersistent",!1),n}})}),define.component("wysiwyg.viewer.components.inputs.DateInput",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({year:{type:Constants.ComponentPartTypes.HTML_ELEMENT},month:{type:Constants.ComponentPartTypes.HTML_ELEMENT},day:{type:Constants.ComponentPartTypes.HTML_ELEMENT}}),t.binds(["_userChange"]),t.states({validation:["valid","invalid"]}),t.dataTypes(["Text"]),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validation")}.bind(this))},_onAllSkinPartsReady:function(){this._skinParts.year.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.month.addEvent(Constants.CoreEvents.CHANGE,this._userChange),this._skinParts.day.addEvent(Constants.CoreEvents.CHANGE,this._userChange);var e=(new Date).getUTCFullYear();for(i=1979;i<e+6;i++)this._skinParts.year.options.add(new Option(i,i));for(i=1;i<13;i++)this._skinParts.month.options.add(new Option(i,i))},render:function(){var e,t=this._data.get("text"),n=new Date(t),r=n.getUTCFullYear(),i=n.getUTCMonth(),s=n.getUTCDate();this._skinParts.year[r-1979].selected=!0,this._skinParts.month[i].selected=!0;while(this._skinParts.day.options.length)this._skinParts.day.options.remove(this._skinParts.day.options[0]);for(e=1;e<this._getDaysForMonth(r,i)+1;e++)this._skinParts.day.options.add(new Option(e,e));this._skinParts.day[s-1].selected=!0},_userChange:function(){var e=new Date(0);e.setUTCFullYear(this._skinParts.year.getSelected()[0].value),e.setUTCMonth(this._skinParts.month.getSelected()[0].value-1),e.setUTCDate(this._skinParts.day.getSelected()[0].value),this.getDataItem().set("text",e.toISOString()),this.fireEvent("selectionChanged",e.toISOString())},_getDaysForMonth:function(e,t){return t--,(new Date(e,t,0)).getDate()}})}),define.component("wysiwyg.viewer.components.inputs.NumberInput",function(e){var t=e;t.propertiesSchemaType("NumberInputProperties"),t.inherits("wysiwyg.viewer.components.inputs.TextInput"),t.fields({_origValue:null,_prevValue:null,_valueChanged:!0}),t.methods({_onAllSkinPartsReady:function(){this.parent(),this._origValue=this._getValue(),this._prevValue=this._origValue,this._skinParts.input.setAttribute("min",this.getComponentProperty("minValue")),this._skinParts.input.setAttribute("max",this.getComponentProperty("maxValue"))},_changeEventHandler:function(e){if(e.code&&!W.Utils.isInputKey(e.code))return;var t=this._getValue(),n=this._getValidValue();t&&t!=n&&this._valueChanged&&(this._valueChanged=!1,this.fireEvent("validationFailed",{evt:e,value:t,validValue:n}));if(n!=this._prevValue){this._prevValue=n,n=this.injects().Utils.convertToHtmlText(n);var r={value:n,origEvent:e,compLogic:this};this.fireEvent("inputChanged",r)}},_fireBlur:function(e){this._setValidValue(),this.parent(e)},_fireKeyUp:function(e){e.code=="13"&&this._setValidValue(),this.parent(e)},_getValidValue:function(){var e=this._getValue();return e?e<this.getComponentProperty("minValue")?e=this.getComponentProperty("minValue"):e>this.getComponentProperty("maxValue")&&(e=this.getComponentProperty("maxValue")):e=this._origValue,e},_setValidValue:function(){var e=this._skinParts.input;e.set("value",this._getValidValue()),this._valueChanged=!0}})}),define.component("wysiwyg.viewer.components.inputs.RadioGroupInput",function(e){var t=e;t.inherits("wysiwyg.viewer.components.inputs.ComboBoxInput"),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.skinParts({collection:{type:Constants.ComponentPartTypes.HTML_ELEMENT},errorMessage:{type:Constants.ComponentPartTypes.HTML_ELEMENT,optional:"true"}}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this._radioGroupName=n.radioGroupName||"radioGroup",this._selectedValue=n.selectedValue},_prepareForRender:function(){return this._createRadioGroup(),!0},_onAllSkinPartsReady:function(){this._createRadioGroup(),this._skinParts.collection.addEvent(Constants.CoreEvents.CHANGE,this._selectedIndexChanged)},_createRadioGroup:function(){var e=function(e){this._optionsData=Object.values(e),this._bindRadioGroupToData(this._skinParts.collection)}.bind(this),t=this.getDataItem().get("items").filter(function(e){return e.get("enabled")});t.length>0&&typeof t[0]=="string"?this.injects().Data.getDataByQueryList(t,e):e(t)},_bindRadioGroupToData:function(e){e.empty();for(var t=0;t<this._optionsData.length;t++){var n=this._optionsData[t],r=n.get("value"),i=new Element("Input",{type:"radio",name:this._radioGroupName,value:r});r==this._selectedValue&&i.setAttribute("checked","checked"),e.grab(i,"bottom"),e.innerHTML+=n.get("text")+"<BR/>"}this._setSelected(e)},_getSelectedIndex:function(){var e=document.getElementsByName(this._radioGroupName);for(var t=0;t<e.length;t++)if(e[t].checked)return t},_setSelected:function(e){var t=this.getDataItem().get("selected");t&&this.injects().Data.getDataByQuery(t,function(t){var n=this._optionsData.indexOf(t);n>-1&&n<e.length&&e[n].set("checked","checked")}.bind(this))}})}),define.component("wysiwyg.viewer.components.inputs.TextAreaInput",function(e){var t=e;t.inherits("wysiwyg.viewer.components.inputs.TextInput"),t.skinParts({textarea:{type:"htmlElement"},errorMessage:{type:"htmlElement",optional:!0}}),t.binds(["_checkMaxLength"]),t.traits(["wysiwyg.viewer.components.traits.ValidationSettings"]),t.methods({initialize:function(e,t,n){this.parent(e,t,n),n=n||{},this._maxLength=n.maxLength||""},_onAllSkinPartsReady:function(){var e=this._skinParts.textarea;e.set("value",this.getDataItem().get("text")),this.addEvent("inputChanged",function(e){this.getDataItem().set("text",e.value)}.bind(this)),this._maxLength&&(e.setProperty("maxlength",this._maxLength),Browser.ie&&e.addEvent(Constants.CoreEvents.KEY_UP,this._checkMaxLength)),this._listenToInput()},_checkMaxLength:function(e){var t=this._skinParts.textarea.get("value"),n=t.length;if(t.length>this._maxLength){var r=this._maxLength-n;t=t.slice(0,r),this._skinParts.textarea.set("value",t)}},_changeEventHandler:function(e){if(e.code==13)return!1;this.parent(e)},_listenToInput:function(){this._skinParts.textarea.addEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.textarea.addEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.textarea.addEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_stopListeningToInput:function(){this._skinParts.textarea.removeEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.textarea.removeEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.textarea.removeEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_getValue:function(){var e=this._skinParts.textarea;return e.get("value")}})}),define.oldComponent({name:"wysiwyg.viewer.components.inputs.TextInput",skinParts:{input:{type:"htmlElement"},errorMessage:{type:"htmlElement"}},traits:["wysiwyg.viewer.components.traits.ValidationSettings"],Class:{Extends:"mobile.core.components.base.BaseComponent",_states:{validation:["valid","invalid"]},Binds:["_changeEventHandler","_fireBlur","_fireKeyUp"],initialize:function(e,t,n){this.parent(e,t,n),this.addEvent(this.VALID_STATE_CHANGED_EVENT,function(e){this.setState(e?"valid":"invalid","validation")}.bind(this)),n=n||{},this._placeholder=n.placeholder||null,this._isPasswordField=n.passwordField||!1,this._label=n.label||""},_onAllSkinPartsReady:function(){var e=this._skinParts.input;e.set("value",this.getDataItem().get("text")),this.addEvent("inputChanged",function(e){this.getDataItem().set("text",e.value)}.bind(this)),this._listenToInput(),this._placeholder&&this._setPlaceholder(this._placeholder),this._isPasswordField&&e.set("type","password"),this.setLabel(this._label)},setError:function(e){this.setValidationState(!1),this._skinParts.errorMessage.set("text",e)},setLabel:function(e){this._skinParts.label&&this._skinParts.label.appendText(e,"top")},_setPlaceholder:function(e){this._skinParts.input.set("placeholder",e),window.Modernizr&&!window.Modernizr.input.placeholder&&this._placeholderPolyFill()},_placeholderPolyFill:function(){function e(e){var t=e.target;t.get("value")==""&&t.get("placeholder")&&(t.addClass("isPlaceholder"),t.set("value",t.get("placeholder")))}function t(e){var t=e.target;t.hasClass("isPlaceholder")&&(t.removeClass("isPlaceholder"),t.set("value",""))}this.hasPlaceholder||(this.hasPlaceholder=!0,this._skinParts.input.addEvent("focus",t),this._skinParts.input.addEvent("blur",e)),e({target:this._skinParts.input})},_changeEventHandler:function(e){if(e.code&&!W.Utils.isInputKey(e.code))return;var t=this._getValue();t=this.injects().Utils.convertToHtmlText(t);var n={value:t,origEvent:e,compLogic:this};this.fireEvent("inputChanged",n)},_fireBlur:function(e){this.fireEvent(Constants.CoreEvents.BLUR,e)},_fireKeyUp:function(e){this.fireEvent(Constants.CoreEvents.KEY_UP,e)},_listenToInput:function(){this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.addEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.addEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_stopListeningToInput:function(){this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.KEY_UP,this._fireKeyUp),this._skinParts.input.removeEvent(Constants.CoreEvents.CUT,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.PASTE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.CHANGE,this._changeEventHandler),this._skinParts.input.removeEvent(Constants.CoreEvents.BLUR,this._fireBlur)},_getValue:function(){var e=this._skinParts.input,t="";return e.hasClass("isPlaceholder")||(t=e.get("value")),t},dispose:function(){this._stopListeningToInput(),this.parent()},getAcceptableDataTypes:function(){return["Text"]}}}),define.component("wysiwyg.viewer.components.inputs.TextOption",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({size:{type:"htmlElement"},tooltip:{type:"wysiwyg.common.components.InfoTip"}}),t.traits(["wysiwyg.common.components.traits.SelectableOption"]),t.states({selectState:["selected","unselected"],enabledState:["enabled","disabled"]}),t.dataTypes(["SelectOption"]),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.setSelected(!1)},_onAllSkinPartsReady:function(){var e=this._skinParts.size;e.set("text",this.getDataItem().get("text")),this._initializeTooTip(this.getViewNode())},_initializeTooTip:function(e){var t=this._skinParts.tooltip,n=this.getDataItem().get("description");n&&n.trim().length>0&&(e.addEvent("mouseenter",function(){t._showToolTipCmd({id:1,content:n},{source:e})}),e.addEvent("mouseleave",function(){t._closeToolTipCmd()}))},_onDataChange:function(e,t,n){this.setEnabled(this.getDataItem().get("enabled"))},setSelected:function(e){this.setState(e?"selected":"unselected","selectState")},setEnabled:function(e){this.setState(e?"enabled":"disabled","enabledState")}})}),define.oldClass({name:"wysiwyg.viewer.components.menus.DropDownController",Class:{Extends:"bootstrap.utils.Events",Binds:["_onItemsContainerOver","_onItemsContainerOut","closeDropDown","_onMoreContainerOver","_onMoreContainerOut"],_menu:null,_dropButtons:[],_dropContainer:null,_dropWrapper:null,_dropOwnerButton:null,_dropDownNeedsClosing:!1,_closeTimerID:null,initialize:function(e){this._menu=e,this._init()},_init:function(){var e=this._menu.getItemsContainer();e.addEvent("mouseover",this._onItemsContainerOver),e.addEvent("mouseout",this._onItemsContainerOut),this._dropContainer=this._menu.getMoreContainer(),this._dropWrapper=this._menu.getDropWrapper(),this._dropWrapper==null&&(this._dropWrapper=this._dropContainer),this.closeDropDown(!0),this._dropContainer.addEvent("mouseover",this._onMoreContainerOver),this._dropContainer.addEvent("mouseout",this._onMoreContainerOut)},openDropDown:function(e,t){if(e==this._dropOwnerButton){this._dropDownNeedsClosing=!1;return}while(this._dropContainer.children.length)this._dropContainer.children[0].dispose();var n,r=[];for(n=0;n<t.length;n++)t[n].isHidden()==0&&r.push(t[n]);if(r.length>0){this._dropWrapper.setStyle("width","auto");for(n=0;n<r.length;n++)r[n].getViewNode().inject(this._dropContainer,"bottom");this._setDropListPositions(r),this._menu.arrangeDropButtons(r),this._dropDownNeedsClosing=!1,this._releasePreviousOwner(),this._dropOwnerButton=e,this._dropButtons=r,this._dropOwnerButton.setDropdownOpen(!0),this._dropWrapper.setStyle("display","block"),this._dropWrapper.setStyle("opacity","1"),this._arrangeDropDown(),this._dropWrapper.setStyle("z-index","99999"),this.fireEvent("open")}},_setDropListPositions:function(e){var t,n,r,i=e.length==1;for(t=0;t<e.length;t++)n=e[t],t==0?i?r="dropLonely":r="top":!i&&t==e.length-1?r="bottom":r="dropCenter",n.getViewNode().setProperty("listposition",r),n.getViewNode().setProperty("container","drop")},closeDropDown:function(e){if(e||this._dropDownNeedsClosing)this._releasePreviousOwner(),this._dropWrapper.setStyle("display","none"),this._dropWrapper.setStyle("opacity","0"),this._dropDownNeedsClosing=!1},_releasePreviousOwner:function(){this._dropOwnerButton&&(this._dropOwnerButton.setDropdownOpen(!1),this.injects().Utils.forceBrowserRepaint(this._dropOwnerButton.getViewNode()),this._dropOwnerButton=null)},_closeDropDownTimer:function(){this.injects().Utils.clearCallLater(this._closeTimerID),this._closeTimerID=this.injects().Utils.callLater(this.closeDropDown,[],this,500)},_arrangeDropDown:function(){var e=this._dropOwnerButton.getViewNode().getProperty("listPosition");this._dropWrapper.setProperty("dropHPosition",e),this._setDropDownWidth(),this._setDropDownPosition()},_setDropDownWidth:function(){var e,t,n,r,i,s,o=this._dropOwnerButton.getMinimalDropdownWidth(),u=o;for(e=0;e<this._dropButtons.length;e++)t=this._dropButtons[e],u=Math.max(u,t.getMinimalWidth());if(u==o){var a=this._menu.getMenuExtraPixels(!0);this._dropWrapper.setStyle("width",a.left+a.right+u+"px")}else this._dropWrapper.setStyle("width","auto")},_setDropDownPosition:function(){this._dropWrapper.setStyle("text-align",this._menu.getComponentProperty("alignText"));for(var e=0;e<this._dropButtons.length;e++){var t=this._dropButtons[e];t.setPadding(0),t.alignText()}this._setHorizontalPosition(),this._setVerticalPosition()},_setHorizontalPosition:function(){var e=this._dropOwnerButton.getOffsetLeft(),t=this._menu.getComponentProperty("alignButtons");this._dropWrapper.setProperty("dropAlign",t);var n="0px",r="auto",i=this._menu.getMenuExtraPixels(!0),s=this._dropOwnerButton.getViewNode().getProperty("listPosition");if(t=="left")s=="left"?n=0:n=e+i.left+"px";else if(t=="right")s=="right"?r=0:r=this._menu.getWidth()-e-this._dropOwnerButton.getOffsetWidth()-i.right+"px",n="auto";else{var o=0;s=="left"?n=e+(this._dropOwnerButton.getOffsetWidth()+i.left-this._dropWrapper.offsetWidth)/2+"px":s=="right"?(n="auto",r=(this._dropOwnerButton.getOffsetWidth()+i.right-parseInt(this._dropWrapper.getStyle("width"),10))/2+"px"):n=i.left+e+(this._dropOwnerButton.getOffsetWidth()-this._dropWrapper.offsetWidth)/2+"px"}this._dropWrapper.setStyle("left",n),this._dropWrapper.setStyle("right",r)},_setVerticalPosition:function(){var e="dropDown";this._needsToOpenUp()?(e="dropUp",this._dropWrapper.setStyle("bottom",this._menu.getHeight()+"px")):this._dropWrapper.setStyle("bottom","auto"),this._dropWrapper.setProperty("dropMode",e)},_needsToOpenUp:function(){if(navigator.userAgent.match(/MSIE 8.0/))return!1;var e=!0,t=window.innerHeight,n=this._menu.getViewNode(),r=0;do r+=n.offsetTop,n=n.offsetParent;while(n!=null);var i=r-document.body.getScroll().y;return i<=t/2&&(e=!1),e},_onItemsContainerOver:function(e){var t=this._findLogicParent(e.target);this._isValidButtonForDropDown(t)&&t.children.length>0&&this.openDropDown(t,t.children)},_onItemsContainerOut:function(e){var t=this._findLogicParent(e.target);t&&t==this._dropOwnerButton&&(this._dropDownNeedsClosing=!0,this._closeDropDownTimer())},_onMoreContainerOver:function(e){this._dropDownNeedsClosing=!1},_onMoreContainerOut:function(e){this._dropDownNeedsClosing=!0,this._closeDropDownTimer()},_findLogicParent:function(e){var t=!1;while(t==0){var n=!1,r;t=!0;try{navigator.userAgent.match(/MSIE 8.0/)?r=e.getLogic():e.hasOwnProperty("getLogic")&&e.getLogic()?r=e.getLogic():t=!1}catch(i){t=!1}t==0?(e=e.getParent(),e||(t=!0)):e=r}return e},_isValidButtonForDropDown:function(e){return e&&e.className=="core.components.MenuButton"?!0:!1}}}),define.component("wysiwyg.viewer.components.menus.DropDownMenu",function(e){var t=e;t.inherits("core.components.BaseRepeater"),t.utilize(["core.components.BaseList","core.components.SimpleButton","wysiwyg.viewer.components.menus.DropDownController"]),t.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,inlineDataField:"items",repeaterDataQueryField:"refId",container:"itemsContainer",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"},dropWrapper:{type:"htmlElement"}}),t.binds(["_onButtonDataChange","_onThemeChange","_arrangeButtons","_onButtonClick","_onPageChanged"]),t.dataTypes(["Menu"]),t.propertiesSchemaType("HorizontalMenuProperties"),t.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.SKIN_CHANGE],EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"FPP_NAVIGATE_LABEL",command:"WEditorCommands.Pages",commandParameter:{galleryConfigID:"pagesPanel"}}],dblClick:{command:"WEditorCommands.Pages"}},_prevButtonsWidth:0,_testOverFlowCount:50,_buttonsPadding:{}}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this.injects().Theme.addEvent("propertyChange",this._onThemeChange),this._arrangeWaitID=-1,this.injects().Viewer.addEvent("pageTransitionStarted",this._onPageChanged),this._usesExternalData=!0,this._staticWidth=0,this._aspectRatio=-1,this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._hiddenButtonsContainer=new Element("div",{id:"hiddenButtonsContainer",style:"visibility:hidden"}),this._hiddenButtonsContainer.inject(this.getViewNode()),this._flatButtons=[],this._arrangeDone=!1,this._treeConstructionDone=!1,this.getViewNode().setStyle("opacity","0")},setWidth:function(e,t,n,r){r==undefined&&(r=!0);if(r&&this._aspectRatio!=-1){var i=e/this._aspectRatio;i<this.getSizeLimits().minH&&(i=this.getSizeLimits().minH,e=i*this._aspectRatio),this.setHeight(i,!0,!1,!1)}this.parent(e,t,n)},setHeight:function(e,t,n,r){r==undefined&&(r=!0);if(r&&this._aspectRatio!=-1){var i=e*this._aspectRatio;i<this.getSizeLimits().minW&&(i=this.getSizeLimits().minW,e=i/this._aspectRatio),this.setWidth(i,!0,!1,!1)}this.parent(e,t,n)},_onAllSkinPartsReady:function(){this.parent(),this._dropDown=new this.imports.DropDownController(this),this._registerButton(this._skinParts.moreButton)},_registerButton:function(e){e.setMenu(this),e.addEvent("dataChanged",this._onButtonDataChange),e.dropdownMode=!0},getItemsContainer:function(){var e=null;return this._skinParts&&(e=this._skinParts.itemsContainer),e},getMoreContainer:function(){var e=null;return this._skinParts&&(e=this._skinParts.moreContainer),e},getDropWrapper:function(){var e=null;return this._skinParts&&(e=this._skinParts.dropWrapper),e},getMenuExtraPixels:function(){return this.getDivExtraPixels(this._skinParts.itemsContainer,!0)},arrangeDone:function(){return this._arrangeDone},_testOverFlow:function(){var e=this._getButtonsWidth();this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth==0&&(this._prevButtonsWidth=e),e!=this._prevButtonsWidth?this._arrangeButtons():(this._testOverFlowCount--,this._testOverFlowCount>0&&(this._overflowID=this.callLater(this._testOverFlow,[],100)))},_onPageChanged:function(e){var t,n;if(this._skinParts==null)return;this._selectActiveButton(e)},_selectActiveButton:function(e){if(this._flatButtons)for(i=0;i<this._flatButtons.length;i++)button=this._flatButtons[i],button.getID()==e?button.setSelected(!0):button.setSelected(!1),this.injects().Utils.forceBrowserRepaint(button.getViewNode())},_onThemeChange:function(){this._changeTriggeredBy="themeChange",this._arrangeButtonsDelayed()},_beforeRepeatersCreation:function(){this._rootButtons=[],this._flatButtons=[],this._flatButtons.push(this._skinParts.moreButton)},_onRepeaterItemReady:function(e,t,n,r){r&&t.addEvent("click",function(){this._onButtonClick(n)}.bind(this)),this._rootButtons.push(t),this._flatButtons.push(t),t.getViewNode().setStyle("visibility","hidden"),this._registerButton(t),this.parent(e,t,n,r)},_onRepeaterReady:function(e){this.addEvent(Constants.PropertyEvents.PROPERTY_CHANGED,this._arrangeButtons),this._treeConstructionDone=!1,this._arrangeButtonAccordingToData(),this._constructButtonsTree()},_constructButtonsTree:function(){var e,t,n=this._data.get("items"),r,i,s,o=this,u=[];for(e=0;e<n.length;e++){r=null;for(t=0;t<this._rootButtons.length;t++)if(this._rootButtons[t].compareRefID(n[e].get("refId"))){r=this._rootButtons[t];break}if(r){r.children=[],i=this._data.getSubItems(n[e]);for(t=0;t<i.length;t++)s=Object.clone(this._repeaterDefinitions[0]),s.dataQuery=i[t].get("refId"),u.push({owner:r,def:s})}}var a=u.length;if(a==0)this._constructionDone();else for(e=0;e<u.length;e++){var f=u[e].def;u[e].owner.createSubButton(this._createComponentbyDefinition.bind(this),f,function(e){o._registerButton(e),o._flatButtons.push(e),e.addEvent("click",function(){o._onButtonClick(e._data)}.bind(o)),a--,a==0&&o._constructionDone()})}},_arrangeButtonAccordingToData:function(e){var t=this._data.get("items"),n=[];for(var r=0;r<t.length;r++){var i=t[r].get("refId").substr(1);n.push(this._rootButtons.filter(function(e,t){return e.getDataItem().get("id")==i})[0])}this._rootButtons=n},_constructionDone:function(){this._treeConstructionDone=!0,this._arrangeButtons()},render:function(){this.parent(),this._changeTriggeredBy=="styleChange"?this._arrangeButtonsDelayed():this._arrangeButtons()},setSkin:function(e){this._staticWidth=e.staticWidth||0,this._aspectRatio=parseFloat(e.aspectRatio,10)||-1,this.parent(e)},_onButtonDataChange:function(e){this._changeTriggeredBy="dataChange",this.render()},_onDataChange:function(e){var t=this.getComponentProperties();t&&t.removeField("spacing"),this._changeTriggeredBy="dataChange",this.parent()},_applySettings:function(){this._preWidthModifier=this._nullModifier,this._postWidthModifier=this._nullModifier,this._staticWidth>0?this._preWidthModifier=this._staticWidthModifier:(this.getComponentProperty("sameWidthButtons")&&(this._preWidthModifier=this._sameWidthModifier),this.getComponentProperty("stretchButtonsToMenuWidth")&&(this._postWidthModifier=this._stretchToFillModifier))},_skinSizeChange:function(){this._changeTriggeredBy="styleChange",this.parent()},_skinParamsChange:function(e){this._changeTriggeredBy="styleChange",this.parent(e)},_arrangeButtonsDelayed:function(){this._arrangeDone=!1,this._arrangeWaitID!=-1&&this.injects().Utils.clearCallLater(this._arrangeWaitID),this._arrangeWaitID=this.callLater(this._arrangeButtonsCapture,[],100),this._changeTriggeredBy="",this._skinParts.itemsContainer.setStyle("overflow","hidden")},_arrangeButtonsCapture:function(){this._arrangeButtons(),this._arrangeWaitID!=-1&&this._arrangeButtonsDelayed()},_arrangeButtons:function(){this._arrangeDone=!1;if(!this._treeConstructionDone||this._skinParts==undefined||!this._rootButtons||this._rootButtons.length==0||!this._isDisplayed||!this.isReady())return;if(this._skinParts.moreButton.className=="")return;var e=this._hideButtonsOfHiddenPages();if(!e)return;this.getViewNode().setStyle("opacity","1"),this.injects().Utils.clearCallLater(this._overflowID),this._prevButtonsWidth=0,this._arrangeWaitID=-1,this._applySettings(),this._initItemsContainer(),this._initMoreButton();var t=this._getDisplayedButtons();if(!t.length)return;t.push(this._skinParts.moreButton),this._preArrangeButtons(this._flatButtons);var n=this._getSampleButton();this._sampleButtonBorder(n),this._setMinimumDimensions(n);for(var r=0;r<t.length;r++)t[r].getViewNode().inject(this._skinParts.itemsContainer),t[r].getViewNode().setProperty("container","menu");this._preWidthModifier(t),this._calculateButtonsAmount(t),this.setMinW(t[0].getViewNode().offsetWidth),this._postWidthModifier(t),t=this._getDisplayedButtons(),t.push(this._skinParts.moreButton),this._alignButtonsText(t),this._restoreTransition(this._flatButtons),this._skinParts.itemsContainer.setStyle("overflow","visible"),this._skinParts.itemsContainer.setStyle("display","inherit"),this._skinParts.itemsContainer.setStyle("white-space","nowrap"),this._testOverFlow(),this._arrangeDone=!0,this._selectActiveButton(this.injects().Viewer.getCurrentPageId()),this.fireEvent("ready")},arrangeDropButtons:function(e){var t,n;for(t=0;t<e.length;t++){var r=e[t];r.getViewNode().setStyle("visibility","inherit");var i=this._skin.more_vPadding||15;this._setButtonHeight(r,this._getButtonMinimalHeight(r)+i)}},_calculateButtonsAmount:function(e){e=this._arrangementAlgorithm(e),this._skinParts.moreButton.skipMe&&(this._skinParts.moreButton.getViewNode().setStyle("visibility","hidden"),this._skinParts.moreButton.getViewNode().inject(this._hiddenButtonsContainer),e[e.length-1]===this._skinParts.moreButton&&e.pop())},_getButtonsWidth:function(){var e=0;for(i=0;i<this._skinParts.itemsContainer.children.length;i++)e+=this._skinParts.itemsContainer.children[i].getLogic().getWidthOnLayout();return e},_hideButtonsOfHiddenPages:function(){var e=!0;for(var t=0;t<this._flatButtons.length;t++)if(this._flatButtons[t]!=this._skinParts.moreButton){if(!this._flatButtons[t].getDataItem()){e=!1;break}this._flatButtons[t].isHidden()&&(this._flatButtons[t].getViewNode().setStyle("visibility","inherit"),this._flatButtons[t].getViewNode().inject(this._hiddenButtonsContainer))}return e},_getDisplayedButtons:function(){var e=[];for(var t=0;t<this._rootButtons.length;t++)this._rootButtons[t].getDataItem()._data.hidePage||e.push(this._rootButtons[t]);return e},_setMenuListPositions:function(e){var t,n,r;if(e.length==1)n=e[0],n.getViewNode().setProperty("listposition","lonely"),n.getViewNode().setProperty("container","menu");else for(t=0;t<e.length;t++)n=e[t],t==0&&this._setPositionForFirst()?r="left":t==e.length-1&&this._setPositionForLast()?r="right":r="center",n.getViewNode().setProperty("listposition",r),n.getViewNode().setProperty("container","menu")},_setPositionForFirst:function(){var e=!1;return this._postWidthModifier==this._stretchToFillModifier?e=!0:this.getComponentProperty("alignButtons")=="left"&&(e=!0),e},_setPositionForLast:function(){var e=!1;return this._postWidthModifier==this._stretchToFillModifier?e=!0:this.getComponentProperty("alignButtons")=="right"&&(e=!0),e},_getSampleButton:function(){return this._rootButtons[0].getViewNode().getStyle("visibility")=="visible"?this._rootButtons[0]:this._skinParts.moreButton},_sampleButtonBorder:function(e){e._skinParts.borderWrapper?this._buttonsBorder=this._getBorder(e._skinParts.borderWrapper):this._buttonsBorder=this._getBorder(e.getViewNode())},_setMinimumDimensions:function(e){this.setMinH(this._getButtonMinimalHeight(e))},_getButtonMinimalHeight:function(e){e._skinParts.label.setStyle("line-height","100%");var t=0;e.getSkin()&&!isNaN(e.getSkin().addToMinH)&&(t=e.getSkin().addToMinH);var n=this._getBorder(this._skinParts.itemsContainer).y+this._buttonsBorder.y;return t+n+parseInt(e._skinParts.label.getComputedStyle("line-height"))},_initItemsContainer:function(){this._skinParts.itemsContainer.setStyle("text-align",this.getComponentProperty("alignButtons"));var e=this.getHeight()-this._getBorder(this._skinParts.itemsContainer).y-this._getMargin(this._skinParts.itemsContainer).y,t=this.getWidth()-this._getBorder(this._skinParts.itemsContainer).x-this._getMargin(this._skinParts.itemsContainer).x;this._skinParts.itemsContainer.setStyle("height",e+"px"),this._skinParts.itemsContainer.setStyle("width",t+"px"),this._skinParts.itemsContainer.setStyle("overflow","hidden"),this._skinParts.itemsContainer.setStyle("white-space","normal")},_initMoreButton:function(){this._skinParts.moreButton.setLabel(this.getComponentProperty("moreButtonLabel")),this._skinParts.moreButton.skipMe=!0,this._skinParts.moreButton.children=[],this._skinParts.moreButton.getViewNode().inject(this._skinParts.itemsContainer)},_preArrangeButtons:function(e){for(var t=0;t<e.length;t++){var n=e[t];e[t].getViewNode().setStyle("position","relative"),n.getViewNode().setStyle("visibility","inherit"),n.disableTransition(),n._skinParts.bg.setStyle("padding","0px 0px")}},_restoreTransition:function(e){for(var t=0;t<e.length;t++){var n=e[t];n.enableTransition()}},_alignButtonsText:function(e){for(var t=0;t<e.length;t++){var n=e[t].getViewNode(),r=parseInt(n.getLogic()._skinParts.bg.getComputedStyle("padding-left"))+parseInt(n.getLogic()._skinParts.bg.getComputedStyle("padding-right"));e[t].setPadding(r)}},_arrangementAlgorithm:function(e){var t=!1;while(!t){t=this._arrangementIteration(e);if(!t)if(e.length==1)t=!0;else{this._skinParts.moreButton.skipMe=!1;var n=e.splice(e.length-2,1)[0];n.getViewNode().setStyle("visibility","inherit"),n.getViewNode().dispose(),this._skinParts.moreButton.children.unshift(n)}}return e},_stretchToFillModifier:function(e,t){function a(e,t){if(f>0){var r=Math.ceil(o/f);o-=r;var i=parseInt(e._skinParts.bg.getStyle(t));n&&(u._buttonsPadding[e]||(u._buttonsPadding[e]={}),u._buttonsPadding[e][t]=i),e._skinParts.bg.setStyle(t,i+r+"px"),f--}}t=t||0;var n=!1;t==0&&(n=!0,this._buttonsPadding={});var r=this._getButtonsWidth(),i,s=parseInt(this._skinParts.itemsContainer.getStyle("width")),o=s-r-t;Browser.ie&&(o-=1),o=Math.max(o,0);var u=this;if(e.length>0){var f=e.length*2;for(i=0;i<e.length/2;i++){var l=e[i],c=e[e.length-i-1];a(l,"padding-left"),a(c,"padding-right"),a(l,"padding-right"),a(c,"padding-left")}}if(this._skinParts.itemsContainer.scrollHeight-e[0].getViewNode().offsetHeight>=e[0].getViewNode().offsetHeight){for(i=0;i<e.length;i++){var h=e[i];h._skinParts.bg.setStyle("padding-left",this._buttonsPadding[h]["padding-left"]),h._skinParts.bg.setStyle("padding-right",this._buttonsPadding[h]["padding-left"])}t<20&&this._stretchToFillModifier(e,t+1)}for(i=0;i<e.length;i++){var h=e[i];h.alignText()}},_sameWidthModifier:function(e){var t=0,n,r;for(n=0;n<e.length;n++){r=e[n];var i=parseInt(r.getViewNode().offsetWidth-this._buttonsBorder.x);isNaN(i)||(t=Math.max(t,i))}if(t>0)for(n=0;n<e.length;n++)r=e[n],r.fillWidthByPadding(t)},_staticWidthModifier:function(e){var t,n;for(t=0;t<e.length;t++)n=e[t],n.offsetWidth<this._staticWidth?n.fillWidthByPadding(this._staticWidth):n.getViewNode().setStyle("width",this._staticWidth+"px")},_nullModifier:function(e){},_arrangementIteration:function(e){var t,n=[],r,i;for(i=0;i<e.length;i++)r=e[i],r.skipMe?r.collapse():n.push(r);this._setMenuListPositions(n);for(i=0;i<n.length;i++)r=n[i],r.uncollapse(),r.getViewNode().setStyle("visibility","visible"),r.getViewNode().inject(this._skinParts.itemsContainer),t=parseInt(this._skinParts.itemsContainer.getStyle("height"))-this._buttonsBorder.y,this._setButtonHeight(r,t),r._skinParts.label.setStyle("width","auto");return this._skinParts.itemsContainer.scrollHeight-e[0].getViewNode().offsetHeight<e[0].getViewNode().offsetHeight},_setButtonHeight:function(e,t){e._skinParts.labelPad!=undefined&&(t-=e._skinParts.labelPad.offsetHeight),e._skinParts.label.setStyle("line-height",t+"px")},_getBorder:function(e){var t=0,n=0;return e&&(t=parseInt(e.getStyle("border-left-width"))+parseInt(e.getStyle("border-right-width")),n=parseInt(e.getStyle("border-top-width"))+parseInt(e.getStyle("border-bottom-width"))),{x:t,y:n}},_getMargin:function(e){var t=0,n=0;return e&&(t=parseInt(e.getStyle("margin-left"))+parseInt(e.getStyle("margin-right")),n=parseInt(e.getStyle("margin-top"))+parseInt(e.getStyle("margin-bottom"))),{x:t,y:n}},_onResize:function(){this._arrangeButtons()},_onButtonClick:function(e){this.injects().Viewer.goToPage(e.get("id")),this.callLater(function(){navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&this._dropDown.closeDropDown(!0)}.bind(this),[],100)},dispose:function(){this.injects().Viewer.removeEvent("pageTransitionStarted",this._onPageChanged),this.injects().Theme.removeEvent("propertyChange",this._onThemeChange),this.parent()}})}),define.oldComponent({name:"wysiwyg.viewer.components.sm.SMApplyForMembership",imports:[],skinParts:{email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},re_password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindRePasswordField"}},Class:{Extends:"wysiwyg.viewer.components.sm.SMRegister",onSubmit:function(){var e=this._emailField._data.get("text"),t=this._passwordField._data.get("text"),n=this._rePasswordField._data.get("text");this._validateFields(e,t,n)&&this.injects().SiteMembers.applyForMembership(e,t,this._onFormSuccess,this._onFormError)},_onFormSuccess:function(e){var t=this._emailField._data.get("text");this._container.showConfirmation("Success! Your member login request has been sent and is awaiting approval. The site administrator will notify you via email ("+t+") once your request has been approved")}}}),define.oldComponent({name:"wysiwyg.viewer.components.sm.SMContainer",imports:[],skinParts:{blockingLayer:{type:"htmlElement"},submitButton:{type:"htmlElement"},okButton:{type:"htmlElement"},content:{type:"htmlElement"},contentInner:{hookMethod:"_createInnerDialog"},confirmationText:{type:"htmlElement"},errMsg:{type:"htmlElement"},title:{type:"htmlElement"},infoTitle:{type:"htmlElement"},note:{type:"htmlElement"},cancel:{type:"htmlElement"},xButton:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Static:{INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"}},Binds:["_handleSubmit","onFormError","onFormSuccess","_getCurrentForm","_handleCancel","_handleConfirmationOk"],_states:["normal","confirm"],initialize:function(e,t,n){this.isVolatile=!0,this.parent(e,t,n),this._intent=n&&n.intent,this._authCallback=n&&n.authCallback,this._hashRedirectTo=n&&n.hashRedirectTo,this._openedByPageSecurity=n&&n.openedByPageSecurity,this._disableCancel=n&&n.disableCancel},_onAllSkinPartsReady:function(e){this.setState("normal"),e.submitButton.addEvent("click",this._handleSubmit),this._disableCancel?(e.xButton.hide(),e.cancel.setStyle("visibility","hidden")):(e.cancel.addEvent("click",this._handleCancel),e.xButton.addEvent("click",this._handleCancel),e.blockingLayer.addEvent("click",function(t){t.target==e.blockingLayer&&this._handleCancel()}.bind(this))),e.okButton.addEvent("click",this._handleConfirmationOk),this._initializeForm(e.contentInner),this.callLater(this.centerDialog)},_getFormType:function(e){var t=this.injects().SiteMembers;e||(t.isNotAuthenticatedWithCookie()?e=this.INTENTS.LOGIN:e=this.INTENTS.REGISTER);switch(e){case"REGISTER":var n=t.getCollectionType();switch(n){case"Open":return"register";case"ApplyForMembership":return"applyForMembership"}break;case"LOGIN":return"login"}},_createInnerDialog:function(e){var t=this._getFormType(this._intent);return e.type="wysiwyg.viewer.components.sm.SM"+t.capitalize(),e.skin="wysiwyg.viewer.skins.sm.SM"+t.capitalize()+"Skin",e.argObject={container:this},e},_initializeForm:function(e){this._currentForm=e;var t=this._skinParts.title;t.set("html",this._currentForm.getDisplayName());var n=this._skinParts.submitButton;n.set("value",this._currentForm.getButtonLabel());var r=this._skinParts.note,i=this._currentForm.getSubHeaderElement();if(i){var s=i.el,o=i.intent;s.getElements("a").addEvent("click",function(){this.injects().SiteMembers.openSiteMembersPopup({intent:o,disableCancel:this._disableCancel,openedByPageSecurity:this._openedByPageSecurity,hashRedirectTo:this._hashRedirectTo})}.bind(this)),r.adopt(s.childNodes)}this._addCurrentFormEvents(),this._openedByPageSecurity&&(this.injects().Viewer.isPublicMode()||W.Config.isInDebugMode()?(this._skinParts.infoTitle.set("text","To view this page, you need to be logged in."),this._skinParts.note.setStyle("float","right"),this._skinParts.infoTitle.setStyle("display","block")):this.showConfirmation("This page is protected with a member login. Your users will be able to see this page once they are logged in. To manage your site's members, go to your site in My Account and click Site Members",function(){this.reportAuthStatusChange(!0),this._closeSMContainer()}.bind(this)))},setActiveForm:function(e){},centerDialog:function(){var e=this._skinParts.dialog;e.setStyles({"margin-left":-(e.getSize().x/2),"margin-top":-(e.getSize().y/2)})},_removeCurrentFormEvents:function(){var e=this._getCurrentForm();e.removeEvent("error",this._onFormError),e.removeEvent("success",this._onFormSuccess)},_addCurrentFormEvents:function(){var e=this._getCurrentForm();e.addEvent("error",this._onFormError),e.addEvent("success",this._onFormSuccess)},onFormError:function(e){this._skinParts.errMsg.set("html",e)},onFormSuccess:function(e){this._closeSMContainer()},closeAndRedirect:function(){this._closeSMContainer();if(this._hashRedirectTo){var e=W.Utils.hash.getHashParts(this._hashRedirectTo);W.Utils.hash.setHash(e.id,e.title,e.extData,!0),window.location.hash=this._hashRedirectTo}location.reload()},reportAuthStatusChange:function(e,t){this._authCallback&&this.injects().SiteMembers.reportAuthStatusChange(this._authCallback,e,t)},showConfirmation:function(e,t){this.setState("confirm"),this._skinParts.confirmationText.set("text",e),this._confirmCallback=t},_handleConfirmationOk:function(){this._confirmCallback&&this._confirmCallback(),this._closeSMContainer()},_handleCancel:function(){this._getCurrentForm().onCancel(),this.reportAuthStatusChange(!1,{cancel:!0}),this._closeSMContainer()},_onKeyPress:function(e){e.code==13&&this._handleSubmit()},_handleSubmit:function(){if(!this.injects().Viewer.isPublicMode()&&!W.Config.isInDebugMode()){this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this._skinParts.submitButton},this);return}this._skinParts.errMsg.set("html",""),this._getCurrentForm().onSubmit()},_editModeChanged:function(e,t){this._closeSMContainer()},_closeSMContainer:function(){this.injects().Commands.executeCommand("WViewerCommands.SiteMembers.Close",null,null)},_getCurrentForm:function(){return this._currentForm}}}),define.oldComponent({name:"wysiwyg.viewer.components.sm.SMForm",imports:[],Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onFormError","_onFormSuccess"],Static:{PASS_MIN_LEN:4,PASS_MAX_LEN:15,ERR_MAP:{GENERAL_ERR:"Server error. try again later.",VAL_ERR_PASSWORD_BLANK:"Password cannot be blank",VAL_ERR_PASSWORD_RETYPE:"Passwords are not the same",VAL_ERR_PASSWORD_LENGTH:"Password length must be between {0} and {1}",VAL_ERR_EMAIL_BLANK:"Email cannot be blank",VAL_ERR_EMAIL_INVALID:"Email is invalid","-19999":"Unknown user","-19995":"Email is already taken","-19972":"Invalid token","-19988":"Validation Error","-19984":"Invalid Session","-19976":"Wrong email or password","-19958":"Your member request is waiting approval from the site owner"},INTENTS:{LOGIN:"LOGIN",REGISTER:"REGISTER",UPDATE_USER:"UPDATE"},LABELS:{EMAIL:"Email",PASSWORD:"Password",RE_PASSWORD:"Retype password",REMEMBER_ME:"Remember Me"}},initialize:function(e,t,n){this.isVolatile=!0,n=n||{},this.parent(e,t,n),this._container=n.container},onSubmit:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"performSubmit")},getDisplayName:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"getDisplayName")},getSubHeaderElement:function(){LOG.reportError(wixErrors.MISSING_METHOD,this.className,"getSubHeaderElement")},reportAuthStatusChange:function(e,t){this._container.reportAuthStatusChange(e,t)},closeAndRedirect:function(){this._container.closeAndRedirect()},onCancel:function(){},_onFormError:function(e,t){var n=this._getErrorMessage(e);t?t.setError(n):this._container.onFormError(n)},_onFormSuccess:function(e){this._container.onFormSuccess(e)},_getErrorMessage:function(e){var t=this.ERR_MAP.GENERAL_ERR;if(e){var n=e.errorCode;if(n&&this.ERR_MAP[n]){t=this.ERR_MAP[n];var r=e.errorParams;if(r){var i=r.length||0;for(var s=0;s<i;s++)t=t.replace("{"+s+"}",r[s])}}else t=this.ERR_MAP.GENERAL_ERR+" ("+n+")";LOG.reportError("Site Members error - "+e.errorDescription+"("+e.errorCode+")")}return t},_bindRePasswordField:function(e){return e.argObject={label:this.LABELS.RE_PASSWORD,passwordField:!0},this._bindTextDataItem(e)},_bindPasswordField:function(e){return e.argObject={label:this.LABELS.PASSWORD,passwordField:!0},this._bindTextDataItem(e)},_bindEmailField:function(e){return e.argObject={label:this.LABELS.EMAIL},this._bindTextDataItem(e)},_bindTextDataItem:function(e){return e.dataItem=this.injects().Data.createDataItem({text:"",type:"Text"},"Text"),e}}}),define.oldComponent({name:"wysiwyg.viewer.components.sm.SMLogin",imports:[],skinParts:{email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},rememberMe:{type:"wysiwyg.viewer.components.inputs.CheckBoxInput",hookMethod:"_bindCheckBoxDataItem"}},Class:{Extends:"wysiwyg.viewer.components.sm.SMForm",_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rememberMeField=this._skinParts.rememberMe},onSubmit:function(){var e=this._emailField._data.get("text"),t=this._passwordField._data.get("text"),n=this._rememberMeField._data.get("value");this._validateFields(e,t)&&this.injects().SiteMembers.login(e,t,n,this._onFormSuccess,this._onFormError)},_validateFields:function(e,t){return this._passwordField.setValidationState(!0),this._emailField.setValidationState(!0),e?this.injects().Utils.isValidEmail(e)?t?t.length<this.PASS_MIN_LEN||t.length>this.PASS_MAX_LEN?(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._passwordField),!1):!0:(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._passwordField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._emailField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._emailField),!1)},_onFormSuccess:function(e){this.closeAndRedirect()},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return"Login"},getButtonLabel:function(){return"GO"},getSubHeaderElement:function(){var e=new Element("DIV");return e.set("html","Or <a>Sign up</a>"),{el:e,intent:this.INTENTS.REGISTER}},_bindCheckBoxDataItem:function(e){return e.dataItem=this.injects().Data.createDataItem({value:"false",type:"Boolean"},"Boolean"),e.dataItem.setMeta("isPersistent",!1),e.argObject={label:this.LABELS.REMEMBER_ME},e}}}),define.oldComponent({name:"wysiwyg.viewer.components.sm.SMProfile",imports:[],skinParts:{name:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindTextDataItem"}},Class:{Extends:"wysiwyg.viewer.components.sm.SMForm",_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._nameField=this._skinParts.name},onSubmit:function(){var e=this._nameField._data.get("text");this._validateFields(e)&&this.injects().SiteMembers.updateMemberDetails({name:e},this._onFormSuccess,this._onFormError)},_validateFields:function(e){return!0},onCancel:function(){this.fireEvent("cancel")},getDisplayName:function(){return"Update your details"},getButtonLabel:function(){return"Update"},getSubHeaderElement:function(){var e=new Element("DIV");return{el:e}}}}),define.oldComponent({name:"wysiwyg.viewer.components.sm.SMRegister",imports:[],skinParts:{email:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindEmailField"},password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindPasswordField"},re_password:{type:"wysiwyg.viewer.components.inputs.TextInput",hookMethod:"_bindRePasswordField"}},Class:{Extends:"wysiwyg.viewer.components.sm.SMForm",_onAllSkinPartsReady:function(){this._emailField=this._skinParts.email,this._passwordField=this._skinParts.password,this._rePasswordField=this._skinParts.re_password},onSubmit:function(){var e=this._emailField._data.get("text"),t=this._passwordField._data.get("text"),n=this._rePasswordField._data.get("text");this._validateFields(e,t,n)&&this.injects().SiteMembers.register(e,t,this._onFormSuccess,this._onFormError)},_validateFields:function(e,t,n){return this._passwordField.setValidationState(!0),this._rePasswordField.setValidationState(!0),this._emailField.setValidationState(!0),e?this.injects().Utils.isValidEmail(e)?t?t.length<this.PASS_MIN_LEN||t.length>this.PASS_MAX_LEN?(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_LENGTH",errorParams:[this.PASS_MIN_LEN,this.PASS_MAX_LEN]},this._passwordField),!1):t!=n?(this._rePasswordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_RETYPE"},this._rePasswordField),!1):!0:(this._passwordField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_PASSWORD_BLANK"},this._passwordField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_INVALID"},this._emailField),!1):(this._emailField.setValidationState(!1),this._onFormError({errorCode:"VAL_ERR_EMAIL_BLANK"},this._emailField),!1)},_onFormSuccess:function(e){this.closeAndRedirect()},onCancel:function(){this.reportAuthStatusChange(!1,{cancel:!0})},getDisplayName:function(){return"Sign up"},getButtonLabel:function(){return"GO"},getSubHeaderElement:function(){var e=new Element("DIV");return e.set("html","I already have a user, <a>Login</a>"),{el:e,intent:this.INTENTS.LOGIN}}}}),define.component("wysiwyg.viewer.components.tpapps.TPABase",function(e){var t=e;t.inherits("wysiwyg.viewer.components.IFrameComponent"),t.resources(["W.Config","W.Viewer"]),t.traits(["wysiwyg.viewer.components.traits.TPAHandlers"]),t.skinParts({iframe:{type:"htmlElement"}}),t.binds(["_handlePageNavigationChange","_onIframeLoad"]),t.dataTypes([]),t.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],MIN_SIZE:{w:100,h:100},EDITOR_META_DATA:{general:{settings:!0,design:!1},custom:[{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}],dblClick:{label:"APPS_SETTINGS_APPS",command:"WEditorCommands.OpenTPASettingsDialog"}},_Events:{EDIT_MODE_CHANGE:"WPreviewCommands.WEditModeChanged",PAGE_NAVIGATION_CHANGE:"pageTransitionEnded",SITE_PUBLISHED:"WEditorCommands.Publish",COMPONENT_DELETED:"COMPONENT_DELETED",APP_MESSAGE:"SETTINGS_UPDATED"},isTpa:!0}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this._initialized=!1,this._appIsAlive=!1,this.setMinW(this.MIN_SIZE.w),this.setMinH(this.MIN_SIZE.h),this.addEvent("resizeEnd",this._onResizeEnd),this._startTime=new Date},isPremiumApp:function(){return!!this._appData&&!!this._appData.vendorProductId},isDemoMode:function(){return!!this._appData&&!!this._appData.demoMode},_onAllSkinPartsReady:function(){this._skinParts.iframe.addEvent("load",this._onIframeLoad),this.addEventListeners()},_onIframeLoad:function(){this._loadTime=(new Date).getMilliseconds()-this._startTime.getMilliseconds(),this.injects().TPA.reportLoadStart(this)},setIFrameSrc:function(e){e?(this._startTime=new Date,this.parent(e)):this.injects().TPA.showAppNotAvailable(this)},setUrl:function(e){this._iframe.src=e},showErrorPage:function(){this._skinParts.iframe.removeEvent("load",this._onIframeLoad),this.setUrl(this.resources.W.Config.getServiceTopologyProperty("scriptsRoot")+"/html/external/appNotResponding.html")},render:function(){this.parent()},onDataInitialized:function(e){},onPageVisibilityChange:function(e,t){e&&this.fireEvent(this._Events.PAGE_NAVIGATION_CHANGE,t._compId)},addEventListeners:function(){this.injects().Commands.registerCommandListenerByName(this._Events.EDIT_MODE_CHANGE,this,function(){this.handleAddEventListener.apply(this,[this._Events.EDIT_MODE_CHANGE])}),this.injects().Viewer.addEvent(this._Events.PAGE_NAVIGATION_CHANGE,this._handlePageNavigationChange),this.resources.W.Viewer.getViewMode()!=="site"&&window.parent.W.Commands.registerCommandListenerByName(this._Events.SITE_PUBLISHED,this,function(){this.handleAddEventListener.apply(this,[this._Events.SITE_PUBLISHED])})},passAppMessage:function(e){this.handleAddEventListener(this._Events.APP_MESSAGE,e)},handleAddEventListener:function(e,t){var n,r={intent:"addEventListener",eventType:"",params:{}};switch(e){case"WPreviewCommands.WEditModeChanged":n="EDIT_MODE_CHANGE",r.params={editMode:this._getCurrentEditMode()};break;case"pageTransitionEnded":n="PAGE_NAVIGATION_CHANGE",r.params=this._getPageParameters(t);break;case"WEditorCommands.Publish":n="SITE_PUBLISHED";break;case this._Events.COMPONENT_DELETED:n=e;break;case this._Events.APP_MESSAGE:n=e,r.params=t}r.eventType=n;if(this._skinParts.iframe){msgStr="";try{msgStr=JSON.stringify(r)}catch(i){return}this._skinParts.iframe.contentWindow.postMessage(msgStr,"*")}},setQueryParams:function(e){this._queryParams=e},isAppAlive:function(){return this._appIsAlive},getAppDefinitionId:function(){return this._appDefinitionId},getApplicationId:function(){return this._data&&this._data.get("applicationId")},getAppData:function(){return this._appData},getSectionURL:function(){return this.injects().TPA.getSectionURL(this._applicationId)},forceRender:function(){this.getIsDisplayed()&&this._renderIframe(!0)},dispose:function(e){e?this.parent():(this.handleAddEventListener.apply(this,[this._Events.COMPONENT_DELETED]),this.injects().Viewer.removeEvent(this._Events.PAGE_NAVIGATION_CHANGE,this._handlePageNavigationChange),this.injects().TPA.getComponentRegistrar().unregister(this),this._view.setStyle("display","none"),this._isSelectable=!1,setTimeout(function(){this.dispose(!0)}.bind(this),500))},refreshAppData:function(){this._extractAppData()},_handlePageNavigationChange:function(e){var t=$$("#"+e)[0].getLogic(),n=t.getPageComponents().map(function(e){return e._compId}).indexOf(this._compId)>-1;(this.getIsDisplayed()||n)&&this.handleAddEventListener(this._Events.PAGE_NAVIGATION_CHANGE,t)},_getPageParameters:function(e){var t={pageName:e._data._data.title,pageId:e._compId,pageUrl:""},n=this._getSiteBaseUrl();return t.pageUrl=n!=""?n+"#!"+t.pageName+"/"+t.pageId:"",t},_getCurrentEditMode:function(){return window.top.W.Editor.getEditMode()=="PREVIEW"?"preview":"editor"},_addCustomQueryString:function(e){if(this._queryParams){var t="";return Object.each(this._queryParams,function(e,n){t+="&"+n+"="+encodeURIComponent(e)}),delete this._queryParams,e+t}return e},_onDataChange:function(e){this._initializeWithData()},_extractAppData:function(){this._applicationId=this._data.get("applicationId"),this._appData=this.injects().Viewer.getAppDataHandler().getAppData(this._applicationId);if(!this._appData&&W.Viewer.getViewMode()!=="site"){this._appDefinitionId=this._data.get("appDefinitionId");if(this._appDefinitionId){var e=this.isWidget?W.AppStoreManager.TPA_WIDGET:W.AppStoreManager.TPA_SECTION,t=this._data.get("widgetId");window.parent.W.AppStoreManager.provisionApp(e,this._appDefinitionId,t,function(e){this.injects().Preview.getPreviewManagers().Viewer.getAppDataHandler().registerAppData(e),this.forceRender()}.bind(this))}}else this._appDefinitionId=this._appData.appDefinitionId},_initializeWithData:function(){if(this._initialized)return;this._extractAppData(),this.injects().Viewer.isPublicMode()&&LOG.reportEvent(wixEvents.APPS_FLOW_APP_LOADED_ON_VIEWER,{g1:this._appDefinitionId+" "+window.location.href,i1:this._applicationId}),this.injects().TPA.getComponentRegistrar().register(this),this._initialized=!0,this.onDataInitialized(this._appData)},_editModeChanged:function(e,t){this._editMode=e},_onResize:function(){this.isRendered()&&this._initialized&&this.parent()},_onResizeEnd:function(){this._appIsAlive&&this._skinParts&&this._renderIfReady(),this._wCheckForSizeChangeAndFireAutoSized(3)},_createIframe:function(){this._iframe=this._skinParts.iframe,this._setBasicIframeParams(),this._setIframeParams()}})}),define.oldComponent({name:"wysiwyg.viewer.components.tpapps.TPAFixedWidget",Class:{Extends:"wysiwyg.viewer.components.tpapps.TPAWidget",Static:{DEFAULT_COORDINATES:{top:"auto",left:"auto",bottom:"auto",right:"auto"}},Binds:[],initialize:function(e,t,n){this.parent(e,t,n),this._$top="auto",this._$left="auto",this._$bottom="auto",this._$right="auto"},initComponentLayout:function(){this._view.setStyle("visibility","visible"),this.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout);var e=["x","y","width","height"],t=0;for(t;t<e.length;t++){var n=e[t],r=this._view.get(n);if(r!=null&&r!=""){var i="set"+n.capitalize();this[i](r,!0)}}this._view.setStyle("position","fixed"),this.saveCurrentDimensions(),this.saveCurrentCoordinates()},getLayoutMode:function(){return"FIXED"},_setCssPosition:function(e,t){var n=e=="auto"||!e&&isNaN(e),r=["top","left","bottom","right"],i="px";if(!r.contains(t)){W.Utils.debugTrace("fixedPositionComponent","_setCssPostion",t+" passed as "+e);return}e&&e.split&&(i=e.split(parseInt(e,10)).join(""),i!=="%"&&(i="px")),e=n?"auto":parseInt(e,10);if(this["_$"+t]!=e){if(!n&&isNaN(e)){W.Utils.debugTrace("fixedPositionComponent","set"+t,"NaN passed as value");return}this["_$"+t]=e+i,this._view.setStyle(t,e+i),t=="left"&&(this._$x=n||i=="%"?this._view.getPosition().x:e),t=="top"&&(this._$y=n||i=="%"?this._view.getPosition().y:e),this.onMovement()}},setX:function(e){this.setLeft(e),this.setRight("auto")},setY:function(e){this.setTop(e),this.setBottom("auto")},getRight:function(){return this._$right},setRight:function(e){this._setCssPosition(e,"right")},getBottom:function(){return this._$bottom},setBottom:function(e){this._setCssPosition(e,"bottom")},getLeft:function(){return this._$left},setLeft:function(e){this._setCssPosition(e,"left");if(e==="50%"){var t=this.getWidth()/2;this._view.setStyle("margin-left",-t)}},setTop:function(e){this._setCssPosition(e,"top");if(e==="50%"){var t=this.getHeight()/2;this._view.setStyle("margin-top",-t)}},setWidth:function(e,t,n){var r,i,s=e;this._isPercent(e)&&(r=parseFloat(e)/100,i=window.getSize().x,s=Math.round(i*r)),this.parent(s,t,n)},setHeight:function(e,t,n){var r,i,s=e;this._isPercent(e)&&(r=parseFloat(e)/100,i=window.getSize().y,s=Math.round(i*r)),this.parent(s,t,n)},setPosition:function(e,t,n,r){this.setTop(e),this.setLeft(t),this.setBottom(n),this.setRight(r)},setCoordinates:function(e){return e=Object.merge(this.DEFAULT_COORDINATES,e||{}),this.setWidth(e.x||0,!1,!1),this.setHeight(e.y||0,!1,!1),this.setTop(e.top),this.setLeft(e.left),this.setBottom(e.bottom),this.setRight(e.right),e},_onAutoSized:function(e){this.fireEvent("autoSizeChange")},_isPercent:function(e){return typeof e=="string"&&e.split(parseFloat(e)).join("")=="%"}}}),define.oldComponent({name:"wysiwyg.viewer.components.tpapps.TPAModal",Class:{Extends:"wysiwyg.viewer.components.tpapps.TPAWidget",Binds:["_onDispose"],Static:{DEFAULT_URL:"http://sslstatic.wix.com/services/js-sdk/1.16.0/html/modal.html"},skinParts:{blockingLayer:{type:"htmlElement"},dialog:{type:"htmlElement"},x:{type:"htmlElement"}},initialize:function(e,t,n){this.parent(e,t,n),n=n||{},this._rawUrl=n.url||this.DEFAULT_URL,this._url=null,this._width=n.width,this._height=n.height,this.isVolatile=!0},getAcceptableDataTypes:function(){return["TPAWidget","TPA"]},_onAllSkinPartsReady:function(){this._skinParts.x.addEvent("click",this._onDispose),this._skinParts.blockingLayer.addEvent("click",this._onDispose)},render:function(){if(this._width>0){var e=this._width/2;this._skinParts.dialog.setStyles({width:this._width,"margin-left":-e})}if(this._height>0){var t=this._height/2;this._skinParts.dialog.setStyles({height:this._height,"margin-top":-t})}this.parent()},_getUrl:function(){var e=this._url;return e||(e=W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData)),e},_onDispose:function(){this._view.dispose()},_onEditModeChanged:function(){this._onDispose()},handleCloseWindow:function(){this.dispose()}}}),define.component("wysiwyg.viewer.components.tpapps.TPAPlaceholder",function(e){var t=e;t.inherits("wysiwyg.viewer.components.WPhoto"),t.skinParts({img:{type:"core.components.image.ImageNew",dataRefField:"*"}}),t.fields({propertiesSchemaName:"WPhotoProperties",EDITOR_META_DATA:{general:{title:"App Placeholder",settings:!0,design:!1},custom:[{label:"SIDE_BTN_MARKET",command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.Market",commandParameterDataRef:"SELF"}}})}),define.oldComponent({name:"wysiwyg.viewer.components.tpapps.TPAPopup",Class:{Extends:"wysiwyg.viewer.components.tpapps.TPAFixedWidget",Binds:["_onResize","_onDispose"],Static:{FIXED_OFFSET:2,MIN_EDGE_SIZE:50},initialize:function(e,t,n){this.parent(e,t,n),n=n||{},this._rawUrl=n.url,this._url=null,this._popupSize=n.popupSize?n.popupSize:{x:n.width,y:n.height},this._origin=n.origin||"",this._placement=n.placement||"CENTER",this._openPosition=n.openPosition||{top:0,left:0},this._openSize=n.openSize,this.isVolatile=!0,this._origPopupSize=this._popupSize},getAcceptableDataTypes:function(){return["TPAWidget","TPA"]},_onAllSkinPartsReady:function(){this._skinParts.x&&this._skinParts.x.addEvent("click",this._onDispose)},render:function(){var e=this.calcCoordinates();this.setCoordinates(e),this.parent()},calcCoordinates:function(){var e={};switch(this._origin){case"RELATIVE":e=Object.merge(this._getRelativeCoords(),this._popupSize),e=this._applyRelativeOffsets(e),e=this._validateRelativeCoordinates(e);break;case"FIXED":default:e=Object.merge(this._getFixedCoords(),this._popupSize),e=this._applyFixedOffsets(e),e=this._validateFixedCoordinates(e)}return e.x||(e.x=200),e.y||(e.y=200),e=this._validateMinSize(e),e=this._validateNegtaivePosition(e),e},_validateMinSize:function(e){if(e.x<=this.MIN_EDGE_SIZE||e.y<=this.MIN_EDGE_SIZE)e=this._fallbackToCenterMin(e);return e},_validateNegtaivePosition:function(e){if(typeof e.top=="number"&&e.top<0||typeof e.left=="number"&&e.left<0||typeof e.bottom=="number"&&e.bottom<0||typeof e.right=="number"&&e.right<0)e=this._fallbackToCenterMin(e);return e},_validateFixedCoordinates:function(e){var t=window.getWidth(),n=window.getHeight();return e.x>=t&&(e.y=t-this.FIXED_OFFSET*2),e.y>=n&&(e.y=n-this.FIXED_OFFSET*2),e},_validateRelativeCoordinates:function(e){return e=this._validateMaxSizeLimit(e),this._isTop()||this._isBottom()?e=this._getVerticalCroppedCoords(e):this._isCenter()&&(e=this._getCenterCroppedCoords(e)),this._getFixedWidthHeightCoords(e)},_getFixedWidthHeightCoords:function(e){for(var t in e)if(e[t]<0&&t!="x"&&t!="y"){if(t==="top"||t==="botom")e.y=e.y+e[t];if(t==="right"||t==="left")e.x=e.x+e[t];e[t]=0}return e},_fallbackToCenterMin:function(e){return e.top="50%",e.left="50%",e.x=this._origPopupSize.x,e.y=this._origPopupSize.y,this._validateMaxSizeLimit(e)},_getVerticalCroppedCoords:function(e){var t=window.getWidth(),n=window.getHeight();if(this._isTop()){var r=this._openPosition.y>this._popupSize.y;r||(e.y=this._openPosition.y-this.FIXED_OFFSET*2,e.top=this.FIXED_OFFSET)}else if(this._isBottom()){var r=n-(this._openPosition.y+this._openSize.y)>this._popupSize.y;r||(e.y=n-(this._openPosition.y+this._openSize.y)-this.FIXED_OFFSET*2)}if(this._isRight()){var i=t-(this._openPosition.x+this._openSize.x)>this._popupSize.x;i||(e.x=t-(this._openPosition.x+this._openSize.x)-10)}else if(this._isLeft()){var i=t-(this._openPosition.x-this._popupSize.x)>this._popupSize.x;i||(e.x=t-this._openPosition.x,e.left=this._openPosition.x-e.x)}else if(this._isCenter()){var i=t-this._openPosition.x>this._popupSize.x;i||(e.x=t-this._openPosition.x),e.left=e.left=this._openPosition.x-e.x/2+this._openSize.x/2}return e},_applyRelativeOffsets:function(e){return this._isTop()&&(e.top-=this.FIXED_OFFSET),this._isBottom()&&(e.top+=this.FIXED_OFFSET),this._isLeft()&&(e.left-=this.FIXED_OFFSET),this._isRight()&&(e.left+=this.FIXED_OFFSET),e},_applyFixedOffsets:function(e){return this._isTop()&&(e.top+=this.FIXED_OFFSET),this._isBottom()&&(e.top+=this.FIXED_OFFSET),this._isLeft()&&(e.left+=this.FIXED_OFFSET),this._isRight()&&(e.left+=this.FIXED_OFFSET),e},_getCenterCroppedCoords:function(e){return e},_validateMaxSizeLimit:function(e){var t=window.getWidth()/2,n=window.getHeight()/2;return e.x=e.x%t==e.x?e.x:t,e.y=e.y%n==e.y?e.y:n,e},_onDispose:function(){this._view.dispose()},_onEditModeChanged:function(){this._onDispose()},_getFixedCoords:function(){var e={};switch(this._placement){case"TOP_LEFT":e={left:0,top:0};break;case"TOP_RIGHT":e={right:0,top:0};break;case"BOTTOM_RIGHT":e={right:0,bottom:0};break;case"BOTTOM_LEFT":e={left:0,bottom:0};break;case"TOP_CENTER":e={top:0,left:"50%"};break;case"CENTER_RIGHT":e={top:"50%",right:0};break;case"BOTTOM_CENTER":e={bottom:0,left:"50%"};break;case"CENTER_LEFT":e={left:0,top:"50%"};break;default:e={top:"50%",left:"50%"}}return e},_getRelativeCoords:function(){var e={},t=this._openPosition,n=this._openSize,r=this._popupSize,i=t.x,s=t.y,o=n.x,u=n.y,a=r.x,f=r.y;switch(this._placement){case"TOP_LEFT":e={top:s-f,left:i-a};break;case"TOP_RIGHT":e={top:s-f,left:i+o};break;case"BOTTOM_RIGHT":e={top:s+u,left:i+o};break;case"BOTTOM_LEFT":e={top:s+u,left:i-a};break;case"TOP_CENTER":e={top:s-f,left:this._getRelativeCenterLeft(i,o,a)};break;case"CENTER_RIGHT":e={top:this._getRelativeCenterTop(s,u,f),left:i+o};break;case"BOTTOM_CENTER":e={top:s+u,left:this._getRelativeCenterLeft(i,o,a)};break;case"CENTER_LEFT":e={top:this._getRelativeCenterTop(s,u,f),left:i-a};break;default:e={top:this._getRelativeCenterTop(s,u,f),left:this._getRelativeCenterLeft(i,o,a)}}return e},_getRelativeCenterTop:function(e,t,n){return e+t/2-n/2},_getRelativeCenterLeft:function(e,t,n){return e+t/2-n/2},_getUrl:function(){var e=this._url;return e||(e=W.TPA.getURLBuilder().buildStateLessUrl(this._rawUrl,["instance","section-url","target","viewMode","locale","cacheKiller"],this,this._appData)),e},_onResize:function(){this.parent(),this._renderIfReady()},handleCloseWindow:function(){this.dispose()},_isTop:function(){return this._placement.indexOf("TOP")>=0},_isBottom:function(){return this._placement.indexOf("BOTTOM")>=0},_isLeft:function(){return this._placement.indexOf("LEFT")>=0},_isRight:function(){return this._placement.indexOf("RIGHT")>=0},_isCenter:function(){return this._placement.indexOf("CENTER")>=0}}}),define.component("wysiwyg.viewer.components.tpapps.TPASection",function(e){var t=e;t.inherits("wysiwyg.viewer.components.tpapps.TPABase"),t.dataTypes(["TPA"]),t.methods({isPage:!0,initialize:function(e,t,n){this.parent(e,t,n),this._resizableSides=[]},render:function(){this.parent()},onDataInitialized:function(e){var t=e.sectionRefreshOnWidthChange;t||this.removeEvent("resizeEnd",this._onResizeEnd)},_getUrl:function(e){if(e||!this._url){if(!this._initialized)return"";var t=this._appData.sectionUrl,n=this.injects().TPA.getURLBuilder().buildUrl(t,["instance","section-url","target","width","viewMode","locale","cacheKiller"],this,this._appData);this._url=this._addCustomQueryString(n)}return this._url},handleAppStateChanged:function(e){this.injects().Utils.hash.setHashExtData(e)},isDeleteable:function(){return!1},isDeleteableRecurse:function(){return!1},isDuplicatable:function(){return!1},canMoveToOtherScope:function(){return!1},isContainable:function(e){return!1}})}),define.component("wysiwyg.viewer.components.tpapps.TPAWidget",function(e){var t=e;t.inherits("wysiwyg.viewer.components.tpapps.TPABase"),t.dataTypes(["TPAWidget"]),t.methods({isWidget:!0,initialize:function(e,t,n){this.parent(e,t,n),this._isSelectable=!0},getWidgetId:function(){return this._data.get("widgetId")},onDataInitialized:function(e){var t=this.getWidgetId(),n=this.injects().Viewer.getAppDataHandler(),r=n.getWidgetProperty(this._applicationId,t,"refreshOnWidthChange");r||this.removeEvent("resizeEnd",this._onResizeEnd)},_getUrl:function(e){if(e||!this._url){var t=this.getWidgetId(),n=this.injects().Viewer.getAppDataHandler().getWidgetData(this._applicationId,t),r=n.widgetUrl,i=this.injects().TPA.getURLBuilder().buildStateLessUrl(r,["instance","section-url","target","width","viewMode","locale","cacheKiller"],this,this._appData);this._url=this._addCustomQueryString(i)}return this._url},handleAppStateChanged:function(){},handleClosePopup:function(){},setIFrameSrc:function(e){this._iframe.src=e,this._url=this._iframe.src},isSelectable:function(){return this._isSelectable},isDeleteableRecurse:function(){return!0}})}),define.oldTrait({name:"wysiwyg.viewer.components.traits.GalleryAutoplay",trait:{Binds:["_onComponentReady","_onMouseDown","_autoplayCallback","_onPropertyChanged","_onTransitionFinished","_onModeChange","_onMediaZoomClosed","_onMediaZoomOpened","_getDirection"],_autoplayOn:!1,_timeoutID:null,_suppressAutoplay:!1,initialize:function(){this._states.slideshow=["autoplayOn","autoplayOff"],this.addEvent(Constants.ComponentEvents.RENDER,this._onComponentRender),this.addEvent(Constants.ComponentEvents.READY,this._onComponentReady),this.injects().Viewer.getPreviewMode()===!0&&(this._suppressAutoplay=!0,this.injects().Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onModeChange)),this.injects().Commands.registerCommandListenerByName("WViewerCommands.MediaZoom.Close",this,this._onMediaZoomClosed),this.injects().Commands.registerCommandListenerByName("WViewerCommands.OpenZoom",this,this._onMediaZoomOpened)},_onComponentReady:function(){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._updateAutoplayState()},_onComponentRender:function(){this._properties.addEvent(Constants.DataEvents.DATA_CHANGED,this._onPropertyChanged),this.addEvent("transitionFinished",this._onTransitionFinished),this._skinParts.autoplay&&(this._skinParts.autoplay.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),this._skinParts.autoplay.setStyle("cursor","pointer"),this._checkAutoPlaySkinPartsVisibility())},_onModeChange:function(e){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._suppressAutoplay=e!="PREVIEW",this._updateAutoplayState()},_onMediaZoomOpened:function(){this._lastAutoplayState=this._autoplayOn,this._suppressAutoplay=!0,this._updateAutoplayState()},_onMediaZoomClosed:function(){this._suppressAutoplay=!1,this._autoplayOn=this._lastAutoplayState===!0,this._updateAutoplayState()},_validateHostComponent:function(){var e=this.getComponentProperties().getSchema();this._skinPartsSchema.hasOwnProperty("autoplay")||this._validationErr("Must require 'autoplay' skinPart."),e.hasOwnProperty("autoplay")||this._validationErr("Must contain 'autoplay' among the component properties."),e.hasOwnProperty("autoplayInterval")||this._validationErr("Must contain 'autoplayInterval' among the component properties."),typeOf(this["gotoNext"])!="function"&&this._validationErr("Host component must implement gotoNext() method.")},_validationErr:function(e){throw new Error("GalleryAutoplay trait's host component validation failed. "+e)},_onMouseDown:function(e){this._toggleAutoplay()},_toggleAutoplay:function(){this._autoplayOn=!this._autoplayOn,this._updateAutoplayState()},_updateAutoplayState:function(){this._suppressAutoplay&&(this._autoplayOn=!1),this.setState(this._autoplayOn?"autoplayOn":"autoplayOff","slideshow"),this._startAutoplayTimer()},_getAutoplayInterval:function(){var e=parseFloat(this.getComponentProperty("autoplayInterval")),t=parseFloat(this.getComponentProperty("transDuration")),n=Math.floor(e*1e3);return n},_startAutoplayTimer:function(){this._timeoutID!=null&&(clearTimeout(this._timeoutID),this._timeoutID=null),this._autoplayOn&&(this._timeoutID=setTimeout(this._autoplayCallback,this._getAutoplayInterval()))},_autoplayCallback:function(){this._getDirection()=="LTR"?this.gotoPrev():this.gotoNext()},_onPropertyChanged:function(){this._autoplayOn=this.getComponentProperty("autoplay")===!0,this._updateAutoplayState(),this._checkAutoPlaySkinPartsVisibility()},_checkAutoPlaySkinPartsVisibility:function(){this._skinParts&&this._skinParts.autoplay&&this._skinParts.autoplay.setStyle("visibility",this.getComponentProperty("showAutoplay")?"visible":"hidden")},_onTransitionFinished:function(){this._startAutoplayTimer()},_getDirection:function(){return this.getComponentProperties().getData().autoPlayDirection}}}),define.oldTrait({name:"wysiwyg.viewer.components.traits.ListIterator",trait:{_currentItemIndex:0,_oldItem:null,_currentItem:null,_numItems:-1,_locked:!1,_lastCommand:"",lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return this._locked},setListAndCurrentIndex:function(e,t){this._numItems=e.get("items").length,this._currentItemIndex=t,this._onCurrentItemChanged()},resetIterator:function(){this._currentItemIndex=0,this._numItems=-1,this._locked=!1,this._lastCommand="",this._currentItem=null},_onCurrentItemChanged:function(){this._oldItem=this._currentItem,this._currentItem=this.getDataItem().getData().items[this._currentItemIndex],this.fireEvent("currentItemChanged")},gotoPrev:function(){this._locked||(this._lastCommand="prev",this._currentItemIndex=this._getPrevItemIndex(),this._onCurrentItemChanged())},gotoNext:function(){this._locked||(this._lastCommand="next",this._currentItemIndex=this._getNextItemIndex(),this._onCurrentItemChanged())},_getNextItemIndex:function(){var e=this._currentItemIndex;return e++,e>=this._numItems&&(e=0),e},_getPrevItemIndex:function(){var e=this._currentItemIndex;return e--,e==-1&&(e=this._numItems-1),e}}}),define.Class("wysiwyg.viewer.components.traits.TPAHandlers",function(e){var t=e;t.inherits("wysiwyg.viewer.components.traits.TPAHandlersBase"),t.statics({DEFAULTS:{POPUP_COORDINATES:{NORMAL:{top:"auto",left:"auto",bottom:"auto",right:"auto",width:500,height:500},MODAL:{top:"50%",left:"50%",bottom:"auto",right:"auto",width:500,height:500}}}}),t.resources(["W.Components","W.Data"]),t.binds(["handleSiteInfo"]),t.methods({initialize:function(){this._datam=this.resources.W.Data},handleHeightChanged:function(e){this.handleChangeAppSize({height:e})},handleResizeWindow:function(e){if(this.injects().Viewer.isPublicMode()||this.injects().Viewer.getEditorMode()==="PREVIEW")e.width=null,e.w=null,e.x=null;this._changeSize(e)},handleChangeAppSize:function(e){this.handleResizeWindow(e)},handleAppSettingsClose:function(e){this.handleCloseWindow(e)},_getMetadataParameter:function(e,t){var n=$$("meta["+(t||"name")+"='"+e+"']"),r="";if(n&&n.length>0){var i=n.get("content");i.length>0&&(r=i[0])}return r},handleOpenPopup:function(e,t){var n=this.injects().Viewer.getSiteNode(),r,i,s,o,u;i="wysiwyg.viewer.components.tpapps.TPAPopup",s="wysiwyg.viewer.skins.TPAPopupSkin",u=this._data,o=this._getPopupArgs(e),r=this.resources.W.Components.createComponent(i,s,u,o,null,null),r.insertInto(n)},_getPopupArgs:function(e){var t=this.isPage?"FIXED":e.position.origin;return{dataItem:this._data,url:e.url,origin:e.position.origin,placement:e.position.placement,openPosition:this._view.getPosition(),openSize:this._view.getSize(),popupSize:{x:e.width||200,y:e.height||200}}},_getModalCoords:function(e,t){return Object.merge(this.DEFAULTS.POPUP_COORDINATES.MODAL,{width:e,height:t}||{})},handleOpenModal:function(e){var t=this.injects().Viewer.getSiteNode();this._clearModals(t);var n,r,i,s,o;r="wysiwyg.viewer.components.tpapps.TPAModal",i="wysiwyg.viewer.skins.TPAModalSkin",o=this._data,s={url:e.url,width:e.width,height:e.height},n=this.resources.W.Components.createComponent(r,i,o,s,null,null),n.insertInto(t)},handleGetSitePages:function(e){var t=this.resources.W.Data.getDataByQuery("#MAIN_MENU"),n=t.getItems()||[],r=this._getSitePages(n);e.callback(r)},handleNavigateToPage:function(e){if(!e.msgData.pageId||this.resources.W.Viewer.getViewMode()==="editor")return;this.resources.W.Viewer.goToPage(e.msgData.pageId)},_handleOpenPopup:function(e,t,n){var r=this.injects().Viewer.getSiteNode();this._clearModals(r);var i,s,o,u,a;s="wysiwyg.viewer.components.tpapps.TPAPopup",o="wysiwyg.viewer.skins.TPAPopupSkin",a=this._data,u={url:e,width:n.width,height:n.height},i=this.resources.W.Components.createComponent(s,o,a,u,null,null),i.insertInto(r)},handleSmRequestLogin:function(e){var t=this.injects().SiteMembers;t.isServiceProvisioned()&&(t.isApiReady()?this.injects().Commands.executeCommand("WViewerCommands.SiteMembers.Open",{form:"login",authCallback:e.callback}):this.callLater(this.handleSmRequestLogin,e))},handleSmCurrentMember:function(e){var t=this.injects().SiteMembers;t.getMemberDetails(function(t){e.callback(t)},function(t){e.callback(null)})},_clearModals:function(e){var t=e.getChildren("[comp=wysiwyg.viewer.components.tpapps.TPAModal]");t.dispose()}})}),define.Class("wysiwyg.viewer.components.traits.TPAHandlersBase",function(e){var t=e;t.resources(["W.Config","W.Commands","W.Viewer","W.Utils","W.Data"]),t.methods({_appIsAlive:!1,initialize:function(){if(!this._changeSize)return new Error("Must... Implement... _changeSize...");this._isAliveTime=0,this._isAliveCounter=0},handleAppIsAlive:function(){this._appIsAlive=!0,this._isAliveTime=new Date,this._isAliveCounter++},handleSiteInfo:function(e){var t=this._getSiteSEOParams();t.pageTitle=this._getCurrentPageName(),t.referer=document.referrer,t.url=location.href,t.baseUrl=this._getSiteBaseUrl(),e.callback(t)},_getSitePages:function(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=this._getPageInfo(e[n]),s=e[n].get("items");for(var o=0,u=s.length;o<u;o++){var a=this._getPageInfo(s[o]);i.subPages=i.subPages||[],i.subPages.push(a)}t.push(i)}return t},_getPageInfo:function(e){var t={},n=e.get("refId"),r=this._datam.getDataByQuery(n);return t.title=r.get("title")||"",t.id=n.indexOf("#")===0?n.substr(1):n,t.hide=r.get("hidePage")||!1,t},_getSiteSEOParams:function(){var e=W.Viewer.getViewMode();switch(e){case"editor":return this._getSiteSEOParamsInEditMode();case"preview":return this._getSiteSEOParamsInPreviewMode();case"site":return this._getSiteSEOParamsInViewMode()}return{}},_getSiteBaseUrl:function(){var e=location.protocol+"//"+location.host+location.pathname;return W.Viewer.getViewMode()=="editor"?e=this.resources.W.Config.getUserPublicUrl():W.Viewer.getViewMode()=="preview"&&(window.parent.W.Config.siteNeverSavedBefore()?e="":e=window.parent.W.Config.getUserPublicUrl()||""),e},_getMetadataParameter:function(e,t){var n=$$("meta["+(t||"name")+"='"+e+"']"),r="";if(n&&n.length>0){var i=n.get("content");i.length>0&&(r=i[0])}return r},_getSiteSEOParamsInViewMode:function(){var e=$$("title");return e=e&&e[0]&&e[0].text,{siteTitle:e||"",siteDescription:this._getMetadataParameter("description")||"",siteKeywords:this._getMetadataParameter("keywords")||""}},_getSiteSEOParamsInPreviewMode:function(){var e=window.parent.W.Data.getDataByQuery("#SITE_SETTINGS"),t=e.getData()||{};return{siteTitle:t.siteTitleSEO||"",siteDescription:t.siteDescriptionSEO||"",siteKeywords:t.keywordsSEO||""}},_getSiteSEOParamsInEditMode:function(){var e=this.resources.W.Data.getDataByQuery("#SITE_SETTINGS"),t=e.getData()||{};return{siteTitle:t.siteTitleSEO||"",siteDescription:t.siteDescriptionSEO||"",siteKeywords:t.keywordsSEO||""}},_getCurrentPageName:function(){var e=null;try{var t=window.rendererModel?this.resources.W.Viewer:this.resources.W.Preview.getPreviewManagers().Viewer,n=t.getCurrentPageNode().getLogic().getDataItem();e=n.getData()}catch(r){return""}return e&&e.title||""}})}),define.oldTrait({name:"wysiwyg.viewer.components.traits.ValidationSettings",trait:{Static:{VALID_STATE_CHANGED_EVENT:"validStateChanged"},_isValid:!0,_validationFunction:function(e){return!0},initialize:function(e,t,n){this.parent(e,t,n),n.validationFunction&&this.setValidationFunction(n.validationFunction)},setValidationState:function(e){var t=this._isValid!=e;this._isValid=e,t&&this.fireEvent(this.VALID_STATE_CHANGED_EVENT,e)},setValidationFunction:function(e){this._validationFunction=e}}}),define.oldTrait({name:"wysiwyg.viewer.components.traits.VideoUtils",trait:{_videoUrl:{YOUTUBE:"http://youtu.be/",VIMEO:"http://vimeo.com/"},_getServices:function(){var e={YOUTUBE:{url:"http://www.youtube.com/embed/",getPreviewUrl:this._getYouTubePreviewUrl},VIMEO:{url:"http://player.vimeo.com/video/",getPreviewUrl:this._getVimeoPreviewUrl}};return e},_getYouTubePreviewUrl:function(e,t){var n="http://img.youtube.com/vi/[repLace]/0.jpg",r=n.replace("[repLace]",e);return t(r),r},_getVimeoPreviewUrl:function(e,t){var n="http://vimeo.com/api/v2/video/[repLace].json",r=n.replace("[repLace]",e),i=new Request.JSONP({url:r+"?"+"r="+Math.random(),onComplete:function(e){t(e[0].thumbnail_large)}});i.send()},_getYoutubeId:function(e){var t="",n=/(?:youtube\.com\/watch[^\s]*[\?&]v=)([\w-]+)/g,r=/(?:youtu\.be\/)([\w-]+)/g,i=n.exec(e)||r.exec(e);return i&&i.length&&i[1]&&(t=i[1]),t},_getVimeoId:function(e){var t="",n=/vimeo\.com\/(\d+)$/gi,r=n.exec(e);return r&&r.length&&r[1]&&(t=r[1]),t},_getVideoDataFromVideoUrl:function(e){var t=null,n=this._getYoutubeId(e);return n?t="YOUTUBE":(n=this._getVimeoId(e),n&&(t="VIMEO")),n&&t?{videoId:n,videoType:t}:{}},_getVideoUrlFromVideoData:function(e){var t=e.videoId,n=e.videoType;return!t||!n?"":this._videoUrl[n]+t}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.HomePageLogin",skinParts:{actionTitle:{type:"htmlElement"},memberTitle:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onStyleChange","_doLogout","_doLogin"],_states:["auth","no_auth"],Translations:{en:{SIGN_IN:"Login/Sign up",SIGN_OUT:"Log out",HELLO:"Hello"},de:{SIGN_IN:"Anmelden/Registrieren",SIGN_OUT:"Abmelden",HELLO:"Hallo"},es:{SIGN_IN:"Login/ Regístrate",SIGN_OUT:"Cerrar Sesión",HELLO:"Hola"},fr:{SIGN_IN:"Connexion/ Inscription",SIGN_OUT:"Déconnexion",HELLO:"Bonjour"},it:{SIGN_IN:"Accedi/Registrati",SIGN_OUT:"Esci",HELLO:"Ciao"},pl:{SIGN_IN:"Zaloguj się/Zarejestruj się",SIGN_OUT:"Wyloguj się",HELLO:"Witaj"},pt:{SIGN_IN:"Login/Registre-se",SIGN_OUT:"Sair",HELLO:"Olá"},ko:{SIGN_IN:"로그인/등록",SIGN_OUT:"로그아웃",HELLO:"안녕하세요?"},ja:{SIGN_IN:"ログイン/サインアップ",SIGN_OUT:"ログアウト",HELLO:"こんにちは"},ru:{SIGN_IN:"Логин/Вход",SIGN_OUT:"Выйти",HELLO:"Здравствуйте"}},initialize:function(e,t,n){this.parent(e,t,n),window.userApi&&(this._userApi=window.userApi)},_translate:function(e){var t="en";return this._userApi&&(t=this._userApi.getLanguage()),this.Translations[t][e]},_onStyleReady:function(){this.parent(),this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStyleChange)},_onStyleChange:function(){this._wCheckForSizeChangeAndFireAutoSized(10)},_onAllSkinPartsReady:function(){this._updateTextsAndEvents()},_doLogout:function(){var e=this._skinParts.actionTitle;e.removeEvent("click",arguments.callee),this.injects().Viewer.isPublicMode()?(this._userApi.logout(),window.location.href="http://www.wix.com"):this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this.getViewNode()},this)},_doLogin:function(){var e=this._skinParts.actionTitle;e.removeEvent("click",arguments.callee),this.injects().Viewer.isPublicMode()?this._openLoginDialog():this.injects().Commands.executeCommand("adminLogin.submitAttempt",{component:this.getViewNode()},this)},_updateView:function(e,t,n){var r=this._skinParts.actionTitle,i=this._skinParts.memberTitle;r.set("text",e),i.set("text",t),r.addEvent("click",n)},_updateTextsAndEvents:function(){var e=this._userApi;e&&e.isSessionValid()?(this._updateView(this._translate("SIGN_OUT"),this._translate("HELLO")+" "+e.getUserName(),this._doLogout),this.setState("auth")):(this._updateView(this._translate("SIGN_IN"),"",this._doLogin),this.setState("no_auth"))},_openLoginDialog:function(){var e=this._data.get("postLoginUrl"),t=this._data.get("postSignUpUrl"),n=this._data.get("startWith");e||(e=location.href),t||(t=location.href),window.animateForm.callForm([t,e,n,"HTML"])},getAcceptableDataTypes:function(){return["HomePageLogin"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.LanguagesDropDown",skinParts:{select:{type:"htmlElement"},options:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_initMenu","_populateDropDown","_updateSelection","_changeLanguage","_onFocus","_onBlur","_onOptionClick","_onKeyPress","_changeLanguageSuccess","_changeLanguageFailed"],Static:{CLASS_NAME_SELECTED:"selected",CLASS_NAME_OPTION_CONTAINER:"optionContainer"},_states:{mouse:["selected"]},initialize:function(e,t,n){this.parent(e,t,n),this._selectedOption=null,window.wixhomepage&&window.wixhomepage.languagesDropDownData?this._menuData=window.wixhomepage.languagesDropDownData:this._menuData=[{languageCode:"en",languageSubdomain:"www",iconURL:"",languageLabel:"English"},{languageCode:"de",languageSubdomain:"de",iconURL:"",languageLabel:"Deutsch"},{languageCode:"es",languageSubdomain:"es",iconURL:"",languageLabel:"Español"},{languageCode:"fr",languageSubdomain:"fr",iconURL:"",languageLabel:"Français"},{languageCode:"it",languageSubdomain:"it",iconURL:"",languageLabel:"Italiano"},{languageCode:"pl",languageSubdomain:"pl",iconURL:"",languageLabel:"Polski"},{languageCode:"pt",languageSubdomain:"pt",iconURL:"",languageLabel:"Português"},{languageCode:"ru",languageSubdomain:"ru",iconURL:"",languageLabel:"Pусский"}]},_onAllSkinPartsReady:function(){this._initMenu()},_initMenu:function(){this._populateDropDown(),this._skinParts.select.addEvent(Constants.CoreEvents.CHANGE,this._changeLanguage),this._skinParts.select.addEvent(Constants.CoreEvents.CLICK,this._onFocus),this._skinParts.options.addEvent(Constants.CoreEvents.CLICK,this._onOptionClick)},_onFocus:function(e){e.stopPropagation();if(this.getState("mouse")=="selected"){this._onBlur(e);return}this.setState("selected","mouse"),document.body.addEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.addEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress)},_onBlur:function(e){e.stopPropagation(),this.removeState("selected","mouse"),document.body.removeEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.removeEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress)},_onOptionClick:function(e){e=e||{};var t=e.target;while(t!==this._skinParts.options&&t.hasClass(this.CLASS_NAME_OPTION_CONTAINER)==0)t=t.parentNode;var n=t.getAttribute("data-subdomain"),r=t.getAttribute("data-languagecode"),i=this._getLanguage();this._setSelected(t),window.viewMode=="site"&&n&&r&&r!=i&&this._skinParts.select.fireEvent(Constants.CoreEvents.CHANGE,{value:n}),this._onBlur(e)},_onKeyPress:function(e){e.stopPropagation();switch(e.key){case"up":var t=this._selectedOption.getPrevious();t||(t=this._skinParts.options.getLast()),this._setSelected(t),e.preventDefault();break;case"down":this._setSelected(this._selectedOption.getNext()),e.preventDefault();break;case"enter":case"space":e.target=this._selectedOption,this._onOptionClick(e);break;case"esc":case"tab":this._onBlur(e)}},_setSelected:function(e){var t=this._skinParts.select,n=this._skinParts.options,r=this._skinParts.options.getElement("."+this.CLASS_NAME_SELECTED);r&&r.removeClass(this.CLASS_NAME_SELECTED),e=e||this._skinParts.options.getFirst(),e.addClass(this.CLASS_NAME_SELECTED),t.setAttribute("data-subdomain",e.getAttribute("data-subdomain")),t.setAttribute("data-languagecode",e.getAttribute("data-languagecode")),t.set("html",e.get("html"));var i=e.getPosition(n).y,s=n.getScroll().y;(i>n.getSize().y+s||i<0)&&n.scrollTo(0,i),this._selectedOption=e},_populateDropDown:function(){var e,t,n,r,i;this._skinParts.select.empty(),this._skinParts.options.empty();for(e=0,r=this._menuData.length;e<r;e++)this._insertOption(this._menuData[e]);this._updateSelection()},_insertOption:function(e){var t=new Element("li",{html:e.languageLabel}),n=new Element("image");t.addClass(this.CLASS_NAME_OPTION_CONTAINER),e.iconURL&&(n.setAttribute("src",e.iconURL),n.inject(t)),t.insertInto(this._skinParts.options),t.setAttribute("data-subdomain",e.languageSubdomain),t.setAttribute("data-languagecode",e.languageCode),t.addEvent(Constants.CoreEvents.CLICK,this._onOptionClick)},_getOptionBySubDomain:function(e){return this._skinParts.options.getElement('[data-subdomain="'+e+'"]')},_changeLanguageSuccess:function(){var e=this._skinParts.select.getAttribute("data-subdomain"),t=location.hostname.substring(location.hostname.indexOf(".")),n=location.protocol+"//"+e+t+location.pathname+location.search+location.hash;location.href.toLowerCase()==n.toLowerCase()?location.reload():location.href=n},_changeLanguageFailed:function(e){},_changeLanguage:function(){var e=this._skinParts.select.getAttribute("data-languagecode");window.userApi?window.userApi.setLanguage(e,this._changeLanguageFailed,this._changeLanguageSuccess):LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"LanguagesDropDown","_changeLanguage")()},_getLanguage:function(){return window.userApi?window.userApi.getLanguage():(LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"LanguagesDropDown","_getLanguage")(),"en")},_updateSelection:function(){var e;window.userApi?e=window.userApi.getLanguage():e="www";var t=this._getOptionBySubDomain(e);this._setSelected(t)},_removeAllDomEvents:function(){document.body.removeEvent(Constants.CoreEvents.CLICK,this._onBlur),document.body.removeEvent(Constants.CoreEvents.KEY_DOWN,this._onKeyPress)},dispose:function(){this._removeAllDomEvents(),this.parent()}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.WixHomepageMenu",skinParts:{buttonsContainer:{type:"htmlElement"},buttonTemplate:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_populateMenu","_getData"],_states:["topMenu","bottomMenu"],render:function(){this._getData(),this._populateMenu(),this._setMenuType()},_setMenuType:function(){var e=this._data.get("menuDataSource");this.setState(e)},_getData:function(){var e=this._data.get("menuDataSource"),t=this._getLanguage();window.wixhomepage&&window.wixhomepage[e]&&window.wixhomepage[e][t]?this._menuData=window.wixhomepage[e][t]:this._menuData=[{label:"Create",link:"/create/website"},{label:"Explore",link:"/sample/website"},{label:"Features",link:"/about/features"},{label:"My Account",link:"/create/my-account"},{label:"Premium",link:"/upgrade/website"},{label:"Support",link:"/support/"}]},_getLanguage:function(){return window.userApi?window.userApi.getLanguage():(LOG.reportError(wixErrors.USER_MANAGER_NOT_FOUND,"WixHomepageMenu","_getLanguage"),"en")},_insertButton:function(e){var t=this._skinParts.buttonTemplate.cloneNode(!0);t.setAttribute("isTemplate","false");var n=t.getElements(".buttonLink")[0];n.setAttribute("href",e.link),n.innerHTML=e.label,t.insertInto(this._skinParts.buttonsContainer)},_populateMenu:function(){var e;this._skinParts.buttonsContainer.empty();for(e=0,l=this._menuData.length;e<l;e++)this._insertButton(this._menuData[e])},getAcceptableDataTypes:function(){return["WixHomepageMenu"]}}}),define.oldComponent({name:"wysiwyg.viewer.components.wixhomepage.WixOfTheDay",imports:["core.components.image.ImageSettings"],skinParts:{img:{type:"core.components.image.ImageNew",dataRefField:"*"},introContainer:{type:"htmlElement"},descriptionContainer:{type:"htmlElement"},introPreTitle:{type:"htmlElement"},introTitle:{type:"htmlElement"},introText:{type:"htmlElement"},shortDescriptionText:{type:"htmlElement"},descriptionText:{type:"htmlElement"},readOn:{type:"htmlElement"},closeDescription:{type:"htmlElement"}},traits:["wysiwyg.common.components.traits.LinkableComponent"],Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onCloseDescriptionClicked","_onReadOnClicked","_renderTexts","_updateContainers"],Static:{},_states:["opened","closed"],Translations:{en:{INTRO_PRE_TITLE:"GET INSPIRED WITH",INTRO_TITLE:"OF THE DAY",INTRO_TEXT:"Everyday we feature an amazing new website built with Wix.<br>Want your website featured?<br>Submit your URL to wixofday@wix.com",READ_ON_BUTTON_LABEL:"Read on",CLOSE_DESCRIPTION_BUTTON_LABEL:"Close"},es:{INTRO_PRE_TITLE:"Inspírate con el",INTRO_TITLE:"del día!",INTRO_TEXT:"Todos los días te presentamos un increíble sitio creado con Wix.<br>¿Quieres que tu sitio aparezca aquí?<br>Envíanos tu URL a wixofday@wix.com",READ_ON_BUTTON_LABEL:"Leer Más",CLOSE_DESCRIPTION_BUTTON_LABEL:"Cerrar"},fr:{INTRO_PRE_TITLE:"Inspirez-vous du",INTRO_TITLE:"du Jour!",INTRO_TEXT:"Nous exposons chaque jour le meilleur site créé avec Wix.<br>Vous voulez que votre site soit exposé?<br>Envoyez votre URL à wixofday@wix.com",READ_ON_BUTTON_LABEL:"En lire plus",CLOSE_DESCRIPTION_BUTTON_LABEL:"Fermer"},it:{INTRO_PRE_TITLE:"Lasciati ispirare dal",INTRO_TITLE:"del giorno!",INTRO_TEXT:"Ogni giorno presentiamo un sito spettacolare creato con Wix.<br>Vuoi che anche il tuo sito venga preso in considerazione?<br>Inviaci il tuo URL a wixofday@wix.com",READ_ON_BUTTON_LABEL:"Continua a leggere",CLOSE_DESCRIPTION_BUTTON_LABEL:"Chiudi"},pl:{INTRO_PRE_TITLE:"Zainspiruj sie",INTRO_TITLE:"EM DNIA!",INTRO_TEXT:"Kazdego dnia prezentujemy nowa, niesamowita witryne zbudowana z Wix.<br>Chcesz, aby twoja witryna zostala wyrózniona?<br>Przeslij jej adres URL na wixofday@wix.com",READ_ON_BUTTON_LABEL:"Czytaj wiecej",CLOSE_DESCRIPTION_BUTTON_LABEL:"Zamknij"},pt:{INTRO_PRE_TITLE:"INSPIRE-SE COM O",INTRO_TITLE:"DO DIA!",INTRO_TEXT:"Todos os dias nós exibimos um site incrível construído com o Wix.<br>Quer ver o seu site aqui?<br>Envie o seu endereço URL para wixofday@wix.com",READ_ON_BUTTON_LABEL:"Leia mais",CLOSE_DESCRIPTION_BUTTON_LABEL:"Fechar"},ko:{INTRO_PRE_TITLE:"영감 얻기",INTRO_TITLE:"오늘의 WIX",INTRO_TEXT:"당사는 날마다 Wix에 새롭고 멋진 웹사이트를 구축합니다.<br>귀하의 웹사이트에 특징을 추가하시겠습니까?<br>wixofday@wix.com으로 귀하의 URL을 보내주십시오.",READ_ON_BUTTON_LABEL:"읽기",CLOSE_DESCRIPTION_BUTTON_LABEL:"닫기"},ja:{INTRO_PRE_TITLE:"インスパイアされよう！\r\n\r\n",INTRO_TITLE:"WIX おすすめサイト！",INTRO_TEXT:"Wixで作成された素晴らしいウェブサイトを毎日ご紹介します。あなたのウェブサイトも紹介したいですか？\nあなたのURLをwixofday@wix.com宛てにお送りください。",READ_ON_BUTTON_LABEL:"続きを読む",CLOSE_DESCRIPTION_BUTTON_LABEL:"閉じる"},ru:{INTRO_PRE_TITLE:"Вдохновитесь сайтом",INTRO_TITLE:"ДНЯ",INTRO_TEXT:"Каждый день мы демонстрируем вам новые, уникальные сайты, созданные с помощью Wix!<br>Хотите, чтобы и ваш сайт стал Сайтом Дня?<br>Пришлите нам адрес URL на wixofday@wix.com",READ_ON_BUTTON_LABEL:"читать далее",CLOSE_DESCRIPTION_BUTTON_LABEL:"закрыть"}},initialize:function(e,t,n){this.parent(e,t,n),this._SettingsClass=this.imports.ImageSettings,window.userApi&&(this._userApi=window.userApi),this.setState("closed")},_translate:function(e){var t="en";return this._userApi&&(t=this._userApi.getLanguage()),this.Translations[t][e]},render:function(){this._renderImage(),this._renderTexts(),this.parent()},_updateContainers:function(){this.getState()=="closed"?(this._skinParts.introContainer.setStyle("display","block"),this._skinParts.descriptionContainer.setStyle("display","none")):(this._skinParts.introContainer.setStyle("display","none"),this._skinParts.descriptionContainer.setStyle("display","block"))},_renderTexts:function(){this._updateContainers(),this._skinParts.introPreTitle.innerHTML=this._translate("INTRO_PRE_TITLE"),this._skinParts.introTitle.innerHTML=this._translate("INTRO_TITLE"),this._skinParts.introText.innerHTML=this._translate("INTRO_TEXT"),this._skinParts.descriptionText.innerHTML=this._data.get("description"),this._skinParts.shortDescriptionText.innerHTML=this._data.get("description"),this._skinParts.readOn.innerHTML=this._translate("READ_ON_BUTTON_LABEL"),this._skinParts.closeDescription.innerHTML=this._translate("CLOSE_DESCRIPTION_BUTTON_LABEL")},_renderImage:function(){if(!this._layoutInitialized)return;var e=this._skinParts.img;if(!e||!e.getOriginalClassName)return;var t=this._getImageSettings();e.setSettings(t),e.setHeight(274,!1,!1),e.setWidth(344,!1,!1)},_getImageSettings:function(){return this._imageSettings||(this._imageSettings=new this.imports.ImageSettings(this._SettingsClass.CropModes.FIT_WIDTH,344,274)),this._imageSettings},_onReadOnClicked:function(e){e.stopPropagation(),this.setState("opened"),W.Utils.Tween.to(this._skinParts.introContainer,.3,{opacity:0,onComplete:this._updateContainers}),W.Utils.Tween.to(this._skinParts.descriptionContainer,.3,{delay:.3,opacity:1})},_onCloseDescriptionClicked:function(e){e.stopPropagation(),this.setState("closed"),W.Utils.Tween.to(this._skinParts.descriptionContainer,.3,{opacity:0,onComplete:this._updateContainers}),W.Utils.Tween.to(this._skinParts.introContainer,.3,{delay:.3,opacity:1})},_onAllSkinPartsReady:function(){this._skinParts.readOn.addEvent(Constants.CoreEvents.CLICK,this._onReadOnClicked),this._skinParts.closeDescription.addEvent(Constants.CoreEvents.CLICK,this._onCloseDescriptionClicked)},_removeAllDomEvents:function(){this._skinParts.readOn.removeEvent(Constants.CoreEvents.CLICK,this._onReadOnClicked),this._skinParts.closeDescription.removeEvent(Constants.CoreEvents.CLICK,this._onCloseDescriptionClicked)},getAcceptableDataTypes:function(){return["Image"]},dispose:function(){this._removeAllDomEvents(),this.parent()}}});