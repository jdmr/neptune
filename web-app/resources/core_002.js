define.Class("core.utils.BeatStatisticsAndKeepAlive",function(e){var t=e;t.statics({BeatStatisticsAndKeepAliveInstances:[]}),t.fields({beatDefaultPulseTime:900,timeoutTimeMillis:1e3,_JSONPScriptId:"BeatStatisticsAndKeepAliveJSONP",_InstanceId:-1,beatUrl:"http://beat.wix.com/alive/jsonp"}),t.methods({initialize:function(e,t,n,r,i,s,o){if(this.isEmpty(e)||this.isEmpty(t)||this.isEmpty(n))throw"the appId, pageId and siteId are mandatory";this._initialize(e,t,n,r,i,s,o),this._gotResponse=!1,this._timeoutCount=0,this._sendRequestToBeatJSONP()},_initialize:function(e,t,n,r,i,s,o){this._InstanceId=this.BeatStatisticsAndKeepAliveInstances.push(this)-1,this._properties={isKeepAlive:i?i:!1,callback:o},this._requestData={app:e,siteId:t,metaSiteId:s,isTemplate:r?r:0,pageFileName:n,firstTimeInDocPage:!0,etag:this._getEtag()}},_getEtag:function(){return $$("meta[http-equiv=etag]")[0]&&$$("meta[http-equiv=etag]")[0].getAttribute?$$("meta[http-equiv=etag]")[0].getAttribute("content"):null},_addJSONPScriptElement:function(){if(document.getElementById(this._JSONPScriptId))return;var e=document.getElementsByTagName("script")[0],t=document.createElement("script");return t.id=this._JSONPScriptId,t.type="text/javascript",t.async=!0,e.parentNode.insertBefore(t,e),t},_sendRequestToBeatJSONP:function(){this._gotResponse=!1;var e=this._getRequestUrl(),t=document.getElementById(this._JSONPScriptId);t&&t.parentNode.removeChild(t);var n=this._addJSONPScriptElement();n.src=e},_processJsonResponse:function(e){this._gotResponse=!0,this._timeoutCount=0,this._requestData.firstTimeInDocPage=!1;var t=e&&e.payload&&e.payload.wixBeat?e.payload.wixBeat:this.beatDefaultPulseTime;if(this._properties.isKeepAlive){var n=this;window.setTimeout(function(){n._sendRequestToBeatJSONP()},t*1e3)}this._properties.callback&&this._properties.callback(e)},_timeoutJsonP:function(){if(!this._gotResponse&&this._properties.callback){this._properties.callback({errorCode:1,errorDescription:"timeout: there is no response after "+this.timeoutTimeMillis+"millis",success:!1});if(this._timeoutCount<2){var e=this;window.setTimeout(function(){e._sendRequestToBeatJSONP()},1e4)}this._timeoutCount++}},_getRequestUrl:function(){var e=this.beatUrl+"?";for(var t in this._requestData)e+=t+"="+this._requestData[t]+"&";return e=e.slice(0,-1),e},isEmpty:function(e){return e===undefined||e===null}})}),define.utils("ColorValidations:this",function(){return{isValidColor:function(e){return instanceOf(e,String)&&(e.indexOf("#")===0&&(e.length===4||e.length===7)&&!isNaN(e.replace("#","0x"))||Constants.CSS.COLORS.contains(e.toLowerCase()))}}}),define.utils("linkUtils",function(){var e={linkType:{SMS:"SMS",CALL:"CALL",SKYPE:"SKYPE",MAP:"MAP",EMAIL:"EMAIL",FACEBOOK:"FACEBOOK",FLICKR:"FLICKR",BLOGGER:"BLOGGER",MYSPACE:"MYSPACE",LINKEDIN:"LINKEDIN",TWITTER:"TWITTER",TUMBLR:"TUMBLR",YOUTUBE:"YOUTUBE",VIMEO:"VIMEO",PAGE:"PAGE",FREE_LINK:"FREE_LINK",TEXT:"TEXT",DELICIOUS:"DELICIOUS",WEBSITE:"WEBSITE",DOCUMENT:"DOCUMENT",LOGIN:"LOGIN"},linkTarget:{SAME_WINDOW:"_self",NEW_WINDOW:"_blank"}};return{linkify:function(e,t,n,r){if(!t)return;n&&n!==""?(t.set("href",n),t.setStyle("cursor","pointer"),this._setTarget(t,r),this.hasState("noLink","linkableComponent")&&this.removeState("noLink","linkableComponent")):(t.setStyle("cursor","default"),t.erase("href"),t.erase("target"),this.hasState("noLink","linkableComponent")&&this.setState("noLink","linkableComponent")),this._handleSpecialCases(e,t)},renderLinks:function(e,t){var n=e.getData(),r=n.href,i=n.target,s=n.linkType,o=t?t:this._skinParts.link;if(i==="same"||i==="self")i="_self",e.set("target","_self");W.Utils.linkUtils.linkify.call(this,s,o,r,i),this._NO_LINK_PROPAGATION&&W.Utils.linkUtils.disableLinkClickPropagation(o)},disableLinkClickPropagation:function(e){e.addEvent("click",function(e){e.stopPropagation()})},_setTarget:function(e,t){e.set("target",t)},_bindPageLeaveWarningToLink:function(e,t){t.erase("href"),t.erase("target"),t.addEvent("click",function(t){t.preventDefault(),this._showNavigationDisabledTooltip(e)}.bind(this))},_showNavigationDisabledTooltip:function(e){this.injects().Commands.executeCommand("linkableComponent.navigateSameWindow",{component:e},e)},linkableComponentEditModeChanged:function(t,n,r){if(this._isDisposed)return;var i=r?r:this._skinParts.link,s=!1,o=!1,u=this.getDataItem?this.getDataItem():n,a=u.get("linkType"),f=u.get("target"),l=e.linkTarget.SAME_WINDOW,c=e.linkType.WEBSITE,h=e.linkType.EMAIL;f===l&&a===c&&(s=!0),a===h&&(o=!0),t=="PREVIEW"?s?this._bindPageLeaveWarningToLink(i):o&&(this._bindMailtoLinks(i),this.renderLinks(n)):(i.removeEvents("click"),this.renderLinks(n))},_bindMailtoLinks:function(e){e=this._skinParts.link,e.addEvent("click",this._temporaryDisableNavigationWarning)},_temporaryDisableNavigationWarning:function(e){window.enableNavigationConfirmation=!1,setTimeout(function(){window.enableNavigationConfirmation=!0},50)},_handleSpecialCases:function(t,n){n.removeEvents("click");switch(t){case e.linkType.LOGIN:n.addEvent("click",function(){if(window.animateForm){var e=this.getDataItem(),t=e.get("text");if(t){t=JSON.parse(t);var n=t.postLoginUrl,r=t.postSignupUrl,i=t.type,s="HTML",o=window.userApi?window.userApi.isSessionValid():!1;o?n&&(window.location.href=n):window.animateForm.callOnContent([r,n,i,s])}}}.bind(this));break;case e.linkType.ADMIN_LOGIN:n.setStyle("cursor","pointer"),n.addEvent("click",function(){this.injects().Commands.executeCommand("WViewerCommands.AdminLogin.Open")}.bind(this))}}}}),define.Class("core.utils.css.Background",function(e){var t=e;t.utilize(["core.utils.css.Color"]),t.methods({initialize:function(e,t){this.setThemeManager(t);if(!e)return;e.getThemeString&&(e=e.getThemeString());var n=e.split(" ").filter(function(e){return!!e});if(n.length===1){var r="^#[\\dA-Fa-f]{3,8}$",i="^rgba?\\([\\d,]+\\)$",s="^[\\[\\{][\\w\\d_]+[\\]\\}]$",o=new RegExp(r+"|"+i+"|"+s),u=n[0];u=="none"?n=["none",0,0,"center","center","auto","repeat","repeat","scroll","none"]:u.test(o)&&(n=["none",0,0,"center","center","auto","repeat","repeat","scroll",u])}this.set.apply(this,n)},setThemeManager:function(e){this._themeManager=e},set:function(e,t,n,r,i,s,o,u,a,f){this._setColor(f),this.setImage(e,t,n),this.setRepeat(o,u),this.setAttachment(a),this.setPosition(r,i),this.setWidth(s)},setWidth:function(e){var t=parseInt(e,10),n=Constants.Background.VALID_WIDTH;this._width=n.contains(e)||!isNaN(t)?e:this._width||n[0]},setPosition:function(e,t){if(typeof t=="undefined"){var n=e.split(" ");n.length===2&&(e=n[0],t=n[1])}var r=Constants.Background.VALID_POSITION_X,i=Constants.Background.VALID_POSITION_Y;this._x=r.contains(e)?e:this._x||r[0],this._y=i.contains(t)?t:this._y||i[0]},setAttachment:function(e){var t=Constants.Background.VALID_ATTACHMENT;this._attachment=t.contains(e)?e:this._attachment||t[0]},setColorReference:function(e){this._colorSource="theme",this._colorName=e,this._color=new this.imports.Color(this._themeManager&&this._themeManager.getProperty(e))},setColor:function(e){if(e=="transparent"||e=="none")e="0,0,0,0";this._colorSource="value",this._colorName="",this._color=new this.imports.Color(e)},_setColor:function(e){var t="",n=e&&(e.test(/\{.+\}/)||e.test(/\[.+\]/));e&&n?(t=n&&e.substring(1,e.length-1)||e,this.setColorReference(t)):this.setColor(e)},setImage:function(e,t,n){this._imageId=e||"none",this._imageW=t||0,this._imageH=n||0},setPyramidSize:function(e){this._pyramid=e},setRepeat:function(e,t){if(typeof t=="undefined"){var n=e.split(" ");switch(n.length){case 1:t=e;break;case 2:e=n[0],t=n[1]}}var r=Constants.Background.VALID_REPEAT;this._repeatX=r.contains(e)?e:this._repeatX||r[0],this._repeatY=r.contains(t)?t:this._repeatY||r[0]},getCssValue:function(e){var t=e?"background:":"";return this.getImageId()&&(t+=[this.getUrl(),this.getPosition(),this.getRepeatUnified(),this.getAttachment()].join(" ")+" "),t+=this.getColor(),t},getCssSizeValue:function(e){return this.getWidth(e)},getCssRule:function(e){var t=this.getCssValue(!0);return e&&(t+=";"+this.getCssSizeValue(!0)),t},getCssRules:function(){return[this.getUrl(!0),this.getPosition(!0),this.getWidth(!0),this.getRepeat(!0),this.getAttachment(!0),this.getColor(!0)].join(";")},getThemeString:function(){var e=this._colorSource==="theme"?"{"+this.getColorReference()+"}":this.getColor();return[this.getImageId(),this.getImageSize()[0],this.getImageSize()[1],this.getPosition(),this.getWidth(),this.getRepeat(),this.getAttachment(),e].join(" ")},getWidth:function(e){var t=e?"background-size:":"";return t+=this._width,t},getWidthInline:function(e){return Modernizr&&Modernizr.backgroundsize||e?"/"+this.getWidth():""},getPosition:function(e){var t=e?"background-position:":"";return t+=this.getPositionX()+" "+this.getPositionY(),t},getPositionX:function(e){var t=e?"background-position-x:":"";return t+=this._x,t},getPositionY:function(e){var t=e?"background-position-y:":"";return t+=this._y,t},getAttachment:function(e){var t=e?"background-attachment:":"";return t+=this._attachment,t},getColor:function(e){var t=e?"background-color:":"";return this._color.getAlpha()==0?t+="transparent":t+=this._color.getHex(),t},getColorReference:function(){return this._colorName},getUrl:function(e){var t=W.Config.getServiceTopologyProperty("staticMediaUrl")+"/",n=e?"background-image:":"";return this._imageId=="none"?n+=this._imageId:n+="url("+t+this._imageId+this._getPyramidSuffix()+")",n},getImageSize:function(){return[this._imageW,this._imageH]},getImageId:function(){return this._imageId||"none"},_getPyramidSuffix:function(){var e="",t=this._pyramid||Constants.Background.DEFAULT_PYRAMID_SIZE,n=[],r=1,i,s;n[0]=parseInt(this.getImageSize()[0],10),n[1]=parseInt(this.getImageSize()[1],10),r=n[0]/n[1],i=n[0],s=n[1];if(n[0]>t||n[1]>t)i=n[0]>=n[1]?t:Math.round(r*t),s=n[1]>=n[0]?t:Math.round(1/r*t);return e="_crp_0_0_"+n[0]+"_"+n[1]+"_"+i+"_"+s+"_crp",e},getRepeat:function(e){var t=e?"background-repeat:":"";return t+=this._repeatX+" "+this._repeatY,t},getRepeatUnified:function(e){var t=e?"background-repeat:":"";return this._repeatX==this._repeatY?t+=this._repeatX=="no-repeat"?"no-repeat":"repeat":t+=this._repeatX=="repeat"?"repeat-x":"repeat-y",t},toString:function(){return this.getCssValue()}})}),define.Class("core.utils.css.BorderRadius",function(e){var t=e;t.methods({initialize:function(e){e.getThemeString?e=e.getThemeString():Array.isArray(e)?e=e.join(" "):e=e.toString();var t=e.split(" ").filter(function(e){return!!e});this.set.apply(this,t)},square:function(e,t,n,r){this._isLocked=!1;for(var i=0;i<arguments.length;++i)switch(arguments[i].toLowerCase()){case"tr":this._topRightRadius=0;break;case"tl":this._topLeftRadius=0;break;case"br":this._bottomRightRadius=0;break;case"bl":this._bottomLeftRadius=0}return this},set:function(e,t,n,r){this._isLocked=!1,typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=e,this._isLocked=!0),typeof n=="undefined"&&(n=e),typeof r=="undefined"&&(r=t),this.setTopLeft(e,this._isLocked),this.setTopRight(t,this._isLocked),this.setBottomRight(n,this._isLocked),this.setBottomLeft(r,this._isLocked)},setTopLeft:function(e,t){this._isLocked=!!t;var n=this._seperateSizeFromUnit(e,this._topLeftUnits);this._topLeftRadius=n.size,this._topLeftUnits=n.unit},setTopRight:function(e,t){this._isLocked=!!t;var n=this._seperateSizeFromUnit(e,this._topRightUnits);this._topRightRadius=n.size,this._topRightUnits=n.unit},setBottomRight:function(e,t){this._isLocked=!!t;var n=this._seperateSizeFromUnit(e,this._bottomRightUnits);this._bottomRightRadius=n.size,this._bottomRightUnits=n.unit},setBottomLeft:function(e,t){this._isLocked=!!t;var n=this._seperateSizeFromUnit(e,this._bottomLeftUnits);this._bottomLeftRadius=n.size,this._bottomLeftUnits=n.unit},_seperateSizeFromUnit:function(e,t){e=String(e);var n=parseFloat(e),r=e.split(String(n)).join("");return n=isNaN(n)?0:n,r=Constants.BorderRadius.VALID_UNITS.contains(r)?r:t||Constants.BorderRadius.VALID_UNITS[0],{unit:r,size:n}},getCssValue:function(){return this._isLocked?this.getTopLeft():[this.getTopLeft(),this.getTopRight(),this.getBottomRight(),this.getBottomLeft()].join(" ")},getCssRule:function(e){return"border-radius:"+this.getCssValue()},getThemeString:function(){return this.getCssValue()},getTopLeft:function(){return this._topLeftRadius+this._topLeftUnits},getTopRight:function(){return this._topRightRadius+this._topRightUnits},getBottomRight:function(){return this._bottomRightRadius+this._bottomRightUnits},getBottomLeft:function(){return this._bottomLeftRadius+this._bottomLeftUnits},getIsLocked:function(){return this._isLocked},getUnits:function(){return[this._topLeftUnits,this._topRightUnits,this._bottomRightUnits,this._bottomLeftUnits]},toString:function(){return this.getCssValue()}})}),define.Class("core.utils.css.BoxShadow",function(e){var t=e;t.utilize(["core.utils.css.Color"]),t.methods({initialize:function(e,t){this._shadow=[];var n="",r=!1;e&&e!=="none"&&(n=e),t!==!1&&n&&(r=!0),n.getThemeString&&(n=n.getThemeString()),this._parseShadowString(n||"0 0 0 0 #000000"),this.setToggleOn(r)},setToggleOn:function(e){this._toggleOn=e},setColor:function(e,t){t=t||0,this._shadow[t].color=new this.imports.Color(e)},setBlurRadius:function(e,t){t=t||0,this._shadow[t].blur=this._getSizeFromUnit(e)},setSpreadRadius:function(e,t){t=t||0,this._shadow[t].spread=this._getSizeFromUnit(e)},setOffset:function(e,t,n){t=typeof t!="undefined"?t:e,this.setOffsetX(e,n),this.setOffsetY(t,n)},setOffsetX:function(e,t){t=t||0,this._shadow[t].x=this._getSizeFromUnit(e),this._shadow[t].angle=this._calcAngle(t),this._shadow[t].distance=this._calcDistance(t)},setOffsetY:function(e,t){t=t||0,this._shadow[t].y=this._getSizeFromUnit(e),this._shadow[t].angle=this._calcAngle(t),this._shadow[t].distance=this._calcDistance(t)},setInset:function(e,t){this._shadow[t||0].inset=e?"inset":""},setDistance:function(e,t){t=t||0,this._shadow[t].distance=this._getSizeFromUnit(e),this._shadow[t].x=this._shadow[t].distance*Math.sin(this._shadow[t].angle),this._shadow[t].y=this._shadow[t].distance*Math.cos(this._shadow[t].angle)},setAngle:function(e,t,n){var r=t?Math.PI/180:1;n=n||0,this._shadow[n].angle=e*r||0,this._shadow[n].x=this._shadow[n].distance*Math.sin(this._shadow[n].angle),this._shadow[n].y=this._shadow[n].distance*Math.cos(this._shadow[n].angle)},setUnit:function(e,t){t=t||0,this._shadow[t].unit=Constants.BoxShadow.VALID_UNITS.contains(e)?e:Constants.BoxShadow.VALID_UNITS[0]},getDistance:function(e){return e=e||0,this._shadow[e].distance},getAngle:function(e,t){t=t||0;var n=e?180/Math.PI:1,r=this._modulo(this._shadow[t].angle,2*Math.PI)*n;return e?Math.round(r):r},getColor:function(e){e=e||0;var t=this._shadow[e].color;return Modernizr&&Modernizr.rgba?"rgba("+t.getRgba()+")":t.getHex()},getBlurRadius:function(e){return e=e||0,this._shadow[e].blur},getSpreadRadius:function(e){return e=e||0,this._shadow[e].spread},getOffsetX:function(e,t){return e=e||0,this._shadow[e].x.toFixed(3)},getOffsetY:function(e,t){return e=e||0,this._shadow[e].y.toFixed(3)},getInset:function(e){return e=e||0,this._shadow[e].inset},getToggleOn:function(){return this._toggleOn},getThemeString:function(){var e=!0;return this._getCssValueFromShadowObject(e)},getUnit:function(e){return e=e||0,this._shadow[e].unit},getCssValue:function(){return this._toggleOn?this._getCssValueFromShadowObject():""},_calcAngle:function(e){e=e||0;var t={x:this._shadow[e].x,y:this._shadow[e].y},n={x:0,y:0},r={x:n.x,y:n.y-Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y))};return 2*Math.atan2(t.x-r.x,t.y-r.y)},_calcDistance:function(e){e=e||0;var t=this._shadow[e].x||0,n=this._shadow[e].y||0;return Math.sqrt(t*t+n*n)},_getSizeFromUnit:function(e){e=String(e);var t=parseFloat(e);return t=isNaN(t)?0:t,t},_parseShadowString:function(e){var t,n=[],r=0,i;if(typeof e!="string")return;t=e.trim().replace(/\s*([\(\)\}\s,])\s*/g,"$1").replace(/([\)\}]|#\w{3,6}),/g,"$1, ").replace(/[,;]$/,"");if(!t)return"";n=t.split(", ");for(r=0;r<n.length;r++)i=n[r].split(" "),i[0]!="inset"&&i.unshift(""),this._shadow[r]=[],this.setUnit("px",r),this.setInset(i[0],r),this.setOffset(i[1],i[2],r),this.setBlurRadius(i[3],r),this.setSpreadRadius(i.length>5?i[4]:0,r),this.setColor(i.getLast(),r)},_getCssValueFromShadowObject:function(e){var t=[],n;for(n=0;n<this._shadow.length;n++)e?t.push([this.getInset(n),this.getOffsetX(n),this.getOffsetY(n),this.getBlurRadius(n),this.getSpreadRadius(n),this.getColor(n)].join(" ").trim()):t.push([this.getInset(n),Math.round(this.getOffsetX(n))+this._shadow[n].unit,Math.round(this.getOffsetY(n))+this._shadow[n].unit,Math.round(this.getBlurRadius(n))+this._shadow[n].unit,Math.round(this.getSpreadRadius(n))+this._shadow[n].unit,this.getColor(n)].join(" ").trim());return t.join(",")},_modulo:function(e,t){return(e%t+t)%t},toString:function(){return this.getCssValue()}})}),define.Class("core.utils.css.Color",function(e){function n(e,t,n){var r,i,s,o,u,a,f,l;return e%=360,n===0?{r:0,g:0,b:0}:(t/=100,n/=100,e/=60,o=Math.floor(e),u=e-o,a=n*(1-t),f=n*(1-t*u),l=n*(1-t*(1-u)),o===0?(r=n,i=l,s=a):o==1?(r=f,i=n,s=a):o==2?(r=a,i=n,s=l):o==3?(r=a,i=f,s=n):o==4?(r=l,i=a,s=n):o==5&&(r=n,i=a,s=f),r=Math.floor(r*255),i=Math.floor(i*255),s=Math.floor(s*255),{r:r,g:i,b:s})}function r(e,t,n){var r,i,s,o,u,a;return e/=255,t/=255,n/=255,r=Math.min(Math.min(e,t),n),i=Math.max(Math.max(e,t),n),r==i?{h:undefined,s:0,l:i*100}:(s=e==r?t-n:t==r?n-e:e-t,o=e==r?3:t==r?5:1,u=Math.floor((o-s/(i-r))*60)%360,a=Math.floor((i-r)/i*100),i=Math.floor(i*100),{h:u,s:a,l:i})}var t=e;t.methods({initialize:function(e,t,n,r){if(typeOf(n)=="number"&&typeOf(t)=="number"&&typeOf(e)=="number")this.setRed(e),this.setGreen(t),this.setBlue(n),this.setAlpha(r);else if(typeOf(e)=="string")if(e.indexOf("#")===0)this.setHex(e);else{var i=e.replace(/[rgba\(\)]/g,"");this.setRgba(i)}else this._isUpdateDisabled=!0,e=e||{},this.setRed(e.getRed&&typeOf(e.getRed)=="function"?e.getRed():0),this.setGreen(e.getGreen&&typeOf(e.getGreen)=="function"?e.getGreen():0),this.setBlue(e.getBlue&&typeOf(e.getBlue)=="function"?e.getBlue():0),this.setAlpha(e.getAlpha&&typeOf(e.getAlpha)=="function"?e.getAlpha():1),this._isUpdateDisabled=!1,this._updateHsb()},invert:function(){return this.getInvertColor()},saturation:function(e){return this.setSaturation(e*(this._s/100)),this},luminous:function(e){return this.setLuminous(e*(this._l/100)),this},alpha:function(e){return this.setAlpha(e*(this._a/100)),this},maxSaturation:function(e){return this._s>e&&this.setSaturation(e),this},minSaturation:function(e){return this._s<e&&this.setSaturation(e),this},maxLuminous:function(e){return this._l>e&&this.setLuminous(e),this},minLuminous:function(e){return this._l<e&&this.setLuminous(e),this},getHex:function(e){var t="#"+this._formatHexColor(this._r)+this._formatHexColor(this._g)+this._formatHexColor(this._b);return e&&(t+=this._formatHexColor(this._a*255)),t},getRgb:function(){return this._r+","+this._g+","+this._b},getRgba:function(){return this.getRgb()+","+this.getAlpha()},getRed:function(){return this._getValue(this._r,0)},getGreen:function(){return this._getValue(this._g,0)},getBlue:function(){return this._getValue(this._b,0)},getAlpha:function(){return this._getValue(this._a,1,2)},getHue:function(){return this._getValue(this._h,0)},getSaturation:function(){return this._getValue(this._s,100)},getLuminous:function(){return this._getValue(this._l,100)},getInvertColor:function(){return new this.$class([255-this._r,255-this._g,255-this._b].join(","))},_getValue:function(e,t,n){var r=!e&&e!==0?t:e;return r!==0&&r!==1&&typeof n=="number"&&typeof r=="number"&&(r=r.toFixed(n),r=Number(r)),r},setRed:function(e){this._r=this._validateValue(e,0,255,0),this._updateHsb()},setGreen:function(e){this._g=this._validateValue(e,0,255,0),this._updateHsb()},setBlue:function(e){this._b=this._validateValue(e,0,255,0),this._updateHsb()},setAlpha:function(e){this._a=this._validateValue(e,0,1,1)},setHue:function(e){this._h=this._validateValue(e,0,360,0),this._updateRgb()},setSaturation:function(e){this._s=this._validateValue(e,0,100,100),this._updateRgb()},setLuminous:function(e){this._l=this._validateValue(e,0,100,100),this._updateRgb()},setHex:function(e){e.charAt(0)=="#"&&(e=e.substr(1)),this._isUpdateDisabled=!0,this.setRed(parseInt(e.substr(0,2),16)),this.setGreen(parseInt(e.substr(2,2),16)),this.setBlue(parseInt(e.substr(4,2),16));var t=parseInt(e.substr(6,2),16);(!isNaN(t)||!this._a)&&this.setAlpha(t===0?0:t/255),this._isUpdateDisabled=!1,this._updateHsb()},setRgba:function(e){this._isUpdateDisabled=!0;var t=this._formatSplitValue(e,["r","g","b","a"]);this.setRed(t.r),this.setGreen(t.g),this.setBlue(t.b),this.setAlpha(t.a),this._isUpdateDisabled=!1,this._updateHsb()},setHsl:function(e){this._isUpdateDisabled=!0;var t=this._formatSplitValue(e,["h","s","l"]);this.setHue(t.h),this.setSaturation(t.s),this.setLuminous(t.l),this._isUpdateDisabled=!1,this._updateRgb()},_formatSplitValue:function(e,t){var n={};typeOf(e)=="string"&&(e=e.split(","));if(typeOf(e)=="array")for(var r=0;r<t.length;++r)n[t[r]]=e[r];return n},_validateValue:function(e,t,n,r){e=isNaN(e)?parseFloat(e):e,e!==0&&(e=e||r||t),e=isNaN(e)?e:Number(String(e).trim());if(isNaN(e)||e>n)e=n;return e<t&&(e=t),e},_formatHexColor:function(e){e=e||"00",typeOf(e)=="number"&&(e=Math.round(e),e=e.toString(16));while(e.length<2)e="0"+e;return e.toUpperCase()},_updateHsb:function(){if(this._isUpdateDisabled===!0)return;var e=r(this._r,this._g,this._b);this._h=e.h||0,this._s=e.s||0,this._l=e.l||0},_updateRgb:function(){if(this._isUpdateDisabled===!0)return;var e=n(this._h,this._s,this._l);this._r=e.r,this._g=e.g,this._b=e.b},toString:function(){return this.getHex(!1)}})}),define.Class("core.utils.css.Font",function(e){var t=e;t.utilize(["core.utils.css.Color"]),t.methods({initialize:function(e,t){this.setThemeManager(t);if(typeOf(e)=="string")this._parseFontString(e);else{var n=e||{};this.setStyle(n.getStyle&&typeOf(n.getStyle)=="function"?n.getStyle():undefined),this.setVariant(n.getVariant&&typeOf(n.getVariant)=="function"?n.getVariant():undefined),this.setWeight(n.getWeight&&typeOf(n.getWeight)=="function"?n.getWeight():undefined),this.setSize(n.getSize&&typeOf(n.getSize)=="function"?n.getSize():undefined),this.setLineHeight(n.getLineHeight&&typeOf(n.getLineHeight)=="function"?n.getLineHeight():undefined),this.setFontFamily(n.getFontFamily&&typeOf(n.getFontFamily)=="function"?n.getFontFamily():undefined);if(n.getColorReference&&typeOf(n.getColorReference)=="function"&&n.getColorReference()!=="")this.setColorReference(n.getColorReference());else{var r=n.getColor&&typeOf(n.getColor)=="function"?n.getColor():"#000000";this.setColor(r)}}},getThemeString:function(){var e=this._colorSource==="theme"?"{"+this.getColorReference()+"}":this.getColor();return[this._style,this._variant,this._weight,this.getSize()+"/"+this.getLineHeight(),this.getFontFamilyWithNoSpaces(),e].join(" ")},getCssRule:function(){return["font:",this.getCssValue(),"; color:",this.getColor()].join(" ")},getCssValue:function(){var e=this.getFontFamilyWithFallbacks();return[this._style,this._variant,this._weight,this.getSize()+"/"+this.getLineHeight(),e].join(" ")},getStyle:function(){return this._style},getVariant:function(){return this._variant},getWeight:function(){return this._weight},getSize:function(){return this._fontSize+this._fontUnit},getLineHeight:function(){return this._lineHeightSize+this._lineHeightUnit},getFontFamily:function(){return this._fontFamily},getFontFamilyWithNoSpaces:function(){return this._fontFamily.replace(/\s/g,"+")},getFontFamilyWithFallbacks:function(){return W.Css.getFontFallbacksCss(this._fontFamily)},getColorReference:function(){return this._colorName},getColor:function(){return this._color},_parseFontString:function(e){var t=e.split(" "),n=t[3]?t[3].split("/"):[];this.setStyle(t[0]),this.setVariant(t[1]),this.setWeight(t[2]),this.setSize(n[0]),this.setLineHeight(n[1]),this.setFontFamily(t[4]),this._setColor(t[5])},setThemeManager:function(e){this._themeManager=e},setStyle:function(e){e=Constants.FONT.STYLE.contains(e)?e:Constants.FONT.STYLE[0],this._style=e},setVariant:function(e){e=Constants.FONT.VARIANT.contains(e)?e:Constants.FONT.VARIANT[0],this._variant=e},setWeight:function(e){e=Constants.FONT.WEIGHT.contains(e)?e:Constants.FONT.WEIGHT[0],this._weight=e},setSize:function(e){var t=this._seperateSizeFromUnit(e);this._fontSize=t.size,this._fontUnit=t.unit},setLineHeight:function(e){var t=this._seperateSizeFromUnit(e);this._lineHeightSize=t.size,this._lineHeightUnit=t.unit},setFontFamily:function(e){e=e&&e.replace(/\+/g," ");var t=W.Css.getFontType(e);t||(e=W.Css.getDefaultFont(),t="system"),this._fontFamily=e},setColorReference:function(e){this._colorSource="theme",this._colorName=e,this._color=(new this.imports.Color(this._themeManager&&this._themeManager.getProperty(e))).getHex()},setColor:function(e){this._colorSource="value",this._colorName="",this._color=(new this.imports.Color(e)).getHex()},_setColor:function(e){var t="",n=e&&(e.test(/\{.+\}/)||e.test(/\[.+\]/));e&&n?(t=n&&e.substring(1,e.length-1)||e,this.setColorReference(t)):this.setColor(e)},_seperateSizeFromUnit:function(e){e=String(e);var t=parseFloat(e),n=e.split(String(t)).join("");return t=isNaN(t)?this._getDefaultFontSize():t,n=Constants.FONT.UNITS.contains(n)?n:this._getDefaultFontUnit(),{unit:n,size:t}},_getDefaultFontSize:function(){return this._fontSize?this._fontSize:12},_getDefaultFontUnit:function(){return this._fontUnit?this._fontUnit:Constants.FONT.UNITS[0]},toString:function(){return this.getCssValue()}})}),define.Class("core.utils.css.Size",function(e){var t=e;t.statics({UNITS:["px","%","em"],DEFAULT_AMOUNT_FOR_UNIT:{px:12,"%":100,em:1}}),t.methods({initialize:function(e){if(typeOf(e)=="string")this._parseSizeString(e);else{var t=e||{};this.setUnit(t.getUnit&&typeOf(t.getUnit)=="function"?t.getUnit():undefined),this.setAmount(t.getAmount&&typeOf(t.getAmount)=="function"?t.getAmount():undefined)}},multiply:function(e){return this._amount*=e,this},decrease:function(e){return this._amount-=e,this},increase:function(e){return this._amount+=e,this},getThemeString:function(){return this.getCssValue()},getCssRule:function(){return this.getCssValue()},getCssValue:function(){return this._amount+this._unit},getAmount:function(){return this._amount},getUnit:function(){return this._unit},add:function(e){var t=new this.$class(e);this._unit===t.getUnit()&&(this._amount+=t.getAmount())},_parseSizeString:function(e){var t=this._seperateAmountFromUnit(e);this.setAmount(t.amount),this.setUnit(t.unit)},setAmount:function(e){e||e===0?this._amount=e:this._amount=this._getDefaultAmountForUnit(this._unit)},setUnit:function(e){this._unit=e||this._getDefaultUnit()},_seperateAmountFromUnit:function(e){e=String(e);var t=parseFloat(e),n=e.split(String(t)).join("");return n=this.UNITS.contains(n)?n:this._getDefaultUnit(),t=isNaN(t)?this._getDefaultAmountForUnit(n):t,{unit:n,amount:t}},_getDefaultAmountForUnit:function(e){return this.DEFAULT_AMOUNT_FOR_UNIT[e]||1},_getDefaultUnit:function(){return this._unit?this._unit:this.UNITS[0]},toString:function(){return this.getCssValue()}})}),define.Const("Background",{VALID_WIDTH:["auto","contain","cover"],VALID_POSITION_X:["left","right","center"],VALID_POSITION_Y:["top","bottom","center"],VALID_ATTACHMENT:["scroll","fixed"],VALID_REPEAT:["repeat","no-repeat"],DEFAULT_PYRAMID_SIZE:1920}),define.Const("BorderRadius",{VALID_UNITS:["px","%","em"]}),define.Const("BoxShadow",{VALID_UNITS:["px"]}),define.Const("FONT",{STYLE:["normal","italic"],VARIANT:["normal","small-caps","inherit"],WEIGHT:["normal","bold","bolder","lighter"],UNITS:["px","em","pt","ex","in","cm","mm","pc"]}),define.bootstrapClass("core.utils.Wixify",function(){function a(e,t,n){this._requiredParams={compData:null,compProperties:null,idPrefix:null,logicClass:null,skinClass:null,dataInstance:null,viewNode:null,style:null},this._wixifyDone=!1,this._wixifyCallback=e,this._paramsSet={},this._className=n,this._startTime=(new Date).getTime(),this._wixifyTimeout=t?t:u}var e={getType:function(){return""}},t=function(e){if(e.viewNode.$logic)return;e.logicClass.NEW_BASE_COMP===!0?n(e):i(e)},n=function(t){var n=t.logicClass,i=t.skinClass,o=t.dataInstance,u=t.viewNode,a=t.compProperties,f=t.style||t.compData.innerStyle,l=r(n,u,t.idPrefix,t.compData.argsObject);W.ComponentLifecycle.registerComponent(l),o&&o!==e&&l.setDataItem(o),a&&l.setComponentProperties(a);var c=new i;f&&c.setParamMapper(f),l.setSkin(c),s(u)},r=function(e,t,n,r){var i=t.getProperty("id")||o(e,n),s=new e(i,t,r);return t.$logic=s,t.getLogic=function(){return s},s},i=function(t){t.dataInstance||(t.dataInstance=e);var n=t.viewNode.getProperty("id")||o(t.logicClass,t.idPrefix),r=new t.logicClass(n,t.viewNode,t.compData.argsObject),i=new t.skinClass;t.compData.innerStyle&&i.applyStyle(t.compData.innerStyle),t.style?r.initSkinAndStyle(i,t.style):r.setSkin(i);var u=r.getAcceptableDataTypes(),a=t.dataInstance.getType();t.compProperties&&r.setComponentProperties(t.compProperties),u.indexOf(a)!=-1?t.dataInstance!==e&&r.setDataItem(t.dataInstance):LOG.reportError(wixErrors.WIXIFY_INVALID_DATA_TYPE,"wrong data type",a,", data type: "+a+", acceptable types: "+u+", component: "+r.className),t.viewNode.$logic=r,t.viewNode.getLogic=function(){return r},s(t.viewNode)},s=function(e){e.fireEvent(Constants.ComponentEvents.WIXIFIED),e.$logic.fireEvent(Constants.ComponentEvents.WIXIFIED),e.trigger&&e.trigger(Constants.ComponentEvents.WIXIFIED),e.$logic.trigger&&e.$logic.trigger(Constants.ComponentEvents.WIXIFIED)},o=function(e,t){t=t?t+"___":"";var n=e.prototype.className,r=n.lastIndexOf(".");return n=r>-1?n.substr(r):n,W.Utils.getUniqueId(t+n)};Element.implement({wixify:function(n,r,i,s,o){var u,f,l,c,h,p,d,v,m,g;u=this.getProperty("comp"),f=this.getProperty("skin"),l=this.getProperty("dataQuery"),c=this.getProperty("propertyQuery"),p={argsObject:n,innerStyle:o},g=this.getProperty("styleId"),!s&&Constants.WixifyTimeOut&&(s=Constants.WixifyTimeOut);var y=new a(t,s,u);if(g)W.Theme.getStyle(g,function(e){y.setParam("style",e),W.Skins.getSkin(e.getSkin(),y.getAsyncSetterFor("skinClass"))},f);else{y.setParam("style",undefined);if(!f){LOG.reportError(wixErrors.WIXIFY_NO_SKIN,"Element","wixify",u);return}W.Skins.getSkin(f,y.getAsyncSetterFor("skinClass"))}if(!u){LOG.reportError(wixErrors.WIXIFY_NO_COMP,"Element","wixify",u);return}if(this.getLogic){LOG.reportError(wixErrors.WIXIFY_ALREADY_WIXIFIED,"Element","wixify",u);return}h=this,h.fireEvent("wixifyStarted"),y.setParam("viewNode",h),y.setParam("idPrefix",i),y.setParam("compData",p);if(r)y.setParam("dataInstance",r);else if(l){var b,w=this.getProperty("dataQuerySource");!w||w!="preview"||!W.Editor?b=W.Data:b=W.Preview.getPreviewManagers().Data,b.getDataByQuery(l,y.getAsyncSetterFor("dataInstance"))}else y.setParam("dataInstance",e);return c?(this.isTimedOut=!1,this.propQueryTimer=setTimeout(function(){this.isTimedOut=!0,y.setParam("compProperties",undefined)}.bind(this),1e4),W.ComponentData.getDataByQuery(c,function(e){this.isTimedOut||(clearTimeout(this.propQueryTimer),y.getAsyncSetterFor("compProperties")(e))}.bind(this))):y.setParam("compProperties",undefined),W.Components.getComponent(u,y.getAsyncSetterFor("logicClass")),y.run(),this}}),Elements.implement({wixify:function(e,t){for(var n=this.length-1;n>-1;--n)this[n].wixify(e,t);return this}});var u=2e3;return a.prototype={_timedOut:null,_timeOutId:null,run:function(){this._wixifyDone||(this._timeOutHandler=setTimeout(function(){this._clearTimeout(),this._onWixifyTimeout()}.bind(this),this._wixifyTimeout))},_clearTimeout:function(){clearTimeout(this._timeOutHandler)},setParam:function(e,t){if(!this._requiredParams.hasOwnProperty(e))throw"this wixifier is not waiting for a parameter named "+e;this._requiredParams[e]=t,this._paramsSet[e]=(new Date).getTime()-this._startTime,this._checkIfEverythingIsThere()},getAsyncSetterFor:function(e){return function(t){this.setParam(e,t)}.bind(this)},_checkIfEverythingIsThere:function(){var e=!0;for(var t in this._requiredParams)if(this._requiredParams.hasOwnProperty(t)&&this._paramsSet[t]===undefined){e=!1;break}e&&this._onAllWixifyParamsReady()},_onAllWixifyParamsReady:function(){this._wixifyDone=!0,this._clearTimeout(),this._wixifyCallback&&this._wixifyCallback(this._requiredParams);if(this._timedOut){var e=(new Date).getTime()-this._startTime;LOG.reportError(wixErrors.WIXIFY_FINISHED_AFTER_TIMEOUT,e,this._timeOutId,e)}},_onWixifyTimeout:function(){this._timedOut=(new Date).getTime()-this._startTime,this._timeOutId="["+this._className+":"+this._timedOut+"]";var e=this._requiredParams,t=this._paramsSet,n=[],r=[];for(var i in e)e.hasOwnProperty(i)&&t[i]===undefined&&n.push(i);var s="Time: "+this._wixifyTimeout+". missing: "+n.join(",");W.Utils.debugTrace("Wixify Error",this._className,this._timeOutId,s),n.length==1&&n[0]=="compProperties"&&(LOG.reportError(wixErrors.WIXIFY_TIMEOUT,this._className,this._timeOutId,s),this._onAllWixifyParamsReady())},toString:function(){return"[Wixifier]"}},function(){}}),define.dataSchema("Button",{label:"resourceKey",toggleMode:"boolean",disabled:"boolean",iconSrc:"string",command:"string",commandParameter:"string",action:"string"}),define.dataSchema("Document",{renderModifiers:"object",name:"string",mainPage:"ref",mainPageId:"string",pages:"refList"}),define.dataSchema("FlatTheme",{THEME_DIRECTORY:{type:"themeUrl","default":"base"},BG_DIRECTORY:{type:"themeUrl","default":"base"},CONTACT_DIRECTORY:{type:"themeUrl","default":"base"},NETWORKS_DIRECTORY:{type:"themeUrl","default":"base"},EXTERNAL_LINKS_DIRECTORY:{type:"themeUrl","default":"base"},PAGES_DIRECTORY:{type:"themeUrl","default":"base"},WEB_THEME_DIRECTORY:{type:"webThemeUrl","default":"base"},font:{type:"font-family","default":"Arial,sans-serif"},bgId:{type:"imageId","default":"BG_USES_THEME_IMAGE"},bgSize:{type:"size","default":","},bgType:{type:"bgMode","default":"BG_USES_THEME_IMAGE"},siteBgColor:{type:"color","default":"0,0,0,1"},headerTextColor:{type:"color","default":"255,255,255,1"},headerBgColor:{type:"color","default":"0,0,0,0"},textColor:{type:"color","default":"255,255,255,1"},areaBgColor:{type:"color","default":"130,81,13,1"},iconBgColor:{type:"color","default":"255,255,255,1"},borderColor:{type:"color","default":"255,255,255,1"},fontHeader:{type:"font","default":"normal normal bold 2.4em/1.0em [font] {headerTextColor}"},fontTitle:{type:"font","default":"italic normal bold 2.0em/2.0em [font] {siteBgColor}"},fontSubTitle:{type:"font","default":"normal normal bold 1.2em/1.4em [font] {siteBgColor}"},fontButton:{type:"font","default":"normal normal bold 1.4em/2.2em [font] {areaBgColor}"},fontText:{type:"font","default":"normal normal normal 1.1em/1.1em [font] {siteBgColor}"},fontSmallText:{type:"font","default":"normal normal normal 0.5em/0.7em [font] {siteBgColor}"},borderContainer:{type:"border","default":"0.15em solid [borderColor]"},borderThumb:{type:"border","default":"0.15em solid [borderColor]"},borderButton:{type:"border","default":"0.15em solid [borderColor]"},borderIcon:{type:"border","default":"0.15em solid [borderColor]"},radiusContainer:{type:"radius","default":"0.6em 0.6em 0.6em 0.6em"},radiusThumb:{type:"radius","default":"0.6em 0.6em 0.6em 0.6em"},radiusButton:{type:"radius","default":"0.6em 0.6em 0.6em 0.6em"},radiusIcon:{type:"radius","default":"0.6em 0.0em 0.0em 0.6em"},padding1:{type:"padding","default":"1em 1em 1em 1em"},padding2:{type:"padding","default":"0.0em 0.5em 0.0em 0.5em"},padding3:{type:"padding","default":"1.0em 0.0em 1.0em 0.0em"},iconSize:{type:"number","default":"3.2"},bulletSize:{type:"number","default":"1.5"},headerSpacing:{type:"number","default":"0em"},componentSpacing:{type:"number","default":"0.45em"},itemSpacing:{type:"number","default":"0.75em"},thumbSpacing:{type:"number","default":"0.23em"},iconSpacing:{type:"number","default":"0.75em"}}),define.dataSchema("Header",{title:"string",imageSize:{type:"string","default":"medium"},image:"ref"}),define.dataSchema("Image",{"extends":"Link",title:"string",uri:"string",description:"string",height:"number",width:"number",borderSize:"string",alt:"string",originalImageDataRef:{type:"ref",description:"Original Image before edit","default":null}}),define.dataSchema("ImageList",{items:"refList"}),define.dataSchema("Link",{linkType:{type:"string","default":"FREE_LINK"},href:"string",text:"string",target:"string",icon:"string"}),define.dataSchema("TextLink",{linkType:{type:"string","default":"FREE_LINK"},href:"string",text:"string",target:"string",icon:"string"}),define.dataSchema("LinkList",{items:"refList",subType:"string"}),define.dataSchema("MediaItem",{componentType:"string",dateCreated:"string",description:"",fileName:"string",fileSize:"number",height:"number",width:"number",iconURL:"string",mediaType:"string",mimeType:"string",originalFileName:"string",sourceURL:null,tags:null,title:"",version:null}),define.dataSchema("MenuItem",{text:"string",refId:"ref",items:"list"}),define.oldClass({name:"core.datatypes.NavigationTreeDataClass",Class:{Extends:"core.managers.data.DataItemBase",initialize:function(e,t){var n=e.items,r=[];n&&this._convertRawItemsToMenuItems(n,r),e.items=r,this.parent(e,t)},_convertRawItemsToMenuItems:function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i={refId:r.refId,items:[],type:"MenuItem"},s=W.Data.createDataItem(i);t.push(s),r.items&&r.items.length>0&&this._convertRawItemsToMenuItems(r.items,s.get("items"))}},getItems:function(){return this._data.items||(this._data.items=[]),this._data.items},getAllItems:function(){var e=this.getItems(),t=[];return this._collectInternalItems(e,t)},getSubItems:function(e){var t=e.get("items"),n=[];return this._collectInternalItems(t,n)},_collectInternalItems:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];t.push(r),this._collectInternalItems(r.get("items"),t)}return t},getItemByRefId:function(e){var t=this.getItems();return this._getItemFromItemsByRefId(t,e)},_getItemFromItemsByRefId:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.get("refId")==t)return r;if(r.get("items")&&r.get("items").length>0){var i=this._getItemFromItemsByRefId(r.get("items"),t);if(i)return i}}},addItem:function(e,t,n){t?this._addSubItem(e,t,n):typeof n=="number"?this.getItems().splice(n,0,e):this.getItems().push(e)},_addSubItem:function(e,t,n){var r=this.getItemByRefId(t),i=r.get("items");typeof n=="number"?i.splice(n,0,e):i.push(e)},_createNavigationItem:function(e){var t={refId:e,items:[],type:"MenuItem"};return W.Data.createDataItem(t)},createAndAddNavigationItem:function(e,t,n){var r=this._createNavigationItem(e),i=this.getItemByRefId(t);this.addItem(r,t,n),this.fireDataChangeEvent({cause:"CREATED_AND_ADDED",parentItem:i,item:r})},deleteNavigationItem:function(e){var t=this.getItemByRefId(e),n=this.getItemParent(t,this),r=n.get("items"),i=t.get("items"),s=r.indexOf(t);if(i){var o=0;while(i.length>0){var u=i[0];this._moveItem(u,n,s+o),o++}}r.erase(t),this.fireDataChangeEvent({cause:"DELETE",item:t})},getItemLevel:function(e,t,n){var r;t?r=t.get("items"):r=this.getItems(),n||(n=0);for(var i=0;i<r.length;i++){var s=r[i];if(s==e)return n;if(s.get("items")&&s.get("items").length>0){var o=this.getItemLevel(e,s,n+1);if(typeof o=="number")return o}}},moveItemToParentAtIndex:function(e,t,n){this._moveItem(e,t,n),this.fireDataChangeEvent({cause:"MOVE",parentItem:t,item:e,newIndex:n})},_moveItem:function(e,t,n){var r=t?t.get("refId"):null,i=this.getItemParent(e,this),s=i.get("items");s.erase(e),this.addItem(e,r,n)},getItemParent:function(e,t){t=t||this;var n=t.get("items");for(var r=0;r<n.length;r++){var i=n[r];if(i==e)return t;if(i.get("items")&&i.get("items").length>0){var s=this.getItemParent(e,i);if(s)return s}}},isSubItemByRefId:function(e){var t=this.getItemByRefId(e),n=this.getItemParent(t);return n==this?!1:!0},getItemParentByRedId:function(e){var t=this.getItemByRefId(e);return this.getItemParent(t)},fireDataChangeEvent:function(e){this._dataManager.markDirtyObject(this),this._dataManager.flagDataChange(),this.fireEvent(Constants.DataEvents.DATA_CHANGED,e)},cloneData:function(){var e={},t=[];return e.type=this._dataType,e.metaData=this._data.metaData,e.id="MAIN_MENU",this.cloneItems(this.getItems(),t),e.items=t,e},cloneItems:function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=this.cloneSingleItem(r);t.push(i),r.get("items")&&r.get("items").length>0&&this.cloneItems(r.get("items"),i.items)}},cloneSingleItem:function(e){return{refId:e.get("refId"),items:[]}},isReady:function(){if(this._isReady)return!0;var e=this.getWaitingForReadyList();return e.length>0?this._isReady=!1:this._isReady=!0,this._isReady},getWaitingForReadyList:function(){var e=[],t=this.getAllItems(),n=this.getDataManager();for(var r=0;r<t.length;r++){var i=t[r],s=i.get("refId"),o=W.Data.isDataAvailable(s);o||e.push(s)}return e}}}),define.dataSchema("Menu",{dataClassRef:"core.datatypes.NavigationTreeDataClass"}),define.dataSchema("Page",{title:"string",hideTitle:"boolean",icon:"string",windowTitle:"string",descriptionSEO:"string",metaKeywordsSEO:"string",pageTitleSEO:"string",pageUriSEO:"string",hidePage:"boolean",underConstruction:"boolean",tpaApplicationId:"number",pageSecurity:{type:"object","default":{requireLogin:!1,passwordDigest:""}}}),define.dataSchema("RichText",{text:"string",defaultStyle:"string"}),define.dataSchema("RichTextImage",{text:"ref",image:"ref"}),define.dataSchema("Service",{title:"string",description:"string",image:"ref"}),define.dataSchema("ServiceList",{serviceType:"string",items:"refList"}),define.dataSchema("Text",{text:{type:"string","default":"asdf"}}),define.dataSchema("Theme",{properties:"object"}),define.dataSchema("TopLevelStyle",{skin:"string",style:"object",styleType:{type:"string","enum":["system","custom","userDefined"],description:"type of the style, defaults to system style","default":"system"},pageId:{type:"string",description:"for custom styles - id of the page where the component is"},compId:{type:"string",description:"for custom styles - id of the component that has the custom style"},componentClassName:{type:"string",description:"class name of the component type this style applies to"}}),define.dataSchema("TwitterFollow",{accountToFollow:{type:"string","default":"wix"}}),define.dataSchema("TwitterTweet",{defaultText:"string",accountToFollow:"string"}),define.dataSchema("WFlatTheme",{THEME_DIRECTORY:{type:"themeUrl","default":"base"},BG_DIRECTORY:{type:"themeUrl","default":"base"},CONTACT_DIRECTORY:{type:"themeUrl","default":"base"},NETWORKS_DIRECTORY:{type:"themeUrl","default":"base"},EXTERNAL_LINKS_DIRECTORY:{type:"themeUrl","default":"base"},PAGES_DIRECTORY:{type:"themeUrl","default":"base"},WEB_THEME_DIRECTORY:{type:"webThemeUrl","default":"base"},BASE_THEME_DIRECTORY:{type:"webThemeUrl","default":"base"},siteBg:{type:"background","default":"none 0 0 center center auto repeat no-repeat fixed {color_2}"},color:{type:"array",itemType:"color",defaultItems:["#000000","#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#333333","#666666","#999999","#AAAAAA","#DCDCDC","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF"]},font:{type:"array",itemType:"font",defaultItems:["normal normal normal 24px/1.2em Arial {color_5}","normal normal bold 16px/1.1em Arial {color_5}","italic normal bold 18px/1.1em Lobster {color_5}","normal normal bold 22px/1.1em Arial {color_5}","normal normal bold 20px/1.1em Arial {color_5}","normal normal normal 18px/1.3em Arial {color_5}","normal normal normal 16px/1.2em Arial {color_6}","normal normal normal 14px/1.3em Arial {color_6}","normal normal normal 12px/1.3em Arial {color_6}","normal normal normal 10px/1.3em Arial {color_6}","normal normal normal 8px/1.3em Arial {color_6}"]},border:{type:"array",itemType:"border",defaultItems:["0.15em solid [color_0]","0.15em solid [color_0]","0.15em solid [color_0]"]},padding1:{type:"padding","default":"0 0 0 0"},padding2:{type:"padding","default":"0.0em 0.5em 0.0em 0.5em"},padding3:{type:"padding","default":"1.0em 0.0em 1.0em 0.0em"},iconSize:{type:"number","default":"3.2"},bulletSize:{type:"number","default":"1.5"},headerSpacing:{type:"number","default":"0em"},componentSpacing:{type:"number","default":"0.45em"},itemSpacing:{type:"number","default":"0.75em"},thumbSpacing:{type:"number","default":"0.23em"},iconSpacing:{type:"number","default":"0.75em"}}),define.dataSchema("testType",{}),define.dataSchema("TemplateList",{id:"string",name:"string",previewSource:"string"}),define.dataPropertyItem("PhotoProperties",{imageSize:{type:"string","enum":["small","medium","large"],"default":"medium",description:"size of the image in runtime"}}),define.Class("core.managers.ConfigurationManager",function(e){var t=e;t.inherits("bootstrap.managers.BaseManager"),t.methods({_getEditorModel:function(){return window.editorModel},getEditorModelProperty:function(e){var t=this._getEditorModel();return t&&t[e]},getRendererModelProperty:function(e){return window.rendererModel&&window.rendererModel[e]},getLocationMapProperty:function(e){return window.serviceTopology&&window.serviceTopology.scriptsLocationMap&&window.serviceTopology.scriptsLocationMap[e]},getServiceTopologyProperty:function(){return function(e){var t={scriptsRoot:this.getLocationMapProperty("web")+"/",staticSkinUrl:this.getLocationMapProperty("skins")+"/",staticThemeUrl:this.getLocationMapProperty("web")+"/images/mobile/core/themes",staticThemeUrlWeb:this.getLocationMapProperty("skins")+"/images/wysiwyg/core/themes"};return window.serviceTopology&&(t[e]||window.serviceTopology[e])}}(),getImagesUrl:function(){var e=window.serviceTopology&&window.serviceTopology.scriptsLocationMap;return(e.web||e["html-wysiwyg"])+"/images"},getCoreThemesUrl:function(){var e=window.serviceTopology&&window.serviceTopology.scriptsLocationMap;return(e.core||e["html-client-core"])+"/images/core/themes"},getHelpServerUrl:function(){var e=this.getServiceTopologyProperty("helpServer")||"http://help.wixpress.com/support/main/html5";return window.wixEditorLangauge&&window.wixEditorLangauge!=="en"&&(e=e.replace("www",window.wixEditorLangauge)),e},setServiceTopologyProperty:function(e,t){window.serviceTopology[e]=t},getUserPublicUrl:function(){return this.getEditorModelProperty("publicUrl")},getUserDomainListUrl:function(){var e=this.getServiceTopologyProperty("premiumServerUrl");return e+"/wix/api/domainConsole"},getSiteId:function(){return window.siteId},getMetaSiteId:function(){return this.getEditorModelProperty("metaSiteId")||this.getRendererModelProperty("metaSiteId")},isMetaSiteTemplate:function(){return this.getEditorModelProperty("metaSiteTemplate")||!1},siteNeverSavedBefore:function(){return this.getEditorModelProperty("firstSave")},setMetaSiteId:function(e){window.editorModel.metaSiteId=e},userHasFacebookSite:function(){return this._userHasAppType(Constants.WEditManager.SITE_TYPE_FACEBOOK)},userHasMobileSite:function(){return this._userHasAppType(Constants.WEditManager.SITE_TYPE_MOBILE)},userHasWebSite:function(){return this._userHasAppType(Constants.WEditManager.SITE_TYPE_WEB)},_userHasAppType:function(e){var t=this.getEditorModelProperty("serviceMappings");if(!t)return!1;for(var n in t)if(t[n].applicationType==e)return!0;return!1},isPremiumUser:function(){var e=this.getEditorModelProperty("metaSiteData");return!e||!e.premiumFeatures?!1:e.premiumFeatures.length>0},getCreateMobileSiteLink:function(){var e=this.getServiceTopologyProperty("createMobileUrl"),t=this.getEditorModelProperty("metaSiteData").siteName,n=this.getMetaSiteId(),r=e+t+"?flashSiteId="+n;return r},getCreateFacebookSiteLink:function(){return this._getCreateWysiwygSiteLink(Constants.WEditManager.SITE_TYPE_FACEBOOK)},getCreateWebsiteLink:function(){return this._getCreateWysiwygSiteLink(Constants.WEditManager.SITE_TYPE_WEB)},_getCreateWysiwygSiteLink:function(e){var t=e==Constants.WEditManager.SITE_TYPE_WEB?this.getServiceTopologyProperty("createWebsiteUrl"):this.getServiceTopologyProperty("createFacebookUrl"),n=this.getMetaSiteId(),r=t+"?metasite="+n;return r},isInDebugMode:function(){return window.debugMode!=="nodebug"},isFacebookSite:function(){var e=this.getApplicationType();return e&&e.toLowerCase()==="htmlfacebook"},getDebugMode:function(){return window.debugMode},getApplicationType:function(){return window.rendererModel&&window.rendererModel.applicationType||window.siteHeader&&window.siteHeader.applicationType},getDocumentType:function(){return window.siteHeader&&window.siteHeader.documentType},getMediaStaticUrl:function(e){var t=this.getServiceTopologyProperty("staticMediaUrl")+"/";return/[^.]+$/.exec(e)[0]=="ico"&&(t=t.replace("media","ficons")),t},getResourcesStaticUrl:function(){var e=this.getServiceTopologyProperty("resourcesRoot");return e||this.getServiceTopologyProperty("scriptsRoot")+"/resources/wysiwyg/bundles/"},getLanguage:function(){return window.wixEditorLangauge||this.getEditorModelProperty("languageCode")},isReady:function(){return!0},clone:function(e){return this.parent(e)},createPackage:function(){},getCurrentOrigin:function(){var e="http://"+window.location.host;return e},getMetaSiteData:function(){return this.getEditorModelProperty("metaSiteData")},getPremiumFeatures:function(){var e=this.getRendererModelProperty("premiumFeatures");if(!e){var t=this.getMetaSiteData();e=t&&t.premiumFeatures}return e},getRunningExperiments:function(){return this.getEditorModelProperty("runningExperiments")||this.getRendererModelProperty("runningExperiments")},isPublicMode:function(){return!!window.publicModel},isPreviewMode:function(){return!this.isPublicMode()&&!this.isEditorMode()},isEditorMode:function(){return!!window.editorModel}})}),define.oldClass({name:"core.managers.LinkTypesManager",Class:{Extends:"bootstrap.managers.BaseManager",langFlag:!1,_allTypes:{FACEBOOK:{target:"http://www.facebook.com/wix",text:"Facebook",linkType:["EXTERNAL_LINKS","NETWORKS"],protocol:"http://",tip:"navigate to"},LINKEDIN:{target:"http://www.linkedin.com/wix",text:"LinkedIn",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},TWITTER:{target:"http://www.twitter.com/wix",text:"Twitter",linkType:["EXTERNAL_LINKS","NETWORKS"],protocol:"http://",tip:"navigate to"},CALL:{target:"212.000.0000",text:"Call Me",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"tel:",tip:"call"},SMS:{target:"212.000.0000",text:"Text Me",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"sms:",tip:"text"},EMAIL:{target:"feedback@wix.com",text:"Email",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"mailto:",tip:"send an email to"},MAP:{target:"wix offices new york",text:"Address",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"http://maps.google.com/maps?f=q&source=s_q&hl=en&q=",tip:"open map for address "},BLOGGER:{target:"http://www.blogger.com/wix",text:"Blogger",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},YOUTUBE:{target:"http://www.youtube.com/wix",text:"Youtube",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},FREE_LINK:{target:"http://www.wix.com",text:"Any link",linkType:["CONTACT","EXTERNAL_LINKS","NETWORKS"],protocol:"http://",tip:"navigate to"},FLICKR:{target:"http://www.flickr.com/wix",text:"Flickr",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},SKYPE:{target:"http://www.skype.com/wix",text:"Skype",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},MYSPACE:{target:"http://www.myspace.com/wix",text:"MySpace",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},VIMEO:{target:"http://www.vimeo.com/wix",text:"Vimeo",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"},DELICIOUS:{target:"http://www.delicious.com/wix",text:"Delicious",linkType:["NETWORKS"],protocol:"http://",tip:"navigate to"}},getLinkTypesByMeta:function(e){var t;if(this.langFlag===!1){for(t in this._allTypes)this._allTypes[t].text=W.Resources.get("EDITOR_LANGUAGE",t+"_TITLE");this.langFlag=!0}var n=[],r={},i=!0;for(t in this._allTypes)n=this._allTypes[t].linkType,n.indexOf(e)>=0&&(r[t]=this._allTypes[t],i=!1);return i==1&&LOG.reportError(wixErrors.LT_LINK_UNKNOWN,"LinkTypesManager","getLinkTypesByMeta",e+""),r},getNewLink:function(e){this._allTypes[e]||LOG.reportError(wixErrors.LT_INVALID_LINK_TYPE,"LinkTypesManager","getNewLink",e+"");var t=Object.clone(this._allTypes[e]);return t.metaData={isPreset:!0},t.linkType=e,t.type="Link",delete t.tip,delete t.protocol,t},getLinkIcon:function(e){return e.toLowerCase()+".png"},gotoLink:function(e){if(W.Viewer.isScrollLock())return;var t=e.get("linkType"),n=e.get("target");if(!W.Viewer.getPreviewMode()){var r=!this._skipForceFlash(n.toLowerCase())&&this._matchCurrentUrl(n.toLowerCase());r&&this.setForceFlashCookie();var i=n.toLowerCase().indexOf("https://")===0;i?n=n.replace("https://",""):n.toLowerCase().indexOf("http://")===0&&(n=n.replace("http://",""));var s=this._allTypes[t].protocol;s=="http://"&&i&&(s="https://");var o=s+n;this._changeLocation(o)}else W.Viewer.getLinkTipFunc()&&W.Viewer.getLinkTipFunc()(e,this)},_changeLocation:function(e){document.location.href=e},showLinkTip:function(e){var t=e.get("linkType"),n=this._allTypes[t].tip+" "+e.get("target");W.Preview.showPreviewTip("Link will",n)},isReady:function(){return!0},clone:function(e){return this.parent(e)},stripUrl:function(e){var t=e.replace(/(\w+:\/\/)*([\w\-_]+\.)*([\w\-_]+\.[\w\-_]+).*/,"$3"),n={com:!0,org:!0,net:!0,edu:!0,gov:!0,mil:!0,info:!0,co:!0,ac:!0},r=t.split("."),i=r[0];return n[i]?e.replace(/(\w+:\/\/)*([\w\-_]+\.)*([\w\-_]+\.[\w\-_]+\.[\w\-_]+).*/,"$3"):t},setForceFlashCookie:function(){var e=new Date;e.setTime(e.getTime());var t=20,n=new Date(e.getTime()+t*1e3*60);document.cookie="forceFlashSite=true;path="+window.location.pathname+";domain=."+this.stripUrl(window.location.hostname)+";expires="+n.toGMTString()},_skipForceFlash:function(e){return window.location.href.toLowerCase()==e},_matchCurrentUrl:function(e){return this.stripUrl(window.location.href.toLowerCase())==this.stripUrl(e)}}}),define.oldClass({name:"core.managers.ResourceManager",Class:{Extends:"bootstrap.managers.BaseManager",Resources:["scriptLoader","topology","W.Utils","W.Config"],_bundleMap:{EDITOR_LANGUAGE:"/resources/editor/bundles/html_editor_",WIXAPPS_LANGUAGE:"/resources/editor/wixapps/wixapps_",WIXAPPS2_LANGUAGE:"/resources/editor/wixapps2/wixapps2_"},Static:{STABLE_LANGUAGES:["en"],EXPERIMENTAL_LANGUAGES:["de","es","fr","it","pl","pt","ru","ja","ko","tr"]},initialize:function(){this.bundles={},this._currentBundle="EDITOR_LANGUAGE",this.langSymbol=this.getLanguageSymbol()},get:function(e,t,n){var r=this.getBundle(e,t);return r?r.hasOwnProperty(t)?r[t]:n?n:"localized item not found: [ "+t+"] in bundle: [ "+e+" ] ":"bundle wasn't loaded yet: [ "+e+" ] when requesting [ "+t+" ]"},getCur:function(e,t){return this.get(this._currentBundle,e,t)},getBundle:function(e,t){var n=this.bundles[e];return n||LOG.reportError(wixErrors.RESOURCE_MANAGER_BUNDLE_NOT_FOUND,"mobile.editor.managers.ResourceManager","getBundle",[e,t]),n},getUrlForLanguage:function(e,t){t=t||this.langSymbol;var n=this.resources.topology.langs;return n+(this._bundleMap[e]||this._bundleMap.EDITOR_LANGUAGE)+t+".json"},setBundle:function(e,t){this.bundles[e]=t},replacePlaceholders:function(e,t){if(typeof t!="string")return"";var n=this.getBundle(e,t);return t.replace(/\[.+?\]/g,function(e){var t=e.substring(1,e.length-1),r=n[t];return r!==undefined?r:e})},loadLanguageBundle:function(e,t,n){var r=this.getUrlForLanguage(e),i=this;this.resources.scriptLoader.loadResource({url:r},{onLoad:function(r){i.setBundle(e,r),i.define.resource(e,r),t.call(i,r,e,n)},onFailed:function(s){i.setBundle(e,{}),i.define.resource(e,{}),t.call(i,s,e,n),LOG.reportError(wixErrors.LANGUAGE_PACK_FAILED_TO_LOAD,{c1:e,c2:r,language:n})}})},getLanguageSymbol:function(){var e="en",t=this.resources.W.Utils.getQueryParam("lang"),n=String(t||this.resources.W.Config.getLanguage()||e).toLowerCase(),r=this.resources.W.Config.getRunningExperiments();if(this.STABLE_LANGUAGES.contains(n)||this.EXPERIMENTAL_LANGUAGES.contains(n)&&r&&(r.MultiLang==="New"||r["Lang_"+n]==="New"))e=n;return window.wixEditorLangauge=e},clone:function(e){var t=this.parent(e);return t.bundles=this.bundles,t._currentBundle=this._currentBundle,t}}}),define.Class("core.managers.components.BCComponentDeserializer",function(e,t){var n=e;n.utilize(["core.managers.components.ComponentBuilder"]),n.methods({initialize:function(){},deserializeComponents:function(e,t,n){var r=e.map(this._createBuilderFromCompDescription.bind(this)),i=[];r.forEach(function(e){e.onCreated(function(e,s){i.push(e),i.length===r.length&&t(i),(n||function(){})(e,s)}).create()})},deserialize:function(e,t){this._createBuilderFromCompDescription(e).onCreated(t).create()},_createBuilderFromCompDescription:function(e){var t=this._initBuilder(e),n=e.components||[];return this._createChildren(n).each(this._attchToBuilder(t)),t},_createChildren:function(e){return e.map(this._createBuilderFromCompDescription.bind(this))},_attchToBuilder:function(e){return function(t){e.withChild(t)}},_initBuilder:function(e){var t=new this.imports.ComponentBuilder;return t.withType(e.comp||e.componentType).withSkin(e.skin)._with("htmlId",e.htmlId||e.id).withUid(e.uId)._with("propertyQuery",e.propsID)._with("styleId",e.styleId).withData(e.dataQuery).withArgs(e.argObject)._with("layout",e.layout)._with("paddingBottom",e.paddingBottom)._with("minHeight",e.minHeight)}})}),define.Class("core.managers.component.BaseCompSchemaGenerator",function(e,t){var n=e,r=t;n.statics({generateComponentSchema:function(e,t){if(!e)return;var n=this._aggregateSchema(e,t);e.$compSchema=n,e.prototype.$compSchema=n},_aggregateSchema:function(e,t){t=t||{};var n={},r=this._getTraitsWithNewSchemaField(e);for(var i=0;i<r.length;++i){var s=r[i],o=s._definitionFieldName_,u=s._fieldName_,a=s._aggregateSchema_,f=t[o];n[u]=this._aggregateSchemaField(e,f,a,o,u)}return n},_aggregateSchemaField:function(e,t,n,i,s){var o;switch(r.getInheritStrategy(t)){case r.STRATEGIES.INHERIT:o=this._aggregateInheritSchema(e,n,s),o=this._aggregateTraits(e,o,n,i);break;case r.STRATEGIES.MERGE:o=this._aggregateInheritSchema(e,n,s),o=this._mergeFieldData(o,t,n),o=this._aggregateTraits(e,o,n,i);break;case r.STRATEGIES.OVERRIDE:o=n(t),o=this._aggregateTraits(e,o,n,i)}return o},_aggregateInheritSchema:function(e,t,n){var r=e.prototype.Extends;return r.$compSchema&&r.$compSchema[n]||null},_aggregateTraits:function(e,t,n,i){var s=this._getClassTraitsWithoutParentTraits(e);for(var o=0;o<s.length;++o){var u=s[o].prototype,a=s[o]._classDef_,f=a[i];r.getInheritStrategy(f)===r.STRATEGIES.MERGE&&(t=this._mergeFieldData(t,f,n))}return t},_mergeFieldData:function(e,t,n){var r=t.include||null,i=t.exclude||null;return n(e,r,i)},_getClassTraitsWithoutParentTraits:function(e){var t=e.prototype.Implements,n=e.prototype.Extends;if(n){var r=n.prototype.Implements;t=t.filter(function(e){if(!r.contains(e))return e})}return t},_getTraitsWithNewSchemaField:function(e){var t=e.prototype.Implements;return t.filter(function(e){if(typeof e._fieldName_=="string"&&typeof e._aggregateSchema_=="function")return e})}})}),define.oldClass({name:"mobile.core.components.base.BaseComponent",imports:["core.components.base.SizeLimits"],Class:{Extends:"bootstrap.utils.Events",Binds:["getComponentProperties","_setSkinPartElements","_onDataChange","_onDefaultAction","_replaceSkin","_replaceSkinAsync","_onRenderingTriggerEvent","_onComponentWixified","_onEditModeChanged","_skinParamsChange"],Static:{MINIMUM_X_DEFAULT:-2e3,MAXIMUM_X_DEFAULT:2e3,MINIMUM_Y_DEFAULT:-1e3,MAXIMUM_Y_DEFAULT:4e4,MINIMUM_WIDTH_DEFAULT:5,MINIMUM_HEIGHT_DEFAULT:5,MAXIMUM_WIDTH_DEFAULT:2500,MAXIMUM_HEIGHT_DEFAULT:2e3},EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[]},_renderTriggers:[],initialize:function(e,t,n){this._onRender=this._onRender.bind(this),this.initComponentLayout=this.initComponentLayout.bind(this),this._layoutInitialized=!1,this._anchors=[],this._$x=this._$y=0,this._$width=this._$height=100,this._reverseAnchors=[],this._actualHeight=-1,this._autoSizeTimerIntervals=-1,this.addEvent("render",this._onRender),this.addEvent("autoSized",this._onAutoSized),this.addEvent("autoSizedAnimation",this._onAutoSizedAnimation),this._baseComponentOriginalInitialize(e,t,n),this._showOnAllPagesChangeability=!0,this._wysiwygMode=!0,this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.BOTTOM,Constants.BaseComponent.ResizeSides.RIGHT],this._moveDirections=[Constants.BaseComponent.MoveDirections.HORIZONTAL,Constants.BaseComponent.MoveDirections.VERTICAL],this._view.setStyle("visibility","hidden"),this.addEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout)},isDraggable:function(){return!0},_baseComponentOriginalInitialize:function(e,t,n){this._compId=e,this._view=t,this.$view=t,this._styleNameSpace=n&&n.styleNameSpace,this._isEnabled=!t.disabled,this._view.setProperty("id",n&&n.id||e),this._allComponentPartsReady=!1,this._componentReady=!1,this._isRenderNeeded=!0,this._autoBoundParts=null,this._isDisposed=!1,this._isRendered=!1,this._editorMode="CURRENT_PAGE";var r=n&&n.command||t.getAttribute("command");this._commandParameter=n&&n.commandParameter||t.getAttribute("commandParameter"),this._command=null,this._commandName=null,this._usesExternalData=!1,this._callLaterIDs=[],this._stateGrpDict={},this._sizeLimits=this.getSizeLimits(),this._minimumTimeBetweenRenders=this._minimumTimeBetweenRenders||0,this._lastRenderTime=-9999,this._renderDelayed=!1,r&&this.setCommand(r,this._commandParameter),this._isDisplayed=!1,t.addEvent(Constants.ComponentEvents.WIXIFIED,this._onComponentWixified),this.injects().Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditModeChanged)},toString:function(){return"[Component "+this.className+" #"+this._compId+"]"},getComponentId:function(){return this._compId},getComponentType:function(){return this._view.get("comp")},_getDataManager:function(){return this._data.getDataManager()},getViewNode:function(){return this._view},getStyleNameSpace:function(){return this._styleNameSpace||this.getOriginalClassName()},getSizeLimits:function(){return this._sizeLimits===undefined&&(this._sizeLimits=new this.imports.SizeLimits,this._sizeLimits.minW=this._sizeLimits.minW||this.MINIMUM_WIDTH_DEFAULT,this._sizeLimits.minH=this._sizeLimits.minH||this.MINIMUM_HEIGHT_DEFAULT,this._sizeLimits.maxW=this._sizeLimits.maxW||this.MAXIMUM_WIDTH_DEFAULT,this._sizeLimits.maxH=this._sizeLimits.maxH||this.MAXIMUM_HEIGHT_DEFAULT,this._originalSizeLimits=this._sizeLimits.clone()),this._sizeLimits},_initSizeLimits:function(){},setMinW:function(e){this.getSizeLimits().minW=e,this._originalSizeLimits.minW=e,this._applySizeLimitsIfNeeded()},setMinH:function(e){this.getSizeLimits().minH=e,this._originalSizeLimits.minH=e,this._applySizeLimitsIfNeeded()},setMaxW:function(e){this.getSizeLimits().maxW=e,this._originalSizeLimits.maxW=e,this._applySizeLimitsIfNeeded()},setMaxH:function(e){this.getSizeLimits().maxH=e,this._originalSizeLimits.maxH=e,this._applySizeLimitsIfNeeded()},_applySizeLimitsIfNeeded:function(){(this._$width<this.getSizeLimits().minW||this._$width>this.getSizeLimits().maxW)&&this.setWidth(this._$width),(this._$height<this.getSizeLimits().minH||this._$height>this.getSizeLimits().maxH)&&this.setHeight(this._$height)},getAcceptableDataTypes:function(){return[""]},getRawData:function(){return this._data?this._data.getData():undefined},getDataItem:function(){return this._data},isUsingExternalData:function(){return this._usesExternalData},setDataItem:function(e){var t=this._data;try{t&&(t.removeComponentWithInterest(this),t.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange))}catch(n){}this._data=e,e&&e!=t&&(this._data.addComponentWithInterest(this),this._data.addEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange)),this._onDataChange(e),this._tryCreatingComponentParts()},setDataByQuery:function(e,t){this.injects().Data.getDataByQuery(e,function(e){this.setDataItem(e),t()}.bind(this))},_setSkinPartElements:function(e){this._validateSkinParts(e),this._skinPartElements=e,this._tryCreatingComponentParts()},_validateSkinParts:function(e){for(var t in this._skinPartsSchema){var n=this._skinPartsSchema[t];!e[t]&&!n.optional&&n.autoCreate!==!1&&!n.repeater&&LOG.reportError(wixErrors.SKIN_PART_MISSING,this.$className+" / "+this._skin.$className,"_validateSkinParts",t)()}},_tryCreatingComponentParts:function(){this._skinPartElements&&(this._data||this.getAcceptableDataTypes().indexOf("")>=0)&&this._loadComponentParts()},_loadComponentParts:function(){this._allComponentPartsReady=!1,this._skinParts=this._skinPartElements;var e={},t=[],n={};for(var r in this._skinPartsSchema){if("view"==r)continue;var i=this.getSkinPartDefinition(r),s=this._doesSkinPartNeedAutoWixification(r,!0,i);if(s){var o=this._skinParts[r]||new Element("div");e[r]=o,n[r]=i,t.push(o)}}delete this._skinPartElements;var u=this;if(t.length!==0){var a=new Async.Bulk(t,null,{completeEvent:Constants.ComponentEvents.READY,onComplete:function(){for(var t in e){var n=e[t];t=n.get("skinPart"),t&&(u._skinParts[t]=n.getLogic())}u._setAllPartsReady()}});for(r in e)this._createInnerComponent(r,e[r],!0,n[r])}else this._setAllPartsReady()},_doesSkinPartNeedAutoWixification:function(e,t,n){return n=n||this.getSkinPartDefinition(e),n.type==Constants.ComponentPartTypes.HTML_ELEMENT||n.repeater?!1:t&&n.autoCreate===!1?!1:!0},_createInnerComponent:function(e,t,n,r){r=r||this.getSkinPartDefinition(e);if(r.type==Constants.ComponentPartTypes.HTML_ELEMENT||r.repeater)return;if(n&&r.autoCreate===!1)return;return r.skin=r.skin||t.getProperty("skin"),this._createComponentbyDefinition(r,t)},_createComponentbyDefinition:function(e,t,n){t=t||new Element("div"),t.setProperty("skinPart",e.id);var r;if(e.dataQuery)r=e.dataQuery;else if(e.dataRefField){var i=e.dataRefField;i=="*"?r=this._data:r=this._data.get(i)}else if(e.dataItem)r=e.dataItem;else if(e.dataType){var s=this._data?this._data.getDataManager():W.Data;r=s.addDataItemWithUniqueId("",{type:e.dataType}).dataObject,r.setMeta("isPersistent",!1)}this._data&&this._data.getDataManager()!=W.Data?t.set("dataQuerySource","preview"):e.dataQuerySource&&t.set("dataQuerySource",e.dataQuerySource),e.argObject=e.argObject||{};var o;e.styleGroup&&this._style&&(o=e.styleGroup=="inherit"?this._style:this._style.getStyleByGroupName(e.styleGroup));var u;if(n||o)u=function(e){o,n&&n(e)};return this.injects().Components.createComponent({compNode:t,type:e.type,skin:e.skin,data:r,args:e.argObject,componentReadyCallback:u,innerStyle:o})},getSkinPartDefinition:function(e){var t=this._skinPartsSchema[e];if(!t)return LOG.reportError(wixErrors.CM_NO_PART,this.className,"getSkinPartParams",skinPartName),ret;var n=this._skinPartsSchema[e]||{},r=this._skin&&this._skin.getCompPartsDefinition()[e]||{},i=Object.merge({id:e},r,n);return i.hookMethod&&typeOf(this[i.hookMethod])=="function"&&(i.argObject=i.argObject||{},i=this[i.hookMethod](i)),i},_setAllPartsReady:function(){if(this._allComponentPartsReady)return;this._allComponentPartsReady=!0,this._registerDataBindings(),this._registerSkinPartCommands(),this._applySizeLimitsIfNeeded(),this._onAllSkinPartsReady(this._skinParts),this._renderIfReady()},setTextContent:function(){W.Utils.debugTrace("")},setSkin:function(e){this._skin&&this._skin.unRegister();if(this._skinParts&&this._skinParts.inlineContent){var t=this._skin.getInlineContent();this._view.empty(),this._view.adopt(t)}this._skin=e;var n=this.getSizeLimits(),r=this._originalSizeLimits;n.minW=this._skin.minW||r.minW,n.minH=this._skin.minH||r.minH,n.maxW=this._skin.maxW||r.maxW,n.maxH=this._skin.maxH||r.maxH,this._skin.register(this._view,this._setSkinPartElements,this._skinParamsChange)},initSkinAndStyle:function(e,t){if(this._skin)return;this._skin=e,this._style=t;var n=this.getSizeLimits(),r=this._originalSizeLimits;n.minW=this._skin.minW||r.minW,n.minH=this._skin.minH||r.minH,n.maxW=this._skin.maxW||r.maxW,n.maxH=this._skin.maxH||r.maxH,this._skin.applyStyle(t),this._updateViewAttributes(),this._style.addEvent("skinChange",this._replaceSkinAsync),this._skin.register(this._view,this._setSkinPartElements,this._skinParamsChange),this._onStyleReady()},setStyle:function(e){if(e===this._style)return;this._style&&this._style.removeEvent("skinChange",this._replaceSkinAsync),this._style=e,e.getSkin()!=this._skin.getOriginalClassName()?this._skin.injects().Skins.getSkin(e.getSkin(),this._replaceSkin):this._skin.applyStyle(e),this._updateViewAttributes(),this._style.addEvent("skinChange",this._replaceSkinAsync),this._onStyleReady()},_onEditModeChanged:function(e){var t=this._editorMode;this._editorMode=e,this._editModeChanged(e,t)},_editModeChanged:function(e,t){},_onStyleReady:function(){},getStyle:function(){return this._style},_replaceSkinAsync:function(){this._skin.injects().Skins.getSkin(this._style.getSkin(),this._replaceSkin)},_replaceSkin:function(e){var t=new e;t.applyStyle(this._style),this.setSkin(t)},_updateViewAttributes:function(){this._view.removeAttribute("styleId"),this._view.setAttribute("skin",this._skin.$className),this._style&&(this._view.removeAttribute("skin"),this._view.setAttribute("styleId",this._style.getId()))},render:function(){},_onAllSkinPartsReady:function(){},_onDataChange:function(e,t,n){this._preventRenderOnDataChange(e,t,n)||this._renderIfReady()},_preventRenderOnDataChange:function(e,t,n){},_renderIfReady:function(){this._componentReady?this._tryRender(!0):this._testComponentReady()},renderIfNeeded:function(){this._componentReady?this._tryRender(!1):this._testComponentReady()},_tryRender:function(e){this._isRenderNeeded=this._isRenderNeeded||!!e;if(!this._componentReady||!this._needsRender()||!this._allComponentPartsReady)return this._componentReady&&this._allComponentPartsReady;var t=!1;if(this._minimumTimeBetweenRenders===0||this._timeSinceLastRender()>this._minimumTimeBetweenRenders)this._prepareForRender()&&(t=!0,this.fireEvent(Constants.ComponentEvents.READY_FOR_RENDER),!this._skipRender&&this._isDisplayed&&(this._isRenderNeeded=!1,this._newlyDisplayed=!1,this._lastRenderTime=(new Date).getTime(),this.render(),this._isRendered=!0,this._refreshDataBindings(),this._areRenderingTriggersAttached||(this._areRenderingTriggersAttached=!0,this._attachRenderTriggers()),this.fireEvent(Constants.ComponentEvents.RENDER),this._view.fireEvent(Constants.ComponentEvents.RENDER)));else if(!this._renderDelayed){this._renderDelayed=!0;var n=Math.max(10,this._minimumTimeBetweenRenders-this._timeSinceLastRender());this.callLater(this._delayedRenderCB,[e],n)}return t},_delayedRenderCB:function(e){this._renderDelayed=!1,this._tryRender(e)},_timeSinceLastRender:function(){return(new Date).getTime()-this._lastRenderTime},_needsRender:function(){return this._isRenderNeeded},isReady:function(){return this._componentReady},isRendered:function(){return this._isRendered},setCollapsed:function(e){e?this.collapse():this.uncollapse()},callLater:function(e,t,n){if(this._isDisposed)return;var r=this.injects().Utils.callLater(e,t,this,n);return r&&this._callLaterIDs.push(r),r},callRenderLater:function(e){if(this._isDisposed)return;e=e||100,this._renderDelayed||(this._renderDelayed=!0,this.callLater(function(){this._renderDelayed=!1,this._renderIfReady()}.bind(this),[],e))},collapse:function(){this._view&&this._view.collapse()},uncollapse:function(e){this._view&&this._view.uncollapse(e)},setState:function(e,t){this._processStates();var n=this._currentState;t||(t=this._stateGrpDict[e]||"DEFAULT"),t=t.toUpperCase();var r=this._stateMap[t];r?r.indexOf(e)<0?LOG.reportError(wixErrors.CM_UNKNOWN_STATE_NAME,this.$className,"setState",t+":"+e):(this._currentStateMap[t]=e,this._syncState()):LOG.reportError(wixErrors.CM_UNKNOWN_STATE_GROUP,this.$className,"setState",t)},hasState:function(e,t){this._processStates(),t||(t=this._stateGrpDict[e]||"DEFAULT"),t=t.toUpperCase();var n=this._stateMap[t];return n?n.indexOf(e)<0?!1:!0:!1},removeState:function(e,t){this._processStates(),t=(t||"DEFAULT").toUpperCase();var n=this._stateMap[t];if(!n)LOG.reportError(wixErrors.CM_UNKNOWN_STATE_GROUP,this.$className,"removeState",t);else{var r=this._currentStateMap[t];r==e&&delete this._currentStateMap[t],this._syncState()}},_syncState:function(){var e=[];for(var t in this._stateMap)this._currentStateMap[t]&&e.push(this._currentStateMap[t]);var n=e.join(" "),r=this._view,i=this._currentState||"";this._currentState=n;if(r===null)return;r.setProperty("state",n),r.addClass("FOCRE_REFLOW_PLEASE"),r.removeClass("FOCRE_REFLOW_PLEASE"),n!=i&&(this._onStateChange(n,i),this.fireEvent("stateChange",{newState:n,oldState:i}),r.triggerDisplayChanged())},getState:function(e){var t;return e?(this._currentStateMap||this._processStates(),t=this._currentStateMap[e.toUpperCase()]):t=this._view.getProperty("state"),t||""},_processStates:function(){if(this._stateMap)return;var e,t;this._currentStateMap={},this._stateMap={DEFAULT:[]};var n=this._states||[],r={};if(n instanceof Array)for(e=0;e<n.length;++e)t=n[e],typeof t!="string"?LOG.reportError(wixErrors.CM_MALFORMED_STATES,this.$className,"_processStates",n):this._stateMap.DEFAULT.push(t);else if(typeof n=="object")for(var i in n){var s=n[i];if(s instanceof Array){var o=i.toUpperCase();this._stateMap[o]=s.concat();for(e=0;e<s.length;++e)t=s[e],t in r&&LOG.reportError(wixErrors.CM_DUPLICATE_STATE_NAME,this.$className,"_processStates",t),r[t]=!0,this._stateGrpDict[t]=o}else LOG.reportError(wixErrors.CM_MALFORMED_STATES,this.$className,"_processStates",i)}else LOG.reportError(wixErrors.CM_MALFORMED_STATES,this.$className,"_processStates",n)},dispose:function(){W.Layout&&W.Layout.deleteSavedAnchorsById(this.getID());if(this._isDisposed)return LOG.reportError(wixErrors.COMPONENT_ALREADY_DISPOSED,this.className,"dispose",this._compId);this._view&&(this._view.cleanup(),this._view.destroy(),this._view=null,this.$view=null,this._isDisposed=!0),this._data&&(this._data.removeComponentWithInterest(this),this._data.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange),this._data.getDataManager().removeDataItem(this._data),delete this._data),this._properties&&(this._properties.removeComponentWithInterest(this),this._properties.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange),this._properties.getDataManager().removeDataItem(this._properties),delete this._properties);while(this._callLaterIDs.length>0){var e=this._callLaterIDs.pop();e&&this.injects().Utils.clearCallLater(e)}this.removeEvents();var t=this.injects().Commands;t&&t.unregisterListener(this),this.getSkin()&&this.getSkin().dispose();if(this._skinParts){for(var n in this._skinParts){var r=this._skinParts[n];if(r)if(r._compId)try{r.dispose()}catch(i){}else try{r.cleanup(),r.destroy()}catch(s){}}this._skinParts=null}},getIsDisposed:function(){return this._isDisposed},_onComponentWixified:function(){var e=this._view;this._canFocus&&(e.addEvent(Constants.CoreEvents.FOCUS,this._onFocus.bind(this)),e.addEvent(Constants.CoreEvents.BLUR,this._onBlur.bind(this))),this._isDisplayed=e.isNodeDisplayed(),this._areRenderingTriggersAttached=!1;var t=this._triggers;if(t)for(var n=t.length-1;n>=0;--n){var r=t[n];e.addEvent(r,this._onDefaultAction)}var i=Constants.DisplayEvents,s=this._onRenderingTriggerEvent;for(var o in Constants.DisplayEvents)e.addEvent(i[o],s)},_onComponentReady:function(){var e=this._view},_attachRenderTriggers:function(){var e=this._renderTriggers||[],t=this._view;for(var n=e.length-1;n>=0;--n)t.addEvent(e[n],this._onRenderingTriggerEvent)},_testComponentReady:function(){if(this._componentReady)return;if(this._view.getLogic)this._isBaseComponentReady()&&(this._componentReady=!0,this._isEnabled?this._handleEnabled():this._handleDisabled(),this._tryRender()?(this.fireEvent(Constants.ComponentEvents.READY),this._view.fireEvent(Constants.ComponentEvents.READY)):this._componentReady=!1);else{var e=function(){this._view.removeEvent(Constants.ComponentEvents.WIXIFIED,e),this._testComponentReady()}.bind(this);this._view.addEvent(Constants.ComponentEvents.WIXIFIED,e)}},_isBaseComponentReady:function(){return this._allComponentPartsReady&&!!this._skinParts&&(!!this._data||this.getAcceptableDataTypes().indexOf("")>=0)},_prepareForRender:function(){return!0},_onStateChange:function(e,t){},fancify:function(e){var t=this.injects().Components.createComponent("mobile.editor.components.FancyItem","mobile.editor.skins.FancyItemSkin",undefined,{},null,function(){var n=this;t.getLogic().createGui({dataPanel:this,upClickHandler:e.upCallback,downClickHandler:e.downCallback,deleteHandler:e.deleteCallback,showHideToggleHandler:e.isHiddenCallback,isHidden:e.initialIsHidden},this._skinParts.fancyContainer),t.getLogic()._skinParts.view.insertInto(n._skinParts.view),this._tryRender(!0),e.readyCallback&&e.readyCallback()}.bind(this))},_refreshDataBindings:function(){var e=this._autoBoundParts;if(!e||!e.length)return;var t=this._data&&this._data.getData(),n=this.injects(),r=n.Resources,i=n.Utils,s=this._skinParts;for(var o=e.length-1;o>=0;--o){var u=e[o],a,f=s[u.skinPart];if(!f)continue;if(u.bindToData){a=t&&t[u.bindToData];if(null===a||undefined===a){LOG.reportError(wixErrors.CM_NO_DATA,this.className,"refreshDataBindings",u.bindToData);continue}}else if(u.bindToDictionary){a=r.get("EDITOR_LANGUAGE",u.bindToDictionary);if(null===a||undefined===a){LOG.reportError(wixErrors.CM_NO_DICTIONARY_DATA,this.className,"refreshDataBindings",u.bindToDictionary);continue}}else u.bindToSelf&&(a=this[u.bindToSelf]);u.dictionaryFallback&&a.match(/^\s*$/)&&(a=r.get("EDITOR_LANGUAGE",u.dictionaryFallback));if(u.isView){var l=u.viewType;if(""===l){var c=f.nodeName;if(c.toLowerCase()=="input"){var h=f.getAttribute("type").toLowerCase();if("text"==h)l="textinput";else if("checkbox"==h||"radio"==h)l="check"}else l="text";u.viewType=l}if("textinput"==l)f.setAttribute("value",a);else if("check"==l){var p=i.stringToBoolean(a);p?f.setAttribute("checked",!0):f.removeAttribute("checked")}else f.innerHTML=a}else f.setTextContent(a)}},hide:function(){this._view&&this._view.hide()},show:function(){this._view&&this._view.show()},_disableLinks:function(e){var t=this;e.addEvent("click",function(e){var n=t.injects().Viewer;if(n.getPreviewMode()){e.preventDefault();if(W.Viewer.getLinkTipFunc()){var r=$(this).getProperty("href")||"",i=t.injects().Data.createDataItem({type:"Link",target:r,linkType:"FREE_LINK"});W.Viewer.getLinkTipFunc()(i)}}})},_sanitizeLinks:function(e){for(var t=0;t<e.length;++t){var n=e[t];this._sanitizeLink(n)}},_sanitizeLink:function(e){var t=e.get("href");t&&t.indexOf("http://")!==0&&t.indexOf("https://")!==0&&t.indexOf("telnet://")!==0&&t.indexOf("ftp://")!==0&&t.indexOf("mailto:")!==0&&(t.indexOf("@")>0?e.set("href","mailto:"+t):(t.indexOf("www")===0||t.indexOf("www")!==0&&t.indexOf("#")!==0)&&e.set("href","http://"+t))},_onFocus:function(){},_onBlur:function(){},_onDefaultAction:function(){this.executeCommand()},executeCommand:function(e){if(!this._command&&this._commandName){var t;this._commandName=="WEditorCommands.AddComponent"?t=W.CommandsNew.getCommand(this._commandName):t=W.Commands.getCommand(this._commandName),t&&this.setCommand(t,this._commandParameter)}if(this._command){var n=arguments.length>0?e:this._commandParameter;n&&(n=this._parseDataReference(n)),this._command.execute(n,this)}},enable:function(){this._isEnabled||(this._isEnabled=!0,this._view.removeAttribute("disabled"),this._handleEnabled())},disable:function(){this._isEnabled&&(this._isEnabled=!1,this._view.setAttribute("disabled","disabled"),this._handleDisabled())},isEnabled:function(){return this._isEnabled},setCommand:function(e,t){var n=this.injects().Commands;if(this._commandName=="WEditorCommands.AddComponent"||e=="WEditorCommands.AddComponent")n=this.injects().CommandsNew;if(typeof e=="string")this._commandName=e,e=n.getCommand(e);else if(!e instanceof n.Command&&!n.isCommandInstance(e)){LOG.reportError(wixErrors.BAD_COMMAND,this.className,"setCommand",e);return}this._commandParameter=t,this._command&&(this._command.unregisterListener(this),this._command=null),e?(this._command=e,e.registerListener(this,null,this._onCommandStatusChanged),this._commandName&&delete this._commandName):this._commandName&&n.registerCommandListenerByName(this._commandName,this,null,this._onCommandStatusChanged)},getCommandName:function(){return this._command?this._command.getName():this._commandName},getCommandParameter:function(){return this._commandParameter},_onCommandStatusChanged:function(e){e.isEnabled()?this.enable():this.disable()},_onEnabled:function(){},_handleEnabled:function(){var e=this._view,t=e.tabIndex,n=e._savedTabIndex;if(null===t||undefined===t)t=-1;-1==t&&(n!==undefined?e.tabIndex=n:this._canFocus&&(e.tabIndex=0)),this._canFocus&&e.addClass("focusable"),this._componentReady&&this._onEnabled()},_onDisabled:function(){},_handleDisabled:function(){var e=this._view,t=e.tabIndex;if(null===t||undefined===t)t=-1;t>=0&&(e._savedTabIndex=t,e.tabIndex=-1),document.activeElement==e&&e.blur(),this._canFocus&&e.removeClass("focusable"),this._componentReady&&this._onDisabled()},_onRenderingTriggerEvent:function(e){var t=this._view.isNodeDisplayed();switch(e){case Constants.DisplayEvents.COLLAPSED:case Constants.DisplayEvents.REMOVED_FROM_DOM:this._isDisplayed=!1,this._newlyDisplayed=!1;break;case Constants.DisplayEvents.SKIN_CHANGE:this._renderTriggers.contains(Constants.DisplayEvents.SKIN_CHANGE)&&(t?this._renderIfReady():this._componentInvalidated=!0);break;case Constants.DisplayEvents.MOVED_IN_DOM:this._view.isNodeDisplayed()&&this._renderTriggers.contains(Constants.DisplayEvents.MOVED_IN_DOM)&&this._renderIfReady(),this._skin.renderCssIfNeeded();break;default:var n=this._isDisplayed;this._isDisplayed=t,this._newlyDisplayed=this._newlyDisplayed||!n&&this._isDisplayed;var r=this._renderTriggers.contains(e)||this._renderTriggers.contains(Constants.DisplayEvents.DISPLAY_CHANGED);this._newlyDisplayed&&(r||!this._areRenderingTriggersAttached||this._componentInvalidated)&&(this._componentInvalidated=!1,this._renderIfReady()),this._skin.renderCssIfNeeded(),this._addedToDom()}},invalidateComponent:function(){this._componentInvalidated=!0},getIsDisplayed:function(){return this._isDisplayed},_addedToDom:function(){},checkVisibility:function(){return this._isDisplayed=this._view.isNodeDisplayed(),this._isDisplayed},_setDataField:function(e,t){this._data.set(e,t,!0)},_setMetaDataField:function(e,t){this._data.setMeta(e,t)},getFocusNode:function(){var e=this._skinParts.view;for(var t in this._skinPartsSchema)this._skinPartsSchema[t].focus&&(e=this._skinParts[t]||e);return e},getSkinPart:function(e){return this._skinParts[e]},getSkin:function(){return this._skin},setComponentProperties:function(e){var t=this._properties;this._properties=e,e.addComponentWithInterest(this),e&&e!=t&&this._properties.addEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange)},getComponentProperty:function(e){return this._properties||this._createComponentProperties(),this._properties.get(e)},setComponentProperty:function(e,t,n){this._properties||this._createComponentProperties(),this._properties.set(e,t,n)},_createComponentProperties:function(){if(!this._view)return;var e=this._compId,t=this._propertiesSchemaName;if(!t)return null;this._properties=W.ComponentData.addDataItem(e,{type:t},this),this._properties.addComponentWithInterest(this),this._view.setProperty("propertyQuery",e),this._properties.addEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange)},deleteComponentProperty:function(e){},_onComponentPropertyChange:function(e,t){},_loadComponentProperties:function(){},getComponentProperties:function(){return this._properties||this._createComponentProperties(),this._properties},_registerSkinPartCommands:function(){var e=this._skinPartsSchema,t=this.injects().Commands;for(var n in e){var r=e[n],i=this._skinParts[n],s=this._parseDataReference(r.command);if(!i||!s)continue;var o;typeof s=="string"?o=t.getCommand(s):o=s;if("view"==n||r.type==Constants.ComponentPartTypes.HTML_ELEMENT){var u=this._parseDataReference(r.commandParameter);o?i._command=o:i._commandName=s,i._commandParameter=u;var a=i.nodeName.toLowerCase();a=="select"?i.addEvent(Constants.CoreEvents.CHANGE,this._elementChangeExecuteCommand):i.addEvent(Constants.CoreEvents.CLICK,this._elementExecuteCommand)}else i.setCommand(o||s,r.commandParameter)}},_registerDataBindings:function(){var e=[],t=this._skinPartsSchema;for(var n in t){var r=t[n],i=this._skinParts[n];if(!i)continue;var s=r.type==Constants.ComponentPartTypes.HTML_ELEMENT,o=s?i:i.getViewNode(),u=null,a=r.autoBindData||o&&o.getAttribute("autoBindData");a?u={bindToData:a}:(a=r.autoBindDictionary||o&&o.getAttribute("autoBindDictionary"),a?u={bindToDictionary:a}:(a=r.autoBindThis||o&&o.getAttribute("autoBindThis"),a&&(u={bindToSelf:a}))),u&&(u.skinPart=n,u.isView=s,u.viewType="",u.dictionaryFallback=r.dictionaryFallback,e.push(u))}e.length&&(this._autoBoundParts=e)},_parseDataReference:function(e){if(!e||typeof e!="string")return e;var t=e;try{var n=e.indexOf("this.");if(0===n){try{t=this[e.substring(5)]}catch(r){t=null}t||W.Utils.debugTrace(this.className+" unknown part data reference "+e)}else n=e.indexOf("data."),0===n&&(!this._data||!(t=this._data.get(e.substring(5))))&&W.Utils.debugTrace(this.className+" missing data for skinpart "+e)}catch(i){W.Utils.debugTrace(this.className+" error processing partData "+e)}return t},_elementExecuteCommand:function(e){var t=W.Commands;this._commandName=="WEditorCommands.AddComponent"&&(t=W.CommandsNew);var n=this._command||(this._command=t.getCommand(this._commandName));n&&n.execute(this._commandParameter||e,this)},_elementChangeExecuteCommand:function(e){var t=this.value,n=W.Commands;this._commandName=="WEditorCommands.AddComponent"&&(n=W.CommandsNew);var r=this._command||(this._command=n.getCommand(this._commandName));r&&r.execute(t)},hasChildren:function(){return!1},onPageVisibilityChange:function(e){},initComponentLayout:function(){this._view.setStyle("visibility","visible"),this.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout),this._valueFetchingRegex=/[-\d\.]+/;var e=["x","y","width","height"],t=!1;for(var n=0;n<e.length;n++){var r=e[n],i=this._view.get(r);if(i!=null&&i!=""){t=!0;var s="set"+r.capitalize();this[s](i,!0)}}this._layoutInitialized=!0;if(t&&this._view.hasAttribute("pos")===!1)this._view.getStyle("position")!="relative"&&this._view.setStyle("position","absolute");else{var o=this._view.getAttribute("pos");o&&this._view.setStyle("position",o)}this.saveCurrentDimensions(),this.saveCurrentCoordinates()},_onRender:function(){this._intervalID&&clearInterval(this._intervalID),this._wCheckForSizeChangeAndFireAutoSized(5),this.flushMinPhysicalHeightCache()},_wCheckForSizeChangeAndFireAutoSized:function(e){if(!this._view)return;this._autoSizeTimerIntervals=Math.max(e,this._autoSizeTimerIntervals);var t=function(){try{this._autoSizeTimerIntervals>1&&requestAnimFrame(t),this._autoSizeTimerIntervals>-1&&this._onAutoSized()}catch(e){}finally{this._autoSizeTimerIntervals--}}.bind(this);window.requestAnimFrame(t)},_addedToDom:function(){this._pendingAutoSize&&(this._onAutoSized(this._pendingAutoSizeArgs),delete this._pendingAutoSize,delete this._pendingAutoSizeArgs)},_onAutoSized:function(e){if(!this._view||!this._isDisplayed||this.getPhysicalHeight()==0){this._pendingAutoSize=!0,this._pendingAutoSizeArgs=e;return}var t=this._actualWidth;this.flushPhysicalHeightCache();var n=this.getPhysicalHeight(),r=this.getWidth(),i;this._lastHeightOnAutoSize?i=this._lastHeightOnAutoSize:i=0;if(n!=i||t!=r&&t){this._actualWidth=r;if(!e||!e.ignoreLayout){var s=!0;this.getAnchors()==null||W.Layout&&!W.Layout._validateAnchorTargetsRendered(this.getAnchors())?s=!1:this.getHorizontalGroup()!=null&&W.Layout&&!W.Layout._validateAnchorTargetsRendered(this.getHorizontalGroup())?s=!1:this._areAnchorsAlreadySet||(s=!1),this._anchorTargetsReady||s?(this._anchorsInvalidated=!1,this._anchorTargetsReady=!0,W.Layout&&W.Layout.enforceAnchors([this])):this._anchorsInvalidated=!0}}this._lastHeightOnAutoSize=n,this.fireEvent("autoSizeChange")},isAnchorsInvalidated:function(){return this._anchorsInvalidated===!0},_onAutoSizedAnimation:function(e){this._wCheckForSizeChangeAndFireAutoSized(20)},_skinParamsChange:function(e){this._view&&this._view.fireEvent(Constants.DisplayEvents.SKIN_CHANGE,Constants.DisplayEvents.SKIN_CHANGE),this._onAutoSized()},saveCurrentCoordinates:function(){this._lastCoords={x:this.getX(),y:this.getY()}},getCurrentCoordinates:function(){return this._lastCoords={x:this.getX(),y:this.getY()},this._lastCoords},getLastCoordinates:function(){return this._lastCoords||this.saveCurrentCoordinates(),this._lastCoords},saveCurrentDimensions:function(){this._lastDimensions={w:this.getWidth(),h:this.getHeight()}},getCurrentDimensions:function(){return this._lastDimensions={w:this.getWidth(),h:this.getHeight()},this._lastDimensions},getLastDimensions:function(){return this._lastDimensions||this.saveCurrentDimensions(),this._lastDimensions},getX:function(){return this._$x},setX:function(e){if(this._$x!=parseInt(e,10)){if(isNaN(parseInt(e,10))){W.Utils.debugTrace("WbaseComp","setX","NaN passed as value");return}this._$x=parseInt(e,10),this._view.setStyle("left",e+"px"),this.onMovement()}},getY:function(){return this._$y},setY:function(e){if(this._$y!=parseInt(e,10)){if(isNaN(parseInt(e,10))){W.Utils.debugTrace("WbaseComp","setY","NaN passed as value");return}this._$y=parseInt(e,10),this._view.setStyle("top",e+"px"),this.onMovement()}},getWidth:function(){return this._$width},setWidth:function(e,t,n){n!=0&&(n=!0),e=parseInt(e,10);if(isNaN(e)){W.Utils.debugTrace("WbaseComp","setWidth","NaN passed as value");return}e=this._limitWidth(e);if(this._$width!=e||t)this._$width=e,this._view.setStyle("width",e+"px"),n&&this._onResize(),this.flushMinPhysicalHeightCache(),this.flushPhysicalHeightCache()},setHeight:function(e,t,n){n!=0&&(n=!0),e=parseInt(e,10);if(isNaN(e)){W.Utils.debugTrace("WbaseComp","setHeight","NaN passed as value");return}e=this._limitHeight(e);if(this._$height!=e||t)this._$height=e,this._view.setStyle("min-height",this._$height+"px"),this.flushPhysicalHeightCache(),n&&this._onResize()},isInstanceOfClass:function(e){if(this.className==e)return!0;var t=this.$parentPrototype;while(t){if(t.className==e)return!0;t=t.$parentPrototype}return!1},isFixedPositioned:function(){return!1},getSelectableX:function(){return this.getX()},getSelectableY:function(){return this.getY()},getSelectableWidth:function(){return this.getWidth()},getSelectableHeight:function(){return this.getPhysicalHeight()},_limitWidth:function(e){return this._limitDimension(e,this.getSizeLimits().minW,this.getSizeLimits().maxW)},_limitHeight:function(e){return this._limitDimension(e,this.getSizeLimits().minH,this.getSizeLimits().maxH)},_limitDimension:function(e,t,n){return Math.min(Math.max(e,t),n)},getHeight:function(){return this._$height},_onResize:function(){this.fireEvent("resize")},onMovement:function(){this.fireEvent("componentMoved")},getPosition:function(){var e=this.getViewNode().getSize();return{y:this.getY(),x:this.getX(),height:e.y,width:e.x}},getGlobalPosition:function(){return this._view.getPosition()},getGlobalPositionRefNode:function(){return this._getEditBoxReferenceNode().getPosition()},getSizeRefNode:function(){return this._getEditBoxReferenceNode().getSize()},getID:function(){return this._view.getProperty("id")},getMinPhysicalHeight:function(){if(!this._minPhysicalHeight){var e=this.getHeight();this.setHeight(1),this._minPhysicalHeight=this.getPhysicalHeight(),this.flushPhysicalHeightCache(),this.setHeight(e)}return this._minPhysicalHeight},getPhysicalHeight:function(){return this._actualHeight=this._actualHeight||this.getViewNode().getSize().y,this._actualHeight=Math.max(this.getHeight(),this._actualHeight),this._actualHeight},getExtraPixels:function(e){return this.getDivExtraPixels(this._view,e)},getDivExtraPixels:function(e,t){var n=Number.from(e.getStyle("border-top"))+Number.from(e.getStyle("padding-top")),r=Number.from(e.getStyle("border-bottom"))+Number.from(e.getStyle("padding-bottom")),i=Number.from(e.getStyle("border-left"))+Number.from(e.getStyle("padding-left")),s=Number.from(e.getStyle("border-right"))+Number.from(e.getStyle("padding-right"));return t&&(n+=Number.from(e.getStyle("margin-top")),r+=Number.from(e.getStyle("margin-bottom")),i+=Number.from(e.getStyle("margin-left")),s+=Number.from(e.getStyle("margin-right"))),{top:n,bottom:r,left:i,right:s,height:n+r,width:i+s}},flushPhysicalHeightCache:function(){delete this._actualHeight},flushMinPhysicalHeightCache:function(){delete this._minPhysicalHeight},getAnchors:function(){return this._anchors},setAnchors:function(e){this._areAnchorsAlreadySet=!0,this._anchors=e,e.forEach(this.addReverseAnchor)},addAnchor:function(e){this._anchors.push(e),this.addReverseAnchor(e)},addReverseAnchor:function(e){e.toComp===this?this._reverseAnchors.include(e):e.toComp.addReverseAnchor(e)},getReverseAnchors:function(){return this._reverseAnchors},getHorizontalGroup:function(){return this._horizontalGroup},setHorizontalGroup:function(e){this._horizontalGroup=e},getLayoutMode:function(){return"NORMAL"},getMinDragY:function(e){return W.Layout&&W.Layout.getComponentMinDragY(this,e)},getParentComponent:function(){var e=this.getViewNode().getParent("[comp]");return e&&e.getLogic?e.getLogic():null},getResizableSides:function(){return this._resizableSides},isResizable:function(){return this._resizableSides.length>0},isHorizResizable:function(){return this._resizableSides.contains(Constants.BaseComponent.ResizeSides.RIGHT)||this._resizableSides.contains(Constants.BaseComponent.ResizeSides.LEFT)},isVertResizable:function(){return this._resizableSides.contains(Constants.BaseComponent.ResizeSides.TOP)||this._resizableSides.contains(Constants.BaseComponent.ResizeSides.BOTTOM)},isHorizontallyMovable:function(){return this._moveDirections.contains(Constants.BaseComponent.MoveDirections.HORIZONTAL)},isVerticallyMovable:function(){return this._moveDirections.contains(Constants.BaseComponent.MoveDirections.VERTICAL)},allowHeightLock:function(){return this.isVertResizable()},useLayoutOnDrag:function(){return!1},useLayoutOnResize:function(){return!1},isEditableInPlace:function(){return!1},getEditedContent:function(){return null},isContainable:function(e){return!0},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD}}},isSelectable:function(){return!0},isContainer:function(){return!1},isDeleteable:function(){return!0},isDuplicatable:function(){return!0},isDeleteableRecurse:function(){if(!this.isDeleteable())return!1;var e=this.getViewNode().getElements("[comp]");for(var t=0;t<e.length;t++){if(!e[t].getLogic)continue;if(!e[t].getLogic().isDeleteable())return!1}return!0},isMultiSelectable:function(){return!0},_createClickOverlay:function(){if(this.injects().Viewer.isPublicMode()||this._debugMode){this._socialOverlayElement&&this._socialOverlayElement.clear();return}if(this._socialOverlayElement)return;var e={};this._socialOverlayElement=new Element("A",e);var t=W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/transparent.gif";this._socialOverlayElement.setStyles({position:"absolute",top:"0",left:"0",height:"100%",width:"100%",background:"transparent url("+t+") repeat top left;"}),this._socialOverlayElement.addEvent("click",function(e){e.stopPropagation();var t={component:this};this.injects().Commands.executeCommand("socialWidget.interact",t,this)}.bind(this)),this.getViewNode().adopt(this._socialOverlayElement)},_getEditBoxReferenceNode:function(){return this._view},getShowOnAllPagesChangeability:function(){return this._showOnAllPagesChangeability},setShowOnAllPagesChangeability:function(e){this._showOnAllPagesChangeability=e},isSiteSegment:function(){return this.isInstanceOfClass("wysiwyg.viewer.components.HeaderContainer")||this.isInstanceOfClass("wysiwyg.viewer.components.PagesContainer")||this.isInstanceOfClass("wysiwyg.viewer.components.FooterContainer")},_addToolTipToSkinPart:function(e,t){e&&e.getViewNode&&(e=e.getViewNode()),e.addEvent("mouseenter",function(){W.Commands.executeCommand("Tooltip.ShowTip",{id:t},e)}.bind(this)),e.addEvent("mouseleave",function(){W.Commands.executeCommand("Tooltip.CloseTip")}.bind(this))},canMoveToOtherScope:function(){return!0},disableReportLayoutChange:function(){},enableReportLayoutChange:function(){}}}),define.Class("core.managers.components.ComponentBuilder",function(e,t){var n=e;n.methods({initialize:function(e){this.data={},this.data.children=[],this.withNode(e)},_with:function(e,t){return this.data[e]=t,t===undefined&&delete this.data[e],this},withType:function(e){return this._with("type",e)._with("comp",e)},withData:function(e){var t=typeof e=="string"?"dataQuery":"dataObject",n=typeof e!="string"?"dataQuery":"dataObject";return this._with(t,e)._with(n,undefined)},withChild:function(e){return this.data.children.push(e),this},withNode:function(e){return this._with("node",this._createNodeWithUidSoMooToolsWouldNotStackEventsOnAllNodes(e))},_createNodeWithUidSoMooToolsWouldNotStackEventsOnAllNodes:function(e){e||(e=!!W.Preview&&W.Preview.getPreviewSite?W.Preview.getPreviewSite().document.createElement("div"):document.createElement("div"));if(!e.uid){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)});e.uid=t}return e},withUid:function(e){return this._with("uid",e)},withSkin:function(e){return this._with("skin",e)},withParentLogic:function(e){return this._with("parentLogic",e)},withSkinParamMapper:function(e){return this._with("skinParamMapper",e)},withDomIdPrefix:function(e){return this._with("domIdPrefix",e)},withArgs:function(e){return this._with("args",e)},onSkinRequest:function(e){return this.skinProvider=e,this},onCreated:function(e){return this.onCreatedCallback=e,this},create:function(){this._validate()&&this._setCreatedEvent()._wixifyNodeWithChildren()},_wixifyNodeWithChildren:function(){var e=this.data.children.filter(function(e){return!e._isWixified()}),t=e.map(function(e){return e.data.node});e.length!=0?(new Async.Bulk(t,null,{completeEvent:Constants.ComponentEvents.WIXIFIED,onComplete:function(){this._wixifyNode()}.bind(this)}),e.each(function(e){e.onError(this.onErrorCallback).create()}.bind(this))):this._wixifyNode()},onError:function(e){return this.onErrorCallback=e,this},_wixifyNode:function(){this._setNodeAttribute("comp")._setNodeAttribute("skin")._setNodeAttribute("dataQuery")._setNodeAttribute("propertyQuery")._setNodeAttribute("styleId")._setNodeAttribute("paddingBottom")._setNodeAttribute("minHeight"),this._setNodeLayout()._setNodeIds(),this.data.node.wixify(this.data.args,this.data.dataObject,this.data.domIdPrefix,undefined,this.data.skinParamMapper,this.data.parentLogic)},_setNodeIds:function(){return this.data.node.uid=this.data.uid||this.data.node.uid,this.data.node.id=this.data.htmlId||this.data.node.id,this},_setNodeLayout:function(){return this.data.layout?(this.data.node.setAttribute("x",this.data.layout.x),this.data.node.setAttribute("y",this.data.layout.y),this.data.node.setAttribute("width",this.data.layout.width),this.data.node.setAttribute("height",this.data.layout.height),this):this},_setNodeAttribute:function(e){return this.data[e]&&this.data.node.setAttribute(e,this.data[e]),this},_setCreatedEvent:function(){if(typeof this.onCreatedCallback=="function"){var e=this.onCreatedCallback;this.data.node.addEvent(Constants.ComponentEvents.READY,function(){e(this.$logic,this)})}return this},_validate:function(){return this._validateType()&&this._validateSkin()&&this._validateNotWixified()},_validateType:function(){return this.data.type?!0:(this._callErrorHandler("you must set type before creating a component!"),!1)},_validateSkin:function(){return this.data.skin?!0:typeof this.skinProvider=="function"?this._validateSkinWithProvider():(this._callErrorHandler("you must set skin or set a skin-provider before creating a component!"),!1)},_validateSkinWithProvider:function(){var e=this.skinProvider();return e?(this.withSkin(e),!0):(this._callErrorHandler("skin-provider did not supply any skin"),!1)},_isWixified:function(){return!!this.data.node.$logic},_validateNotWixified:function(){return this._isWixified()?(this._callErrorHandler("you cannot create component on a wixified element"),!1):!0},_callErrorHandler:function(e){if(typeof this.onErrorCallback!="function")throw e;this.onErrorCallback(e)}})}),define.Class("core.managers.component.ComponentDefinition",function(e){var t=e;t.inherits(e.constructor),t.methods({initialize:function(){e.constructor.apply(this),this._skinParts_=undefined,this._dataTypes_=undefined,this._states_=undefined,this._propertiesSchemaType_=undefined},skinParts:function(e){this._skinParts_=e},dataTypes:function(e){this._dataTypes_=e},states:function(e){this._states_=e},propertiesSchemaType:function(e){this._propertiesSchemaType_=e}})}),define.Class("core.managers.component.ComponentManager",function(e){var t=e;t.utilize(["bootstrap.utils.Queue","core.managers.component.ComponentDefinition","mobile.core.components.base.BaseComponent","core.managers.component.BaseCompSchemaGenerator"]),t.resources(["W.Classes"]),t.inherits("bootstrap.managers.BaseManager"),t.binds(["_onClassReady","getComponent"]),t.methods({initialize:function(){this._componentQue=new this.imports.Queue,this._componentMap={},this._componentDefinitions={},this._pendingComponentClassMap={},this.resource.getResources(["W.Classes","W.Experiments"],function(e){this._experimentManager=e.W.Experiments,this._classManager=e.W.Classes,this._classManager.addClassNamespaceHook(this.getComponent),this._classManager.addClassReadyHandler(this._onClassReady)}.bind(this)),this._componentMap["mobile.core.components.base.BaseComponent"]=this.imports.BaseComponent,this.define.component.definitionModifier=this._onCompDefineCallBack.bind(this)},_onCompDefineCallBack:function(e,t){var n=this._componentQue.getQueue(e);return n&&n.length>0&&this.registerNewComponent(e,t),t},registerNewComponent:function(e,t){var n=new this.imports.ComponentDefinition;t(n,n._inheritStrategy_),n=this._experimentManager.applyExperiments(e,n),n=this._fixCompDefinition(e,n),this._validateNewComponent(e,n),this._pendingComponentClassMap[e]="pending",this._componentDefinitions[e]=n,this._classManager.registerClassDefinition(e,n)},_validateNewComponent:function(e,t){if(this._componentMap[e]){LOG.reportError(wixErrors.CM_NAME_ALREADY_EXIST,this.className,"newComponent",e)();return}},_fixCompDefinition:function(e,t){var n=t._skinParts_||{},r=t._imports_||[];for(var i in n){if(!n[i])continue;var s=n[i].type;if(s&&s!=Constants.ComponentPartTypes.HTML_ELEMENT&&r.indexOf(s)<0){var o=this.getNameOverride(s);r.push(o)}}t.utilize(r),t._fields_._skinPartsSchema=n,t._fields_._propertiesSchemaName=t._propertiesSchemaType_,t._dataTypes_&&(t._methods_.getAcceptableDataTypes=function(){return t._dataTypes_}),t._states_&&(t._fields_._states=t._states_);var u=t._methods_.onComponentReady;return u&&this._componentQue.add(e,u),t},newComponent:function(e){this.define.oldComponent(e)},_buildCompClassData:function(e,t,n,r){return{name:e,traits:t(),imports:n(),Class:r()}},_validateComponent:function(e,t,n,r,i){if(this._componentMap[e])return LOG.reportError(wixErrors.CM_NAME_ALREADY_EXIST,this.className,"_validateComponent > is new",e)(),!1;var s=i().Extends;if(!instanceOf(s,String)){LOG.reportError(wixErrors.CM_NO_EXTEND,this.className,"_validateComponent > has inherits",e)();return}return!0},_addImportsToCompClass:function(e,t){var n=t.imports||[],r=e&&e.skinParts||{};for(var i in r){var s=r[i].type;s&&s!=Constants.ComponentPartTypes.HTML_ELEMENT&&n.indexOf(s)<0&&n.push(s)}t.imports=n},override:function(e,t){if(!e)throw new Error("null/undefined component name for override");this._componentMap[e]=t},getComponent:function(e,t){e=this.getNameOverride(e);if(this._componentMap[e])return W.Utils.callLater(t,[this._componentMap[e]]),this._componentMap[e];var n=this.define.getDefinition("component"),r=nsUtil.getNameSpace(n,e),i=this._componentQue.hasQueue(e)===!1;return this._componentQue.add(e,t),i&&(r?this.registerNewComponent(e,r):this._classManager.getClass(e,function(){})),null},getNameOverride:function(e){return this.define.Class.$nameOverrides[e]||e},_onClassReady:function(e,t){if(!this._pendingComponentClassMap[e]){this._componentQue.removeKey(e);return}this._onComponentClassReady(t,e)},_onComponentClassReady:function(e,t){t=e.$originalClassName,this._componentMap[t]=e;var n=this._componentDefinitions[t];this.imports.BaseCompSchemaGenerator.generateComponentSchema(e,n);var r=this._componentQue.getQueue(t);r.forEach(function(e){e&&e(this._componentMap[t])}.bind(this)),this._componentQue.removeKey(t)},createComponent:function(e,t,n,r,i,s,o,u,a,f){if(e&&typeOf(e)=="object"){var l=e;e=l.type,t=l.skin||t,n=l.data||n,r=l.args||r,i=l.wixifyCallback||i,s=l.componentReadyCallback||s,o=l.domIdPrefix||o,u=l.compNode||u,f=l.innerStyle||l.skinParamMapper}if(!e||typeOf(e)!="string")return LOG.reportError(wixErrors.CM_LOGIC_TYPE,this.className,"createComponent","created from:"+this.className+""),new Element("span");var c={comp:e,skin:t};if(n){var h=typeof n;h=="string"?(c.dataQuery=n,n=null):h=="object"&&(n._dataType||LOG.reportError(wixErrors.WIXIFY_MISSING_DATA_TYPE,this.className,"createComponent","created from:"+this.className))}return u?u.setProperties(c):u=new Element("div",c),i&&typeof i=="function"&&u.addEvent("wixified",function(){i(u.getLogic())}),s&&typeof s=="function"&&u.addEvent(Constants.ComponentEvents.READY,function(){u.removeEvent(Constants.ComponentEvents.READY,arguments.callee),s(u.getLogic())}),n&&n._dataType?u.wixify(r,n,o,a,f):u.wixify(r,null,o,a,f),u},isReady:function(){return!0}})}),define.experimentPlugin("ExperimentComponentPlugin",function(e){function r(e,t){resource.getResourceValue("W.Classes",function(e){e.getClass("core.managers.component.ComponentDefinition",function(e){n=e})});var r=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),i=e;typeof e=="function"&&(i=new n,e(i));var s=new n;return t(s,r),i.inherits(s._extends_||i._extends_),i.resources(r._mergeField_(i._resources_,s._resources_)),i.binds(r._mergeField_(i._binds_,s._binds_)),i.traits(r._mergeField_(i._traits_,s._traits_)),i.utilize(r._mergeField_(i._imports_,s._imports_)),i.statics(r._mergeObjects_(i._statics_,s._statics_)),i.fields(r._mergeObjects_(i._fields_,s._fields_)),i.methods(r._mergeObjects_(i._methods_,s._methods_)),i.skinParts(r._mergeField_(i._skinParts_,s._skinParts_)),i.states(r._mergeField_(i._states_,s._states_)),i.dataTypes(r._mergeField_(i._dataTypes_,s._dataTypes_)),i.propertiesSchemaType(s._propertiesSchemaType_||i._propertiesSchemaType_),i}function i(e,t){define.component(e,t)}var t=e,n;t.init("component","newComponent",r,i)}),define.Const("components",{DEFAULT_PREFIX:"c",BASE_LIST_ITEM_PREFIX:"bli"}),define.Class("core.managers.componentlifecyclemanager.ComponentInfo",function(e){var t=e;t.statics({STATES:{INITIATED:"initiated",READY:"ready",ERROR:"error_in_comp",PAUSED:"paused"}}),t.fields({component:null,state:"",isDisplayed:!1,isDisplayedBefore:!1,error:null,parentComp:null,childComps:{}}),t.methods({initialize:function(e){this.component=e,this.state=this.STATES.INITIATED,this.childComps={}}})}),define.Class("core.managers.componentlifecyclemanager.ComponentLifecycleManager",function(e){var t=e;t.inherits("bootstrap.managers.BaseManager"),t.utilize(["core.managers.componentlifecyclemanager.ReflowTimer","core.managers.componentlifecyclemanager.ComponentMeasurer","core.managers.componentlifecyclemanager.ComponentRenderer","core.managers.componentlifecyclemanager.ComponentInfo"]),t.binds(["_beforeReflow","_afterReflow"]),t.statics({PHASES:{MEASURE_INITIATED:"measureInitiatedComps",MEASURE:"measure",COLLECT_RENDER_COMPS:"collectCompsForRender",RENDER:"render"}}),t.methods({initialize:function(){this._registeredComponents={};var e=this.imports.ReflowTimer;this._reflowTimer=new e,this._reflowTimer.on(e.REFLOW_EVENTS.BEFORE_REFLOW,this,this._beforeReflow),this._reflowTimer.on(e.REFLOW_EVENTS.AFTER_REFLOW,this,this._afterReflow),this._compMeasurer=new this.imports.ComponentMeasurer(this),this._compRenderer=new this.imports.ComponentRenderer(this),this.ComponentInfo=this.imports.ComponentInfo,this.run()},run:function(){this._reflowTimer.run()},pause:function(){this._reflowTimer.stop()},forceRender:function(){this._reflowTimer.forceReflow()},_beforeReflow:function(){this._compRenderer.updateLayoutForDisplayedComps(),this._compRenderer.renderComponents()},_afterReflow:function(){this._compMeasurer.invalidateDisplayAndMeasureAllDisplayedComponents()},registerComponent:function(e,t){var n=e.getComponentId();if(this._registeredComponents[n]){LOG.reportError(wixErrors.COMPONENT_ALREADY_REGISTERED_IN_LIFECYCLE,"ComponentLifecycleManager","registerComponent",n);return}var r=new this.ComponentInfo(e);return this._registeredComponents[n]=r,e.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._componentExterminated),t&&this._renderImmediate(r),this.forceRender(),r},_renderImmediate:function(e){},getComponentInfo:function(e,t){var n=e.getComponentId();return this._registeredComponents[n]?this._registeredComponents[n]:(!t&&LOG.reportError(wixErrors.COMPONENT_NOT_REGISTERED_IN_LIFECYCLE,"ComponentLifecycleManager",n),null)},getAllComponentsInfo:function(){return this._registeredComponents},setParentComponentProcess:function(e,t){var n=e.getComponentId(),r=this.getComponentInfo(e,!0),i=this.getComponentInfo(t,!0);i&&r&&(this.removeChildComponentProcess(e),i.childComps[n]=r,r.parentComp=i)},removeChildComponentProcess:function(e){var t=this.getComponentInfo(e,!0),n=t&&t.parentComp;if(n){var r=e.getComponentId();delete n.childComps[r],t.parentComp=null}},getComponentChildList:function(e,t,n){n=n||[];var r=e.childComps;for(var i in r){var s=r[i];s&&(t&&this.getComponentChildList(s,!0,n),n.push(s))}return n},_onComponentError:function(e,t,n){var r=e.component;e.state=e.STATES.ERROR,e.error=t,this._errorHandler&&this._errorHandler(e,t,n)},_componentExterminated:function(e){var t=e.target,n=t.getComponentId(),r=this._registeredComponents[n];r&&(this.removeChildComponentProcess(r.component),delete this._registeredComponents[n])},setComponentErrorHandler:function(e){this._errorHandler=e},clone:function(e){return this._reflowTimer.stop(),this.parent(e)},"@testRenderNow":function(e){if(!e)throw'specified null for required arg "component"';this._compRenderer.runRender([e])}})}),define.Class("core.managers.componentlifecyclemanager.ComponentMeasurer",function(e){var t=e;t.methods({initialize:function(e){this._compLC=e},invalidateDisplayAndMeasureAllDisplayedComponents:function(){this._markAllCompsAsNotDisplayed(),this._runMeasureForFirstTimeInitiatedComps();var e=this._getDisplayedCompList(document.body);this.measureComponents(e),this._invalidateAllDisplayModifiedComps()},measureComponents:function(e){var t,n,r;if(e.length)try{for(t=0;t<e.length;++t)n=e[t],r=this._compLC.getComponentInfo(n),r.isDisplayed=!0,this._measureComponent(r)}catch(i){e.splice(0,t+1),this._compLC._onComponentError(r,i,this._compLC.PHASES.MEASURE),e.length>0&&this.measureComponents(e)}},_measureComponent:function(e){var t=e.component;if(t._skinParts){t._invalidations_.clearInvalidationType(t.INVALIDATIONS.SIZE),t._invalidations_.clearInvalidationType(t.INVALIDATIONS.POSITION);for(var n in t._skinParts){var r=this._getNodeForMeasure(t._skinParts[n]);if(r){var i=this._getOldMeasure(r),s=this._getNewMeasure(r);r.$measure=s,this._invalidateSizeIfChanged(t,n,r,s,i),this._invalidatePositionIfChanged(t,n,r,s,i)}}t.isInvalidated([t.INVALIDATIONS.SIZE,t.INVALIDATIONS.POSITION])&&t.reportLayoutChange()}t.trigger(Constants.LifecycleSteps.MEASURE)},_getNodeForMeasure:function(e){return e instanceof HTMLElement?e:e.getViewNode instanceof Function?e.getViewNode():null},_getOldMeasure:function(e){return e.$measure||{width:0,height:0,top:0,left:0}},_getNewMeasure:function(e){var t=e.getSize(),n=e.getPosition(e.parentNode);return{width:t.x,height:t.y,top:n.y,left:n.x}},_invalidateSizeIfChanged:function(e,t,n,r,i){if(r.width!==i.width||r.height!==i.height){var s=t==="view"?e.INVALIDATIONS.SIZE:e.INVALIDATIONS.PART_SIZE;e.invalidate(s,{current:r,old:i,partName:t,reference:n},!0)}},_invalidatePositionIfChanged:function(e,t,n,r,i){if(r.top!==i.top||r.left!==i.left){var s=t==="view"?e.INVALIDATIONS.POSITION:e.INVALIDATIONS.PART_POSITION;e.invalidate(s,{current:r,old:i,partName:t,reference:n},!0)}},_markAllCompsAsNotDisplayed:function(){var e=this._compLC.getAllComponentsInfo();for(var t in e){var n=e[t];n.isDisplayedBefore=n.isDisplayed,n.isDisplayed=!1}},_runMeasureForFirstTimeInitiatedComps:function(){var e=this._compLC.getAllComponentsInfo();for(var t in e){var n=e[t];if(n.state===n.STATES.INITIATED)try{n.state=n.STATES.READY,this._measureComponent(n)}catch(r){this._compLC._onComponentError(n,r,this._compLC.PHASES.MEASURE_INITIATED),this._runMeasureForFirstTimeInitiatedComps()}}},_invalidateAllDisplayModifiedComps:function(){var e=this._compLC.getAllComponentsInfo();for(var t in e){var n=e[t];if(n.isDisplayedBefore!==n.isDisplayed){var r=n.component;r.invalidate(r.INVALIDATIONS.DISPLAY,{current:n.isDisplayed})}}},_getDisplayedCompList:function(e,t){t=t||[];var n=this._isNodeDisplayed(e);if(n){var r=e.childNodes;for(var i=0;i<r.length;++i)this._getDisplayedCompList(r[i],t)}if(n&&e.$logic){var s=e.$logic,o=s.getComponentId(),u=this._compLC.getAllComponentsInfo(),a=u[o];a&&t.push(s)}return t},_isNodeDisplayed:function(e){return e.getStyle?e.getStyle("display")!=="none"?!0:!1:!0}})}),define.Class("core.managers.componentlifecyclemanager.ComponentRenderer",function(e){var t=e;t.methods({initialize:function(e){this._compLC=e},renderComponents:function(){this._collectCompListForRender(),this.runRender(this._compsForRender)},runRender:function(e){var t,n,r;if(e.length)try{for(t=0;t<e.length;++t)n=e[t],r=this._compLC.getComponentInfo(n),this._renderComponent(n)}catch(i){e.splice(0,t+1),this._compLC._onComponentError(r,i,this._compLC.PHASES.RENDER),e.length>0&&this.runRender(e)}},_renderComponent:function(e){var t={invalidations:e._invalidations_};e._invalidations_=new e.imports.InvalidationCollector,e.trigger(Constants.LifecycleSteps.RENDER,t)},updateLayoutForDisplayedComps:function(){var e=this._compLC.getAllComponentsInfo();for(var t in e){var n=e[t];n.isDisplayed&&this._updateCompLayout(n.component)}},_updateCompLayout:function(e){var t=this._getComponentResizeData(e);if(t)for(var n in t){var r=t[n];switch(n){case"width":e._setWidth_(r);break;case"height":e._setHeight_(r);break;case"x":e._setX_(r);break;case"y":e._setY_(r)}}},_getComponentResizeData:function(e){return this._getLayoutChangeData({width:e.getLastInvalidationByType(e.INVALIDATIONS.WIDTH_REQUEST),height:e.getLastInvalidationByType(e.INVALIDATIONS.HEIGHT_REQUEST),x:e.getLastInvalidationByType(e.INVALIDATIONS.X_REQUEST),y:e.getLastInvalidationByType(e.INVALIDATIONS.Y_REQUEST)})},_getLayoutChangeData:function(e){var t;for(var n in e){var r=e[n];r&&!r._used_&&(r._used_=!0,t=t||{},t[n]=r[n])}return t},_collectCompListForRender:function(e){var t,n=e?e.compList:[],r=e?e.checkedCompIds:{},i=function(e){t=e;var i=e.component,s=i.getComponentId();r[s]=!0,this._isComponentReadyForRender(t)&&n.push(i)}.bind(this);try{var s=this._compLC.getAllComponentsInfo();for(var o in s)if(!r[o]){var u=s[o],a=this._compLC.getComponentChildList(u,!0);a.forEach(i),i(u)}}catch(f){this._compLC._onComponentError(t,f,this.PHASES.COLLECT_RENDER_COMPS),this._collectCompListForRender({compList:n,checkedCompIds:r})}this._compsForRender=n},_isComponentReadyForRender:function(e){var t=e.component;return e.state===e.STATES.READY&&t.isRenderNeeded(t._invalidations_)}})}),define.Class("core.managers.componentlifecyclemanager.ReflowTimer",function(e){var t=e;t.inherits("bootstrap.managers.events.EventDispatcher"),t.resources(["W.Utils"]),t.binds(["_beforeReflow","_onIdleDone"]),t.statics({REFLOW_EVENTS:{BEFORE_REFLOW:"beforeReflow",AFTER_REFLOW:"afterReflow"}}),t.methods({initialize:function(){this._isRunning=!1,this._isInIdleMode=!1,this._idleFPS=4},run:function(e){if(this._isRunning)return;this._idleFPS=e||this._idleFPS,this._isRunning=!0,this._listenForNextReflow()},stop:function(){this._isRunning=!1,this._stopListening(),this._removeTestNode()},forceReflow:function(){this._isInIdleMode&&(this._stopListening(),this._isInIdleMode=!1,this._forceReflowTimeoutIndex=this.resources.W.Utils.callLater(this._onIdleDone,[],this,0))},_listenForNextReflow:function(){this._beforeReflowTimoutIndex=this.resources.W.Utils.callOnNextRender(this._beforeReflow)},_listenForAfterReflow:function(){this._isReflowTestNodeValid()?this._afterReflow():this._checkReflowTimoutIndex=this.resources.W.Utils.callLater(this._listenForAfterReflow,[],this,0)},_stopListening:function(){this.resources.W.Utils.clearOnNextRender(this._beforeReflowTimoutIndex),this.resources.W.Utils.clearCallLater(this._checkReflowTimoutIndex),this.resources.W.Utils.clearCallLater(this._idleTimoutIndex),this.resources.W.Utils.clearCallLater(this._forceReflowTimeoutIndex)},_beforeReflow:function(){this._isRunning&&(this.trigger(this.REFLOW_EVENTS.BEFORE_REFLOW),this._updateReflowTestNode(),this._setIdleDelay())},_afterReflow:function(){this._isRunning&&(this.trigger(this.REFLOW_EVENTS.AFTER_REFLOW),this._listenForNextReflow())},_setIdleDelay:function(){var e=1e3/this._idleFPS;this._isInIdleMode=!0,this._idleTimoutIndex=W.Utils.callLater(this._onIdleDone,[],this,e)},_onIdleDone:function(){this._stopListening(),this._isInIdleMode=!1,this._listenForAfterReflow()},_updateReflowTestNode:function(){this._textNode||(this._textNode=(new Element("div",{id:"ReflowTestNode"})).setStyles({width:"10px",height:"0px"}),this._textNodeInnerDiv=(new Element("div",{id:"ReflowTextInnerNode"})).setStyles({width:"10%"}),this._textNode.adopt(this._textNodeInnerDiv),document.body.adopt(this._textNode));var e=parseInt(this._textNode.getStyle("width"),10)+10;this._reflowTextExpectedWidth=.1*e,this._textNode.setStyle("width",e+"px")},_removeTestNode:function(){this._textNode&&(this._textNode.parentNode&&this._textNode.parentNode.removeChild(this._textNode),delete this._textNode,delete this._reflowTextExpectedWidth)},_isReflowTestNodeValid:function(){return this._textNodeInnerDiv.offsetWidth==this._reflowTextExpectedWidth}})}),define.Const("LifecycleSteps",{RENDER:"render",MEASURE:"measure",UPDATE:"update"}),function(){var e=null;define.Class("core.managers.css.CssManager",function(t){var n=t;n.inherits("bootstrap.managers.BaseManager"),n.binds(["_onThemePropertyChange","updateAllThemeCss"]),n.statics({GLOBAL_THEME_CSS_TYPES:["font","color"],FONT_SERVICE_URL:"http://fonts.googleapis.com/css?family="}),n.methods({initialize:function(){this._themeStyleSheet=this._generateThemeStylesSheet(),this._addHelveticaToWixSites(),this._configureSystemFonts(),this._configureCustomFonts(),this.resource.getResourceValue("W.Theme",function(e){this._themeManager=e,e.addEvent("propertyChange",this._onThemePropertyChange),e.isDataReady()?this.updateAllThemeCss():e.addEvent("dataReady",this.updateAllThemeCss)}.bind(this))},_configureSystemFonts:function(){this._systemFontsCssDefinition={},this._systemFontsNames=[];for(var e in Constants.CSS.SYSTEM_FONTS){var t=Constants.CSS.SYSTEM_FONTS[e];for(var n=0;n<t.length;++n){var r=t[n],i=typeOf(r)=="array"?r[0]:r;this._systemFontsNames.push(i);var s=typeOf(r)=="array"?r.concat().reverse():[r];s.push(e),this._addQuoteToArrayElementsIfContainSpaces(s),this._systemFontsCssDefinition[i]=s.join(",")}}},_configureCustomFonts:function(){this._customFontsCssDefinition={},this._customFontsNames=[];for(var e in Constants.CSS.CUSTOM_FONTS){var t=Constants.CSS.CUSTOM_FONTS[e];for(var n=0;n<t.length;++n){var r=t[n],i=typeOf(r)=="array"?r[0]:r;this._customFontsNames.push(i);var s=typeOf(r)=="array"?r.concat().reverse():[r];s.push(e),this._addQuoteToArrayElementsIfContainSpaces(s),this._customFontsCssDefinition[i]=s.join(",")}}},_addQuoteToArrayElementsIfContainSpaces:function(e){for(var t=0;t<e.length;++t)e[t].indexOf(" ")&&(e[t]='"'+e[t]+'"')},_onThemePropertyChange:function(e){var t=this._themeManager.getPropertyType(e.name);this.GLOBAL_THEME_CSS_TYPES.contains(t)&&this._updateThemeGlobalCssByPropertyName(e.name,t)},updateAllThemeCss:function(){for(var e=0;e<this.GLOBAL_THEME_CSS_TYPES.length;++e){var t=this.GLOBAL_THEME_CSS_TYPES[e],n=this._themeManager.getPropertiesAccordingToType(t);for(var r=0;r<n.length;++r)this._updateThemeGlobalCssByPropertyName(n[r],t)}},_updateThemeGlobalCssByPropertyName:function(e,t){var n=this.getThemeGlobalPropertyCssDefinition(e,t);this._themeStyleSheet.updateRule(n.selector,n.rules);if(t=="font"){var r=this._themeManager.getProperty(e).getFontFamily(),i=this.getFontType(r);i=="custom"&&this.loadFont(r)}},getThemeGlobalPropertyCssDefinition:function(e,t,n){t=t||this._themeManager.getPropertyType(e);var r=this._themeManager.getProperty(e),i,s="";switch(t){case"font":i="."+e,n?s="font: "+r.getCssValue():s=r.getCssRule();break;case"color":i="."+e,s="color:"+r.getHex(!1)}return{selector:i,rules:s}},_generateThemeStylesSheet:function(){return e||(e=W.Utils.createStyleSheet("WIX_THEME_STYLES")),this._themeStyleNodeId=e.styleNode.get("id"),e},getCssNodeId:function(){return this._themeStyleNodeId},getDefaultFont:function(){var e=Constants.CSS.SYSTEM_FONTS["sans-serif"][0];return e=typeOf(e)==="array"?e[0]:e,e},getFontFallbacksCss:function(e){return this._systemFontsCssDefinition[e]||this._customFontsCssDefinition[e]||'"'+e+'"'},getFontList:function(){return[].concat(this._systemFontsNames,this._customFontsNames).sort()},getFontType:function(e){return this._systemFontsNames.indexOf(e)!=-1?"system":this._customFontsNames.indexOf(e)!=-1?"custom":null},getUsedFontsUrl:function(){var e=this._themeManager.getPropertiesAccordingToType("font"),t={};for(var n=0;n<e.length;++n){var r=this._themeManager.getProperty(e[n]).getFontFamily();this.getFontType(r)=="custom"&&(t[r]=r)}return this.FONT_SERVICE_URL+this._getFontsQuery(t)},loadFont:function(e){this._readyFonts=this._readyFonts||{},this._loadedFonts=this._loadedFonts||{};var t=this._customFontsNames.indexOf(e)!=-1,n=this._readyFonts[e],r=this._loadedFonts[e];if(!t||n||r)return;this._loadedFonts[e]=e,this._fontLoadCallLater||(this._fontLoadCallLater=W.Utils.callLater(this._loadFonts,undefined,this,50))},_loadFonts:function(){delete this._fontLoadCallLater;var e=this.FONT_SERVICE_URL+this._getFontsQuery(this._loadedFonts);for(var t in this._loadedFonts)this._readyFonts[t]=t,delete this._loadedFonts[t];this._addFontsLoaderCssTag(e)},_getFontsQuery:function(e){fontQuery="";for(var t in e)fontQuery+=t.split(" ").join("+"),fontQuery+=":n,b,i,bi|";return fontQuery},_addFontsLoaderCssTag:function(e){if($$("[href="+e+"]").length===0){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e;var n=document.getElementsByTagName("link")[0];n.parentNode.insertBefore(t,n)}},_addHelveticaToWixSites:function(){if(window.rendererModel&&rendererModel.documentType==="WixSite"){this._pushUnique(Constants.CSS.SYSTEM_FONTS["sans-serif"],["Helvetica Neue"]),this._pushUnique(Constants.CSS.SYSTEM_FONTS["sans-serif"],["Helvetica Neue Italic"]),this._pushUnique(Constants.CSS.SYSTEM_FONTS["sans-serif"],["Helvetica Neue Thin"]),this._pushUnique(Constants.CSS.SYSTEM_FONTS["sans-serif"],["Helvetica Neue Medium"]);var e=this.getHelveticaCssUrl();e&&this._addFontsLoaderCssTag(e)}},getHelveticaCssUrl:function(){return window.rendererModel&&rendererModel.documentType==="WixSite"?window.serviceTopology.publicStaticsUrl+"/css/Helvetica/fontFace.css":null},_pushUnique:function(e,t){var n=this._doesArrayExistInArrayOfArrays(e,t);n||e.push(t)},_doesArrayExistInArrayOfArrays:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.length===t.length)for(var i=0;i<t.length;i++){if(r[i]!==t[i])break;if(i===t.length-1)return!0}}return!1},clone:function(e){return this.parent(e)},isReady:function(){return!0}})})}(),define.Const("CSS",{COLORS:["transparent","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],SYSTEM_FONTS:{"sans-serif":[["Arial","Helvetica"],["Arial Black","Gadget"],["Impact","Charcoal"],["Lucida Sans Unicode","Lucida Grande"],["Tahoma","Geneva"],["Verdana","Geneva"]],serif:["Georgia",["Palatino Linotype","Book Antiqua","Palatino"],["Times New Roman","Times"]],cursive:["Comic Sans MS"],monospace:["Courier New",["Lucida Console","Monaco"]]},CUSTOM_FONTS:{"sans-serif":["Anton","Basic","Jockey One","Jura","Open Sans","Overlock","Play","Signika","Spinnaker","Chelsea Market"],serif:["Caudex","EB Garamond","Enriqueta","Forum","Noticia Text","Fredericka the Great","Kelly Slab","Josefin Slab"],cursive:["Lobster","Niconne","Marck Script","Mr De Haviland","Patrick Hand","Sarina","Corben"],monospace:[]}}),define.oldClass({name:"core.managers.data.ComponentDataManager",imports:["core.managers.data.PropertiesItem"],Class:{Extends:"core.managers.data.DataManager",initialize:function(){this._PropertiesItem=this.imports.PropertiesItem,this.parent()},DEFINE_NAMESPACE:"dataPropertyItem",addDataItem:function(e,t,n){var r=this.createDataItem(t,n);return r._data.id=e,this.dataMap[e]=r,this._runCallbacks(e,r),this.markDirtyObject(r),r},createDataItem:function(e,t){var n=e.type,r=this.getDataTypeSchema(n);return r?new this._PropertiesItem(r,e,this,t):new this._DataItemBase(e,this)}}}),define.oldClass({name:"core.managers.data.DataItemBase",Class:{Extends:"bootstrap.utils.Events",Binds:["fireDataChangeEvent"],Static:{METADATA_DEFAULTS:{isPreset:!1,isHidden:!1,description:"",isPersistent:!0},getFieldsFilterArray:function(e){return typeOf(e)=="array"?e:Object.keys(e)}},initialize:function(e,t){this._data=e;if(e.type&&typeof e.type!="string")throw"invalid data type. must be string";this._dataType=e.type,this._dataManager=t||this.injects().Data,this.componentsWithInterest=[]},setData:function(e,t){var n=this._data,r=this._data!==e;this._data=e,this._dataType=e.type,r&&!t&&this.fireDataChangeEvent(undefined,e,n)},setFields:function(e,t){var n={},r={},i=this._data;Object.forEach(e,function(e,t){i[t]!==e&&(n[t]=i[t],r[t]=e),this.set(t,e,!0)}.bind(this)),Object.keys(n).length>0&&this.fireDataChangeEvent(r,r,n,t)},setMeta:function(e,t,n){if(e in this.METADATA_DEFAULTS){this._data.metaData=this._data.metaData||{},this._data.metaData[e]=t;if(n){var r={key:t},i={};this.fireDataChangeEvent(r,i)}}else LOG.reportError(wixErrors.INVALID_METADATA_FIELD,"DataItemBase","setMeta",e)()},set:function(e,t,n,r){t=this.injects().Utils.sanitizeUnicode(t);if(this._data[e]!==t){var i={};i[e]=this._data[e],this._data[e]=t,this.setMeta("isPreset",!1);if(!n){var s={};s[e]=t,this.fireDataChangeEvent(e,s,i,r)}}},getFields:function(e){var t={},n=this.getFieldsFilterArray(e);return n.forEach(function(e){t[e]=this.get(e)}.bind(this)),t},getData:function(){return this._data},getType:function(){return this._data.type},getMeta:function(e){if(e in this.METADATA_DEFAULTS){var t=this._data.metaData&&this._data.metaData[e];return t!==undefined?t:this.METADATA_DEFAULTS[e]}LOG.reportError(wixErrors.INVALID_METADATA_FIELD,"DataItemBase","getMeta",e)()},get:function(e){var t=this._data[e];return typeof t=="string"&&(t=this._sanitizeString(t)),t},_sanitizeString:function(e){return e.replace(/[\u0080\u0099\u009C]/g,"")},fireDataChangeEvent:function(e,t,n,r,i){this.markDataAsDirty();var s=e!==undefined?[this,e,t,n]:[this];this.fireEvent(Constants.DataEvents.DATA_CHANGED,s),this._dataManager.reportDataItemChangeEvent(this,t,n,r,i)},markDataAsDirty:function(){this.getMeta("isPersistent")!==!1&&(this._dataManager.markDirtyObject(this),this._dataManager.flagDataChange())},toString:function(){return"[Data Object]"},getDataManager:function(){return this._dataManager},addComponentWithInterest:function(e){this.componentsWithInterest.include(e)},removeComponentWithInterest:function(e){this.componentsWithInterest.erase(e)},cloneData:function(){return Object.clone(this.getData())},hasField:function(e){var t=this._data[e];return t!==null&&t!=undefined}}}),define.oldClass({name:"core.managers.data.DataItemProxy",traits:["core.managers.data.DataItemProxyTrait"],Class:{Extends:"core.managers.data.DataItemBase"}}),define.oldTrait({name:"core.managers.data.DataItemProxyTrait",trait:{Binds:["_originDataChangeHandler"],initialize:function(e,t){instanceOf(this,this.imports.DataItemBase)?(this.setOriginalDataItem(e),this._dataType=rawDataObject.type,this._dataManager=t||this.injects().Data):LOG.reportError(wixErrors.INVALID_TRAIT_USAGE,this.className,"initialize of DataItemProxy")()},setOriginalDataItem:function(e){this._originalDataItem&&this._originalDataItem.removeEvent(Constants.DataEvents.DATA_CHANGED,this._originDataChangeHandler);if(e)this._dataManager=e.getDataManager(),this._data=e.getData(),this._originalDataItem=e,this._originalDataItem.addEvent(Constants.DataEvents.DATA_CHANGED,this._originDataChangeHandler),this.fireEvent(Constants.DataEvents.DATA_CHANGED,[this]);else{var t=new this.imports.DataItemBase({},this.getDataManager());this.setOriginalDataItem(t,this.getDataManager())}},setData:function(e,t){this._originalDataItem.setData(e,t)},setFields:function(e){this._originalDataItem.setFields(e)},setMeta:function(e,t,n){this._originalDataItem.setMeta(e,t,n)},set:function(e,t,n){this._originalDataItem.set(e,t,n)},getOriginalDataItem:function(){return this._originalDataItem},_originDataChangeHandler:function(){this.fireEvent(Constants.DataEvents.DATA_CHANGED,arguments)},fireDataChangeEvent:function(e,t){var n={},r={};r[e]=t,n[e]="",this.parent(e,t),dontFireOriginal||this._originalDataItem.fireDataChangeEvent(e,r,{})}}}),define.oldClass({name:"core.managers.data.DataItemWithSchema",imports:["core.utils.css.Color"],traits:["bootstrap.utils.Events"],Class:{Extends:"core.managers.data.DataItemBase",Static:{FIELD_TYPE_DEFAULTS:{refList:[],ref:"",number:Number.NaN,string:"",color:"255,255,255,1","boolean":!1,object:{},list:[]}},initialize:function(e,t,n,r){this._schema=e,this._schemaType=r,this._snapshot={},this.parent(t,n),this._setSchemaDefaults()},reset:function(){for(var e in this._schema){var t=this._getDefaultValue(e);this._data[e]!=t&&this.set(e,t)}},removeField:function(e){delete this._data[e]},takeSnapshot:function(){var e={};this._cloneBySchema(e,this._data),this._snapshot=e},restoreSnapshot:function(e){this._snapshot?(this._cloneBySchema(this._data,this._snapshot),this.discardSnapshot(),e!==!1&&this.fireDataChangeEvent()):LOG.reportError(wixErrors.DATA_MISSING_SNAPSHOT,"DataItem","restoreSnapshot",this._dataType)},discardSnapshot:function(){this._snapshot=null},getSchemaType:function(){return this._schemaType},getSchema:function(){return this._schema},setSchema:function(e){this._schema=e},getFieldSchema:function(e){return this._schema[e]},_setSchemaDefaults:function(){for(var e in this._schema){var t=this._schema[e];if(t&&t["default"]){var n=this._data[e],r=this.get(e);!n&&n!=r&&this.set(e,r)}}},get:function(e){var t=this.parent(e),n=this._schema[e];if(t!==undefined&&t!==null){if(Constants.DataTypes.TYPE_RESOURCE_KEY==n){var r=this.getDataManager().getResourceManager();r&&(t=r.get("EDITOR_LANGUAGE",t,t))}}else t=this._getDefaultValue(e),this._data[e]=t;return"color"==n?new this.imports.Color(value):t},getFieldType:function(e){return this._schema[e]},_getDefaultValue:function(e){var t=this._schema[e],n;if(!t)return;return typeof t=="string"?n=this.FIELD_TYPE_DEFAULTS[t]:t.hasOwnProperty("default")?n=t["default"]:n=this.FIELD_TYPE_DEFAULTS[t.type],this._cloneDefaultObject(n)},_cloneDefaultObject:function(e){return Array.isArray(e)?e.splice(0,0):typeof e=="object"&&e!==null?Object.clone(e):e},_cloneBySchema:function(e,t){for(var n in this._schema){var r=t[n],i=typeof r;instanceOf(r,Array)?e[n]=r.slice():"object"==i?e[n]=Object.clone(r):e[n]=r}return e},copySchemaFieldsFrom:function(e,t){this._cloneBySchema(this._data,e._data),t||this.fireDataChangeEvent()},copySchemaFieldsTo:function(e,t,n){var r=this._cloneBySchemaAndReturnDataChange(e._data,this._data),i=Object.keys(r.newValue).length+Object.keys(r.oldValue).length==0;if(i)return;t||e.fireDataChangeEvent(undefined,r.newValue,r.oldValue,n)},_cloneBySchemaAndReturnDataChange:function(e,t){var n,r,i={},s={};for(var o in this._schema){var u=t[o],a=typeof u;n=e[o],instanceOf(u,Array)?(r=u.slice(),e[o]=r):"object"==a?(r=Object.clone(u),e[o]=r):(r=u,e[o]=r),(n||r)&&n!=r&&(s[o]=n,i[o]=r)}return{dataItem:e,newValue:i,oldValue:s}},set:function(e,t,n,r){var i=this._validateByPresenceInSchema(e);i?this.parent(e,t,n,r):LOG.reportError(wixErrors.SCHEMA_MISSING_KEY,"DataItemWithSchema","set",{c1:"key: "+e+"schemaType: "+this._schemaType})},setData:function(e,t){if(e===this._data)return;if(!this._hasValidType(e.type)){LOG.reportError(wixErrors.SCHEMA_MISSING,"DataItemWithSchema","setData",{c1:"type: "+e.type+"schemaType: "+this._schemaType});return}this._data?this._data.type==e.type&&(e.id=this._data.id,this.parent(e,!1),this._setSchemaDefaults(),t!==!1&&this.fireDataChangeEvent()):this.parent(e,t)},hasField:function(e){var t=this._data[e];return t!==null&&t!=undefined},_hasValidType:function(e){return this._schemaType===e},_hasCheckableSchema:function(){return this._schemaType&&this._schemaType!=="Document"},_isKeyPresentedInSchema:function(e){return this._schema[e]!==undefined},_validateByPresenceInSchema:function(e){return this._hasCheckableSchema()?this._isKeyPresentedInSchema(e):!0}}}),define.oldClass({name:"core.managers.data.DataItemWithSchemaProxy",traits:["core.managers.data.DataItemProxyTrait"],Class:{Extends:"core.managers.data.DataItemWithSchema"}}),define.oldClass({name:"core.managers.data.DataManager",imports:["core.managers.data.DataItemBase","core.managers.data.DataItemWithSchema","bootstrap.utils.Queue"],Class:{Extends:"bootstrap.managers.BaseManager",Resources:["W.Classes","W.Experiments"],initialize:function(){this._classManager=this.resources.W.Classes,this._readyDataSchemaMap={},this.dataMap={},this.dirtyDataObjectsMap={},this.callbackQueue=new this.imports.Queue,this._DataItemBase=this.imports.DataItemBase,this._DataItemWithSchema=this.imports.DataItemWithSchema,this.define[this.DEFINE_NAMESPACE].definitionModifier=this._onDataItemDefineCallBack.bind(this)},DEFINE_NAMESPACE:"dataItem",flagDataChange:function(){this._dataChanged=!0},clearDataChange:function(){this._dataChanged=!1},isDataChange:function(){return this._dataChanged===!0},_onDataItemDefineCallBack:function(e,t){return this.addDataItem(e,t),t},getDataTypeSchema:function(e){if(!this._readyDataSchemaMap[e]){var t=this.define.getDefinition("dataSchema"),n=t[e];if(!n){var r="/schema=["+e+"]";return LOG.reportError(wixErrors.SCHEMA_MISSING,"DataManager","getSchema"+r,[e])(),null}this._applySchemaInheritance(n),n=this.resources.W.Experiments.applyExperiments(e,n),this._readyDataSchemaMap[e]=n}return this._readyDataSchemaMap[e]},_applySchemaInheritance:function(e){var t=e["extends"];if(t){var n=this.getDataTypeSchema(t);Object.merge(e,n)}},clearDirtyObjectsMap:function(){this.dirtyDataObjectsMap={}},hasDirtyObjects:function(){return W.Utils.objectSizeDelta(this.dirtyDataObjectsMap)},markDirtyObject:function(e){var t=e._data,n=t.id;this.dirtyDataObjectsMap[n]=e},addDataItems:function(e){for(var t in e)this.addDataItem(t,e[t])},addDataItemsForPage:function(e){var t=this.define.getDefinition(this.DEFINE_NAMESPACE);for(var n in e){var r=nsUtil.getNameSpace(t,n);!this.dataMap[n]&&!r&&define[this.DEFINE_NAMESPACE](n,e[n])}},addDataItem:function(e,t){t=this.resources.W.Experiments.applyExperiments(e,t);var n=this.createDataItem(t);return n._data.id=e,this.dataMap[e]=n,this._runCallbacks(e,n),this.skipDirtyMarking||this.markDirtyObject(n),n},override:function(e,t){if(!e||!this.dataMap[e])throw new Error("Invalid data id name for override: "+e);this.dataMap[e]=t},addDataItemWithUniqueId:function(e,t){var n;do n=e+Number.random(0,99999).toString(36),n=n.replace(" ","_");while(this.dataMap[n]);var r=this.addDataItem(n,t);return{id:n,dataObject:r}},reportDataItemChangeEvent:function(e,t,n,r,i){this.fireEvent(Constants.DataEvents.DATA_CHANGED,[e,t,n,r]),!i&&t!==undefined&&n!==undefined&&e._data.id&&this.fireEvent("undoDataChangedEvent",[e,t,n,r])},_runCallbacks:function(e,t){this.callbackQueue.popQueue(e).forEach(function(e){e&&e(t)})},createDataItem:function(e,t){t=t||e.type;var n;t&&(n=this.getDataTypeSchema(t));if(n){if(!n.dataClassRef)return new this._DataItemWithSchema(n,e,this,t);var r;return this._classManager.getClass(n.dataClassRef,function(e){r=e}),r?new r(e,this):(LOG.reportError(wixErrors.SCHEMA_MISSING,"DataManager","getSchema"+n.dataClassRef,[n.dataClassRef])(),null)}return new this._DataItemBase(e,this)},isDataItem:function(e){return e&&instanceOf(e,this._DataItemBase)},getDataByQuery:function(e,t){var n=null;if(e.indexOf("#")===0){var r=e.substr(1);n=this.dataMap[r];if(!!n)return t&&t(n),n;this.callbackQueue.add(r,t);var i=this.define.getDefinition(this.DEFINE_NAMESPACE),s=nsUtil.getNameSpace(i,r);if(s)return this.addDataItem(r,s)}else LOG.reportError(wixErrors.DM_MALFORMED_QUERY,"DataManager","getDataByQuery",e),W.Utils.callLater(t,[null])},isDataAvailable:function(e){var t=null;if(e.indexOf("#")===0){var n=e.substr(1);if(!n)return!1;t=this.dataMap[n];if(t)return!0;var r=this.define.getDefinition(this.DEFINE_NAMESPACE),i=nsUtil.getNameSpace(r,n);return i?!0:!1}return LOG.reportError(wixErrors.DM_MALFORMED_QUERY,"DataManager","isDataAvailable",e),!1},getDataByQueryList:function(e,t){var n={},r=function(r){return function(i){n[r]=i;var s=!0;for(var o=0;o<e.length;++o)if(!n[e[o]]){s=!1;break}s&&t&&t(n)}};if(e.length===0){var i={};W.Utils.callLater(t,[i])}else{var s={},o=!0;for(var u=0;u<e.length;++u){var a=this.getDataByQuery(e[u],r(e[u]));a?s[e[u]]=a:o=!1}if(o)return s}},getDataMap:function(){return this.dataMap},getDirtyDataObjectsMap:function(){return Object.filter(this.dirtyDataObjectsMap,function(e){return e.getMeta("isPersistent")})},clone:function(e){var t=this.parent(e);return t},isReady:function(){return!0},_copyData:function(e){for(var t in this.dataMap){var n=Object.clone(this.dataMap[t].getData());e.addDataItem(t,n)}},toString:function(){return"[Data Manager]"},markAllDirty:function(){for(var e in this.dataMap)this.dirtyDataObjectsMap[e]=this.dataMap[e]},getResourceManager:function(){return W.Resources},removeDataItem:function(e){var t=typeof e=="string"?e:this.getQueryOfDataItem(e);this._removeIfSafe(t)},_removeIfSafe:function(e){var t=e&&this.dataMap[e.substr(1)];if(!t)return;t.componentsWithInterest.length===0&&!this._isReferenced(e)&&(t.removeAllEvents(),delete this.dataMap[e.substr(1)])},_isReferenced:function(e){var t,n;for(t in this.dataMap){n=this.dataMap[t].getData();if(n&&n.items&&n.items.indexOf&&n.items.indexOf(e)!==-1)return!0}return!1},getQueryOfDataItem:function(e){var t;for(t in this.dataMap)if(e===this.dataMap[t])return"#"+t},getDataItem:function(e,t){typeof e=="string"?this.injects().Data.getDataByQuery(e,t):t(e)},getDataItemsList:function(e,t){e.length>0&&typeof e[0]=="string"},getDataItemsByType:function(e,t){var n=this._getDataItemsByTypeFromMap(e),r=this._getDefinitionsByType(e),i=Object.keys(r),s=i.map(function(e){return"#"+e});this.getDataByQueryList(s,function(e){var r=Object.append(e,n);t(r)})},_getDataItemsByTypeFromMap:function(e){var t=Object.values(this.dataMap),n=t.filter(function(t){return t.getType()==e});return n.toMap(function(e){return"#"+e.get("id")})},_getDefinitionsByType:function(e){var t=Object.filter(this.define.getDefinition(this.DEFINE_NAMESPACE),function(t,n){return t&&t.type===e});return t}}}),define.experimentPlugin("ExperimentDataItemPlugin",function(e){function n(e,t){var n=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),r=t(n),i=n._mergeField_(e,r);return i}function r(e,t){define.dataItem(e,t())}var t=e;t.init("dataItem","newDataItem",n,r)}),define.experimentPlugin("ExperimentDataPropertyItemPlugin",function(e){function n(e,t){var n=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),r=t(n),i=n._mergeField_(e,r);return i}function r(e,t){define.dataPropertyItem(e,t())}var t=e;t.init("dataPropertyItem","newDataPropertyItem",n,r)}),define.experimentPlugin("ExperimentDataSchemaPlugin",function(e){function n(e,t){var n=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),r=t(n),i=n._mergeField_(e,r);return i}function r(e,t){define.dataSchema(e,t())}var t=e;t.init("dataSchema","newDataSchema",n,r)}),define.oldClass({name:"core.managers.data.PropertiesItem",Class:{Extends:"core.managers.data.DataItemWithSchema",initialize:function(e,t,n,r){this.parent(e,t,n),this._ownerComponent=r}}}),define.Const("DataEvents",{DATA_CHANGED:"dataChanged",BEFORE_CHANGE:"beforeDataChange",AFTER_CHANGE:"afterDataChange"}),define.Const("DataTypes",{TYPE_RESOURCE_KEY:"resourceKey"}),define.Const("PropertyEvents",{PROPERTY_CHANGED:"propertyChanged"}),define.Const("UrmEvents",{DATA_CHANGE_RECORDED:"dataChanged"}),define.oldClass({name:"core.managers.serverfacade.CorsRESTClient",Class:{Extends:"core.managers.serverfacade.RESTClient",initialize:function(){},get:function(e,t,n){var r=this._createCorsXhr(e);r.onabort=function(e){this._onXhrEvent("abort",r,n)}.bind(this),r.ontimeout=function(e){this._onXhrEvent("timeout",r,n)}.bind(this),r.onerror=function(e){this._onXhrEvent("error",r,n)}.bind(this),r.onload=function(e){this._onXhrEvent("load",r,n)}.bind(this),r.onprogress=function(e){},r.send()},_createCorsXhr:function(e,t){var n=t||"GET",r=null;try{r=new XMLHttpRequest}catch(i){}return r&&"withCredentials"in r?r.open(n,e,!0):typeof XDomainRequest!="undefined"&&(e=e.indexOf("?")!=-1?e+"&":e+"?",e+="ctype=text/plain",r=new XDomainRequest,r.open(n,e),r.setRequestHeader=function(e,t){}),r},_onXhrEvent:function(e,t,n){if(e!="load"||!this._isIExplorer()&&t.readyState!=4)this._onError(t,n);else{var r={};try{r=JSON.parse(t.responseText)}catch(i){}this._onSuccess(r,n)}},_isIExplorer:function(){return navigator.userAgent.indexOf("MSIE")!=-1},post:undefined,jsonp:undefined,jsonrpc:undefined}}),define.oldClass({name:"core.managers.serverfacade.RESTClient",Class:{Static:{CALLBACK_STATUS:{SUCCESS:"success",ERROR:"error"},REQUEST_OBJECT:{jsonrpc:"2.0",id:1,method:"",params:[]}},initialize:function(){},get:function(e,t,n){var r=this._createRequestOptions(e,t,n),i=new Request.JSON(r);t?i.get(JSON.encode(t)):i.get()},post:function(e,t,n){var r=this._createRequestOptions(e,t,n);r.headers={"Content-Type":"application/json; charset=utf-8"};var i=new Request.JSON(r);i.post(JSON.encode(t))},jsonp:function(e,t,n){var r=this._createRequestOptions(e,t,n),i=new Request.JSONP(r);i.send(JSON.encode(t))},jsonrpc:function(e,t,n,r){var i=Object.clone(this.REQUEST_OBJECT);i.method=t,i.params=n,this.post(e,i,{onSuccess:function(e){e.result&&typeof r.onSuccess=="function"?r.onSuccess(e.result):typeof r.onError=="function"&&r.onError({errorDescription:"json-rpc returned an error",errorCode:-9999,payload:e.error})},onError:r.onError})},responseCallback:null,_createRequestOptions:function(e,t,n){var r=function(e){this._onSuccess(e,n)}.bind(this),i=function(e){this._onError(e,n)}.bind(this),s=function(e){this._onComplete(e,n)}.bind(this),o=function(e,t){this._onRequest(e,t,n)}.bind(this),u={url:e,urlEncoded:!1,onSuccess:r,onFailure:i,onComplete:s,onRequest:o};return u},_onSuccess:function(e,t){e?this._executeSuccessCallback(t.onSuccess,e):this._executeFailureCallback(t.onError,Constants.ServerErrors.NO_DATA),this._executeUsersCallback(this.CALLBACK_STATUS.SUCCESS,e)},_onError:function(e,t){if(e){var n=Object.clone(Constants.ServerErrors.SERVER_UNHANDLED_ERROR);n.errorCode=e.status,this._executeFailureCallback(t.onError,n)}else this._executeFailureCallback(t.onError,Constants.ServerErrors.NO_DATA);this._executeUsersCallback(this.CALLBACK_STATUS.ERROR,e)},_onComplete:function(e,t){this._executeSuccessCallback(t.onComplete,e)},_onRequest:function(e,t,n){var r=W.Utils.getQueryParam("callback",e).split("."),i=window;for(var s=0;s<r.length;s++)i=i[r[s]];typeof n.onRequest=="function"&&n.onRequest(i,e,t)},_executeSuccessCallback:function(e,t){typeOf(e)==="function"&&e(t)},_executeFailureCallback:function(e,t){typeOf(e)==="function"&&e(t.errorDescription,t.errorCode,t.payload)},_executeUsersCallback:function(e,t){this.responseCallback&&typeOf(this.responseCallback)==="function"&&this.responseCallback(e,t)}}}),define.oldClass({name:"core.managers.serverfacade.WixRESTClient",Class:{Extends:"core.managers.serverfacade.RESTClient",initialize:function(){},jsonp:function(e,t,n,r){if(!r)this.parent(e,t,n);else{var i=this._createRequestOptions(e,t,n);i.onSuccess=function(e,t){this._onSuccess(t,n)}.bind(this),i.onComplete=function(){},i.timeout=5e3;var s=new Request.JSONP(i);s.send(JSON.encode(t))}},_onSuccess:function(e,t){this._validateServerSuccessResponse(e),e?e.success?this._executeSuccessCallback(t.onSuccess,e):this._executeFailureCallback(t.onError,e):this._executeFailureCallback(t.onError,Constants.ServerErrors.NO_DATA),this._executeUsersCallback(this.CALLBACK_STATUS.SUCCESS,e.payload)},_onComplete:function(e,t){this._validateServerSuccessResponse(e),this.parent(e,t)},_validateServerSuccessResponse:function(e){(!e||e.success===!1)&&LOG.reportError(wixErrors.SERVER_RETURNED_ERROR,"RESTClient","_onComplete",e)},_executeSuccessCallback:function(e,t){var n=t&&t.payload||t;this.parent(e,n)},_executeUsersCallback:function(e,t){var n=t&&t.payload||t;this.parent(e,n)}}}),define.Const("ServerErrors",{NO_DATA:{errorDescription:"no data",errorCode:-9999,payload:"no data"},SERVER_UNHANDLED_ERROR:{errorDescription:"server unhandled error",errorCode:-9999,payload:"no data"}}),define.oldClass({name:"mobile.core.skins.BaseSkin",Class:{Binds:["_onStylePropChange"],initialize:function(){this._isDisposed=!1},_comps:[],_params:[{type:"domId",name:"Component ID",id:"compId",inherited:!0}],_html:"<div></div>",_css:["base {}"],_viewNode:null,_updatePartsCallback:null,_skinParts:null,_inlineContainer:null,applyStyle:function(e){if(!e||this._style===e)return;this._removeOldStyle(),this._addStyle(e),this._render()},_removeOldStyle:function(){this._style&&this._style.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStylePropChange),delete this._style},_addStyle:function(e){this._style=e,this._style.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onStylePropChange)},register:function(e,t,n){this._isRegistered()?LOG.reportError(wixErrors.SKIN_MANAGER_RE_REGISTER,"mobile.core.skins.BaseSkin","register",e.getProperty("id")):(this._viewNode=e,this._updatePartsCallback=t,this._skinParamChangeCallback=n,this._render())},unRegister:function(){this._viewNode=null,this.dispose()},_isRegistered:function(){return this._viewNode&&this._updatePartsCallback},getInlineContent:function(){return this._skinParts?this._skinParts.inlineContent?this._skinParts.inlineContent.getChildren():null:this._viewNode.getChildren()},_render:function(){if(!this._isRegistered())return;var e=this.getInlineContent();this._skinParts=this._buildSkin();if(this._skinParts.inlineContent&&e){this._skinParts.inlineContent.empty();for(var t=0;t<e.length;t++)e[t].insertInto(this._skinParts.inlineContent,"bottom",Constants.DisplayEvents.MOVED_IN_DOM)}this._updatePartsCallback(this._skinParts)},_onStylePropChange:function(e){this.injects().Skins.stylePropertiesChangedForSkin(this.className,this._style,e.properties),this._skinParamChangeCallback(e.properties)},_informLogicOfParamChanges:function(){},_buildSkin:function(e){return this._renderCss(),this._renderHtml(e)},_renderCss:function(){this.injects().Skins.buildSkinCSS(this.className,this._style)},_renderHtml:function(e){var t=this._viewNode;return e&&e.viewNode&&(t=e.viewNode),this.injects().Skins.buildSkinHTML(this.className,t,this._style)},renderCssIfNeeded:function(){var e=!0;if(this._style)e=this._style.isStyleRenderedForAllSkins();else{var t=this.getSkinClassData(),n=t.CSSBuildFlags;for(var r in n)if(!n[r]){e=!1;break}}e||this._renderCss()},getStyle:function(){return this._style},getParams:function(){return this._params},getCompPartsDefinition:function(){return this.compParts||{}},getCompPartSkinName:function(e){var t=this.compParts;return t&&t[e].skSin},getUniqueClass:function(e){return this.injects().Skins.getUniqueClass(e,this.$className)},dispose:function(){this._isDisposed=!0,this._updatePartsCallback=null,this._removeOldStyle()},getParamValue:function(e){return this.injects().Skins.getSkinParamValue(this.$className,e,this._style)}}}),define.oldClass({name:"core.managers.skin.BaseSkin2",Class:{Extends:"bootstrap.managers.events.EventDispatcher",Binds:["_onParamChange","_onParamMapperSkinChange"],Static:{},initialize:function(){},setParamMapper:function(e){this.removeParamMapper(),this._paramMapper=e,this._paramMapper.addEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onParamChange),this._paramMapper.addEvent(Constants.StyleEvents.SKIN_CHANGED,this._onParamMapperSkinChange),this._render()},getParamMapper:function(){return this._paramMapper||null},removeParamMapper:function(){this._paramMapper&&(this._paramMapper.removeEvent(Constants.StyleEvents.PROPERTY_CHANGED,this._onParamChange),this._paramMapper.removeEvent(Constants.StyleEvents.SKIN_CHANGED,this._onParamMapperSkinChange),delete this._paramMapper)},_onParamMapperSkinChange:function(){this._paramMapper.getSkinClassName()!==this.$className&&this._logic&&this._logic.setSkinMapper(this._paramMapper)},_onParamChange:function(e){W.Skins.stylePropertiesChangedForSkin(this.className,this._paramMapper,e.properties)},_setLogic_:function(e){this._logic=e,this._render()},_removeLogic_:function(){delete this._logic},_render:function(){if(!this._logic)return;var e=this._logic.getInlineContent();this._skinParts=this._buildSkin();if(this._skinParts.inlineContent&&e){this._skinParts.inlineContent.empty();for(var t=0;t<e.length;t++)e[t].insertInto(this._skinParts.inlineContent,"bottom",Constants.DisplayEvents.MOVED_IN_DOM)}this._logic._updateSkinParts_(this._skinParts)},_buildSkin:function(){return this._renderCss(),this._renderHtml()},_renderCss:function(){this.injects().Skins.buildSkinCSS(this.$className,this._paramMapper)},_renderHtml:function(){var e=this._logic.getViewNode();return this.injects().Skins.buildSkinHTML(this.$className,e,this._paramMapper)},getCompPartsDefinition:function(){return this.compParts||{}},getParams:function(){return this._params},getCompPartSkinName:function(e){var t=this.compParts;return t&&t[e].skSin},getUniqueClass:function(e){return this.injects().Skins.getUniqueClass(e,this.getOriginalClassName())},getParamValue:function(e){return this.injects().Skins.getSkinParamValue(this.getOriginalClassName(),e,this._paramMapper)},exterminate:function(){this._removeLogic_(),this.removeParamMapper(),this.parent()}}}),define.oldClass({name:"core.managers.skin.CssGarbageCollector",imports:["core.managers.skin.GCDomTraverse"],Class:{Binds:["runGarbageCollector"],initialize:function(e,t,n){this._styleDataMap=e,this._skinDataMap=t,this._skinRenderer=n,this._DomTraverserClass=this.imports.GCDomTraverse},runGarbageCollector:function(){this._domTraverser=new this._DomTraverserClass,this._domTraverser.traverseDomAndCollectUsedStyles(function(e,t){this._runGarbageCollectorOnStyles(e),this._runGarbageCollectorOnSkins(t)}.bind(this))},_runGarbageCollectorOnStyles:function(e){var t=this._findUnusedStyles(e);for(var n in t){if(!t[n])continue;var r=t[n];this._processUnusedStyles(r)}},_findUnusedStyles:function(e){var t=Object.filter(this._styleDataMap,function(t,n){return!e.contains(n)});return t},_runGarbageCollectorOnSkins:function(e){var t=this._findUnusedSkins(e);for(var n in t){var r=this._skinDataMap[n];r&&this._removeUnusedSkinRules(r)}},_findUnusedSkins:function(e){var t=Object.filter(this._skinDataMap,function(t,n){return!e.contains(n)});return t},_processUnusedStyles:function(e){var t=e.getSkinArray(),n=e.getGroups();for(var r in n){var i=n[r];this._processUnusedStyles(i)}for(var s=0;s<t.length;s++){var o=this._skinDataMap[t[s]];o&&this._removeUnusedSkinRules(o,e.getId())}e.setStyleRenderFlag(!1)},_removeUnusedSkinRules:function(e,t){var n=e.css;if(!n)return;for(var r=0;r<n.length;r++){t||(t="");var i=this._skinRenderer.replaceStylePlaceHolder(n[r].selector,t);this._skinRenderer.removeCssRule(i),e.CSSBuildFlags[t]=!1}}}}),define.experimentPlugin("ExperimentSkinPlugin",function(e){function i(e,t){resource.getResourceValue("W.Classes",function(e){e.getClass("core.managers.skin.SkinDefinition",function(e){r=e})});var n=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),i=e;typeof e=="function"&&(i=new r,e(i));var s=new r;return t(s,n),i.inherits(s._extends_||i._extends_),i.utilize(n._mergeField_(i._imports_,s._imports_)),i.fields(n._mergeObjects_(i._fields_,s._fields_)),i.compParts(n._mergeField_(i._compParts_,s._compParts_)),i.skinParams(n._mergeField_(i._skinParams_,s._skinParams_)),i.html(s._html_||i._html_),i.css(n._mergeField_(i._css_,s._css_)),i}function s(e,t){define.skin(e,t)}var t=e,n,r;t.init("skin","newSkin",i,s)}),define.oldClass({name:"core.managers.skin.GCDomTraverse",Class:{initialize:function(){this._usedStyles=[],this._usedSkins=[]},traverseDomAndCollectUsedStyles:function(e){this._traverseElementAndCollect($(document.body)),e(this._usedStyles,this._usedSkins)},_traverseElementAndCollect:function(e){var t=e.isDisplayed();if(!t)return;this._collectElementStylesSkins(e);var n=e.getChildren();if(!n||!n.length)return;for(var r=0;r<n.length;r++)this._traverseElementAndCollect(n[r])},_collectElementStylesSkins:function(e){var t=e.getAttribute("styleId");t&&this._usedStyles.push(t);var n=e.getAttribute("skin");n&&this._usedSkins.push(n);var r=e.getLogic&&e.getLogic().getSkin&&e.getLogic().getSkin().$className;r&&this._usedSkins.include(r)}}}),define.Class("core.managers.skin.SkinDefinition",function(e){var t=e;t.inherits(e.constructor),t.methods({initialize:function(){e.constructor.apply(this),this._compParts_={},this._skinParams_=[],this._html_="",this._css_=[]},compParts:function(e){this._compParts_=e},skinParams:function(e){this._skinParams_=e},html:function(e){this._html_=e},css:function(e){this._css_=e}})}),define.oldClass({name:"core.managers.skin.SkinManager",imports:["core.managers.skin.SkinDefinition","core.managers.skin.SkinParser","core.managers.skin.SkinRenderer","core.managers.skin.CssGarbageCollector","bootstrap.utils.Queue"],Class:{Extends:"bootstrap.managers.BaseManager",Resources:["W.Classes","W.Theme","W.Utils","W.Experiments"],Binds:["_onClassReady","getSkin","buildSkinCSS","_onThemeChange","_checkThemePropChanges","_checkStylePropChanges","_onSkinDefineCallBack"],initialize:function(){this._SkinParserClass=this.imports.SkinParser,this._SkinRendererClass=this.imports.SkinRenderer,this._CssGarbageCollectorClass=this.imports.CssGarbageCollector,this._skinParser=new this._SkinParserClass,this._skinRenderer=new this._SkinRendererClass,this._skinQue=new this.imports.Queue,this._skinClassMap={},this._pendingSkinClassMap={},this._skinDataMap={},this._styleDataMap={},this._cssGarbageCollector=new this._CssGarbageCollectorClass(this._styleDataMap,this._skinDataMap,this._skinRenderer),this._classManager=this.resources.W.Classes,this._classManager.addClassNamespaceHook(this.getSkin),this._classManager.addClassReadyHandler(this._onClassReady),this.resources.W.Theme.addEvent("propertyChange",this._onThemeChange),this.define.skin.definitionModifier=this._onSkinDefineCallBack.bind(this)},_onSkinDefineCallBack:function(e,t){var n=this._skinQue.getQueue(e);return n&&n.length>0&&this.registerNewSkin(e,t),t},registerNewSkin:function(e,t){if(this._isSkinRegister())return;var n=new this.imports.SkinDefinition;t(n),n=this.resources.W.Experiments.applyExperiments(e,n),this._fixSkinDefinition(e,n),this._validateNewSkin(e),this._addSkinDependencies(e,n),this._pendingSkinClassMap[e]="pending",this._classManager.registerClassDefinition(e,n)},_isSkinRegister:function(e){return this._pendingSkinClassMap[e]||this._skinDataMap[e]},_fixSkinDefinition:function(e,t){var n=t._fields_;n._html=t._html_,n._css=t._css_,n._params=t._skinParams_,n.compParts=t._compParts_},_validateNewSkin:function(e){if(this._skinClassMap[e]||this._skinDataMap[e]){LOG.reportError(wixErrors.SKIN_ALREADY_EXIST,this.className,"newSkin",e+"");return}},_addSkinDependencies:function(e,t){var n=this,r=t._imports_||[],i=t._compParts_||{};for(var s in i){var o=i[s].skin;if(o&&r.indexOf(o)<0){var u=this.getNameOverride(o);r.push(u)}}t.utilize(r)},newSkin:function(e){this.define.oldSkin(e)},override:function(e,t){if(!e)throw new Error("null/undefine skin name to override: ");this.getSkin(e,function(){this._skinClassMap[e]=t}.bind(this))},getSkin:function(e,t){e=this.getNameOverride(e);if(this._skinClassMap[e])return this.resources.W.Utils.callLater(t,[this._skinClassMap[e]]),this._skinClassMap[e];var n=this._skinQue.hasQueue(e)===!1;this._skinQue.add(e,t);if(n){var r=this.define.getDefinition("skin"),i=nsUtil.getNameSpace(r,e);i?this.registerNewSkin(e,i):this._classManager.getClass(e,function(){})}return null},getNameOverride:function(e){return this.define.Class.$nameOverrides[e]||e},_onClassReady:function(e,t){if(!this._pendingSkinClassMap[e]){this._skinQue.removeKey(e);return}this._onSkinClassReady(e,t),this._skinQue.getQueue(e).forEach(function(e){e&&e(t)}.bind(this))},_onSkinClassReady:function(e,t){var n=this._skinParser.parseSkinData(e,t);this._skinDataMap[e]=n,t.prototype.getSkinClassData=function(){return n},this._onSkinReady(t,e)},_onSkinReady:function(e,t){this._skinClassMap[t]=e,this._skinQue.getQueue(t).forEach(function(e){e&&e(this._skinClassMap[t])}.bind(this)),this._skinQue.removeKey(t)},_$getCssId:function(){return this._skinRenderer.getCssNodeId()},isReady:function(){return!this._skinQue.hasQueue()},buildSkinCSS:function(e,t){var n=this._skinDataMap[e];if(!n){LOG.reportError(wixErrors.SKIN_MANAGER_NO_DATA_FOR_SKIN,"mobile.core.managers.SkinManager","buildSkinCSS",e);return}var r=this._skinRenderer.getStyleId(t);if(n.CSSBuildFlags[r]||t&&t.isStyleRenderedForSkin(e))return;t?(this._styleDataMap[r]=t,t.setStyleRenderFlagForSkin(e,!0)):n.CSSBuildFlags[r]=!0,this._skinRenderer.registerSkinCSSNow(n,t)},buildSkinHTML:function(e,t,n){if(!e||!t){var r=t&&t.getProperty("id");return LOG.reportError(wixErrors.SKIN_MANAGER_MISSING_ARGUMENTS,"mobile.core.managers.SkinManager","buildSkinHTML","skinName="+e+" compId="+r+"compViewNode: "+t),{}}var i=this._skinDataMap[e];return i?this._skinRenderer.buildSkinHTML(i,t,n):(LOG.reportError(wixErrors.SKIN_MANAGER_NO_DATA_FOR_SKIN,"mobile.core.managers.SkinManager","buildSkinHTML",e),{})},stylePropertiesChangedForSkin:function(e,t,n){var r=t&&t.getId();if(e&&r&&n){this._styleChangedProps||(this._styleChangedProps={}),this._styleChangedProps[e]=this._styleChangedProps[e]||{},this._styleChangedProps[e][r]=this._styleChangedProps[e][r]||{style:t,props:{}};for(var i in n)this._styleChangedProps[e][r].props[i]="";this._styleChangeCallLater||(this._styleChangeCallLater=this.resources.W.Utils.callOnNextRender(this._checkStylePropChanges,100))}},_onThemeChange:function(e){var t=e.name;t&&(this._themeChangedProps||(this._themeChangedProps={}),this._themeChangedProps[t]=e,this._themeChangeCallCallLater||(this._themeChangeCallCallLater=this.resources.W.Utils.callOnNextRender(this._checkThemePropChanges,100)))},_checkStylePropChanges:function(){var e,t,n,r,i,s,o,u;delete this._styleChangeCallLater;for(e in this._styleChangedProps){t=this._styleChangedProps[e],n=this._skinDataMap[e];for(r in t){i=t[r].style,s=t[r].props,o=n.css;for(u=0;u<o.length;++u)this._isSkinCssClassContainsPartialParams(o[u],s,"id")&&this._skinRenderer.updateSkinCSSClass(o[u].selector,o[u].rules,o[u].params,n.params,i)}}delete this._styleChangedProps},_checkThemePropChanges:function(){delete this._themeChangeCallCallLater;if(this===W.Skins)for(var e in this._skinDataMap){var t=this._skinDataMap[e],n=this._skinDataMap[e].css;for(var r=0;r<n.length;++r)this._isSkinCssClassContainsPartialParams(n[r],this._themeChangedProps,"defaultTheme")&&this._skinRenderer.updateSkinCSSClass(n[r].selector,n[r].rules,n[r].params,t.params)}delete this._themeChangedProps},_isSkinCssClassContainsPartialParams:function(e,t,n){var r=e.params;for(var i in t)for(var s=0;s<r.length;++s)if(r[s][n]&&r[s][n]==i)return!0;return!1},getSkinParamValue:function(e,t,n){var r=this._skinDataMap[e].params;for(var i=0;i<r.length;i++){var s=r[i];if(s.id==t)return this._skinRenderer.getParamValue(s,n)}return null},getUniqueClass:function(e,t){var n=this._skinParser.getSkinCSSName(t),r=this._skinParser.getUniqueClass(e,n);return r.uniqueClass}}}),define.oldClass({name:"core.managers.skin.SkinParser",Class:{parseSkinData:function(e,t){var n=t.prototype,r=n._params||[],i=n._html||"",s=n._css||[],o=[],u={},a={},f=this._addStylePlaceHolder(this.getSkinCSSName(e));r=this._processSkinParams(r,e);for(var l=0;l<s.length;++l){var c=s[l];if(!c){var h="";try{h=s.join(",")}catch(p){}LOG.reportError(wixErrors.SKIN_PROBLEM_WITH_RULE,this.className,"_registerSkinData",e+"("+l+") : "+h)}else this._processSkinCssClass(c,r,f,a,u,o)}return{name:e,params:r,html:i,css:o,compParts:n.compParts||{},skinPartClasses:u,skinSpecificClasses:a,skinCSSName:f,CSSBuildFlags:{},canFocus:!!n.canFocus}},getSkinCSSName:function(e){return e.replace(/\./g,"_")},_processSkinParams:function(e,t){for(var n=0;n<e.length;++n){var r=e[n];r.defaultParam&&(r.defaultParam=this._getParamById(e,r.defaultParam),r.defaultParam||(LOG.reportError(wixErrors.SKIN_PARAM_REF_NOT_FOUND,t,"_processSkinParams/defaultParam",r.id)(),delete r.defaultParam,r.defaultValue=""));if(r.sumParams){var i=[];for(var s=0;s<r.sumParams.length;++s){var o=this._getParamById(e,r.sumParams[s]);o?i.push(o):LOG.reportError(wixErrors.SKIN_PARAM_REF_NOT_FOUND,t,"_processSkinParams/sumParams",r.sumParams[s])()}r.sumParams=i}}return e},_getParamById:function(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t)return e[n];return null},_processSkinCssClass:function(e,t,n,r,i,s){var o=e.indexOf("{"),u=e.lastIndexOf("}");if(o!=-1&&u!=-1&&o<u-1){var a=e.substr(0,o),f=e.substring(o+1,u),l=this._getParamsUsed(f,t),c=a.split(",");for(var h=0;h<c.length;++h)a=this._processSkinCssSelector(c[h],n,r,i),s.push({selector:a,rules:f,params:l})}},_processSkinCssSelector:function(e,t,n,r){var i=this._convertCssSelector(e,t,n,r),s=e.length?e.charAt(0):"",o=s=="["||s==":"||s===""||s=="{"||s=="."||s==">";if(o||i==e){var u=o?"":" ";i="."+t+u+i}return i=i.trim().replace(/\s+/g," "),i},_convertCssSelector:function(e,t,n,r){var i=/%(\.?[a-z0-9]+)%/i,s,o,u;s=e.match(i);while(s){if(s.length<2)break;o=s[1];var a=this.getUniqueClass(o,t);a.type=="class"?n[o.substring(1)]=a.uniqueClass:r[o]=a.uniqueClass,e=e.replace(i,"."+a.uniqueClass),s=e.match(i)}return e},getUniqueClass:function(e,t){var n={};if(e.charAt(0)=="."){var r=e.substring(1);n.uniqueClass=t+"-c-"+r,n.type="class"}else n.uniqueClass=t+"-"+e,n.type="skinPart";return n},_getParamsUsed:function(e,t){var n=[];if(!e||!t||t.length===0)return n;for(var r=0,i=t.length;r<i;++r)e.indexOf("["+t[r].id+"]")!=-1&&(n[t[r].id]=t[r]);var s={};for(var o in n){var u=n[o];if(u.defaultParam){while(u.defaultParam!==undefined)u=u.defaultParam;s[u.id]=u}}return Object.values(Object.merge(n,s))},_addStylePlaceHolder:function(e){return e+Constants.skinManager.STYLE_CSS_PLACEHOLDER}}}),function(){var e=null;define.Class("core.managers.skin.SkinRenderer",function(t){var n=t;n.utilize(["core.utils.css.BorderRadius","core.utils.css.Color","core.utils.css.Size","core.utils.css.Font","core.utils.css.BoxShadow"]),n.methods({initialize:function(){this._stylesheet=this._generateSkinsStylesSheet()},replaceStylePlaceHolder:function(e,t){return e.split(Constants.skinManager.STYLE_CSS_PLACEHOLDER).join(t)},registerSkinCSSNow:function(e,t){var n=e.css;for(var r=0;r<n.length;++r)this.updateSkinCSSClass(n[r].selector,n[r].rules,n[r].params,e.params,t)},updateSkinCSSClass:function(e,t,n,r,i){styleId=this.getStyleId(i);for(var s=0;s<n.length;++s){var o=n[s],u=o.id,a=this._getParamValue(o,i),f=this._paramValueToCss(a,o);f===null&&(f=""),t=t.split("["+u+"]").join(f)}e=this.replaceStylePlaceHolder(e,styleId);if(i&&i.isCssRedirectedToStyle())i.updateCssRule(e,t);else try{this._stylesheet.updateRule(e,t)}catch(l){}},getParamValue:function(e,t){return this._getParamValue(e,t)},_getParamValue:function(e,t){var n=null;if(e.defaultParam){var r=e.defaultParam;return this._applyParamMutators(this._getParamValue(r,t),e)}if(t&&t.get(e.id)){var i=t.getPropertySource(e.id);return n=t.get(e.id),i=="theme"&&(n=this.injects().Theme.getProperty(n)),n=this._castToType(n,e),n=this._addExtraToParamByType(e,n,t),this._applyParamMutators(n,e)}if(e.defaultTheme){var s=e.defaultTheme,o=W.Theme.getProperty(s);return o=this._castToType(o,e),this._applyParamMutators(o,e)}if(e.sumParams){var u=e.sumParams;if(u&&typeOf(u)=="array"&&u.length>0){var a=this._getParamValue(u[0],t);if(a.add&&typeof a.add=="function")for(var f=1;f<u.length;f++)a.add(this._getParamValue(u[f],t));return this._applyParamMutators(a,e)}}return e.defaultValue?(n=this._castToType(e.defaultValue,e),this._applyParamMutators(n,e)):null},_castToType:function(e,t){switch(t.type){case Constants.SkinParamTypes.COLOR:case Constants.SkinParamTypes.COLOR_ALPHA:case Constants.SkinParamTypes.BG_COLOR:e=new this.imports.Color(e);break;case Constants.SkinParamTypes.SIZE:e=new this.imports.Size(e);break;case Constants.SkinParamTypes.BOX_SHADOW:e=new this.imports.BoxShadow(e);break;case Constants.SkinParamTypes.BORDER_RADIUS:e=new this.imports.BorderRadius(e);break;case Constants.SkinParamTypes.FONT:e=new this.imports.Font(e)}return e},_addExtraToParamByType:function(e,t,n){var r=n.getPropertyType(e.id);if(r=="color"){var i=n.getPropertyExtraParamValue(e.id,"alpha");t.setAlpha(i)}return r=="boxShadow"&&t.setToggleOn(n.getPropertyExtraParamValue(e.id,"isOn")===!0),t},_applyParamMutators:function(e,t){if(t.mutators)for(var n=0;n<t.mutators.length;n+=2){var r=e[t.mutators[n]];if(r&&typeof r=="function"){var i=t.mutators[n+1];if(!i||typeOf(i)!="array")i=i?[i]:[];e=r.apply(e,i)}else LOG.reportError(wixErrors.SKIN_PARAM_MUTATOR_FUNC_NOT_FOUND,"SkinRenderer","_applyParamMutators",r)()}return e},_paramValueToCss:function(e,t){var n=Constants.skinManager.FEATURES;if(e!==undefined&&e!==null){t=t||{};switch(t.type){case Constants.SkinParamTypes.BG_COLOR:var r=e,i=r.getAlpha();i>0?Modernizr.rgba===!0&&i<1?e="background-color:rgba("+r.getRgba()+");":(e="background-color:"+r.getHex(!1)+";",n.filter_alpha&&i<1&&(e+="filter:alpha(opacity="+i*100+");")):e="background-color:transparent;";break;case Constants.SkinParamTypes.BORDER_RADIUS:var s=W.Utils.getCSSBrowserFeature("border-radius");s?e=s+":"+e+";":e="";break;case Constants.SkinParamTypes.TRANSITION:s=W.Utils.getCSSBrowserFeature("transition"),s?e=s+":"+e+";":e="";break;case Constants.SkinParamTypes.BOX_SHADOW:W.Utils.getCSSBrowserFeature("box-shadow")?e=W.Utils.getCSSBrowserFeature("box-shadow")+":"+e.getCssValue()+";":e="";break;case Constants.SkinParamTypes.FONT:e="font:"+e.getCssValue()+";";break;case Constants.SkinParamTypes.SIZE:e=e.getCssValue();break;case Constants.SkinParamTypes.COLOR:e=e.getHex!==undefined?e.getHex(!1):e;break;case Constants.SkinParamTypes.COLOR_ALPHA:r=e,i=r.getAlpha(),i>0?Modernizr.rgba===!0&&i<1?e="rgba("+r.getRgba()+")":e=r.getHex(!1):e="transparent"}return e}return null},buildSkinHTML:function(e,t,n){styleId=this.getStyleId(n);var r=e.html,i=this.replaceStylePlaceHolder(e.skinCSSName,styleId);t.empty(),t.set("html",r),t.set("styleId",styleId),t.set("skin",e.name),e.canFocus?t.tabIndex=0:t.tabIndex===0&&(t.tabIndex=-1),t._wixCSSName&&(t.removeClass(t._wixCSSName),delete t._wixCSSName),i&&(t.addClass(i),t._wixCSSName=i);var s={view:t},o=$$(t.getElements("[skinPart]")),u=e.compParts||{},a=e.skinPartClasses||{};for(var f=0;f<o.length;++f){var l=o[f],c=l.getAttribute("skinPart");s[c]=l;var h=a[c];h&&l.addClass(this.replaceStylePlaceHolder(h,styleId));var p=l.getAttribute("skin");!p&&u[c]&&u[c].skin&&(p=u[c].skin,p&&l.setAttribute("skin",p))}var d=e.skinSpecificClasses||{};for(var v in d){var m=$(t).getElements("."+v);m.removeClass(v).addClass(this.replaceStylePlaceHolder(d[v],styleId))}return s},getStyleId:function(e){return e&&e.getId()||""},_skinStyleNodeId:null,_generateSkinsStylesSheet:function(){return e||(e=W.Utils.createStyleSheet("WIX_SKIN_STYLES")),this._skinStyleNodeId=e.styleNode.get("id"),e},getCssNodeId:function(){return this._skinStyleNodeId},removeCssRule:function(e){this._stylesheet.removeRuleBySelector(e)}})})}(),function(){var e={},t=document.createElement("div"),n=function(n,r,i){t.style.cssText=r,e[n]=i(t)};n("filter_alpha","filter:alpha(opacity=0.9);",function(e){return e.style.filter!==undefined&&e.style["filter"].indexOf("alpha")!=-1}),n("opacity","opacity:0.7;",function(e){return e.style.opacity!==undefined&&e.style["opacity"]=="0.7"}),n("background-color_rgba","background-color:rgba(255,0,0,0.5);",function(e){return e.style.backgroundColor!==undefined&&e.style["backgroundColor"].indexOf("rgba")!=-1}),n("border-radius","border-top-right-radius:0.1em;",function(e){return e.style.borderTopRightRadius!==undefined&&e.style["borderTopRightRadius"].indexOf("0.1em")!=-1}),n("-webkit-border-radius","-webkit-border-top-right-radius:0.2em;",function(e){return e.style.webkitBorderTopRightRadius!==undefined&&e.style["webkitBorderTopRightRadius"].indexOf("0.2em")!=-1}),n("-moz-border-radius","-moz-border-radius-topright:0.3em;",function(e){return e.style.MozBorderRadiusTopright!==undefined&&e.style["MozBorderRadiusTopright"].indexOf("0.3em")!=-1}),define.Const("skinManager",{STYLE_CSS_PLACEHOLDER:"[STYLE_PH]",FEATURES:e})}(),define.Const("SkinParamCssTypesToGeneralTypesMap",{cssBorderRadius:"radius",cssBgColor:"color",boxShadow:"boxShadow",color:"color",color_alpha:"color",cssFont:"font",size:"size",cssStr:"string",url:"url",transition:"transition"}),define.Const("SkinParamTypes",{BORDER_RADIUS:"cssBorderRadius",BG_COLOR:"cssBgColor",BOX_SHADOW:"boxShadow",COLOR:"color",COLOR_ALPHA:"color_alpha",FONT:"cssFont",SIZE:"size",OTHER:"cssStr",URL:"url",TRANSITION:"transition"}),define.oldClass({name:"core.managers.style.SkinExtraParamHandler",Class:{Extends:"bootstrap.utils.Events",Static:{PROPERTY_TYPE_EXTRA_PARAMS:{color:{alpha:{prefix:"alpha",defaultValue:1,type:"number"}},boxShadow:{isOn:{prefix:"boxShadowToggleOn",defaultValue:!0,type:"boolean"}}}},initialize:function(e,t,n){this._properties=e,this._propertiesTypes=t,this._propertiesCounter=n},getPropertyExtraParamValue:function(e,t){var n=this._getPropertyExtraParamDefinition(e,t);if(!n)return;var r=this._getPropertyExtraParamId(e,n.prefix);return this._convertStringToType(this._properties[r],n.type)},_getPropertyExtraParamDefinition:function(e,t){var n=this._propertiesTypes[e],r=this._getExtraParamDefinitionByType(n,t);if(!r){LOG.reportError(wixErrors.STYLE_EXTRA_PARAM_DEFINITION_MISSING,"SkinExtraParamHandler","_getPropertyExtraParamDefinition",n+"-"+t)();return}return r},_getExtraParamDefinitionByType:function(e,t){return this.PROPERTY_TYPE_EXTRA_PARAMS[e]&&this.PROPERTY_TYPE_EXTRA_PARAMS[e][t]},_getPropertyExtraParamId:function(e,t){return t+"-"+e},_convertStringToType:function(e,t){switch(t){case"number":e=Number(e);break;case"boolean":e=String(e).toLowerCase()==="true"}return e},setPropertyExtraParamValue:function(e,t,n){var r=this._getPropertyExtraParamDefinition(e,t);if(!r)return;var i=this._getPropertyExtraParamId(e,r.prefix);return this._properties[i]=String(n),i},setPropertyExtraParams:function(e,t){var n=t.type,r=this.PROPERTY_TYPE_EXTRA_PARAMS[n];if(r){var i=t.styleDefaults;for(var s in r){var o=r[s],u=this._getPropertyExtraParamId(e,o.prefix),a;this._properties[u]?a=this._properties[u]:i&&i[o.prefix]?a=i[o.prefix]:a=o.defaultValue,this._properties[u]=a,this._propertiesTypes[u]=n+"-"+s,this._increasePropertyUseCount(u)}}},_increasePropertyUseCount:function(e){this._propertiesCounter[e]?this._propertiesCounter[e]+=1:this._propertiesCounter[e]=1}}}),define.oldClass({name:"core.managers.style.SkinParamMapper",imports:["bootstrap.utils.BufferFunction","core.managers.style.SkinParamParser","core.managers.style.SkinParamRenderHandler"],Class:{Extends:"bootstrap.utils.Events",Binds:["_onThemePropertiesChange"],initialize:function(e,t,n){this.SkinParserClass=this.imports.SkinParamParser,this.SkinParamRenderHandlerClass=this.imports.SkinParamRenderHandler,this._dataItem=e,this._rawData=t,this._mapId=this._dataItem.get("id")+"-"+this.getNewGroupIdCounter(),n=typeof n=="string"?W.Skins.getSkin(n):n,this._skin=new n,this._initMapProperties(),this._skinParser=new this.SkinParserClass(this._dataItem,this._rawData,this._skin,this.$class),this._skinParamRenderHandler=new this.SkinParamRenderHandlerClass(this.getGroups()),this._garbageCollection(),W.Theme.getDataItem().addEvent(Constants.DataEvents.DATA_CHANGED,this._onThemePropertiesChange)},_initMapProperties:function(){this._rawData.properties=this._rawData.properties||{},this._rawData.groups=this._rawData.groups||{},this._rawData.propertiesSource=this._rawData.propertiesSource||{}},setSkin:function(e){var t=new e;return this._skin.$className==t.$className?!1:(this._skin=t,this._dataItem.set("skin",this._skin.$className),this._rawData.properties={},this._rawData.propertiesSource={},this._rawData.groups={},this._skinParser=new this.SkinParserClass(this._dataItem,this._rawData,this._skin,this.$class),this._skinParamRenderHandler=new this.SkinParamRenderHandlerClass(this.getGroups()),this.fireEvent(Constants.StyleEvents.SKIN_CHANGED),this.fireEvent(Constants.StyleEvents.READY),!0)},getSkin:function(){return this.getSkinClassName()},getSkinClassName:function(){return this._skin.$className},getSkinClass:function(){return this._skin.$class},getDataItem:function(){return this._dataItem},getPropertyExtraParamValue:function(e,t){return this._skinParser.getPropertyExtraParamValue(e,t)},setPropertyExtraParamValue:function(e,t,n,r){var i=this._skinParser.setPropertyExtraParamValue(e,t,n),s={},o={};s[i]=this._skinParser.getProperty(i),this._dataItem.fireDataChangeEvent(e,s,o),r&&this._firePropertyChangesEvent(e,s)},_onThemePropertiesChange:function(e,t){for(var n in t){var r=this._skinParser.getProperties();for(var i in r)this.getPropertySource(i)==Constants.STYLE.SOURCE.THEME&&r[i]==n&&this._firePropertyChangesEvent(i)}},_firePropertyChangesEvent:function(e){this._changes||(this._changes={}),this._changes[e]=this._skinParser.getPropertyType(e),this.injects().Utils.clearCallLater(this._dispatchEventId),this._dispatchEventId=this.injects().Utils.callLater(this._dispatchChangeEventAndResetChanges,[],this,50)},_dispatchChangeEventAndResetChanges:function(){this.fireEvent(Constants.StyleEvents.PROPERTY_CHANGED,{style:this,properties:this._changes}),this._changes={}},updateCssRule:function(e,t){this._changedCssClasses||(this._changedCssClasses={}),this._changedCssClasses[e]=t,this._dispatchCssChanges()},_dispatchCssChanges:function(){this.fireEvent("cssChanged",this._changedCssClasses),this._changedCssClasses={}},setRedirectCssTarget:function(e){this._redirectCssTarget=e===!0},isCssRedirectedToStyle:function(){return this._redirectCssTarget},_garbageCollection:function(){this.setStyleRenderFlag(!1),this._skinParser.garbageCollection()},addInnerSkin:function(e,t,n){this._skinParser.parseSkinByInstance(e,t,n)},getNewGroupIdCounter:function(){return this._groupIdCounter=this._groupIdCounter||0,this._groupIdCounter++,this._groupIdCounter},getMapId:function(){return this._mapId},getId:function(){return this._dataItem.get("id")},getProperty:function(e){return this._skinParser.getProperty(e)},setProperty:function(e,t){this._skinParser.setProperty(e,t);var n={},r={};n[e]=t,r[e]=this.getProperty(e),this._dataItem.fireDataChangeEvent(e,n,r),this._firePropertyChangesEvent(e)},getProperties:function(){return this._skinParser.getProperties()},getGroups:function(){return this._skinParser.getInnerSkins()},isPropertyAvailable:function(e){return this._skinParser.getProperty(e)?!0:!1},getPropertySource:function(e){return this._skinParser.getPropertySource(e)},getPropertyType:function(e){return this._skinParser.getPropertyType(e)},getStyleByGroupName:function(e){return this._skinParser.getInnerSkin(e)},getSkinArray:function(){return this._skinParser.getUsedSkinArray()},changePropertySource:function(e,t,n){this._skinParser.setPropertySource(e,n),this.setProperty(e,t)},getPropertyLangKey:function(e){return this._skinParser.getPropertyLangKey(e)},isStyleRenderedForSkin:function(e){return this._skinParamRenderHandler.isSkinParamRenderedForSkin(e)},isStyleRenderedForAllSkins:function(){return this._skinParamRenderHandler.isSkinParamRenderedForAllSkins()},setStyleRenderFlag:function(e){this._skinParamRenderHandler.setSkinParamRenderFlag(e)},setStyleRenderFlagForSkin:function(e,t){this._skinParamRenderHandler.setSkinParamRenderFlagForSkin(e,t)},invalidateStyle:function(){this._skinParamRenderHandler.invalidateSkinParamMapper()},getStyleType:function(){return this._dataItem.get("styleType")},setStyleType:function(e){this._dataItem.set("styleType",e)},getIsCustomStyle:function(){return this.getStyleType()==="custom"},setIsCustomStyle:function(e){this.setStyleType(e?"custom":"system")},getCompClassName:function(){return this._dataItem.get("componentClassName")},setCompClassName:function(e){this._dataItem.set("componentClassName",e)},getPageId:function(){return this._dataItem.get("pageId")},setPageId:function(e){this._dataItem.set("pageId",e)},getCompId:function(){return this._dataItem.get("compId")},setCompId:function(e){this._dataItem.set("compId",e)}}}),define.Class("core.managers.style.SkinParamParser",function(e){var t=e;t.utilize(["core.managers.style.SkinParamSourceHandler","core.managers.style.SkinExtraParamHandler"]),t.inherits("bootstrap.utils.Events"),t.statics({STYLE_PROPERTIES_FILTER:{color:[Constants.STYLE.SOURCE.THEME],font:[Constants.STYLE.SOURCE.THEME],radius:[Constants.STYLE.SOURCE.VALUE],size:[Constants.STYLE.SOURCE.VALUE],boxShadow:[Constants.STYLE.SOURCE.VALUE]}}),t.methods({initialize:function(e,t,n,r){this._innerSkinMaps={},this._properties=t.properties||{},this._propertiesTypes={},this._propertiesCounter={},this._propertiesLangKey={},this._usedSkinNamesArray=[],this.SkinMapperClass=r;var i=this.imports.SkinParamSourceHandler,s=this.imports.SkinExtraParamHandler;this._paramSourceHandler=new i(t.propertiesSource),this._extraParamHandler=new s(this._properties,this._propertiesTypes,this._propertiesCounter),this._parseSkinAndData(e,t,n)},parseSkinByInstance:function(e,t,n){var r=new n;this._parseSkinAndData(e,t,r)},_parseSkinAndData:function(e,t,n){this._addUsedSkinName(n.$className),this._saveSkinParams(n.getParams()),this._parseSkinInnerComponents(e,t,n.getCompPartsDefinition(),n.imports)},_addUsedSkinName:function(e){this._usedSkinNamesArray.push(e)},_saveSkinParams:function(e){for(var t=0;t<e.length;t++)this._addProperty(e[t])},_addProperty:function(e){var t=e.id,n=this._createParamDataObj(e);if(n.source!="unknown"&&!n.ignore){this._properties[t]=this._properties[t]||e.defaultTheme||e.defaultValue,this._propertiesTypes[t]=n.type,this._propertiesLangKey[t]=n.langKey;var r=this.getPropertySource(t)||n.source;this.setPropertySource(t,r),this._increasePropertyUseCount(t),this._extraParamHandler.setPropertyExtraParams(t,n)}},_createParamDataObj:function(e){var t={};e.defaultTheme?(t.source=Constants.STYLE.SOURCE.THEME,t.value=e.defaultTheme,t.type=W.Theme.getPropertyType(e.defaultTheme)):e.defaultValue&&(t.source=Constants.STYLE.SOURCE.VALUE,t.value=e.defaultValue,t.type=this._getGeneralTypeFromCssType(e.type)),t.langKey=e.lang||e.id,t.styleDefaults=e.styleDefaults||{};var n=e.noshow===!0,r=this.STYLE_PROPERTIES_FILTER[t.type],i=r&&r.contains(t.source);return t.ignore=n===!0||i!==!0,t.ignore=e.enableEdit===!0?!1:t.ignore,t},_getGeneralTypeFromCssType:function(e){return Constants.SkinParamCssTypesToGeneralTypesMap[e]||"unknown"},_increasePropertyUseCount:function(e){this._propertiesCounter[e]?this._propertiesCounter[e]+=1:this._propertiesCounter[e]=1},garbageCollection:function(){for(var e in this._properties)this._propertiesCounter[e]||delete this._properties[e]},_parseSkinInnerComponents:function(e,t,n,r){for(var i in n){var s=n[i].skin,o=n[i].styleGroup,u=this._findSkinByName(s,r);if(!o)continue;if(o=="inherit")this.parseSkinByInstance(e,t,u);else{var a=t.groups&&t.groups[o]?t.groups[o]:{properties:{},groups:{}};if(!this._innerSkinMaps[o]){var f=new this.SkinMapperClass(e,a,u);this._innerSkinMaps[o]=f}else this._innerSkinMaps[o].addInnerSkin(e,a,u)}}},_findSkinByName:function(e,t){var n=e.substring(e.lastIndexOf(".")+1),r=Object.filter(t,function(e,t){return t==n});return r[n]},getInnerSkins:function(){return this._innerSkinMaps},getInnerSkin:function(e){return this._innerSkinMaps[e]},getProperties:function(){return this._properties},getProperty:function(e){return this._properties[e]},setProperty:function(e,t){this._properties[e]=t},getPropertiesTypes:function(){return this._propertiesTypes},getPropertySource:function(e){return this._paramSourceHandler.getPropertySource(e)},setPropertySource:function(e,t){return this._paramSourceHandler.setPropertySource(e,t)},getPropertyType:function(e){return this._propertiesTypes[e]},getUsedSkinArray:function(){return this._usedSkinNamesArray},setPropertyExtraParamValue:function(e,t,n){return this._extraParamHandler.setPropertyExtraParamValue(e,t,n)},getPropertyExtraParamValue:function(e,t){return this._extraParamHandler.getPropertyExtraParamValue(e,t)},getPropertyLangKey:function(e){return this._propertiesLangKey[e]}})}),define.oldClass({name:"core.managers.style.SkinParamRenderHandler",Class:{initialize:function(e){this._innerSkinMaps=e,this._skinParamRenderFlags={}},isSkinParamRenderedForSkin:function(e){return this._skinParamRenderFlags[e]||!1},isSkinParamRenderedForAllSkins:function(){for(var e in this._skinParamRenderFlags)if(!this._skinParamRenderFlags[e])return!1;return!0},setSkinParamRenderFlag:function(e){for(var t in this._skinParamRenderFlags)this.setSkinParamRenderFlagForSkin(t,e)},setSkinParamRenderFlagForSkin:function(e,t){this._skinParamRenderFlags[e]=t},invalidateSkinParamMapper:function(){this.setSkinParamRenderFlag(!1);for(var e in this._innerSkinMaps)this._innerSkinMaps[e].invalidateStyle()}}}),define.oldClass({name:"core.managers.style.SkinParamSourceHandler",Class:{initialize:function(e){this._propertiesSource=e||{}},getPropertiesSource:function(){return this._propertiesSource},getPropertySource:function(e){return this._propertiesSource[e]},setPropertySource:function(e,t){this._isPropertySourceValid(t)?this._propertiesSource[e]=t:LOG.reportError(wixErrors.STYLE_PROP_SRC_UNKNOWN,"SkinParamSourceHandler","setPropertySource",t)()},_isPropertySourceValid:function(e){var t=!1;for(var n in Constants.STYLE.SOURCE)Constants.STYLE.SOURCE[n]===e&&(t=!0);return t}}}),define.oldClass({name:"core.managers.style.Style",Class:{Extends:"core.managers.style.StyleProperties",initialize:function(e){this._ready=!1,e&&this._setStyleDataItem(e)},_setStyleDataItem:function(e){this._skinName=e.get("skin"),this._resetDataCollection(),e.get("style")||e.set("style",{}),this._configStyle(e.get("style"),e,this._skinName,this)},_resetDataCollection:function(){this._groupIdCounter=0;var e=this._onProcessAllSkins.bind(this);this.unprocessedSkins={map:{},size:0,add:function(e){this.map[e]?this.map[e]=1:this.map[e]++,this.size++},remove:function(t){this.map[t]&&this.map[t]--,this.size--,this.size===0&&e()}}},_onProcessAllSkins:function(){this._garbageCollection(),this._oldSkinName!=this._skinName&&this.fireEvent(Constants.StyleEvents.SKIN_CHANGED),this.fireEvent(Constants.StyleEvents.READY,this),this._ready=!0},isReady:function(){return this._ready},getNewGroupId:function(){return this._groupIdCounter=this._groupIdCounter||0,this._groupIdCounter++,this._groupIdCounter},setSkin:function(e){return this._skinName==e?!1:(this._ready=!1,this._resetUsedSkinNameArray(),this.setStyleRenderFlag(!1),this._oldSkinName=this._skinName,this._skinName=e,this._styleDataItem.set("skin",e),this._styleRawData.properties={},this._styleRawData.propertiesSource={},this._styleRawData.groups={},this._resetData(this._styleRawData.properties,this._styleRawData.propertiesSource,this._styleRawData.groups),this.createStylesAndRawData(this._styleRawData,e),!0)},getSkin:function(){return this._skinName},getId:function(){return this._styleDataItem.get("id")}}}),define.Class("core.managers.style.StyleProperties",function(e){var t=e;t.utilize(["bootstrap.utils.BufferFunction"]),t.inherits("bootstrap.utils.Events"),t.binds(["_onThemePropertiesChange"]),t.statics({STYLE_PROPERTIES_FILTER:{color:[Constants.STYLE.SOURCE.THEME],font:[Constants.STYLE.SOURCE.THEME],radius:[Constants.STYLE.SOURCE.VALUE],size:[Constants.STYLE.SOURCE.VALUE],boxShadow:[Constants.STYLE.SOURCE.VALUE]},PROPERTY_TYPE_EXTRA_PARAMS:{color:{alpha:{prefix:"alpha",defaultValue:1,type:"number"}},boxShadow:{isOn:{prefix:"boxShadowToggleOn",defaultValue:!0,type:"boolean"}}}}),t.methods({initialize:function(e,t,n,r){e&&t&&n&&r&&this._configStyle(e,t,n,r)},setRedirectCssTarget:function(e){this._redirectCssTarget=e===!0},isCssRedirectedToStyle:function(){return this._redirectCssTarget},updateCssRule:function(e,t){this._changedCssClasses[e]=t,this._dispatchCssChanges()},_dispatchCssChanges:function(){this.fireEvent("cssChanged",this._changedCssClasses),this._changedCssClasses={}},_configStyle:function(e,t,n,r){this._redirectCssTarget=!1,this._changedCssClasses={};var i=new this.imports.BufferFunction(this,"_dispatchCssChanges");i.setBufferTime(50),this._resetUsedSkinNameArray(),this.StyleClass=W.Classes.get("core.managers.style.StyleProperties"),this._isStyleRendered={},this._groupId=t.get("id")+"-"+r.getNewGroupId(),this._topLevelStyle=r,this._styleDataItem=t,this._styleRawData=e,e.properties=e.properties||{},e.propertiesSource=e.propertiesSource||{},e.groups=e.groups||{},this._resetData(e.properties,e.propertiesSource,e.groups),this._changes={},this.createStylesAndRawData(e,n),this.resource.getResourceValue("W.Theme",function(e){e.getDataItem().addEvent(Constants.DataEvents.DATA_CHANGED,this._onThemePropertiesChange)}.bind(this))},_resetData:function(e,t,n){this._properties=e||{},this._propertiesSource=t||{},this._groups=n||{},this._propertiesTypes={},this._propertiesCounter={},this._propertiesLangKey={},this._groupsStyleObjects={}},_onThemePropertiesChange:function(e,t){for(var n in t)for(var r in this._properties)this._propertiesSource[r]==Constants.STYLE.SOURCE.THEME&&this._properties[r]==n&&this._firePropertyChangesEvent(r)},_firePropertyChangesEvent:function(e){this._changes[e]=this._propertiesTypes[e],this.injects().Utils.clearCallLater(this._dispatchEventId),this._dispatchEventId=this.injects().Utils.callLater(this._dispatchChangeEventAndResetChanges,[],this,50)},_dispatchChangeEventAndResetChanges:function(){this.fireEvent(Constants.StyleEvents.PROPERTY_CHANGED,{style:this,properties:this._changes}),this._changes={}},isStyleRenderedForSkin:function(e){return this._isStyleRendered[e]||!1},isStyleRenderedForAllSkins:function(){for(var e in this._isStyleRendered)if(!this._isStyleRendered[e])return!1;return!0},setStyleRenderFlag:function(e){for(var t in this._isStyleRendered)this.setStyleRenderFlagForSkin(t,e)},setStyleRenderFlagForSkin:function(e,t){this._isStyleRendered[e]=t},invalidateStyle:function(){this.setStyleRenderFlag(!1);for(var e in this._groupsStyleObjects)this._groupsStyleObjects[e].invalidateStyle()},get:function(e){return this._properties[e]},getStyleByGroupName:function(e){return this._groupsStyleObjects[e]},set:function(e,t){var n={},r={};n[e]=t,r[e]=this._properties[e],this._properties[e]=t,this._styleDataItem.fireDataChangeEvent(e,n,r),this._firePropertyChangesEvent(e)},changePropertySource:function(e,t,n){this._isPropertySourceValid(n)?(this._propertiesSource[e]=n,this.set(e,t)):LOG.reportError(wixErrors.STYLE_PROP_SRC_UNKNOWN,"StyleProperties","changePropertySource",n)()},_isPropertySourceValid:function(e){var t=!1;for(var n in Constants.STYLE.SOURCE)Constants.STYLE.SOURCE[n]===e&&(t=!0);return t},getPropertyExtraParamValue:function(e,t){var n=this.getPropertyType(e),r=this._getExtraParamDefinitionByType(n,t);if(!r){LOG.reportError("STYLE_EXTRA_PARAM_DEFINITION_MISSING","StyleProperties","setPropertyExtraParamValue",n+"-"+t)();return}var i=this._getPropertyExtraParamId(e,r.prefix);return this._convertStringToType(this._properties[i],r.type)},setPropertyExtraParamValue:function(e,t,n,r){var i=this.getPropertyType(e),s=this._getExtraParamDefinitionByType(i,t);if(!s){LOG.reportError("STYLE_EXTRA_PARAM_DEFINITION_MISSING","StyleProperties","setPropertyExtraParamValue",i+"-"+t)();return}var o=this._getPropertyExtraParamId(e,s.prefix);this._properties[o]=String(n);var u={},a={};u[o]=this._properties[o],this._styleDataItem.fireDataChangeEvent(e,u,a),r&&this._firePropertyChangesEvent(e,u,a)},_convertStringToType:function(e,t){switch(t){case"number":e=Number(e);break;case"boolean":e=String(e).toLowerCase()==="true"}return e},_getExtraParamDefinitionByType:function(e,t){return this.PROPERTY_TYPE_EXTRA_PARAMS[e]&&this.PROPERTY_TYPE_EXTRA_PARAMS[e][t]},_getPropertyExtraParamId:function(e,t){return t+"-"+e},isPropertyAvailable:function(e){return this._propertiesTypes.hasOwnProperty(e)},createStylesAndRawData:function(e,t){this._topLevelStyle.unprocessedSkins.add(t),W.Skins.getSkin(t,function(n){this._addUsedSkinName(t);var r=new n;this._saveSkinParamsAsProperties(r.getParams()),this._parseSkinInnerComponents(e,r.getCompPartsDefinition()),this._topLevelStyle.unprocessedSkins.remove(t)}.bind(this))},_saveSkinParamsAsProperties:function(e){for(var t=0;t<e.length;t++)this._addProperty(e[t])},_addProperty:function(e){var t=e.id,n=this._getParamData(e);n.source!="unknown"&&!n.ignore&&(this._properties[t]=this._properties[t]||e.defaultTheme||e.defaultValue,this._propertiesTypes[t]=n.type,this._propertiesSource[t]=this._propertiesSource[t]||n.source,this._propertiesLangKey[t]=n.langKey,this._increasePropertyUseCount(t),this._setPropertyExtraParams(t,n))},_parseSkinInnerComponents:function(e,t){for(var n in t){var r=t[n].skin,i=t[n].styleGroup;if(!i||i.toLowerCase()=="undefined")continue;if(i=="inherit")this.createStylesAndRawData(e,r);else{e.groups[i]||(e.groups[i]={properties:{},groups:{}});var s=e.groups[i];if(!this._groupsStyleObjects[i]){var o=new this.StyleClass(s,this._styleDataItem,r,this._topLevelStyle);this._groupsStyleObjects[i]=o}else this._groupsStyleObjects[i].createStylesAndRawData(s,r)}}},_getParamData:function(e){var t={source:"unknown"};e.defaultTheme?(t.source=Constants.STYLE.SOURCE.THEME,t.value=e.defaultTheme,t.type=W.Theme.getPropertyType(e.defaultTheme)):e.defaultValue&&(t.source=Constants.STYLE.SOURCE.VALUE,t.value=e.defaultValue,t.type=this._getGeneralTypeFromCssType(e.type)),t.langKey=e.lang||e.id,t.styleDefaults=e.styleDefaults||{};var n=e.noshow===!0,r=e.enableEdit===!0,i=this.STYLE_PROPERTIES_FILTER[t.type],s=i&&i.contains(t.source);return t.ignore=n===!0||s!==!0,t.ignore=r?!1:t.ignore,t},_increasePropertyUseCount:function(e){this._propertiesCounter[e]?this._propertiesCounter[e]+=1:this._propertiesCounter[e]=1},_garbageCollection:function(){for(var e in this._properties)this._propertiesCounter[e]||delete this._properties[e];this.setStyleRenderFlag(!1);for(var t in this._groupsStyleObjects)this._groupsStyleObjects[t]._garbageCollection()},_getGeneralTypeFromCssType:function(e){return Constants.SkinParamCssTypesToGeneralTypesMap[e]||"unknown"},_setPropertyExtraParams:function(e,t){var n=t.type,r=this.PROPERTY_TYPE_EXTRA_PARAMS[n];if(r){var i=t.styleDefaults;for(var s in r){var o=r[s],u=this._getPropertyExtraParamId(e,o.prefix);this._properties[u]=this._properties[u]||i[o.prefix]||o.defaultValue,this._propertiesTypes[u]=n+"-"+s,this._increasePropertyUseCount(u)}}},getId:function(){return this._groupId},getProperties:function(){return this._properties},getGroups:function(){return this._groupsStyleObjects},getPropertyType:function(e){return this._propertiesTypes[e]},getPropertySource:function(e){return this._propertiesSource[e]},getPropertyLangKey:function(e){return this._propertiesLangKey[e]},_addUsedSkinName:function(e){this._usedSkinNamesArray.push(e)},_resetUsedSkinNameArray:function(){this._usedSkinNamesArray=[]},getSkinArray:function(){return this._usedSkinNamesArray}})}),define.Const("SKIN_PARAM",{SOURCE:{THEME:"theme",VALUE:"value"}}),define.Const("STYLE",{SOURCE:{THEME:"theme",VALUE:"value"}}),define.Const("StyleEvents",{SKIN_CHANGED:"skinChange",READY:"styleReady",PROPERTY_CHANGED:"propertyChange"}),define.experimentPlugin("ExperimentDataThemeItemPlugin",function(e){function n(e,t){var n=this.define.createBootstrapClassInstance("bootstrap.managers.experiments.ExperimentStrategy"),r=t(n),i=n._mergeField_(e,r);return i}function r(e,t){define.dataThemeItem(e,t())}var t=e;t.init("dataThemeItem","newDataThemeItem",n,r)}),define.oldClass({name:"core.managers.theme.ThemeManager",imports:["core.managers.style.Style","bootstrap.utils.Queue","core.utils.css.BorderRadius","core.utils.css.Color","core.utils.css.Size","core.utils.css.Font","core.utils.css.BoxShadow","core.utils.css.Background"],Class:{Extends:"core.managers.data.DataManager",Binds:["_onDataChanged","_onDataReady","_onPropChange","_updateEffectedProps"],Static:{INIT_STYLE_RAW_DATA:{type:"TopLevelStyle",skin:"skin-name-place-holder",style:{properties:{},groups:{}}},TEXT_STYLE_SHEET:""},DEFINE_NAMESPACE:"dataThemeItem",getStyle:function(e,t,n){if(this._styleCache[e])W.Utils.callLater(t,[this._styleCache[e]]);else{this._styleQueue.add(e,t);if(this._styleQueue.getQueue(e).length>1)return;var r=function(t){t.removeEvent(Constants.StyleEvents.READY,r),this._styleCache[e]=t,this._styleQueue.getQueue(e).forEach(function(e){e(t)}),this._styleQueue.removeKey(e)}.bind(this);this.isStyleAvailable(e)?this.getDataByQuery("#"+e,function(e){var t=e.get("style"),n=new this.TopLevelStyleClass(e);n.isReady()?r(n):n.addEvent(Constants.StyleEvents.READY,r)}.bind(this)):this.createStyle(e,"",n,r)}},isStyleAvailable:function(e){return this.isDataAvailable("#"+e)},invalidateStyle:function(e){this._styleCache[e]&&this._styleCache[e].invalidateStyle()},createStyle:function(e,t,n,r){(this._stylesInProcess[e]||this._styleCache[e])&&LOG.reportError(wixErrors.STYLE_ALREADY_EXISTS,"ThemeManager","createStyle",e)();var i=Object.clone(this.INIT_STYLE_RAW_DATA);i.skin=n;var s=this.addDataItem(e,i),o=new this.TopLevelStyleClass(s);this._stylesInProcess[e]=o;var u=function(){o.removeEvent("styleReady",u);var e=o.getId();delete this._stylesInProcess[e],this._styleCache[e]=o,r(o)}.bind(this);o.isReady()?u(o):o.addEvent("styleReady",u)},initialize:function(e){this.parent(),this.TopLevelStyleClass=this.imports.Style,this._placeHoldersMap={},this._isReady=!0,this._isDataReady=!1,this._styleQueue=new this.imports.Queue,this._styleCache={},this._stylesInProcess={},this._isOperating=!1,this.getDataByQuery("#THEME_DATA",this._onDataReady)},getPropertyType:function(e){return this._data.getFieldSchema(e).type},_onDataReady:function(e){var t=e.get("type")==="Theme";if(t){var n=e;e=this.addDataItem(n.get("id"),{type:this._getThemeSchemaTypeName()});var r=n.get("properties");for(var i in r)e.set(i,r[i].value)}this._setData(e),this._isDataReady=!0,this.fireEvent("dataReady")},isDataReady:function(){return this._isDataReady},_getThemeSchemaTypeName:function(){return"WFlatTheme"},_setData:function(e){this._flattenData(e),this._data&&this._data.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChanged),this._data=e,this._data.addEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChanged),this._indexAllPlaceholders()},_flattenData:function(e){this._flattenedDataItems={};var t=e.getData(),n=e.getSchema(),r={},i,s,o;for(o in t)if(typeOf(t[o])=="array"){i=o;var u=t[o],a=u.length,f=n[o].defaultItems;if(f.length>a)for(var l=a;l<f.length;l++)u.push(f[l]),a++;for(s=0;s<a;s++)r[i+"_"+s]=u[s],this._flattenedDataItems[i+"_"+s]=i}else r[o]=t[o];e.setData(r);var c={};for(o in n)if(n[o].type=="array"){i=o;var h=n[o].itemType,p=n[o].defaultItems;for(s=0;s<p.length;s++)c[i+"_"+s]={type:h,"default":p[s]},this._flattenedDataItems[i+"_"+s]||(this._flattenedDataItems[i+"_"+s]=i)}else c[o]=n[o];e.setSchema(c)},_indexAllPlaceholders:function(){this._placeHoldersMap={};var e=this._data.getSchema();for(var t in e)this._updatePlaceholdersInProperty(t,this.getRawProperty(t))},_updatePlaceholdersInProperty:function(e,t,n){var r=this._getPlaceholders(t,!0),i=n?this._getPlaceholders(n,!0):{},s=Object.merge({},i,r);for(var o in s)this._placeHoldersMap[o]=this._placeHoldersMap[o]||{},r[o]&&!i[o]?this._placeHoldersMap[o][e]=e:r[o]||delete this._placeHoldersMap[o][e]},_getPlaceholders:function(e,t){var n=/\[([^}]+)\]/g,r=/\{([^}]+)\}|\[([^}]+)\]/g,i=t?r:n,s={},o=i.exec(e);while(o){var u=o[1]||o[2];u&&(s[u]=u),o=i.exec(e)}return s},clone:function(e){var t=this.parent(e);return t},isReady:function(){return this._isReady},getProperties:function(){var e={},t=this._data.getSchema();for(var n in t)e[n]={value:this.getRawProperty(n),type:this._data.getFieldSchema(n).type};return e},getProperty:function(e,t,n){var r=this._data.get(e),i=typeOf(r)=="string"?r:Object.clone(r),s=this._data.getFieldSchema(e);if(!s)return LOG.reportError(wixErrors.SCHEMA_MISSING_KEY,"ThemeManager","getProperty",[e,this._data.getData(),null]),null;var o=this.getPropertyType(e);if(!t&&typeOf(i)=="string"&&i.indexOf("[")!=-1)for(var u in this._data.getSchema())i.indexOf("["+u+"]")!=-1&&(i=i.split("["+u+"]").join(this.getProperty(u)));if(n)return i;switch(o){case"themeUrl":return W.Config.getImagesUrl()+"/web/";case"color":return new this.imports.Color(i);case"background":return new this.imports.Background(i,this);case"font":return new this.imports.Font(i,this);case"radius":return new this.imports.BorderRadius(i);case"webThemeUrl":return W.Config.getServiceTopologyProperty("staticThemeUrlWeb")+"/"+i+"/"}return i},_onDataChanged:function(e,t){if(this._isOperating)return;this._isOperating=!0,this._indexAllPlaceholders();if(typeof t=="string")this._updateEffectedProps(t);else for(var n in t)this._updateEffectedProps(n);this._isOperating=!1},getRawProperty:function(e){return this.getProperty(e,!0,!0)},clearOverrides:function(){this._data.reset()},getOverrides:function(){return this.getProperties()},getDataItem:function(){return this._data},setProperty:function(e,t){var n=this._data.getFieldSchema(e);if(!n){LOG.reportError(wixErrors.SCHEMA_MISSING_KEY,"ThemeManager","setProperty",[e,this._data.getData(),null]);return}var r=n.type;r=="color"&&t&&t.getRgba&&(t=t.getRgba()),this._updatePlaceholdersInProperty(e,t,this.getRawProperty(e)),this._data.set(e,t),this._updateEffectedProps(e)},getPropertiesAccordingToType:function(e){var t=[],n=this._data.getSchema();for(var r in n)e==this._data.getFieldSchema(r).type&&t.push(r);return t},_onPropChange:function(e,t){var n=[e];t=t||this.getProperty(e),this.fireEvent("propertyChange",{name:e,newVal:t,type:"propertyChange"});var r=this._placeHoldersMap[e];for(var i in r)n.combine(this._onPropChange(i,this.getProperty(i)));return n},_updateEffectedProps:function(e){var t=this._onPropChange(e),n={};t.forEach(function(e){n[e]=this._data.get(e)}.bind(this)),this._data.fireDataChangeEvent(n)},getDirtyDataObjectsMap:function(){var e=this.parent();if(e&&e.THEME_DATA){e.THEME_DATA=this.createDataItem(Object.clone(e.THEME_DATA.getData()),this._getThemeSchemaTypeName());var t=e.THEME_DATA.getData();for(var n in t)if(this._flattenedDataItems&&this._flattenedDataItems[n]){var r=this._flattenedDataItems[n];t[r]||(t[r]=[]),t[r].push(t[n]),delete t[n]}}return e}}}),define.Const("Theme",{COLOR_PALETTE_INDEX:11,COLOR_SUB_PALETTE_SIZE:5}),define.oldClass({name:"core.managers.viewmanager.ViewManagerBase",Class:{Extends:"bootstrap.managers.BaseManager",Binds:["_onTransitionFinished","_onEditModeChanged","_onHashChange"],initialize:function(){this._isReady=!0,this._isSiteReady=!1,this._pages=null,this._pagesData=null,this._mainPageData=null,this._siteStructureData=null,this._currentPageId=null,this._isFullScreen=null,this._fullScreenCallbacks=[],this._scrollLock=!1,this._isPageScrollToTopEnabled=!0,this._stopAnimation=null,this._loadedExtJS={},this._pendingExtJS=[],this._onSiteReady=this._onSiteReady.bind(this),this._loadNextPage=this._loadNextPage.bind(this),this._loadScript=this._loadScript.bind(this),this._onScriptLoaded=this._onScriptLoaded.bind(this);var e=W.Utils.getQueryParam("isEdited");e=="true"&&this.setPreviewMode(!0),this.addEvent("pageTransitionEnded",this._onTransitionFinished)},setPreviewMode:function(e){this._isPreview=e,e&&document&&document.body&&$(document.body).addClass("prevMode")},setStopAnimation:function(e){this._stopAnimation=e},getNewUniquePageId:function(e){var t;do t=W.Utils.getUniqueId(e+"Page");while(this._pages[t]!==undefined);return t},isScrollLock:function(){return this._scrollLock},setLinkTipFunc:function(e){this._linkTipFunc=e},getLinkTipFunc:function(){return this._linkTipFunc},getPreviewMode:function(){return!!this._isPreview},setSite:function(e,t,n){e||LOG.reportError(wixErrors.VM_INVALID_SITE_NODE,this.className,"setSite",""),t||LOG.reportError(wixErrors.VM_INVALID_SITE_DATA,this.className,"setSite",""),this._siteNode=e,this._siteStructureData=t,this.indexPages("#SITE_PAGES"),this._siteNode.addEvent(Constants.ComponentEvents.WIXIFIED,function(){t.addComponentWithInterest(this.getLogic())}),this._isInViewer()?this._wixifySiteLazily(e,n):this._wixifyEntireSite(e);var r=this._siteNode.getProperty("comp");r&&r.contains("components.SiteStructure")&&this._siteNode.wixify()},_isInViewer:function(){return this.getViewMode()!=="editor"},_getUrlSearchParameters:function(){return window.location.search},_wixifyEntireSite:function(e){var t=e.getElements("[comp]");if(window.adData){this.setAdData(window.adData);var n=document.getElementById("wixFooter");n&&t.push(n)}e.get("comp")&&t.push(e);var r=new Async.Bulk(t,null,{timeout:2e4,completeEvent:Constants.ComponentEvents.READY,completeCallback:function(){t.removeClass("initHidden"),this.updatePagesData();for(var e in this._pages){var n=this._pages[e].getLogic();n.setAsWixified()}this._onSiteReady()}.bind(this)});t.wixify()},_getAllComponentsButPageContents:function(e){var t=e.getElements("#SITE_PAGES> div[comp]").combine([e.getElement("#SITE_HEADER")]).combine(e.getElements("#SITE_HEADER div[comp]")).combine(e.getElements("#SITE_FOOTER")).combine(e.getElements("#SITE_FOOTER div[comp]"));return e.get("comp")&&t.push(e),t},_wixifySiteLazily:function(e,t){var n=this._getAllComponentsButPageContents(e);if(window.adData){this.setAdData(window.adData);var r=document.getElementById("wixFooter");r&&n.push(r)}var i=new Async.Bulk(n,null,{completeEvent:Constants.ComponentEvents.READY,completeCallback:function(){n.removeClass("initHidden"),this.updatePagesData();var e=[];if(t===!1)for(var r in this._pages)e.push(this._pages[r].getLogic());else{var i=this._getPageDataFromHash(W.Utils.hash.getHash());e.push(this._pages[i.get("id")].getLogic())}var s=new Async.Bulk(e,null,{completeEvent:"contentWixified",completeCallback:function(){this._onSiteReady()}.bind(this)});for(var o=0;o<e.length;++o)e[o].wixifyContent()}.bind(this)});n.wixify()},_onSiteReady:function(){this.setPreviewMode(this._isPreview),this._isReady=!0,this._isSiteReady=!0,window.scrollTo(0,1),W.Utils.hash.addEvent("change",this._onHashChange),W.Utils.hash.fireHashChangeEvent(),this._loadNextPage(),this._reportBIEvents(),this.fireEvent("SiteReady"),window.viewMode=="editor"&&window.location.hash=="#save=1"&&(window.location.hash="",W.Commands.executeCommand("WEditorCommands.SaveSuccessDialog"))},_reportBIEvents:function(){switch(window.viewMode){case"preview":LOG.reportEvent(wixEvents.PREVIEW_READY);break;case"site":LOG.reportEvent(wixEvents.SITE_READY)}},getViewMode:function(){return window.viewMode},_loadNextPage:function(){},createElement:function(e,t){return new Element(e,t)},clone:function(e){return this.parent(e)},isReady:function(){return this._isReady},isSiteReady:function(){return this._isSiteReady},_onHashChange:function(e){e=e||{};if(this.isSiteReady()){var t=e.newHash,n=e.isIdChanged;W.Data.isDataAvailable("#"+t)?(W.Data.getDataByQuery("#"+t,function(e){this._setDataObjectFromHash(e,t,n)}.bind(this)),e.isForSureAfterChange&&LOG.reportPageEvent(window.location.href)):this._changePageFromHash(t)}},_setDataObjectFromHash:function(e,t,n){n&&e.getType&&e.getType()==="Page"&&t&&this._changePageFromHash(t)},_changePageFromHash:function(e){var t=this._getPageDataFromHash(e);if(t===null)return;var n=t.get("id");if(n==this._currentPageId)return;n&&this._pageTransition(n)},_getPageDataFromHash:function(e){e=e||W.Utils.hash.getHash();var t=this._mainPageData;for(var n in this._pagesData){var r=this._pagesData[n],i=r.getMeta("isHidden")&&!this._isPreview;if(r.get("id")==e&&!i){t=r;break}}return t},_pageTransition:function(e){var t=this.getCurrentPageNode(),n=this._siteNode.getElement("#"+e);if(n){W.Utils.clearCallLater(this._setVisiblePageCallId),this._currentPageId=e,this._isFullScreen&&this.exitFullScreenMode();if(t)t.getLogic().collapse();else for(var r in this._pages){var i=this._pages[r];i!=n&&i.getLogic().collapse()}n.getLogic().uncollapse(),this._setVisiblePageCallId=W.Utils.callLater(function(){n.getLogic().wixifyContent(function(){W.Editor&&W.Editor.setKeysEnabled(!0),this.fireEvent("pageTransitionEnded"),W.Utils.callLater(function(){})}.bind(this))}.bind(this)),W.Editor&&W.Editor.setKeysEnabled(!1),this.fireEvent("pageTransitionStarted")}},getScrollTop:function(){return document.body.scrollTop},getPagesData:function(){return this._pagesData},_scrollToTopOnPageChange:function(){this._isPageScrollToTopEnabled&&(this._isPreview?(this._siteNode.setStyle("top","0px"),$(document.body).setStyle("background-position","0px 0px")):$(document.body).scrollTo(0,0))},goToPage:function(e){if(this._scrollLock)return;this._stopAnimation!==null&&this._stopAnimation.stop(),this._scrollToTopOnPageChange();var t=this._pagesData[e];if(!t)return;if(this._currentPageId==e)return;LOG.reportEvent(wixEvents.USER_REQUESTED_PAGE_MOVE,{c1:t._data&&t._data.pageUriSEO||"no-page-url"}),this._pageTransition(e)},_onTransitionFinished:function(){this._setUrlHashToPage(this._currentPageId)},_setUrlHashToPage:function(e){var t=this._pagesData[e];t&&W.Utils.hash.setHash(e,t.get("pageUriSEO"))},goToHomePage:function(){this.goToPage(this.getHomePageId())},isHomePage:function(e){return e=e||this._currentPageId,this._isSiteReady?e==this.getHomePageId():!0},getHomePageId:function(){if(this._isSiteReady&&this._mainPageData)return this._mainPageData.get("id")},getCurrentPageId:function(){return this._currentPageId},getCurrentPageNode:function(){var e=null;return this._currentPageId&&this._siteNode&&(e=this._siteNode.getElement("#"+this._currentPageId)),e},indexPages:function(e){var t=this._siteNode.getElement(e);if(!t)return W.Utils.callLater(this.indexPages,[e],this,10);var n={},r=[],i="[comp=mobile.core.components.Page],[comp=core.components.Page]";t.getElements(i).each(function(e){var t=e.get("id")||W.Utils.getUniqueId("page");n[t]=e,e.addClass("sitePage");var i=e.get("dataQuery");i!=this._siteStructureData.get("mainPage")&&r.push(i)}.bind(this));var s=this._siteStructureData.getData().pages;s||(s=[]);for(var o=0;o<s.length;++o){var u=s[o],a=r.indexOf(u);a!=-1&&(r.splice(a,1),r.splice(o,0,u))}var f=W.Data.isDataChange();this._siteStructureData.set("pages",r),f&&W.Data.flagDataChange(),this._pages=n},loadExternalScript:function(e,t,n){var r=this;return e in this._loadedExtJS?(t(),"ALREADY_LOADED"):e in this._pendingExtJS?(this._pendingExtJS[e].push(t),"PENDING_LOAD"):(this._pendingExtJS[e]=[t],this._loadScript(e,n),"FIRST_LOAD")},_loadScript:function(e,t){var n=document.createElement("script");n.type="text/javascript",n.async=!1,n.readyState?n.onreadystatechange=function(){if(n.readyState==="loaded"||n.readyState==="complete")n.onreadystatechange=null,this._onScriptLoaded(e)}.bind(this):n.onload=function(){this._onScriptLoaded(e)}.bind(this),n.src=e;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r)},_onScriptLoaded:function(e){this._loadedExtJS[e]=!0;var t=this._pendingExtJS[e];for(var n=0;n<t.length;n++)t[n]();delete this._pendingExtJS[e]},_getSiteViewMode:function(){var e=window.viewMode;return e=="preview"&&window.top===window?"site":e},isPublicMode:function(){return this._getSiteViewMode()=="site"},updatePagesData:function(){this._pagesData={};for(var e in this._pages){var t=this._pages[e].getLogic().getDataItem();this._pagesData[t.get("id")]=t,this._siteStructureData.get("mainPage")=="#"+t.get("id")&&(this._mainPageData=t)}},getSiteNode:function(){return this._siteNode},_onEditModeChanged:function(e){this._editorMode=e},getEditorMode:function(){return this._editorMode}}}),define.Const("ViewEvents",{ORIENTATION_CHANGE:"orientationchange"}),define.Const("ViewManager",{VIEW_MODE_SITE:"site",VIEW_MODE_EDITOR:"editor",VIEW_MODE_PREVIEW:"preview"}),define.oldComponent({name:"core.components.BaseList",Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_onItemReady","_onDataItemsReady","_onChildAutoSized","_onChildAutoSizedAnimation"],initialize:function(e,t,n){this.parent(e,t,n),this._itemClassName=n&&n.itemClassName||this._itemClassName,this._itemsNodes=[]},_renderItems:function(e,t){e=e||[],e.length===0?(this.getItemsContainer().empty(),this._onAllItemsReady()):t?this._onDataItemsReady(null,e):this._data.getDataManager().getDataByQueryList(e,function(t){this._onDataItemsReady(e,t)}.bind(this))},_createHiddenItems:function(){return!0},_createItem:function(e,t,n,r){var i=this._skin.itemSkinClassName,s=this.getItemClassName();if(!i)return LOG.reportError(wixErrors.NO_SKIN,this.className,"_createItem",""),new Element("b");if(!s)return LOG.reportError(wixErrors.MISSING_METHOD,this.className,"_createItem",""),new Element("b");var o=W.Utils.getUniqueId(Constants.components.BASE_LIST_ITEM_PREFIX),u=new Element("div",{id:o}),a=this;return this._getParamsToPassToItem(e,function(n){var o=e;this.injects().Data.isDataItem(e)||(o=null),this.injects().Components.createComponent(s,i,o,n,function(){t(u,!0,e,r)},undefined,undefined,u)}.bind(this)),u},getSkinElementByIndex:function(e){var t=this.getItemsContainer().getChildren();return t[e]},_getParamsToPassToItem:function(e,t){t(undefined)},_onItemReady:function(e,t,n){},_onAllItemsReady:function(){},getItemClassName:function(){return this._itemClassName},getItemsContainer:function(){return this._view},_onChildAutoSizedAnimation:function(){this.fireEvent("autoSizedAnimation")},_onChildAutoSized:function(){this.fireEvent("autoSized")},_onDataItemsReady:function(e,t){var n=this._itemsNodes||[];this._itemsNodes=[],this.getItemsContainer().empty();var r=[],i=0,s=function(e,t,n,r){if(e){var s=e.getLogic();this.fireEvent("itemReady",[s,s.getDataItem(),t]),s.addEvent("autoSizedAnimation",this._onChildAutoSizedAnimation),s.addEvent("autoSized",this._onChildAutoSized),this._onItemReady(s,t,n)}if(++i>=r){var o=this._itemsNodes.clean();o.length>1&&(o[0].addClass("firstItem"),o[o.length-1].addClass("lastItem")),this._itemsNodes=o,this._onAllItemsReady()}}.bind(this),o=this.getItemsContainer(),u=function(e,t,r){if(!this._createHiddenItems()&&e.getMeta("isHidden")){s(null,!1,e,r);return}var i=undefined,u=this.injects().Data;for(var a=0;a<n.length;++a){var f=n[a];if(f&&f.getLogic&&e===f.getLogic().getDataItem()){i=f,n.splice(a,1);break}}i?s(i,!1,e,r):i=this._createItem(e,s,t,r),this._itemsNodes[t]=i,i.removeClass("firstItem").removeClass("lastItem"),i.insertInto(o)}.bind(this),a,f,l;if(e)for(f=0,a=e.length;f<a;++f)l=t[e[f]],u(l,f,a);else for(f=0,a=t.length;f<a;++f)l=t[f],u(l,f,a);r.length>1&&(r[0].addClass("firstItem"),r[r.length-1].addClass("lastItem"))},_disposeItems:function(e){if(!e)return;for(var t=e.length-1;t>=0;--t){var n=e[t],r=n.getLogic&&n.getLogic();r&&(this._disposeItem(r),r.dispose())}},_disposeItem:function(){}}}),define.oldComponent({name:"core.components.BaseRepeater",Class:{Extends:"mobile.core.components.base.BaseComponent",Static:{repeaterStates:{INITIATE:"init",LOADING:"loading",READY:"ready"}},_elementPool:[],_usedElementPool:[],_stillLoading:!1,_onDataChange:function(){this._allRepeatersReady=!1,this.parent()},_setSkinPartElements:function(e){this._allRepeatersReady=!1,this.parent(e)},_prepareForRender:function(){return!this._data||this._data.length===0?!0:(this._allRepeatersReady===!1&&(this._repeaterDefinitions=this._getRepeaterDefinitions(),this._startRepeaterCreations()),this._allRepeatersReady)},_getRepeaterDefinitions:function(){var e=[];for(var t in this._skinPartsSchema)if(this._skinPartsSchema[t].repeater&&this._skinPartsSchema[t].autoCreate!==!1){var n=this.getSkinPartDefinition(t);n.hookMethod&&typeOf(this[n.hookMethod])=="function"&&(n=this[n.hookMethod](n)),e.push(n)}return e},_startRepeaterCreations:function(){if(this._stillLoading)return;this._usedElementPool=[],this._beforeRepeatersCreation(),this._repeatersDataOld=this._repeatersData,this._repeatersData={},this._stillLoading=!0;for(var e=0;e<this._repeaterDefinitions.length;++e){var t=this._repeaterDefinitions[e],n={};this._repeatersData[t.id]=n,n.definition=t,n.pendingItems=[],n.readyItems=[],n.readyItemsLogic=[],n.state=this.repeaterStates.INITIATE,this._loadRepeater(n)}this._checkIfRepeatersReady()},_checkIfRepeatersReady:function(){for(var e in this._repeatersData){var t=this._repeatersData[e];if(t.state!=this.repeaterStates.READY)return!1}return!0},_loadRepeater:function(e){if(e.definition.autoCreate!==!1){var t=function(t,n){this._onLoadRepeaterReady(t,n,e)}.bind(this),n=this._getRepeaterContainer(e);n&&n.empty();var r=this._getRepeaterDataList(e.definition),i;r=this._processDataRefs(r),e.itemsAmount=r.length;if(r.length>0)for(var s=0;s<r.length;++s)i=Object.clone(e.definition),i.dataQuery=this._getDataQueryField(e.definition,r[s]),this._createRepeaterItem(i,e,n,t);else this._disposeOldRepeaters(),this._onRepeaterReady(e),this._stillLoading=!1,this._allRepeatersReady=!0,this._renderIfReady()}else e.state=this.repeaterStates.READY},_getDataQueryField:function(e,t){return e.repeaterDataQueryField?t.get(e.repeaterDataQueryField):t},_onLoadRepeaterReady:function(e,t,n){var r=!t,i=e.getViewNode(),s=n.pendingItems.indexOf(i),o=e.getDataItem();n.pendingItems.splice(s,1),n.readyItems.push(i),n.readyItemsLogic.push(e),n.definition.hideHidden&&o.getMeta("isHidden")&&i.collapse(),this._onRepeaterItemReady(n,e,o,r),n.readyItems.length==n.itemsAmount&&(n.state=this.repeaterStates.READY,this._checkIfRepeatersReady()&&(this._disposeOldRepeaters(),this._onRepeaterReady(n),this._stillLoading=!1,this._allRepeatersReady=!0,this._renderIfReady()))},_disposeOldRepeaters:function(){var e=[];this._elementPool.forEach(function(t){this._usedElementPool.contains(t)?e.push(t):t.getLogic().dispose()}.bind(this)),this._elementPool=e},_processDataRefs:function(e){return e},_createRepeaterItem:function(e,t,n,r){var i=this._getOldRepeaterItemMatchingDefinition(t.definition.id,e);if(!i){var s=new Element("div");this._elementPool.push(s),this._usedElementPool.push(s),s.repeaterDefinition=e,t.pendingItems.push(s),n&&s.insertInto(n),this._createComponentbyDefinition(e,s,r)}else{n&&e.moveOldItemsToContainer!==!1&&i.insertInto(n),this._usedElementPool.push(i);var o=i.getLogic(),u=o.getSkin(),a=!1,f,l;e.styleGroup&&this._style&&(f=e.styleGroup=="inherit"?this._style:this._style.getStyleByGroupName(e.styleGroup),l=u.getStyle(),a=f!==l);if(a){var c=function(){o.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,c),r(o,!0)};o.addEvent(Constants.ComponentEvents.READY_FOR_RENDER,c),u.applyStyle(f)}else r(o,!0)}},_getOldRepeaterItemMatchingDefinition:function(e,t){if(this._repeatersDataOld){var n=this._repeatersDataOld[e].readyItems;for(var r=0;r<n.length;++r){var i=n[r].repeaterDefinition;if(i.skin==t.skin&&i.dataQuery===t.dataQuery)return n.splice(r,1)[0]}}return null},_getRepeaterContainer:function(e){var t=e.definition.container;return t&&this._skinParts[t]?this._skinParts[t]:null},_getRepeaterDataList:function(e){if(e.dataRefList)return e.dataRefList;if(e.dataRefField){var t=[];return e.dataRefField!="*"&&(t=this._data.get(e.dataRefField)),t}if(e.inlineDataField)return this._data.get(e.inlineDataField)},dispose:function(){this._elementPool.forEach(function(e){e.getLogic().dispose()}),this._elementPool=[],this.parent()},_beforeRepeatersCreation:function(){},_onRepeaterItemReady:function(e,t,n,r){},_onRepeaterReady:function(e){}}}),define.component("core.components.Button",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.states(["up","over","selected","pressed"]),t.binds(["_onClick","_onOver","_onOut","_onMouseDown","_onMouseUp","render"]),t.dataTypes(["","Button"]),t.skinParts({icon:{type:"htmlElement",optional:"true"},label:{type:"htmlElement"}}),t.fields({_triggers:["click"],_canFocus:!0}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),n=n||{},this.setParameters({label:n.label||t.getAttribute("label"),toggleMode:n.toggleMode||!1,disabled:n.disabled||!1,iconSrc:n.iconSrc||"",command:n.command||null,commandParameter:n.commandParameter||null})},_onDataChange:function(e){e.getType()=="Button"&&this.setParameters({label:e.get("label"),toggleMode:e.get("toggleMode"),disabled:e.get("disabled"),iconSrc:e.get("iconSrc"),command:e.get("command"),commandParameter:e.get("commandParameter")}),this.parent()},render:function(){this._setPreDefinedCommand(),this._skinParts.label.set("html",this._label||""),this._skinParts.icon&&(this._iconSrc?(this._skinParts.icon.setStyle("background","url("+this._iconSrc+") no-repeat 50% 50%"),this._skinParts.icon.uncollapse()):(this._skinParts.icon.setStyle("background",""),this._skinParts.icon.collapse()))},_setPreDefinedCommand:function(){this._tmpCommand&&this.setCommand(this._tmpCommand,this._tmpCommandParameter),this._tmpCommand=null,this._tmpCommandParameter=null},_onEnabled:function(){var e=this._skinParts.view;e.addEvent(Constants.CoreEvents.CLICK,this._onClick),e.addEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),e.addEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),e.addEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),e.addEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},_onDisabled:function(){var e=this._skinParts.view;e.removeEvent(Constants.CoreEvents.CLICK,this._onClick),e.removeEvent(Constants.CoreEvents.MOUSE_OVER,this._onOver),e.removeEvent(Constants.CoreEvents.MOUSE_OUT,this._onOut),e.removeEvent(Constants.CoreEvents.MOUSE_DOWN,this._onMouseDown),e.removeEvent(Constants.CoreEvents.MOUSE_UP,this._onMouseUp)},setLabel:function(e){this._label=e,this._renderIfReady()},setIcon:function(e){this._iconSrc=e,this._renderIfReady()},setTextContent:function(e){this.setLabel(e)},setToggleMode:function(e){this._toggleMode=e},setDisabled:function(e){this._disabled=!!e,this._renderIfReady()},setParameters:function(e){e=e||{},this._label=e.label||this._label,this._toggleMode=e.toggleMode||this._toggleMode,this._disabled=e.disabled||this._disabled,this._iconSrc=e.iconSrc||this._iconSrc,this._tmpCommand=e.command||this._tmpCommand,this._tmpCommandParameter=e.commandParameter||this._tmpCommandParameter,this._renderIfReady()},getLabel:function(){return this._label},toggleSelected:function(e){var t=!1;typeof e!="undefined"?t=e:this.getState().contains("selected")||(t=!0),t?this.setState("selected"):this.removeState("selected")},_onClick:function(e){if(this.isEnabled()){this._command||(e=e||{},e.target=this.getViewNode(),this.fireEvent(Constants.CoreEvents.CLICK,e));if(this._toggleMode){var t=this.getState().contains("selected")?"over":"selected";this.setState(t)}}},_onOver:function(e){this.isEnabled()&&!this.getState().contains("selected")&&(this.fireEvent("over",e),this.setState("over"))},_onOut:function(e){this.isEnabled()&&!this.getState().contains("selected")&&(this.fireEvent("up",e),this.setState("up"))},_onMouseDown:function(){this.isEnabled()&&!this.getState().contains("selected")&&this.setState("pressed")},_onMouseUp:function(){this.removeState("pressed")}})}),define.oldComponent({name:"core.components.Container",skinParts:{inlineContent:{type:"htmlElement"}},Class:{EDITOR_META_DATA:{general:{settings:!0,design:!0}},Extends:"mobile.core.components.base.BaseComponent",Z_INDEX_CHANGE_TYPES:{BACK:"BACK",FORWARD:"FORWARD",TOP:"TOP",BOTTOM:"BOTTOM"},initialize:function(e,t,n){n&&n.allowDragChildren!=null&&(this._allowDragChildren=n.allowDragChildren),this.parent(e,t,n),this.setMaxH(8e3)},_allowDragChildren:!0,getInlineContentContainer:function(){return this._skinParts.inlineContent?this._skinParts.inlineContent:this._view},getChildren:function(){return this.getInlineContentContainer().getChildren()},addChild:function(e){var t=e.getParentComponent(),n=t.getChildComponents().map(function(e){return e.getLogic().getComponentId()});e.getViewNode().insertInto(this.getInlineContentContainer()),this._reportComponentsZOrderChanged(e,t,n),this.moveChild(e,this.Z_INDEX_CHANGE_TYPES.TOP)},moveChildFromIndexToIndex:function(e,t,n){var r=this.getChildComponents().map(function(e){return e.getLogic().getComponentId()});W.Utils.setChildIndex(this.getInlineContentContainer(),t,n),this._reportComponentsZOrderChanged(e,this,r)},_reportComponentsZOrderChanged:function(e,t,n){var r=t.getChildComponents().map(function(e){return e.getLogic().getComponentId()}),i={subType:"explicitZOrderChange",changedComponentIds:[e.getComponentId()],oldState:{children:n},newState:{children:r}};this.injects().Commands.executeCommand("WViewerCommands.ComponentZIndexChanged",{editedComponent:e,urmData:i})},removeChild:function(e){var t=e.getViewNode?e.getViewNode():e;this.getInlineContentContainer().removeChild(t)},canMoveForward:function(e){var t=this.getChildren(),n=t.indexOf(e.getViewNode());return n==-1?!1:n<t.length-1},canMoveBack:function(e){var t=this.getChildren().indexOf(e.getViewNode());return t==-1?!1:t>0},moveChild:function(e,t){var n=this.getChildren(),r=this._getChildIndex(e),i;switch(t){case this.Z_INDEX_CHANGE_TYPES.BACK:i=r-1;break;case this.Z_INDEX_CHANGE_TYPES.FORWARD:i=r+1;break;case this.Z_INDEX_CHANGE_TYPES.BOTTOM:i=0;break;case this.Z_INDEX_CHANGE_TYPES.TOP:i=n.length-1}this.moveChildFromIndexToIndex(e,r,i)},_getChildIndex:function(e){var t=this.getChildren(),n=e.getViewNode();return t.indexOf(n)},hasChildren:function(){return!0},isContainer:function(){return this._allowDragChildren},getChildComponents:function(){return this.getInlineContentContainer().getChildren("[comp]")},getContainerComponents:function(e){var t=this.getChildComponents();for(var n=0;n<t.length;n++){var r=t[n].getLogic();e.push(r),r.isInstanceOfClass("core.components.Container")&&e.concat(r.getContainerComponents(e))}return e},getDescendantComponents:function(){return this.getDescendantComponentsRecurse(this,[])},getDescendantComponentsRecurse:function(e,t){var n=e.getChildComponents();for(var r=0;r<n.length;r++)t.push(n[r]),n[r].getLogic&&n[r].getLogic().getChildComponents&&this.getDescendantComponentsRecurse(n[r].getLogic(),t);return t},disposeChildren:function(){var e=this.getChildren();for(var t=0;t<e.length;t++)e[t].getLogic&&e[t].getLogic().dispose()},dispose:function(e){this.disposeChildren(),this.parent()}}}),define.component("core.components.Image",function(e){var t=e;t.utilize(["core.components.image.ImageDimensions","core.components.image.ImageUrl"]),t.inherits("mobile.core.components.base.BaseComponent"),t.states(["loading","loaded"]),t.binds(["_onImageLoaded","_onOrientationChange"]),t.dataTypes(["Image",""]),t.statics({unitOptions:{EM:"em",PX:"px",PERCENT:"%"}}),t.skinParts({image:{type:"htmlElement"}}),t.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],_invalidProps:{}}),t.methods({initialize:function(e,t,n){this._initGlobalResources(),this.parent(e,t,n),this.lockRefresh(),this._imageDimensions=new this.imports.ImageDimensions,this._imageUrl=new this.imports.ImageUrl,this._setParametersToDefaults(),this._initializeParametersFromArgs(n),this._requestExactSize=this._globals.viewer&&this._globals.viewer.getPreviewMode()!==!0,this._globals.viewer&&this._globals.viewer.addOrientationEvent(this._onOrientationChange)},_initGlobalResources:function(){this._globals={};var e=this.injects();this._globals.viewer=e.Viewer,this._globals.utils=e.Utils},_setParametersToDefaults:function(){this._sizeOfComponentInPx={x:0,y:0},this._units={x:this.unitOptions.PERCENT,y:this.unitOptions.PERCENT},this._sizeOfComponentInUnits={x:100,y:100},this._uri=""},_initializeParametersFromArgs:function(e){e=e||{},this.setCropMode(e.cropMode),this.setAlign(e.align,e.valign),this._passedUnit=this._isValueInObject(this.unitOptions,e.unit)?e.unit:null,this.setSize(e.width,e.height),this._renderDelay=e.renderDelay||1,this._useWebUrl=e.useWebUrl||!1},_onOrientationChange:function(){setTimeout(this.refresh.bind(this,!0),50)},render:function(){this.unLockRefresh(),this._renderDelay===0?this.refresh(!0):this._globals.utils.callLater(this.refresh,[!0],this,this._renderDelay)},_needsRender:function(){var e=this._data&&this._data.get("uri")&&this._uri!==this._data.get("uri"),t=this._getComponentSizeInPx();return e||this._sizeOfComponentInPx.x!=t.x||this._sizeOfComponentInPx.y!=t.y||this._isPropInvalid("size")||this._isPropInvalid("cropMode")},_onAllSkinPartsReady:function(){this._skinParts.image.setStyle("position","absolute"),this._skinParts.view.setStyles({position:"relative",overflow:"hidden"})},lockRefresh:function(){this._isLock=!0},unLockRefresh:function(){this._isLock=!1},refresh:function(e){if(e||this._needsRender())this._renderDelay===0?this._onRefresh(e):this._globals.utils.callLater(this._onRefresh,[e],this,this._renderDelay)},_onRefresh:function(e){if(this._isLock&&!e)return;if(!this._data)return;this._skinParts.image.set("alt",this._data.get("alt"));var t=this._getImageDimensionsAndSetCompSize(e),n=this._validateImageDimensions(t);if(n){var r={isSameImage:null,isSameImageWithBiggerPyramidSize:null},i=this._getImageFullUrl(t.imageRequestSize,r);this.fireEvent("loading",{url:i,imgWidth:t.imageObjectSize.x,imgHeight:t.imageObjectSize.y,requestSize:this._pyramidRequestSize,imgX:t.imagePosition.x,imgY:t.imagePosition.y}),this._skinParts.image.setStyles({width:t.imageObjectSize.x+"px",height:t.imageObjectSize.y+"px",top:t.imagePosition.y+"px",left:t.imagePosition.x+"px"}),i!=this._skinParts.image.get("src")?((!r.isSameImage||r.isSameImageWithBiggerPyramidSize)&&this.setState("loading"),this._skinParts.image.addEvent("load",this._onImageLoaded),this._skinParts.image.removeEvents("error"),this._skinParts.image.addEvent("error",this._onImageError.bind(this,i)),this._skinParts.image.set("src",i)):this._moveImageToBackground()}else this._globals.utils.callLater(this._renderIfReady,[],this,50);this._validate()},_validateImageDimensions:function(e){if(!e||!e.imageRequestSize)return!1;var t=e.imageRequestSize,n=t.x===0||t.y===0;return n?this._isLastImageRequestZero=!0:(this._isLastImageRequestZero&&LOG.reportError(wixErrors.IMG_VALID_SIZE_AFTER_ZERO,this.$className,"_validateImageDimensions",this._data.get("uri")),this._isLastImageRequestZero=!1),!n},_getImageDimensionsAndSetCompSize:function(e){var t=null,n=parseInt(this._data.get("width"),10),r=parseInt(this._data.get("height"),10);!n&&!r&&(n=r=128);if(e||this._isPropInvalid("size")){var i=this._getComponentSizeInUnits();this._skinParts.view.setStyles({width:i.x,height:i.y})}if(e||this._isPropInvalid("size")||this._isPropInvalid("cropMode"))this._sizeOfComponentInPx=this._getComponentSizeInPx(),t=this._imageDimensions.getDimensionsForContainerSize({x:n,y:r},this._sizeOfComponentInPx);return t},_getImageFullUrl:function(e,t){var n=this._uri;this._uri=this._data.get("uri"),t.isSameImage=n===this._uri;var r=this._uri,i=this._uri.test(/(^https?)|(^data)/);if(!this._useWebUrl&&!i)if(this._requestExactSize)r=this._imageUrl.getImageUrlExactSize(e,this._uri);else{var s=this._imageUrl.getImageUrlFromPyramid(e,this._uri,t.isSameImage,this._pyramidRequestSize);r=s.url,t.isSameImageWithBiggerPyramidSize=t.isSameImage&&s.pyramidRequestSize>this._pyramidRequestSize,this._pyramidRequestSize=s.pyramidRequestSize}return r},_onImageLoaded:function(){var e=window.Browser.ie7?7e3:1;this._globals.utils.callLater(this._validateResultImageSize,[],this,e),this.setState("loaded"),this._moveImageToBackground(),this._renderIfReady()},_validateResultImageSize:function(){this._renderIfReady()},_moveImageToBackground:function(){var e=this._skinParts.image;if(this._sizeOfComponentInPx.x!==0&&this._sizeOfComponentInPx.y!==0&&Modernizr.backgroundsize){var t=this._globals.utils.getCSSBrowserFeature("backgroundSize"),n={};n["background-image"]="url('"+e.get("src")+"')",n[t]=e.getStyle("width")+" "+e.getStyle("height"),n["background-position"]=parseInt(e.getStyle("left"),10)+"px "+parseInt(e.getStyle("top"),10)+"px",n["background-repeat"]="no-repeat",this._skinParts.view.setStyles(n),e.setStyles({visibility:"hidden"})}},_onImageError:function(e){LOG.reportError(wixErrors.IMAGE_LOAD_ERROR,"Image","refresh",e),this._renderIfReady()},_getComponentSizeInUnits:function(){return{x:this._sizeOfComponentInUnits.x+this._units.x,y:this._sizeOfComponentInUnits.y+this._units.y}},_getComponentSizeInPx:function(){if(this._skinParts===null)return;return this._units.x!==this.unitOptions.PX||this._units.y!==this.unitOptions.PX?this._skinParts.view.getSize():{x:Number(this._sizeOfComponentInUnits.x),y:Number(this._sizeOfComponentInUnits.y)}},_invalidate:function(e){switch(typeOf(e)){case"string":this._invalidProps[e]="invalid";break;case"array":for(var t=0;t<e.length;++t)this._invalidProps[e[t]]="invalid"}},_validate:function(e){switch(typeOf(e)){case"string":delete this._invalidProps[e];break;case"array":for(var t=0;t<e.length;++t)delete this._invalidProps[e[t]];break;default:this._invalidProps={}}},_isPropInvalid:function(e){return Boolean(this._invalidProps[e])},setCropMode:function(e){this._imageDimensions.setCropMode(e)&&(this._invalidate("cropMode"),this._renderIfReady())},setAlign:function(e,t){var n=!1;this._imageDimensions.setHorizontalAlign(e)&&(n=!0),this._imageDimensions.setVerticalAlign(t)&&(n=!0),n&&(this._invalidate("align"),this._renderIfReady())},setSize:function(e,t,n){var r=!1;this._passedUnit=n||this._passedUnit,e&&(r=this._passedUnit&&this._passedUnit!==this._units.x||this._sizeOfComponentInUnits.x!==parseInt(e,10),this._units.x=this._passedUnit||this._units.x,this._sizeOfComponentInUnits.x=parseInt(e,10)),t&&(r=r||this._passedUnit&&this._passedUnit!==this._units.y||this._sizeOfComponentInUnits.y!==parseInt(t,10),this._units.y=this._passedUnit||this._units.y,this._sizeOfComponentInUnits.y=parseInt(t,10)),r&&(this._invalidate("size"),this._renderIfReady())},_isValueInObject:function(e,t){for(var n in e)if(e[n]===t)return!0;return!1}})}),define.component("core.components.MenuButton",function(e){var t=e;t.inherits("mobile.core.components.base.BaseComponent"),t.skinParts({label:{type:"htmlElement"},icon:{type:"htmlElement",optional:!0},description:{type:"htmlElement",optional:!0},bullet:{type:"htmlElement",optional:!0}}),t.binds(["_buttonClick","_onMouseOver","_onMouseOut","_setImages","_onThemePropChange"]),t.states(["selected","idle","up","over","down","disable"]),t.dataTypes(["Link","Page","","AppPage","Text"]),t.fields({_renderTriggers:[Constants.DisplayEvents.DISPLAY_CHANGED],_selected:!1,_dropdownOpen:!1,_menu:null,_transitionValue:null,dropdownMode:!1,children:[]}),t.methods({initialize:function(e,t,n){this.parent(e,t,n),this._listSubType="NONE",n&&n.listSubType&&this.setListSubtype(n.listSubType),this.injects().Theme.addEvent("propertyChange",this._onThemePropChange)},createSubButton:function(e,t,n){var r=this;e(t,null,function(e){r.children.push(e),n(e)})},setMenu:function(e){this._menu=e},getMinimalWidth:function(){return Math.max(this.getOffsetWidth(),this._skinParts.label.offsetWidth)},fillWidthByPadding:function(e){this.setPadding(0);var t=e-this.getOffsetWidth();this.setPadding(t)},getPads:function(){return{left:parseInt(this._skinParts.bg.getStyle("padding-left"),10),right:parseInt(this._skinParts.bg.getStyle("padding-right"),10)}},disableTransition:function(){this._transitionValue=this.getViewNode().getStyle("-webkit-transition-duration"),this.getViewNode().setStyle("-webkit-transition-duration","0s")},enableTransition:function(){this._transitionValue!=null&&this.getViewNode().setStyle("-webkit-transition-duration",this._transitionValue)},setPadding:function(e){+e<0&&(e=0);var t=e/2,n;t-Math.floor(t)===0?n=t:(t=Math.floor(t),n=t+1);switch(this._menu.getComponentProperty("alignText")){case"center":this._skinParts.bg.setStyle("padding-left",t+"px"),this._skinParts.bg.setStyle("padding-right",n+"px");break;case"right":this._skinParts.bg.setStyle("padding-left",e+"px"),this._skinParts.bg.setStyle("padding-right","0px");break;case"left":this._skinParts.bg.setStyle("padding-left","0px"),this._skinParts.bg.setStyle("padding-right",e+"px")}},getMinimalDropdownWidth:function(){var e=0,t=this.getViewNode().getElements(".dropSizeTarget");return t&&t.length>0?t.forEach(function(t,n){e+=t.offsetWidth}):e=this.getViewNode().offsetWidth,e},isHidden:function(){var e=!1;return this._data.get("hidePage")==1&&(e=!0),e},compareRefID:function(e){return this._data?this._data.get("id")===e.substr(1):!1},alignText:function(){var e=this.getPads();this.setPadding(e.left+e.right)},getOffsetWidth:function(){return this.getViewNode().offsetWidth},getOffsetLeft:function(){return this.getViewNode().offsetLeft},_onThemePropChange:function(e){this._setImages(e)},_onDataChange:function(e){return this._updateButtonView(),this.fireEvent("dataChanged"),this.parent(e)},render:function(){this._updateButtonView()},setSelected:function(e){this._selected=e,this._selected?this.setState("selected"):(this.removeState("selected"),this._dropdownOpen&&this.setState("over"))},setDropdownOpen:function(e){this._dropdownOpen=e,this._selected||(this._dropdownOpen?this.setState("over"):this.removeState("over"))},_getButtonLabelTextField:function(){return this._data.getType()=="Page"?"title":"text"},_updateButtonView:function(){if(!this._data||!this._skinParts)return;var e=this._getButtonLabelTextField(),t=this._data.get(e);this._skinParts.label.set("html",this._getNonEmptyText(t));var n=this._skinParts.description;if(n){var r=this._data.get("target");n.set("html",this._getNonEmptyText(r))}this._setImages()},getID:function(){return this._data?this._data.get("id"):""},_getNonEmptyText:function(e){return e=e.trim().replace(/ /g,"&nbsp;"),e||"&nbsp;"},_onAllSkinPartsReady:function(e){this.injects().Theme.addEvent(Constants.ComponentEvents.PROPERTY_CHANGE,this._setImages);var t=e.hitArea||e.view;t.addEvent(Constants.CoreEvents.CLICK,this._buttonClick),t.addEvent("mouseenter",this._onMouseOver),t.addEvent("mouseleave",this._onMouseOut)},_setImages:function(e){var t,n=this._listSubType+"_DIRECTORY";if(e&&e.name!=n)return;var r=this.injects().Theme.getProperty(n);if(this._data.getType()=="Link")this._skinParts.icon.uncollapse(),this._listSubType=="PAGES"?t=r+this._data.get("icon"):t=r+this.injects().LinkTypes.getLinkIcon(this._data.get("linkType")),this._skinParts.icon.set("src",t);else if(this._skinParts.icon){var i=this._data.get("icon");i?(t=r+this._data.get("icon"),this._skinParts.icon.set("src",t)):this._skinParts.icon.setStyle("display","none")}},getWidthOnLayout:function(){return this.getViewNode().offsetWidth+parseInt(this.getViewNode().getStyle("margin-left"),10)+parseInt(this.getViewNode().getStyle("margin-right"),10)},setLabel:function(e){this._skinParts.label.set("html",this._getNonEmptyText(e))},setListSubtype:function(e){this._listSubType=e},_buttonClick:function(){this.fireEvent("click")},_onMouseOver:function(e){this.dropdownMode&&(this._selected||this.setState("over")),this.fireEvent("over")},_onMouseOut:function(e){this.dropdownMode&&!this._selected&&!this._dropdownOpen&&this.removeState("over"),this.fireEvent("out")}})}),define.oldComponent({resources:["W.Layout","W.Viewer"],name:"core.components.Page",skinParts:{},Class:{Extends:"core.components.Container",Binds:["_notifyPageComponentsOnPageVisibilityChange","_doNotification"],Static:{MAX_HEIGHT:6e4,MIN_HEIGHT:500},initialize:function(e,t,n){this.parent(e,t,n),this._isContentWixified=!1,this._isContentWixifyStarted=!1,this._wixifyCBList=[],this._contentReady=!1,this.setMaxH(this.MAX_HEIGHT),this.setMinH(this.MIN_HEIGHT),t.collapse(),this.resources.W.Viewer.addEvent("pageTransitionEnded",this._notifyPageComponentsOnPageVisibilityChange)},delayedDispose:function(e){this.disposeChildren(),this._view.setStyle("visibility","hidden");var t=this,n=function(){t.dispose(),e&&e()};setTimeout(n,500)},dispose:function(){this.resources.W.Viewer.removeEvent("pageTransitionEnded",this._notifyPageComponentsOnPageVisibilityChange),this.parent()},getPageComponents:function(){var e=[];return this.getContainerComponents(e)},listenForContentRendered:function(){var e=this._view.getElements("[comp]"),t=[];for(var n=0;n<e.length;n++)(!e[n].getLogic||e[n].getLogic().isRendered()!==!0)&&t.push(e[n]);if(t.length===0)this._setContentRendered();else var r=new Async.Bulk(t,null,{completeEvent:Constants.ComponentEvents.RENDER,completeCallback:function(){this._setContentRendered()}.bind(this)})},getAcceptableDataTypes:function(){return["Page"]},wixifyContent:function(e){e&&this._wixifyCBList.push(e);if(!this._isContentWixified){if(this._isContentWixifyStarted)return;this._isContentWixifyStarted=!0;var t=this._view.getElements("[comp]");if(t.length===0){this._setWixified(),this.listenForContentRendered();return}var n=new Async.Bulk(t,null,{completeEvent:"wixified",completeCallback:function(){this._setWixified()}.bind(this)});this.listenForContentRendered(),t.wixify()}else this._setWixified()},render:function(){if(this.resources.W.Layout&&this.resources.W.Layout.getComponentMinResizeHeight){var e=this.resources.W.Layout.getComponentMinResizeHeight(this);this.setHeight(e)}},isContentWixify:function(){return this._isContentWixified},_setWixified:function(){this._isContentWixified||(this._view.getElements(".initHidden").removeClass("initHidden"),this._view.removeClass("initHidden"),this._isContentWixified=!0),this.fireEvent("contentWixified",this);for(var e=0;e<this._wixifyCBList.length;++e)this._wixifyCBList[e]();this._wixifyCBList=[],this.resources.W.Layout&&this.resources.W.Layout.attachSavedAnchors(this._view)},_setContentRendered:function(){this._contentReady=!0,this._findAndEnforceInvalidatedAnchors(this),this.render(),this.fireEvent("pageContentReady")},_findAndEnforceInvalidatedAnchors:function(e){if(!e.getChildComponents)return;var t=e.getChildComponents(),n=[];for(var r=0;r<t.length;r++)this._findAndEnforceInvalidatedAnchors(t[r].getLogic()),t[r].getLogic().isAnchorsInvalidated&&t[r].getLogic().isAnchorsInvalidated()&&n.push(t[r].getLogic());this.resources.W.Layout&&this.resources.W.Layout.enforceAnchors&&this.resources.W.Layout.enforceAnchors(n)},setAsWixified:function(){this._setWixified()},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.NEVER},from:!1}},isSelectable:function(){return!1},isContentReady:function(){return this._contentReady},getInlineContentContainer:function(){return this._skinParts.inlineContent?this._skinParts.inlineContent:this._view},getThirdPartyApplicationComponent:function(){var e=this._view.getElement("[comp*='TPASection']");return e.getLogic()},isThirdPartyApplicationPage:function(){if(this._data.get("tpaApplicationId"))return!0},_doNotification:function(){var e=$$("#"+this._newPageId)[0].getLogic(),t=this.getPageComponents(),n=!1;this._compId==this._newPageId&&(n=!0),t.forEach(function(t){t.onPageVisibilityChange(n,e)})},_notifyPageComponentsOnPageVisibilityChange:function(e){var t=$$("#"+e)[0];if(!t||!t.getLogic)return;this._newPageId=e,this._isContentWixified?this._doNotification():this.addEvent("contentWixified",this._doNotification)}}}),define.oldComponent({name:"core.components.ServiceItem",skinParts:{icon:{type:"htmlElement"},label:{type:"htmlElement"},readMore:{type:"htmlElement"},description:{type:"htmlElement"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_toggleOpen","_onImageReady"],_states:["uncut","cutClosed","cutOpened"],initialize:function(e,t,n){this.parent(e,t,n),this._opened=!1,this._uncut=!0,this.imageDataQuery=undefined},render:function(){this._skinParts.label.set("html",this._data.get("title"));var e=this._data.get("description");e=e.replace(/\n/g,"<br/>"),this._skinParts.description.set("html",e);var t=$(this._skinParts.description).getElements("a");this._sanitizeLinks(t),this._disableLinks(t),this._skinParts.readMore.set("html","Read More"),this._testOpenState(),this._view.addEvent("click",this._toggleOpen);var n=this._data.get("image");n!=this.imageDataQuery&&(this._imageSkinContainer=this.injects().Components.createComponent("core.components.Image","mobile.core.skins.ImageSkin",n,{width:6,height:6,unit:"em",align:"center",valign:"top",cropMode:"fill"},this._onImageReady),this._skinParts.icon.empty(),this._imageSkinContainer.insertInto(this._skinParts.icon),this.imageDataQuery=n)},_testOpenState:function(){var e=this._skinParts.allText.getSize(),t=parseInt(this.injects().Utils.getComputedStyle(this._skinParts.description).fontSize,10);e.y>t*6.5?(this._opened=!this._opened,this._uncut=!1,this._toggleOpen()):(this._uncut=!0,this.setState("uncut"))},_toggleOpen:function(){if(this._uncut||W.Viewer.isScrollLock())return;this._opened?(this._skinParts.readMore.set("html","Read More"),this.setState("cutClosed")):(this._skinParts.readMore.set("html","Close"),this.setState("cutOpened")),this.fireEvent("autoSizedAnimation"),this._opened=!this._opened},_onAutoSizedAnimtion:function(){},_onImageReady:function(e){e._data.addEvent(Constants.DataEvents.DATA_CHANGED,this._onImageDataChange.bind(this,e._data)),this._onImageDataChange(e._data)},_onImageDataChange:function(e){e.getMeta("isHidden")?(this._skinParts.icon.collapse(),this._skinParts.view.removeClass("showImage"),this._skinParts.view.addClass("hideImage")):(this._skinParts.icon.uncollapse(),this._skinParts.view.addClass("showImage"),this._skinParts.view.removeClass("hideImage"))},getAcceptableDataTypes:function(){return["Service"]}}}),define.oldComponent({name:"core.components.SimpleBaseList",Class:{Extends:"core.components.BaseList",initialize:function(e,t,n){this.parent(e,t,n),this._allItemsLoaded=!1,this._isLoadingItems=!1},getAcceptableDataTypes:function(){return["PropertyList"]},getItemsContainer:function(){return this._skinParts.itemsContainer||this._view},_prepareForRender:function(){if(this._allItemsLoaded)return!0;if(this._isLoadingItems)return!1;this._isLoadingItems=!0;var e=this._getItemsData();return this._renderItems(e),this._allItemsLoaded},_onDataChange:function(){this._allItemsLoaded=!1,this._isLoadingItems=!1,this.parent()},_getItemsData:function(){if(this._data)return this._data.get("items")},_onAllItemsReady:function(){this._isLoadingItems=!1,this._allItemsLoaded=!0,this._renderIfReady()}}}),define.oldComponent({name:"core.components.SimpleButton",imports:["mobile.core.components.base.BaseComponent"],injects:[],skinParts:{label:{type:"htmlElement"},hitArea:{type:"htmlElement"}},states:["up","over","down","disable"],Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:["_buttonClick"],render:function(){var e=this._data.getType()=="Page"?"title":"text";this._skinParts.label.set("html",this._data.get(e))},_onAllSkinPartsReady:function(e){e.hitArea.addEvent("click",this._buttonClick)},_buttonClick:function(){this.fireEvent("click")},getAcceptableDataTypes:function(){return["Button","Link","Page"]}}}),function(){var e="BG_USES_CUSTOM_IMAGE",t="BG_USES_THEME_IMAGE",n="BG_USES_CUSTOM_COLOR";define.oldComponent({name:"core.components.SiteStructure",Class:{Extends:"core.components.Container",Binds:["changeBGImage"],_bgSizes:[{w:204,h:309},{w:320,h:452},{w:320,h:646},{w:320,h:800},{w:400,h:591},{w:480,h:480},{w:533,h:239},{w:683,h:334},{w:768,h:896},{w:1024,h:640}],initialize:function(e,t,n){this.parent(e,t,n),window.onorientationchange&&window.addEvent("orientationchange",this.changeBGImage),window.addEvent("resize",this.changeBGImage),W.Theme.addEvent("propertyChange",this.changeBGImage),this.changeBGImage({type:"init"})},render:function(){this.sitePagesNode=this._view.getElement("#SITE_PAGES"),this.sitePagesNode||LOG.reportError(wixErrors.SITE_STRUCTURE_NO_SITE_PAGES,"core.components.SiteStructure","render");var e=this.injects().Theme.getProperty("padding1");e=e.split(" ");var t="0";switch(e.length){case 1:t="0 "+e[0];break;case 2:case 3:t="0 "+e[1];break;case 4:t="0 "+e[1]+" 0 "+e[3]}this.sitePagesNode.setStyle("margin",t)},_getReformattedBgColor:function(){var e=this.injects().Theme.getProperty("bgSize").split(",");return{width:e[0],height:e[1]}},changeBGImage:function(n){var r=this.injects().Utils.getWindowSize(),i=this._getBestFit(r,this._bgSizes),s,o=this.injects().Theme.getProperty("bgType");switch(o){case t:s=this.injects().Theme.getProperty("BG_DIRECTORY")+"bg_"+i.w+"x"+i.h+".jpg",$(document.body).setStyle("background",'url("'+s+'") repeat');break;case e:var u=this.injects().Config.getServiceTopologyProperty("staticMediaUrl")+"/",a=this.injects().Theme.getProperty("bgId"),f=this._getReformattedBgColor(),l=f.width,c=f.height;if(l>100){l=i.w;var h=f.width/f.height;c=Math.round(l/h)}var p=u+a+"_crp_0"+"_0"+"_"+f.width+"_"+f.height+"_"+l+"_"+c+"_crp";$(document.body).setStyle("background",'url("'+p+'") repeat');break;default:$(document.body).setStyle("background","")}s=this.injects().Theme.getProperty("siteBgColor"),$(document.body).setStyle("background-color",s.getHex(!1))},_getWantedBgSize:function(){var e,t,n,r=this._getReformattedBgColor(),i=r.width,s=r.height,o=this._view.clientWidth,u=this._view.clientHeight,a=s/i,f=u/o;a<f?(t=u,e=t/a):(e=o,t=e*a);var l=e>t?t:e;for(var c=0;c<this._bgSizes.length;c++)if(this._bgSizes[c]>=l){n=this._bgSizes[c];break}return n},_getBestFit:function(e,t){var n=t[0];for(var r=1;r<t.length;++r){var i=t[r],s=i.w-e.width,o=n.w-e.width;s>=0?o<0?n=t[r]:n=s<o?t[r]:n:o<0&&(n=s>o?t[r]:n)}return n}}})}(),define.oldComponent({name:"core.components.TwitterFollow",imports:["mobile.core.components.base.BaseComponent"],injects:[],skinParts:{twitter:{type:"htmlElement"}},propertiesSchema:{showCount:{type:"string","enum":["true","false"],"default":"true",description:"Followers count display"},button:{type:"string","enum":["blue","gray"],"default":"blue",description:"Button color"},textColor:{type:"string","default":"",description:"HEX color code for the text color"},linkColor:{type:"string","default":"",description:"HEX color code for the Username link color"},width:{type:"string","default":"",description:"width of the Follow Button"},align:{type:"string","default":"",description:"alignment of the Follow Button"},dataLang:{type:"string","enum":["en","fr","de","it","es","ko","ja"],"default":"en",description:"The language for the Tweet Button"}},Class:{Extends:"mobile.core.components.base.BaseComponent",Binds:[],initialize:function(e,t){this.parent(e,t)},render:function(){this._runTwitterScript(),this._rebuildTwitterElement()},_onComponentPropertyChange:function(e,t){this._rebuildTwitterElement()},_rebuildTwitterElement:function(){this._skinParts.twitter.empty();var e=this._data.get("accountToFollow").replace("@","");e||(e="wix");var t={"class":"twitter-follow-button",href:"https://twitter.com/"+e,"data-show-count":this.getComponentProperty("showCount"),"data-button":this.getComponentProperty("button"),"data-text-color":this.getComponentProperty("textColor"),"data-link-color":this.getComponentProperty("linkColor"),"data-lang":this.getComponentProperty("dataLang"),"data-width":this.getComponentProperty("width"),"data-align":this.getComponentProperty("align")},n=new Element("a",t);this._skinParts.twitter.adopt(n),window.twttr!==undefined&&twttr.widgets.load()},getAcceptableDataTypes:function(){return["TwitterFollow"]},_runTwitterScript:function(){this.injects().Viewer.loadExternalScript("//platform.twitter.com/widgets.js")}}}),define.component("core.components.base.BaseComp",function(e){var t=e;t.inherits("bootstrap.managers.events.EventDispatcher"),t.utilize(["core.managers.component.ComponentDefinition"]),t.traits(["core.components.base.traits.BaseCompInvalidation","core.components.base.traits.BaseCompSkinHandler","core.components.base.traits.BaseCompChildCompHandler","core.components.base.traits.BaseCompStates","core.components.base.traits.BaseCompDataHandler","core.components.base.traits.BaseCompProperties","core.components.base.traits.BaseCompLayout","core.components.base.traits.OldBaseCompIntegration","core.components.base.traits.OldBaseCompLayoutIntegration","core.components.base.traits.OldBaseCompEditorPropIntegration"]),t.resources(["W.ComponentLifecycle"]),t.skinParts({}),t.dataTypes([""]),t.states({}),t.statics({NEW_BASE_COMP:!0,INVALIDATIONS:{SKIN_CHANGE:"skinChange",DATA_CHANGE:"dataChange",DISPLAY:"display",WIDTH_REQUEST:"widthRequest",HEIGHT_REQUEST:"heightRequest",X_REQUEST:"xRequest",Y_REQUEST:"yRequest",SIZE:"sizeChanged",POSITION:"positionChanged",PART_SIZE:"partSize",PART_POSITION:"partPosition"}}),t.methods({initialize:function(e,t,n){this._compId=e,this.on(Constants.LifecycleSteps.RENDER,this,this._onRender)},getComponentId:function(){return this._compId},isRenderNeeded:function(e){var t=[this.INVALIDATIONS.SKIN_CHANGE,this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.WIDTH_REQUEST,this.INVALIDATIONS.HEIGHT_REQUEST];return e.isInvalidated(t)},_onRender:function(e){},isDisplayed:function(){var e=this.resources.W.ComponentLifecycle.getComponentInfo(this);return e.isDisplayed},getComponentStatus:function(){var e=this.resources.W.ComponentLifecycle.getComponentInfo(this);return e.state},exterminate:function(){if(this._isExterminated)return LOG.reportError(wixErrors.COMPONENT_ALREADY_DISPOSED,this.$className,"exterminate",this.getComponentId());this._isExterminated=!0,this.parent()}})}),define.Class("core.components.base.BaseLayoutEngine",function(e){var t=e;t.methods({initialize:function(e){this._viewNode=e},updateLayoutFromViewNode:function(){},setSize:function(e,t,n){},setPosition:function(e,t,n){},getSize:function(e){},getPosition:function(e){}})}),define.Const("ComponentEvents",{DISPLAYED:"displayed",READY:"componentReady",WIXIFIED:"wixified",PROPERTY_CHANGE:"componentPropertyChange",READY_FOR_RENDER:"readyForRender",RENDER:"render",COMPONENT_SEQUENCER_COMP_SETUP:"componentSetup",COMPONENT_SEQUENCER_PRODUCTION_FINISHED:"productionFinished"}),define.Const("ComponentPartTypes",{HTML_ELEMENT:"htmlElement"}),define.Class("core.components.base.InvalidationCollector",function(e){var t=e;t.methods({initialize:function(){this._invalidations={}},invalidate:function(e,t){if(e){var n=this._invalidations[e]||[];n.push(t),this._invalidations[e]=n}},clearInvalidationType:function(e){delete this._invalidations[e]},isInvalidated:function(e){for(var t=0;t<e.length;++t){type=e[t];if(this._invalidations[type]!==undefined)return!0}return!1},getInvalidationByType:function(e){return this._invalidations[e]},getLastInvalidationByType:function(e){var t=this._invalidations[e];return t?t[t.length-1]:null}})}),define.Class("core.components.base.SizeLimits",function(e){var t=e;t.methods({initialize:function(){this.minW=null,this.minH=null,this.maxW=null,this.maxH=null},clone:function(){var e=new this.$class;return e.minW=this.minW,e.minH=this.minH,e.maxW=this.maxW,e.maxH=this.maxH,e}})}),define.Const("BaseComponent",{ResizeSides:{TOP:"RESIZE_TOP",LEFT:"RESIZE_LEFT",BOTTOM:"RESIZE_BOTTOM",RIGHT:"RESIZE_RIGHT"},MoveDirections:{HORIZONTAL:"HORIZONTAL_MOVE",VERTICAL:"VERTICAL_MOVE"},AnchorLock:{NEVER:"never",BY_THRESHOLD:"threshold",ALWAYS:"always"}}),define.Class("core.components.base.traits.BaseCompChildCompHandler",function(e){var t=e;t.utilize(["core.managers.components.ComponentBuilder"]),t.resources(["W.ComponentLifecycle"]),t.binds(["_onChildComponentReady"]),t.fields({SKIN_PART_ATTR_NAME:"skinPart"}),t.methods({_createInnerComponent:function(e,t,n){t=t||new Element("div"),t.setProperty(this.SKIN_PART_ATTR_NAME,e.id);var r=e.argObject||{},i=this._getInnerComponentData(e),s=this._getInnerComponentStyle(e),o=e.skin,u=e.type,a=new this.imports.ComponentBuilder(t);return a.withType(u).withSkin(o).withData(i).withArgs(r).withSkinParamMapper(s).onCreated(this._onChildComponentReady).create(),n&&!t.$logic,t.$logic},_onChildComponentReady:function(e){console.log("created "+e),this.resources.W.ComponentLifecycle.setParentComponentProcess(e,this)},_getInnerComponentData:function(e){var t;if(e.dataQuery)t=e.dataQuery;else if(e.dataRefField){var n=e.dataRefField;n=="*"?t=this._data:t=this._data.get(n)}else if(e.dataType){var r=this._data?this._data.getDataManager():this.injects().Data;t=r.addDataItemWithUniqueId("",{type:e.dataType}).dataObject,t.setMeta("isPersistent",!1)}return t},_getInnerComponentStyle:function(e){var t,n=this._skin&&this._skin.getParamMapper();return e.styleGroup&&n&&(t=e.styleGroup=="inherit"?n:n.getStyleByGroupName(e.styleGroup)),t}})}),define.Class("core.components.base.traits.BaseCompDataHandler",function(e){var t=e;t.binds(["_onDataChange"]),t.statics({_definitionFieldName_:"_dataTypes_",_fieldName_:"dataTypes",_aggregateSchema_:function(e,t,n){if(!e||e&&typeOf(e)!=="array")e=[""];t&&typeOf(t)==="array"&&(e=e.combine(t));if(typeOf(n)==="array"){var r=[];for(var i=0;i<e.length;++i)n.indexOf(e[i])===-1&&r.push(e[i]);e=r}return e}}),t.methods({initialize:function(e,t,n){this._data=null,this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._exterminateData),this.$compSchema.dataTypes||(this.$compSchema.dataTypes=[""])},_getDataManager:function(){return this._data?this._data.getDataManager():null},getRawData:function(){return this._data?this._data.getData():undefined},getDataItem:function(){return this._data},setDataItem:function(e){if(!this.isDataTypeValid(e))return;e!=this._data&&(this._removeCurrentData(),this._data=e,e&&(this._data.addComponentWithInterest(this),this._data.addEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange)),this._onDataChange(e))},_removeCurrentData:function(){if(this._data)try{this._data.removeComponentWithInterest(this),this._data.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange);var e=this._data.getDataManager();e&&e.removeDataItem(this._data),this._data=null}catch(t){}},setDataByQuery:function(e,t){this.injects().Data.getDataByQuery(e,function(e){this.setDataItem(e),t()}.bind(this))},isDataTypeValid:function(e){var t=e?e.getType():"";return!this.$compSchema.dataTypes.contains,this.$compSchema.dataTypes.contains(t)},_setDataField:function(e,t){this._data.set(e,t,!0)},_setMetaDataField:function(e,t){this._data.setMeta(e,t)},_onDataChange:function(e,t,n){var r={dataItem:e,field:t,value:n};this.invalidate(this.INVALIDATIONS.DATA_CHANGE,r,!0)},_exterminateData:function(){this._removeCurrentData()}})}),define.Class("core.components.base.traits.BaseCompInvalidation",function(e){var t=e;t.utilize(["core.components.base.InvalidationCollector"]),t.methods({initialize:function(){this._invalidations_=new this.imports.InvalidationCollector},invalidate:function(e,t,n){e&&(this._invalidations_.invalidate(e,t),n&&this.trigger(e,t))},isInvalidated:function(e){return this._invalidations_.isInvalidated(e)},getInvalidationByType:function(e){return this._invalidations_.getInvalidationByType(e)},getLastInvalidationByType:function(e){return this._invalidations_.getLastInvalidationByType(e)}})}),define.Class("core.components.base.traits.BaseCompLayout",function(e){var t=e;t.methods({initialize:function(e,t,n){this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._exterminateLayout)},setWidth:function(e){value=parseInt(e,10);if(isNaN(value))return;value=this._limitWidth(value),this._setWidth_(value),this.getRequestDimensions().width=value,this.invalidate(this.INVALIDATIONS.WIDTH_REQUEST,{width:value,requestedWeight:e},!0),this.resources.W.ComponentLifecycle.forceRender()},setHeight:function(e){value=parseInt(e,10);if(isNaN(value))return;value=this._limitHeight(value),this._setHeight_(value),this.getRequestDimensions().height=value,this.invalidate(this.INVALIDATIONS.HEIGHT_REQUEST,{height:value,requestedHeight:e},!0),this.resources.W.ComponentLifecycle.forceRender()},setX:function(e){value=parseInt(e,10);if(isNaN(value))return;this._setX_(value),this.getRequestDimensions().left=value,this.invalidate(this.INVALIDATIONS.X_REQUEST,{x:value,requestedX:e},!0),this.resources.W.ComponentLifecycle.forceRender()},setY:function(e){value=parseInt(e,10);if(isNaN(value))return;this._setY_(value),this.getRequestDimensions().top=value,this.invalidate(this.INVALIDATIONS.Y_REQUEST,{y:value,requestedY:e},!0),this.resources.W.ComponentLifecycle.forceRender()},getWidth:function(){return this.getRequestDimensions().width},getHeight:function(){return this.getRequestDimensions().height},getX:function(){return this.getRequestDimensions().left},getY:function(){return this.getRequestDimensions().top},getInvalidatedWidth:function(){var e=this.getLastInvalidationByType(this.INVALIDATIONS.WIDTH_REQUEST);return e?e.width:null},getInvalidatedHeight:function(){var e=this.getLastInvalidationByType(this.INVALIDATIONS.HEIGHT_REQUEST);return e?e.height:null},getInvalidatedX:function(){var e=this.getLastInvalidationByType(this.INVALIDATIONS.X_REQUEST);return e?e.x:null},getInvalidatedY:function(){var e=this.getLastInvalidationByType(this.INVALIDATIONS.Y_REQUEST);return e?e.y:null},_setWidth_:function(e){e=this._limitWidth(e),this.$view.style.minWidth=e+"px"},_setHeight_:function(e){e=this._limitHeight(e),this.$view.style.minHeight=e+"px"},_setX_:function(e){this.$view.style.left=e+"px"},_setY_:function(e){this.$view.style.top=e+"px"},getPhysicalHeight:function(){var e=this.getMeasure().height,t=this.getInvalidatedHeight();return Math.max(e,t)},getPhysicalWidth:function(){var e=this.getMeasure().width,t=this.getInvalidatedWidth();return Math.max(e,t)},getRequestDimensions:function(){return this.$view.$requestDimensions=this.$view.$requestDimensions||{width:0,height:0,top:0,left:0},this.$view.$requestDimensions},getMeasure:function(){return this.$view.$measure||{width:0,height:0,top:0,left:0}},getMinDragY:function(e){return W.Layout&&W.Layout.getComponentMinDragY(this,e)},isSizeInvalidated:function(){return!!this.getInvalidatedWidth()||!!this.getInvalidatedHeight()},_limitWidth:function(e){return this._limitDimension(e,this.getSizeLimits().minW,this.getSizeLimits().maxW)},_limitHeight:function(e){return this._limitDimension(e,this.getSizeLimits().minH,this.getSizeLimits().maxH)},_limitDimension:function(e,t,n){return Math.min(Math.max(e,t),n)},disableReportLayoutChange:function(){this._isReportLayoutChangeDisabled=!0},enableReportLayoutChange:function(){this._isReportLayoutChangeDisabled=!1},reportLayoutChange:function(){if(this._isReportLayoutChangeDisabled)return;var e=!0;this.getAnchors()==null||W.Layout&&!W.Layout._validateAnchorTargetsRendered(this.getAnchors())?e=!1:this.getHorizontalGroup()!=null&&W.Layout&&!W.Layout._validateAnchorTargetsRendered(this.getHorizontalGroup())?e=!1:this._areAnchorsAlreadySet||(e=!1),this._anchorTargetsReady||e?(this._anchorsInvalidated=!1,this._anchorTargetsReady=!0,W.Layout&&W.Layout.enforceAnchors([this])):this._anchorsInvalidated=!0},_exterminateLayout:function(){W.Layout&&W.Layout.deleteSavedAnchorsById(this.getComponentId())}})}),define.Class("core.components.base.traits.BaseCompProperties",function(e){var t=e;t.resources(["W.ComponentData"]),t.statics({_definitionFieldName_:"_propertiesSchemaType_",_fieldName_:"propertiesSchemaType",_aggregateSchema_:function(e,t,n){return e||""}}),t.methods({initialize:function(e,t,n){this._properties=null,this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._exterminateProperties)},setComponentProperties:function(e){e&&e!==this._properties&&(this._removeCurrentProperties(),this._properties=e,this._properties.addComponentWithInterest(this),this._properties.addEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange),this.$view.setProperty("propertyQuery",this._properties.get("id")))},_removeCurrentProperties:function(){if(this._properties){this._properties.removeComponentWithInterest(this),this._properties.removeEvent(Constants.DataEvents.DATA_CHANGED,this._onDataChange);var e=this._properties.getDataManager();e&&e.removeDataItem(this._properties),this._properties=null}},getComponentProperties:function(){return this._properties||this._createComponentProperties(),this._properties},getComponentProperty:function(e){return this._properties||this._createComponentProperties(),this._properties.get(e)},setComponentProperty:function(e,t,n){this._properties||this._createComponentProperties(),this._properties.set(e,t,n)},_createComponentProperties:function(){if(!this.$view)return;var e=this._compId,t=this.$compSchema.propertiesSchemaType;if(!t)return null;var n=this.resources.W.ComponentData.addDataItem(e,{type:t},this);this.setComponentProperties(n)},deleteComponentProperty:function(e){},_onComponentPropertyChange:function(e,t){},_loadComponentProperties:function(){},_exterminateProperties:function(){this._removeCurrentProperties()}})}),define.Class("core.components.base.traits.BaseCompSkinHandler",function(e){var t=e;t.statics({_definitionFieldName_:"_skinParts_",_fieldName_:"skinParts",_aggregateSchema_:function(e,t,n){if(!e||e&&typeOf(e)!=="object")e={};t&&typeOf(t)==="object"&&Object.merge(e,t);if(n&&typeOf(n)==="object")for(var r in n)delete e[r];return e}}),t.methods({initialize:function(e,t,n){this.$view=t,this.on(Constants.EventDispatcher.Events.EXTERMINATING,this,this._exterminateView),this._styleNameSpace=n&&n.styleNameSpace,this.$compSchema.skinParts||(this.$compSchema.skinParts={})},setSkin:function(e){this._removeOldSkinAndExtractInlineContent(),this._skin=e,this._skin._setLogic_(this)},getSkin:function(){return this._skin||null},setSkinMapper:function(e){if(this._skin.getOriginalClassName()===e.getSkin())this._skin.setParamMapper(e);else{var t=e.getSkinClass(),n=new t;n.setParamMapper(e),this.setSkin(n)}},getSkinMapper:function(){return this._skin&&this._skin.getParamMapper()||null},getStyleNameSpace:function(){return this._styleNameSpace||this.$className},getInlineContent:function(){return this._skinParts&&this._skinParts.inlineContent?this._skinParts.inlineContent.getChildren():!this._skinParts&&this.$view?this.$view.getChildren():null},_removeOldSkinAndExtractInlineContent:function(){var e=this.getInlineContent();e&&(this.$view.empty(),this.$view.adopt(e)),this._skin&&this._skin._removeLogic_()},_updateSkinParts_:function(e){this._validateSkinParts(e),this._skinParts=this._processCompParts(e),this.invalidate(this.INVALIDATIONS.SKIN_CHANGE)},_validateSkinParts:function(e){var t=this.$compSchema.skinParts;if(t)for(var n in t){var r=t[n];!e[n]&&!r.optional&&r.autoCreate!==!1&&LOG.reportError(wixErrors.SKIN_PART_MISSING,this.getOriginalClassName()+" / "+this._skin.getOriginalClassName(),"_validateSkinParts",n)()}},_processCompParts:function(e){var t=Object.clone(e),n=this.$compSchema.skinParts;for(var r in n){var i=n[r];if(i.type!=="htmlElement"&&i.autoCreate!==!1){var s=this.getSkinPartDefinition(r),o=e[r];t[r]=this._createInnerComponent(s,o,!1)}}return t},getSkinPartDefinition:function(e){var t=this.$compSchema.skinParts[e],n=this._skin&&this._skin.getCompPartsDefinition()[e]||{},r={id:e};return t?r=Object.merge(r,n,t):(r.partDefinitionNotFound="maybe you missed a letter?",LOG.reportError(wixErrors.CM_NO_PART,this.getOriginalClassName(),"getSkinPartDefinition",e)()),r.hookMethod&&typeOf(this[r.hookMethod])=="function"&&(r.argObject=r.argObject||{},r=this[r.hookMethod](r)),r},_exterminateView:function(){this._skin&&this._skin.exterminate(),this.$view&&(this.$view.cleanup(),this.$view.destroy(),this.$view=null)}})}),define.Class("core.components.base.traits.BaseCompStates",function(e){var t=e;t.fields({DEFAULT_GROUP_NAME:"DEFAULT",ATTR_NAME:"state"}),t.statics({_definitionFieldName_:"_states_",_fieldName_:"states",_aggregateSchema_:function(e,t,n){e=e||[],typeOf(e)==="array"&&(e={DEFAULT:e}),t&&(typeOf(t)==="array"?e.DEFAULT=t:Object.merge(e,t));if(n)if(typeOf(n)==="array")e.DEFAULT=[];else for(var r in n)delete e[r];var i={};for(var s in e)Array.each(e[s],function(e){if(i[e])return LOG.reportError(wixErrors.CM_DUPLICATE_STATE_NAME,"BaseCompStates","_aggregateSchema_",e)(),null;i[e]=1}.bind(this));return e}}),t.methods({initialize:function(e,t,n){this._selectedStates={},this._groupNames=[],this.$compSchema.states||(this.$compSchema.states={}),this._initializeCurrentState()},_initializeCurrentState:function(){this._selectedStates={},Object.each(this.$compSchema.states,function(e,t){this._selectedStates[t]=e[0]},this),this._syncViewNodeWithStates()},getState:function(e){var t=e||this.DEFAULT_GROUP_NAME,n=this._selectedStates[t];return n||null},setState:function(e,t){var n=e,r=t;r||(r=this._getGroupNameByState(n));if(!r){LOG.reportError(wixErrors.CM_UNKNOWN_STATE_NAME,"BaseCompStates","setState",this.getOriginalClassName()+"{"+t+":"+e+"}");return}if(!this._selectedStates[r]){LOG.reportError(wixErrors.CM_UNKNOWN_STATE_GROUP,"BaseCompStates","setState",this.getOriginalClassName()+"{"+t+"}");return}if(!this.$compSchema.states[r].contains(n)){LOG.reportError(wixErrors.CM_UNKNOWN_STATE_NAME,"BaseCompStates","setState",this.getOriginalClassName()+"{"+t+":"+e+"}");return}this._selectedStates[r]=n,this._syncViewNodeWithStates()},hasState:function(e,t){return t||(t=this._getGroupNameByState(e)),t?this.$compSchema.states?this.$compSchema.states[t]?this.$compSchema.states[t].contains(e)?!0:!1:!1:!1:!1},_getGroupNameByState:function(e){for(var t in this.$compSchema.states)if(this.$compSchema.states[t].contains(e))return t;return null},_syncViewNodeWithStates:function(){var e=this.getViewNode();if(!e)return;var t=Object.values(this._selectedStates).join(" ");e.setAttribute(this.ATTR_NAME,t),e.addClass("FOCRE_REFLOW_PLEASE"),e.removeClass("FOCRE_REFLOW_PLEASE")}})}),define.Class("core.components.base.traits.OldBaseCompEditorPropIntegration",function(e){var t=e;t.utilize(["core.components.base.SizeLimits"]),t.statics({MINIMUM_X_DEFAULT:-2e3,MAXIMUM_X_DEFAULT:2e3,MINIMUM_Y_DEFAULT:-1e3,MAXIMUM_Y_DEFAULT:4e4,MINIMUM_WIDTH_DEFAULT:5,MINIMUM_HEIGHT_DEFAULT:5,MAXIMUM_WIDTH_DEFAULT:2500,MAXIMUM_HEIGHT_DEFAULT:2e3}),t.methods({initialize:function(){this._showOnAllPagesChangeability=!0,this._usesExternalData=!1,this._resizableSides||(this._resizableSides=[Constants.BaseComponent.ResizeSides.TOP,Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.BOTTOM,Constants.BaseComponent.ResizeSides.RIGHT]),this._moveDirections=[Constants.BaseComponent.MoveDirections.HORIZONTAL,Constants.BaseComponent.MoveDirections.VERTICAL],this.on(this.INVALIDATIONS.Y_REQUEST,this,this._OBCEI_onMovement),this.on(this.INVALIDATIONS.X_REQUEST,this,this._OBCEI_onMovement)},getSelectableX:function(){return this.getX()},getSelectableY:function(){return this.getY()},getSelectableWidth:function(){return this.getWidth()},getSelectableHeight:function(){return this.getPhysicalHeight()},isSelectable:function(){return!0},getHorizontalGroup:function(){return this._horizontalGroup},_OBCEI_onMovement:function(){this.fireEvent("componentMoved")},allowHeightLock:function(){return this.isVertResizable()},getResizableSides:function(){return this._resizableSides},isResizable:function(){return this._resizableSides.length>0},isHorizResizable:function(){return this._resizableSides.contains(Constants.BaseComponent.ResizeSides.RIGHT)||this._resizableSides.contains(Constants.BaseComponent.ResizeSides.LEFT)},isVertResizable:function(){return this._resizableSides.contains(Constants.BaseComponent.ResizeSides.TOP)||this._resizableSides.contains(Constants.BaseComponent.ResizeSides.BOTTOM)},isHorizontallyMovable:function(){return this._moveDirections.contains(Constants.BaseComponent.MoveDirections.HORIZONTAL)},isVerticallyMovable:function(){return this._moveDirections.contains(Constants.BaseComponent.MoveDirections.VERTICAL)},getSizeRefNode:function(){return this._getEditBoxReferenceNode().getSize()},_getEditBoxReferenceNode:function(){return this.$view},getExtraPixels:function(e){return this.getDivExtraPixels(this.$view,e)},getDivExtraPixels:function(e,t){var n=Number.from(e.getStyle("border-top"))+Number.from(e.getStyle("padding-top")),r=Number.from(e.getStyle("border-bottom"))+Number.from(e.getStyle("padding-bottom")),i=Number.from(e.getStyle("border-left"))+Number.from(e.getStyle("padding-left")),s=Number.from(e.getStyle("border-right"))+Number.from(e.getStyle("padding-right"));return t&&(n+=Number.from(e.getStyle("margin-top")),r+=Number.from(e.getStyle("margin-bottom")),i+=Number.from(e.getStyle("margin-left")),s+=Number.from(e.getStyle("margin-right"))),{top:n,bottom:r,left:i,right:s,height:n+r,width:i+s}},isSiteSegment:function(){return this.isInstanceOfClass("wysiwyg.viewer.components.HeaderContainer")||this.isInstanceOfClass("wysiwyg.viewer.components.PagesContainer")||this.isInstanceOfClass("wysiwyg.viewer.components.FooterContainer")},isInstanceOfClass:function(e){if(this.className==e)return!0;var t=this.$parentPrototype;while(t){if(t.className==e)return!0;t=t.$parentPrototype}return!1},useLayoutOnDrag:function(){return!1},useLayoutOnResize:function(){return!1},isDraggable:function(){return!0},isEditableInPlace:function(){return!1},getGlobalPosition:function(){return this.$view.getPosition()},getGlobalPositionRefNode:function(){return this._getEditBoxReferenceNode().getPosition()},getParentComponent:function(){var e=this.getViewNode().getParent("[comp]");return e&&e.getLogic?e.getLogic():null},isAnchorable:function(){return{to:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD},from:{allow:!0,lock:Constants.BaseComponent.AnchorLock.BY_THRESHOLD}}},isContainable:function(e){return!0},isDeleteable:function(){return!0},isDuplicatable:function(){return!0},isDeleteableRecurse:function(){if(!this.isDeleteable())return!1;var e=this.getViewNode().getElements("[comp]");for(var t=0;t<e.length;t++){if(!e[t].getLogic)continue;if(!e[t].getLogic().isDeleteable())return!1}return!0},isMultiSelectable:function(){return!0},getShowOnAllPagesChangeability:function(){return this._showOnAllPagesChangeability},setShowOnAllPagesChangeability:function(e){this._showOnAllPagesChangeability=e},hasChildren:function(){return!1},canMoveToOtherScope:function(){return!0},isUsingExternalData:function(){return this._usesExternalData},onPageVisibilityChange:function(e){},getID:function(){return this.$view.getProperty("id")}})}),define.Class("core.components.base.traits.OldBaseCompIntegration",function(e){var t=e;t.inherits("bootstrap.utils.Events"),t.methods({initialize:function(){this._isRendered=!1,this.on(Constants.LifecycleSteps.RENDER,this,this._OBCI_onRender),this.on(this.INVALIDATIONS.SIZE,this,this._OBCI_onSizeChange)},_OBCI_onRender:function(){this.off(Constants.LifecycleSteps.RENDER,this,this._OBCI_onRender),this._isRendered=!0,this.fireEvent(Constants.ComponentEvents.RENDER),this.$view.fireEvent(Constants.ComponentEvents.RENDER),this.fireEvent(Constants.ComponentEvents.READY),this.$view.fireEvent(Constants.ComponentEvents.READY)},_OBCI_onSizeChange:function(){this.fireEvent("autoSizeChange")},setStyle:function(e){this.setSkinMapper(e)},getStyle:function(){return this.getSkinMapper()},getIsDisposed:function(){return this._isExterminated},isRendered:function(){return this._isRendered},getViewNode:function(){return this.$view},dispose:function(){this.exterminate()}})}),define.Class("core.components.base.traits.OldBaseCompLayoutIntegration",function(e){var t=e;t.utilize(["core.components.base.SizeLimits"]),t.statics({MINIMUM_X_DEFAULT:-2e3,MAXIMUM_X_DEFAULT:2e3,MINIMUM_Y_DEFAULT:-1e3,MAXIMUM_Y_DEFAULT:4e4,MINIMUM_WIDTH_DEFAULT:5,MINIMUM_HEIGHT_DEFAULT:5,MAXIMUM_WIDTH_DEFAULT:2500,MAXIMUM_HEIGHT_DEFAULT:2e3}),t.methods({initialize:function(e,t,n){this._actualHeight=-1,this._anchors=[],this._reverseAnchors=[],this.initComponentLayout()},initComponentLayout:function(){this.$view.setStyle("visibility","visible"),this.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout),this._valueFetchingRegex=/[-\d\.]+/;var e=["x","y","width","height"],t=!1;for(var n=0;n<e.length;n++){var r=e[n],i=this.$view.get(r);if(i!=null&&i!=""){t=!0,i=Number(i);switch(r){case"width":this.getRequestDimensions().width=i,this._setWidth_(i);break;case"height":this.getRequestDimensions().height=i,this._setHeight_(i);break;case"x":this.getRequestDimensions().left=i,this._setX_(i);break;case"y":this.getRequestDimensions().top=i,this._setY_(i)}}}if(t&&this.$view.hasAttribute("pos")===!1)this.$view.getStyle("position")!="relative"&&this.$view.setStyle("position","absolute");else{var s=this.$view.getAttribute("pos");s&&this.$view.setStyle("position",s)}this.saveCurrentDimensions(),this.saveCurrentCoordinates()},getMinPhysicalHeight:function(){return 1},saveCurrentDimensions:function(){this._lastDimensions={w:this.getWidth(),h:this.getHeight()}},getCurrentDimensions:function(){return this._lastDimensions={w:this.getWidth(),h:this.getHeight()},this._lastDimensions},getLastDimensions:function(){return this._lastDimensions||this.saveCurrentDimensions(),this._lastDimensions},getCurrentCoordinates:function(){return this._lastCoords={x:this.getX(),y:this.getY()},this._lastCoords},getLastCoordinates:function(){return this._lastCoords||this.saveCurrentCoordinates(),this._lastCoords},saveCurrentCoordinates:function(){this._lastCoords={x:this.getX(),y:this.getY()}},_onAutoSized:function(e){},getIsDisplayed:function(){return this.isDisplayed()},checkVisibility:function(){return this.isDisplayed()},getSizeLimits:function(){return this._sizeLimits===undefined&&(this._sizeLimits=new this.imports.SizeLimits,this._sizeLimits.minW=this._sizeLimits.minW||this.MINIMUM_WIDTH_DEFAULT,this._sizeLimits.minH=this._sizeLimits.minH||this.MINIMUM_HEIGHT_DEFAULT,this._sizeLimits.maxW=this._sizeLimits.maxW||this.MAXIMUM_WIDTH_DEFAULT,this._sizeLimits.maxH=this._sizeLimits.maxH||this.MAXIMUM_HEIGHT_DEFAULT,this._originalSizeLimits=this._sizeLimits.clone()),this._sizeLimits},setMinW:function(e){this.getSizeLimits().minW=e,this._originalSizeLimits.minW=e,this._applySizeLimitsIfNeeded()},setMinH:function(e){this.getSizeLimits().minH=e,this._originalSizeLimits.minH=e,this._applySizeLimitsIfNeeded()},setMaxW:function(e){this.getSizeLimits().maxW=e,this._originalSizeLimits.maxW=e,this._applySizeLimitsIfNeeded()},setMaxH:function(e){this.getSizeLimits().maxH=e,this._originalSizeLimits.maxH=e,this._applySizeLimitsIfNeeded()},_applySizeLimitsIfNeeded:function(){(this._$width<this.getSizeLimits().minW||this._$width>this.getSizeLimits().maxW)&&this.setWidth(this._$width),(this._$height<this.getSizeLimits().minH||this._$height>this.getSizeLimits().maxH)&&this.setHeight(this._$height)},_onResize:function(){this.fireEvent("resize")},flushPhysicalHeightCache:function(){delete this._actualHeight},flushMinPhysicalHeightCache:function(){delete this._minPhysicalHeight},getAnchors:function(){return this._anchors},setAnchors:function(e){this._areAnchorsAlreadySet=!0,this._anchors=e,e.forEach(this.addReverseAnchor)},addAnchor:function(e){this._anchors.push(e),this.addReverseAnchor(e)},addReverseAnchor:function(e){e.toComp===this?this._reverseAnchors.include(e):e.toComp.addReverseAnchor(e)},getReverseAnchors:function(){return this._reverseAnchors},getHorizontalGroup:function(){return this._horizontalGroup},setHorizontalGroup:function(e){this._horizontalGroup=e}})}),define.oldClass({name:"core.components.image.ImageDimensions",Class:{Static:{settingOptions:{crop:{FILL:"fill",FULL:"full",STRETCH:"stretch"},align:{LEFT:"left",CENTER:"center",RIGHT:"right"},v_align:{TOP:"top",MIDDLE:"middle",BOTTOM:"bottom"}}},initialize:function(){this._imageSettings={crop:this.settingOptions.crop.FILL,align:this.settingOptions.align.CENTER,v_align:this.settingOptions.v_align.MIDDLE}},getDimensionsForContainerSize:function(e,t){var n=this._getImageRequestSize(e,t),r=this._getImageObjectSize(n,t),i=this._getImageLeftPosition(r.x,t.x),s=this._getImageTopPosition(r.y,t.y);return{imageRequestSize:n,imageObjectSize:r,imageVisibleSize:{x:Math.min(t.x,n.x),y:Math.min(t.y,n.y)},imagePosition:{x:i,y:s}}},_getImageRequestSize:function(e,t){var n=e.x/e.y,r=t.x/t.y,i,s;switch(this._imageSettings.crop){case this.settingOptions.crop.FILL:case this.settingOptions.crop.STRETCH:n>r?(s=t.y,i=s*n):(i=t.x,s=i/n);break;case this.settingOptions.crop.FULL:n<r?(s=t.y,i=s*n):(i=t.x,s=i/n)}return{x:Math.ceil(i),y:Math.ceil(s)}},_getImageObjectSize:function(e,t){var n=e;return this._imageSettings.crop===this.settingOptions.crop.STRETCH&&(n=t),n},_getImageLeftPosition:function(e,t){var n;switch(this._imageSettings.align){case this.settingOptions.align.LEFT:n=0;break;case this.settingOptions.align.CENTER:n=t/2-e/2;break;case this.settingOptions.align.RIGHT:n=t-e}return Math.ceil(n)},_getImageTopPosition:function(e,t){var n;switch(this._imageSettings.v_align){case this.settingOptions.v_align.TOP:n=0;break;case this.settingOptions.v_align.MIDDLE:n=t/2-e/2;break;case this.settingOptions.v_align.BOTTOM:n=t-e}return Math.ceil(n)},getCropMode:function(){return this._imageSettings.crop},getHorizontalAlign:function(){return this._imageSettings.align},getVerticalAlign:function(){return this._imageSettings.v_align},setCropMode:function(e){return this._setSettingsProperty(this.settingOptions.crop,"crop",e)},setHorizontalAlign:function(e){return this._setSettingsProperty(this.settingOptions.align,"align",e)},setVerticalAlign:function(e){return this._setSettingsProperty(this.settingOptions.v_align,"v_align",e)},_setSettingsProperty:function(e,t,n){return this._imageSettings[t]===n||!this._isValueInObject(e,n)?!1:(this._imageSettings[t]=n,!0)},_isValueInObject:function(e,t){for(var n in e)if(e[n]===t)return!0;return!1}}}),define.Class("core.components.image.ImageDimensionsNew",function(e){var t=e;t.utilize(["core.components.image.ImageSettings"]),t.methods({initialize:function(){this.ImageSettings=this.imports.ImageSettings},getDimensionsForExactSize:function(e,t){return this._getImageDimensions(e,t,!0)},getDimensionsForPyramid:function(e,t){return this._getImageDimensions(e,t,!1)},_getImageDimensions:function(e,t,n){var r=t.x/t.y,i=this._getContainerSize(e,r),s=this._getWholeImageSize(e,r,i,n),o=this._getImagePosition(s,i,e);return{containerSize:i,imageSize:s,imagePosition:o}},_getContainerSize:function(e,t){var n=e.getCropMode(),r=Object.clone(e.getSize());return n===this.ImageSettings.CropModes.FIT_WIDTH?r.y=this._getHeightByWidth(r.x,t):n===this.ImageSettings.CropModes.FIT_HEIGHT&&(r.x=this._getWidthByHeight(r.y,t)),r},_getWholeImageSize:function(e,t,n,r){var i=n.x/n.y,s=Object.clone(n),o=e.getCropMode();if(o===this.ImageSettings.CropModes.CONTAINS)i>t?s.x=this._getWidthByHeight(n.y,t):s.y=this._getHeightByWidth(n.x,t);else if(o===this.ImageSettings.CropModes.STRETCH||!r&&o===this.ImageSettings.CropModes.COVER)i>t?s.y=this._getHeightByWidth(n.x,t):s.x=this._getWidthByHeight(n.y,t);return s},_getImagePosition:function(e,t,n){if(n.getCropMode()==this.ImageSettings.CropModes.STRETCH)return{x:0,y:0};var r={};return r.y=Math.ceil((t.y-e.y)/2),r.x=Math.ceil((t.x-e.x)/2),r},_getHeightByWidth:function(e,t){return Math.ceil(e/t)},_getWidthByHeight:function(e,t){return Math.ceil(e*t)}})}),define.component("core.components.image.ImageNew",function(e){var t=e;t.utilize(["core.components.image.ImageDimensionsNew","core.components.image.ImageUrlNew","core.components.image.ImageSettings"]),t.skinParts({image:{type:"htmlElement"}}),t.inherits("mobile.core.components.base.BaseComponent"),t.methods({initialize:function(e,t,n){this._initGlobalResources(),this.parent(e,t,n),this._useWebUrl=n.useWebUrl||!1,this._settings=n.settings,this._requestExactSize=typeof n.requestExactSize=="boolean"?n.requestExactSize:!0,this._imageDimensions=new this.imports.ImageDimensionsNew,this._imageSrcBuilder=new this.imports.ImageUrlNew,this._imageUrl="",this._isSameImage=!1},_initGlobalResources:function(){this._utils=this.injects().Utils},setSettings:function(e){if(!e)return;this._settings=e,this._renderIfReady()},_onDataChange:function(e,t,n){this._isSameImage=this._imageUrl===e.get("uri"),this._imageUrl=e.get("uri"),this.parent(e,t,n)},_prepareForRender:function(){return!this._settings||!this._imageUrl?!0:(this._refreshImage(),!0)},_refreshImage:function(){this._skinParts.image.set("alt",this._data.get("alt")),this._handleImageLoadingError();var e=this._getImageDimensions();this._setContainerSize(e.containerSize);var t=this._imageUrl;!this._useWebUrl&&!this._imageUrl.test(/(^https?)|(^data)/)&&(t=this._getImageSrc(e.imageSize,!this._isSameImage)),this._isSameImage=!0,this._setImageSrc(t);var n=this._settings.getCropMode()===this._settings.CropModes.STRETCH?e.containerSize:e.imageSize;this._setImagePositionAndSize(e.imagePosition,n)},_getImageDimensions:function(){var e=this._getOriginalSizeFromData(),t;return this._requestExactSize?t=this._imageDimensions.getDimensionsForExactSize(this._settings,e):t=this._imageDimensions.getDimensionsForPyramid(this._settings,e),t},_getImageSrc:function(e,t){var n;if(this._requestExactSize)n=this._imageSrcBuilder.getImageUrlExactSize(e,this._imageUrl,this._getOriginalSizeFromData());else{var r=t?this._imageSrcBuilder.getImageUrlFromPyramidFirstTime(e,this._imageUrl):this._imageSrcBuilder.getImageUrlFromPyramidForSameImage(e,this._imageUrl,this._pyramidRequestSize);n=r.url,this._pyramidRequestSize=r.pyramidRequestSize}return n},_getOriginalSizeFromData:function(){var e={};return e.x=parseInt(this._data.get("width"),10),e.y=parseInt(this._data.get("height"),10),!e.x&&!e.y&&(e.x=e.y=128),e},_setContainerSize:function(e){this._utils.isEquivalent(this._containerSize,e)||(this.getViewNode().setStyles({width:e.x+"px",height:e.y+"px"}),this._containerSize=e)},getSize:function(){return this._containerSize},_setImageSrc:function(e){this._imgSrc!=e&&(this._skinParts.image.set("src",e),this._imgSrc=e)},_setImagePositionAndSize:function(e,t){this._skinParts.image.setStyles({"margin-top":e.y+"px","margin-left":e.x+"px",width:t.x+"px",height:t.y+"px"})},_handleImageLoadingError:function(){this._skinParts.image.removeEvents("error"),this._skinParts.image.addEvent("error",function(){LOG.reportError(wixErrors.IMAGE_LOAD_ERROR,"ImageNew","refresh",this._imageUrl),this._renderIfReady()}.bind(this))}}),t.dataTypes(["Image",""])}),define.Class("core.components.image.ImageSettings",function(e){var t=e;t.statics({CropModes:{COVER:"fill",CONTAINS:"full",FIT_WIDTH:"fitWidth",FIT_HEIGHT:"fitHeight",STRETCH:"stretch"}}),t.methods({initialize:function(e,t,n){return this.setSettings(e,t,n)},setSettings:function(e,t,n){return this._validateSettings(e,t,n)?(this._cropMode=e,this._containerWidth=t,this._containerHeight=n,this):null},getCropMode:function(){return this._cropMode},getSize:function(){return{x:this._containerWidth,y:this._containerHeight}},setCropMode:function(e){this._validateSettings(e,this._containerWidth,this._containerHeight)&&(this._cropMode=e)},setSize:function(e,t){this._validateSettings(this._cropMode,e,t)&&(this._containerWidth=e,this._containerHeight=t)},setWidth:function(e){this._containerWidth=e},setHeight:function(e){this._containerHeight=e},setContainerHeight:function(e){this._validateSettings(this._cropMode,this._containerWidth,e)&&(this._containerHeight=e)},setContainerWidth:function(e){this._validateSettings(this._cropMode,e,this._containerHeight)&&(this._containerWidth=e)},_validateSettings:function(e,t,n){switch(e){case this.CropModes.FIT_WIDTH:return this._isValidNumber(t);case this.CropModes.FIT_HEIGHT:return this._isValidNumber(n);case this.CropModes.COVER:case this.CropModes.CONTAINS:case this.CropModes.STRETCH:return this._isValidNumber(n)&&this._isValidNumber(t);default:return!1}},_isValidNumber:function(e){return e&&typeof e=="number"&&!isNaN(e)&&e>0},_getErrorDescString:function(e,t,n){return"_cropMode: "+e+" width: "+t+" height: "+n}})}),define.oldClass({name:"core.components.image.ImageUrl",Class:{getImageUrlExactSize:function(e,t){var n=this.injects().Config.getMediaStaticUrl(t)+t,r=this._getFileExtension(n);return n+"_srz_"+parseInt(e.x,10)+"_"+parseInt(e.y,10)+"_85_22_0.50_1.20_0.00_"+r+"_srz"},getImageUrlFromPyramid:function(e,t,n,r){var i=this.injects().Config.getMediaStaticUrl(t)+t,s=e.y>e.x?e.y:e.x,o=this._getPyramidSize(s,n,r);return i=i+"_"+o,{url:i,pyramidRequestSize:o}},_getPyramidSize:function(e,t,n){var r=[128,256,400,512,650,850,1024],i=r[r.length-1];for(var s=0;s<r.length;++s)if(r[s]>=e){i=r[s];break}return t&&(i=Math.max(i,n)||i),i},_getFileExtension:function(e){var t=/[.]([^.]+)$/.exec(e);return t&&/[.]([^.]+)$/.exec(e)[1]||""}}}),define.Class("core.components.image.ImageUrlNew",function(e){var t=e;t.methods({initialize:function(){this._initGlobalResources()},_initGlobalResources:function(){this._config=this.injects().Config},getImageUrlExactSize:function(e,t,n){var r=this._config.getMediaStaticUrl(t)+t,i=this._getFileExtension(r),s=[r];s.push("srz");var o=this._getRequestSizeSmallerThanOriginal(e,n);return s.push(parseInt(o.x,10)),s.push(parseInt(o.y,10)),s.push("75_22_0.50_1.20_0.00"),s.push(i),s.push("srz"),s.join("_")},getImageUrlFromPyramidFirstTime:function(e,t){return this._getUrlForPyramid(e,t)},getImageUrlFromPyramidForSameImage:function(e,t,n){return this._getUrlForPyramid(e,t,!0,n)},_getRequestSizeSmallerThanOriginal:function(e,t){var n=t.x/e.x,r=t.y/e.y;if(n>=1&&r>=1)return e;var i={};return n<r?(i.x=t.x,i.y=t.x*(e.y/e.x)):(i.y=t.y,i.x=t.y*(e.x/e.y)),i},_getUrlForPyramid:function(e,t,n,r){var i=this._config.getMediaStaticUrl(t)+t,s=e.y>e.x?e.y:e.x,o=this._getPyramidSize(s,n,r);return i=i+"_"+o,{url:i,pyramidRequestSize:o}},_getPyramidSize:function(e,t,n){var r=[128,256,400,512,650,850,1024],i=r[r.length-1],s;for(s=0;s<r.length;++s)if(r[s]>=e){i=r[s];break}return t&&(i=Math.max(i,n)||i),i},_getFileExtension:function(e){var t=/[.]([^.]+)$/.exec(e);return t&&/[.]([^.]+)$/.exec(e)[1]||""}})}),define.oldClass({name:"",Class:{}}),define.oldTrait({name:"core.components.traits.InputFieldEvents",trait:{_bindInputToDataField:function(e,t,n,r){this._boundFields=this._boundFields||[],this._inputEventHandlersMap=this._inputEventHandlersMap||{};if(this._boundFields.indexOf(e)==-1){var i=this,s=function(s){var o=window["debugMode"]=="unit_test"&&!s.code;if(o||!W.Utils.isInputKey(s.code))return;var u=i._inputEventHandlersMap[t];if(u._skinNextInputChange){u._skinNextInputChange=!1;return}var a=i._data,f=i.injects().Utils.convertToHtmlText(e.get("value"));if(a.get(t)==f)return;var l=e.get("text")||e.value||"";if(r!==undefined&&l.length>r){e.set("value",a.get(t));return}a.set(t,f),n&&a.setMeta("isPreset",!1)};if(this._inputEventHandlersMap[t]){var o=this._inputEventHandlersMap[t];this._stopListeningToInput(o.inputElement,o.changeEventHandler)}this._inputEventHandlersMap[t]={inputElement:e,eventHandler:s},this._boundFields.push(e),this._selectPresetFieldContent(e,t),this._listenToInput(e,s)}},_skinNextInputChange:function(e){this._inputEventHandlersMap[e]._skinNextInputChange=!0},_selectPresetFieldContent:function(e){e.addEvent("click",function(t){this._data.getMeta("isPreset")&&(e.get("isSelected")||(e.set("isSelected","true"),e.select()))}.bind(this)),e.addEvent("blur",function(){e.set("isSelected","")})},_listenToInput:function(e,t){e.addEvent("keyup",t),e.addEvent("cut",t),e.addEvent("paste",t),e.addEvent("change",t),e.addEvent("click",t)},_stopListeningToInput:function(e,t){e.removeEvent("keyup",t),e.removeEvent("cut",t),e.removeEvent("paste",t),e.removeEvent("change",t),e.removeEvent("click",t)}}}),define.oldTrait({name:"core.components.traits.SwipeSupport",trait:{Binds:["_onTouchDown","_onTouchMove","_onTouchUp"],_swipeMovementSpeedProp:"_movementSpeed",_swipeOrientation:"horizontal",_swipeEmulate:!1,_swipeLastPos:[],_swipeActive:!1,_swipeFrameCount:0,_touchSupported:!1,initialize:function(){this._touchSupported="ontouchend"in document||this._swipeEmulate,this._touchSupported&&(this.addEvent(Constants.ComponentEvents.READY,this._onComponentReady),this._view.addEvent(this._swipeEmulate?"mousedown":"touchstart",this._onTouchDown,!0),this._Tween=this.injects().Utils.Tween)},_onComponentReady:function(){this._skinParts.swipeLeftHitArea.setStyle("display","none"),this._skinParts.swipeRightHitArea.setStyle("display","none")},_onTouchDown:function(e){this._view.addEvent(this._swipeEmulate?"mousemove":"touchmove",this._onTouchMove,!0),this._view.addEvent(this._swipeEmulate?"mouseup":"touchend",this._onTouchUp,!0),this._swipeLastPos=[{x:e.client.x,y:e.client.y,time:(new Date).getTime()}],this._swipeActive=!0,this._swipeFrameCount=0,this._enableMovement(!0)},_setSwipeMovementSpeed:function(e){this[this._swipeMovementSpeedProp]=e},_addLastPos:function(e){this._swipeLastPos.unshift(e),this._swipeLastPos.length>5&&this._swipeLastPos.pop()},_onTouchMove:function(e){e.preventDefault();var t={x:e.client.x,y:e.client.y,time:(new Date).getTime()},n=this._getSwipeDistance(t,this._swipeLastPos[0]);this._shiftOffset-=n,this._Tween.to(this,1,{_shiftOffset:this._shiftOffset-n,ease:"strong_easeInOut"}),this._addLastPos(t)},_onTouchUp:function(e){var t={x:e.client.x,y:e.client.y,time:(new Date).getTime()};t=this._swipeLastPos[0],this._view.removeEvent(this._swipeEmulate?"mouseup":"touchend",this._onTouchUp,!0),this._view.removeEvent(this._swipeEmulate?"mousemove":"touchmove",this._onTouchMove,!0);var n=this._calculateSwipeSpeed(this._swipeLastPos[this._swipeLastPos.length-1],t);this._Tween.killTweensOf(this),this._setSwipeMovementSpeed(-n*20);var r={ease:"linear",onComplete:function(){this._enableMovement(!1)}.bind(this)};r[this._swipeMovementSpeedProp]=0,this._Tween.to(this,1,r)},_getSwipeDistance:function(e,t){if(this._swipeOrientation=="horizontal")return t.x-e.x;if(this._swipeOrientation=="vertical")return t.y-e.y},_calculateSwipeSpeed:function(e,t){return this._getSwipeDistance(e,t)/(t.time-e.time)}}}),define.oldTrait({name:"core.components.traits.TouchRollOverSupport",trait:{Binds:["_onComponentTouchStart","_onStageTouchStart","_onRender","_onComponentReady"],initialize:function(){this._touchSupported="ontouchend"in document||this._swipeEmulate,this._touchSupported&&(this._states.touchRollOverSupport=["touchRollOver","touchRollOut"],this.addEvent(Constants.ComponentEvents.READY,this._onComponentReady),this.addEvent(Constants.ComponentEvents.RENDER,this._onRender))},_onComponentReady:function(){this.setState("touchRollOut")},_onRender:function(){this._view.addEvent("touchstart",this._onComponentTouchStart),document.addEvent("touchstart",this._onStageTouchStart)},_onComponentTouchStart:function(e){this.getState().indexOf("touchRollOut")!==-1&&(e.preventDefault(),e.stopPropagation(),this.setState("touchRollOver"))},_onStageTouchStart:function(e){this.getState().indexOf("touchRollOver")!==-1&&e.target.getParents().indexOf(this._view)===-1&&e.target!==this._view&&this.setState("touchRollOut")},dispose:function(){document.removeEvent("touchstart",this._onStageTouchStart),this.parent()}}}),define.experiment.component("core.components.Image.GIFFix.New",function(e){var t=e;t.methods({_getImageFullUrl:function(e,t){var n=this._uri;this._uri=this._data.get("uri"),t.isSameImage=n===this._uri;var r=this._uri,i=this._uri.test(/(^https?)|(^data)/);if(this._useWebUrl||i)r=r;else if(this._isGIF())r=this._imageUrl.getImageUrlExactSize(this._getOriginalSizeFromData(),this._uri);else if(this._requestExactSize)r=this._imageUrl.getImageUrlExactSize(e,this._uri);else{var s=this._imageUrl.getImageUrlFromPyramid(e,this._uri,t.isSameImage,this._pyramidRequestSize);r=s.url,t.isSameImageWithBiggerPyramidSize=t.isSameImage&&s.pyramidRequestSize>this._pyramidRequestSize,this._pyramidRequestSize=s.pyramidRequestSize}return r},_isGIF:function(){return this._data.get("uri").test(/(\.gif$)/)},_getOriginalSizeFromData:function(){return{x:this._data.get("width"),y:this._data.get("height")}}})}),define.experiment.component("core.components.MenuButton.WixAppsPage.New",function(e,t){var n=e,r=t;n.skinParts({label:{type:"htmlElement"},icon:{type:"htmlElement",optional:!0},description:{type:"htmlElement",optional:!0},bullet:{type:"htmlElement",optional:!0}}),n.methods({_getButtonLabelTextField:function(){return this._data.getType().contains("Page")?"title":"text"}})}),define.experiment.component("core.components.Page.GridLines.New",function(e,t){var n=e,r=t;n.statics({MAX_HEIGHT:6e4}),n.methods({initialize:function(e,t,n){this.parent(e,t,n),this._isContentWixified=!1,this._isContentWixifyStarted=!1,this._wixifyCBList=[],this._contentReady=!1,this.setMaxH(this.MAX_HEIGHT),t.collapse(),this.resources.W.Viewer.addEvent("pageTransitionEnded",this._notifyPageComponentsOnPageVisibilityChange)},getPageMinHeight:function(){var e=this.getMinHeight();return e?e:500},render:function(){this.setMinH(this.getPageMinHeight()),this.parent(),this._fixSkinsWith20pxBottom()},_fixSkinsWith20pxBottom:function(){this._isPageSkinUsedToBeWith20pxBottom()&&this.getPaddingBottom()===undefined&&this.setPaddingBottom(20)},_isPageSkinUsedToBeWith20pxBottom:function(){var e=["wysiwyg.viewer.skins.page.BasicPageSkin","wysiwyg.viewer.skins.page.BorderPageSkin","wysiwyg.viewer.skins.page.LiftedBottomPageSkin","wysiwyg.viewer.skins.page.LiftedShadowPageSkin","wysiwyg.viewer.skins.page.LiftedTopPageSkin","wysiwyg.viewer.skins.page.ShinyIPageSkin"];return e.contains(this.getSkin().className)}})}),define.experiment.component("core.components.Page.JITPageLoader.New",function(e,t){var n=e,r=t;n.methods({initialize:r.after(function(e,t,n){t.setStyle("position","absolute").setStyle("top","0px").setStyle("left","0px")}),wixifyContent:function(e){e&&this._wixifyCBList.push(e);var t=this._view.getAttribute("id");W.Pages.isPageLoaded(t)?this._oldWixifyContent():W.Pages.loadPageById(t,this._oldWixifyContent.bind(this),this)},_oldWixifyContent:function(){if(this._isContentWixified){this._setWixified();return}if(this._isContentWixifyStarted)return;this._isContentWixifyStarted=!0;var e=this._view.getElements("[comp]");if(e.length===0){this._setWixified(),this.listenForContentRendered();return}var t=new Async.Bulk(e,null,{completeEvent:"wixified",completeCallback:function(){this._setWixified()}.bind(this)});this.listenForContentRendered(),e.wixify()}})}),define.experiment.component("core.components.image.ImageNew.GIFfix.New",function(e){var t=e;t.methods({_refreshImage:function(){this._skinParts.image.set("alt",this._data.get("alt")),this._handleImageLoadingError();var e=this._getImageDimensions();this._setContainerSize(e.containerSize);var t=this._imageUrl;this._isGIF()?t=this._getImageSrc(this._getOriginalSizeFromData()):this._useWebUrl||this._imageUrl.test(/(^https?)|(^data)/)||this._isGIF()||(t=this._getImageSrc(e.imageSize,!this._isSameImage)),this._isSameImage=!0,this._setImageSrc(t);var n=this._settings.getCropMode()===this._settings.CropModes.STRETCH?e.containerSize:e.imageSize;this._setImagePositionAndSize(e.imagePosition,n)},_getImageDimensions:function(){var e=this._getOriginalSizeFromData(),t;return this._requestExactSize&&!this._isGIF()?t=this._imageDimensions.getDimensionsForExactSize(this._settings,e):t=this._imageDimensions.getDimensionsForPyramid(this._settings,e),t},_isGIF:function(){return this._imageUrl.test(/(\.gif$)/)}})}),define.experiment.component("core.editor.components.UploadButton.NativeUploadButton.New",function(e,t){var n=e,r=t;n.utilize(["core.editor.managers.uploadmanager.DragAndDrop","core.editor.managers.uploadmanager.Uploader"]),window.$Uploader=null,n.resources(["W.Config","mode"]),n.methods({initialize:function(e,t,n){this.parent(e,t,n),this.scriptsRoot=W.Config.getServiceTopologyProperty("scriptsRoot"),this.mediaServerRoot=W.Config.getServiceTopologyProperty("mediaServerRoot");if(this.imports.Uploader.isAllApiExists()){var r=window.location.host.split(".").shift();r="editor",this.baseUrl="//"+r+"."+this.mediaServerRoot,this.baseStaticUrl="//0.static."+this.mediaServerRoot,Object.append(this,this.nativeUploader)}else Object.append(this,this.fleshUploader)},fleshUploader:{render:function(){this._flashLocation=W.Config.getServiceTopologyProperty("scriptsRoot")+"/flash/MediaUploader.swf";var e={},t={};t.quality="high",t.bgcolor="#FAFAFA",t.allowscriptaccess="always",t.allowfullscreen="true",t.wMode="window",t.scale="noScale",t.flashVars="serverRoot="+this.injects().Config.getServiceTopologyProperty("mediaServerRoot");var n={};n.id="UploadBTN",n.name="UploadBTN",n.align="middle",this._flashObjID=W.Utils.getUniqueId("UploadBTNFlashCont"),this._skinParts.flashContainer.setProperty("id",this._flashObjID),this._flashObj=swfobject.embedSWF(this._flashLocation,this._flashObjID,141,30,"10.0.0","playerProductInstall.swf",e,t,n)},setUploadFileType:function(e){this._message="setFileType",this._content=e,setTimeout(this._doCallFlash.bind(this),1)},_doCallFlash:function(){var e=this._getFlashObj("UploadBTN");e&&e.sendToFlash?e.sendToFlash(this._message,this._content):setTimeout(this._doCallFlash.bind(this),1)},_getFlashObj:function(e){var t=navigator.appName.indexOf("Microsoft")!=-1;return t?window[e]:document[e]}},nativeUploader:{_onAllSkinPartsReady:function(){this.uploader=window.$Uploader||new this.imports.Uploader({addQueryParam:function(){return"&s="+this.context._content.mediaS},ticketUrl:this.baseUrl+"/media/tickets/get",uploadUrl:this.baseStaticUrl+"/api/add_file",getValidationRules:function(){return this.context._content||{}},parallelUploads:6,events:{onInit:function(){},onUploadStart:function(){},onSelectedFiles:function(){var e=document.createElement("ul");this.inQ.forEach(this.context._attachProgressNode.bind(this.context,e));var t=this.badFiles.filter(function(e){return e.$validation_errors_displayed?!1:e.$validation_errors_displayed=!0});t.length&&(t.forEach(this.context._attachErrorNode.bind(this.context,e)),this.context.injects().UserMedia.fireEvent("UploadError","<>"+this.context._createErrorMessage(t))),this.progressOutputNode&&this.progressOutputNode.appendChild(e)},onUploadProgress:function(e,t){var n,r,i=0,s=this.inProgress.indexOf(e),o=s!==-1?e:{};o.uploadprogress=~~(t.loaded/t.total*100),o&&o.getNode&&(r=o.getNode(),r.querySelector(".uploader-progress-bar").innerHTML=o.uploadprogress+"%"),n=this.inQ.concat(this.inProgress,this.done),n.forEach(function(e){i+=e.uploadprogress||0}),i/=n.length,this.context.injects().UserMedia.fireEvent("UploadProgressUpdate",i)},onFileUploaded:function(e,t){e.uploadResponse=this.context._parseMediaResponseXML(t.responseXML);var n=e.getNode();n.style.background="rgba(0,255,0,0.2)"},onUploadEnd:function(){function e(e){var t=e.getNode();setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t),delete e.getNode},1500),this.context.resources.mode.debug&&this.history.push(e)}this.done.forEach(e,this),this.context._finleizeUpload(this.done),this.done.length=0},onUploadError:function(e){this.context.injects().UserMedia.fireEvent("UploadError",'<><ul class="uploader-error-message"><li>'+e+"</li></ul>")}}}),window.Uploader=this.uploader,this.uploader.context=this,this.uploader.progressOutputNode=this._createUploadStatusNode(),this._skinParts.flashContainer.appendChild(this.uploader.progressOutputNode),this._skinParts.flashContainer.appendChild(this.uploader.uploadButton)},setUploadFileType:function(e){this._content=e,this.uploader.uploadButton.setTitle(e.label)},_createUploadStatusNode:function(){var e=document.createElement("div");e.innerHTML='<div>Debug Upload Status <button data-action="close">X</button></div>',e.onclick=function(e){e.target.getAttribute("data-action")==="close"&&this.parentNode&&this.parentNode.removeChild(this)},e.className="uploader-status-updater",e.id="uploader-status-updater-view";var t="background:rgba(255,255,255,0.8);text-align:left;padding:10px;overflow:auto;max-height:600px;position:fixed;z-index:100000000000;top:36px;right:0;display:none";return this.resources.mode.debug&&(t+="display:block"),e.style.cssText=t,e},_createErrorMessage:function(e){var t=e.map(function(e){return e.$validation_errors?"<li>"+e.name+"<br>"+e.$validation_errors.join("<br>")+"</li>":"<li>"+e.name+"<br> invalid file </li>"});return'<ul class="uploader-error-message">'+t.join("<br>")+"</ul>"},_attachProgressNode:function(e,t){if(t.getNode)return;var n=document.createElement("li");n.style.padding="5px",n.style.background="hsla(200,100%,50%,0.2)";var r="<span>File Name: "+t.name+"</span><span>Size: "+t.size+'</span><div class="uploader-progress-bar">0%<div>';n.innerHTML=r,t.getNode=function(){return n},e.appendChild(n)},_attachErrorNode:function(e,t){if(t.getNode)return;var n=document.createElement("li");n.style.background="hsla(0,100%,50%,0.2)",n.style.padding="5px";var r="Error: <br>"+this._createErrorMessage([t]);n.innerHTML=r,t.getNode=function(){return n},e.appendChild(n),setTimeout(function(){delete t.getNode,n.parentNode&&n.parentNode.removeChild(n)},1e4)},_finleizeUpload:function(e){var t=this,n=this._createMediaAddRequsetXML(e,this._content.wixType.replace("media","picture"),this._content.compType),r=new XMLHttpRequest;r.onload=function(e){W.UserMedia.updateMedia(t._content.wixType)},r.onerror=function(e){t.injects().UserMedia.fireEvent("UploadError",'<><ul class="uploader-error-message"><li>Upload Error</li></ul>')},r.open("POST",this.baseUrl+"/media/private/add"),r.withCredentials="true",r.setRequestHeader("Content-Type","application/xml"),r.send(n)},_createMediaAddRequsetXML:function(e,t,n){var r,i,s="<mediaItemList>";for(var o=0;o<e.length;o++)r=e[o].uploadResponse,s+="<mediaItem",s+=' mediaType="'+t,s+='" componentType="'+n,s+='" fileName="'+r.fileName,s+='" originalFileName="'+r.originalName,s+='" fileSize="'+r.fileSize,s+='" width="'+(r.width||""),s+='" height="'+(r.height||""),s+='" mimeType="'+r.mimeType,s+='" iconURL="'+r.iconUrl,s+='" version="'+r.ver,s+='" />\n';return s+="</mediaItemList>",s},_parseMediaResponseXML:function(e){var t,n;e?(t=e.querySelector("upload"),n=t.getAttribute("success")):(t={getAttribute:function(){return"No Response Error"}},n=!1);if(n==="true"){var r=e.querySelector("properties"),i=e.querySelector("sys_meta");return{status:t.getAttribute("errorDescription"),originalName:i.getAttribute("original_file"),mimeType:i.getAttribute("mime_type"),fileUrl:i.getAttribute("file_url"),iconUrl:i.getAttribute("icon_url"),fileSize:i.getAttribute("file_size"),width:i.getAttribute("width"),height:i.getAttribute("height"),ver:i.getAttribute("ver"),fileName:r.getAttribute("file_name")}}return{status:"error",origin:t.getAttribute("origin"),errorCode:t.getAttribute("errorCode"),errorDescription:t.getAttribute("errorDescription")}}},render:function(){},_doCallFlash:undefined,_getFlashObj:undefined,setUploadFileType:undefined})}),define.experiment.component("core.editor.components.dialogs.DialogWindow.Aviary.New",function(e,t){var n=e,r=t;n.methods({openDialog:r.after(function(e){this.fireEvent("dialogOpened",{dialog:this})}),setCloseCallBack:function(e){this._closeCallBack=e},endDialog:function(e){this.fireEvent("onDialogClosing",{result:e}),this.closeDialog()},_onButtonClicked:function(e){var t=this._buttonsMap[e];if(!t||t&&t.getLogic&&t.getLogic().isEnabled()){var n=!0;this._closeCallBack&&this._closeCallBack({result:e})===!1&&(n=!1),n&&this.endDialog(e)}}})}),define.experiment.component("core.editor.components.dialogs.DialogWindow.RemoveStopPropogation.New",function(e,t){var n=e,r=t;n.methods({setDialogOptions:function(e,t){e=e||{},e.eventData&&LOG.reportError("Someone called DialogWindow with deprecated param eventData, please use top and left instead","core.editor.components.dialogs.DialogWindow","setDialogOptions"),this._optionsReadyCallback=t,this._setOptions(e),this._modalMode=e.nonModal&&Constants.DialogWindow.TYPES.NON_MODAL||e.semiModal&&Constants.DialogWindow.TYPES.SEMI_MODAL||e.transparentModal&&Constants.DialogWindow.TYPES.TRANSPARENT_MODAL||Constants.DialogWindow.TYPES.MODAL,this._allowDrag=e.allowDrag,this.setTitle(e.title),this.setDescription(e.description),this.setHelpLink(e.helplet,!0),this.setHelpButton(e.helpButtonId),this.setWidth(this._width),this.setMaxMinHeight(this._maxHeight,this._minHeight),this._setDialogHeightRelativeToWindowHeight(),this._enableDrag(),window.addEvent(Constants.CoreEvents.RESIZE,this._enableDrag),Browser.safari?setTimeout(function(){this._setupButtons(e.buttonSet||W.EditorDialogs.DialogButtonSet.OK)}.bind(this),120):this._setupButtons(e.buttonSet||W.EditorDialogs.DialogButtonSet.OK),this.setState(this._modalMode),this._modalMode!==Constants.DialogWindow.TYPES.NON_MODAL&&(this.injects().Editor.disableEditCommands(),this._view.addEvent(Constants.CoreEvents.MOUSE_DOWN,function(e){e.stopPropagation()})),this._skinParts.blockLayer.addEvent(Constants.CoreEvents.CLICK,this._closeOnOutsideClick),this._skinParts.dialogToolbar.setCollapsed(!e.showToolbar),this._skinParts.tabs.setCollapsed(!e.tabs),this._checkDialogOptionsSet()}})}),define.experiment.Class("core.editor.managers.editormanager.EditorManagerBase.FirstSave.New",function(e,t){var n=e,r=t;n.statics({MILLISECONDS_TO_POP_UP_AUTO_FIRST_SAVE:12e5})}),define.experiment.Class("mobile.core.components.base.BaseComponent.GridLines.New",function(e,t){var n=e;n.methods({initComponentLayout:function(){this._view.setStyle("visibility","visible"),this.removeEvent(Constants.ComponentEvents.READY_FOR_RENDER,this.initComponentLayout),this._valueFetchingRegex=/[-\d\.]+/;var e=["x","y","width","height","paddingBottom","minHeight"],t=!1;for(var n=0;n<e.length;n++){var r=e[n],i=this._view.get(r);if(i!=null&&i!=""){t=!0;var s="set"+r.capitalize();this[s](i,!0)}}this._layoutInitialized=!0;if(t&&this._view.hasAttribute("pos")===!1)this._view.getStyle("position")!="relative"&&this._view.setStyle("position","absolute");else{var o=this._view.getAttribute("pos");o&&this._view.setStyle("position",o)}this.saveCurrentDimensions(),this.saveCurrentCoordinates()},getPaddingBottom:function(){return this._$paddingBottom},getMinHeight:function(){return this._$minHeight},setPaddingBottom:function(e){if(this._$paddingBottom!=parseInt(e,10))return isNaN(parseInt(e,10))?(W.Utils.debugTrace("WbaseComp","setPaddingBottom","NaN passed as value"),!1):(this._$paddingBottom=parseInt(e,10),!0)},setMinHeight:function(e){if(this._$minHeight!=parseInt(e,10))return isNaN(parseInt(e,10))?(W.Utils.debugTrace("WbaseComp","setMinHeight","NaN passed as value"),!1):(this._$minHeight=parseInt(e,10),!0)},getSizeLimits:function(){return this._sizeLimits===undefined&&(this._sizeLimits=new this.imports.SizeLimits,this._sizeLimits.minW=this._sizeLimits.minW||this.MINIMUM_WIDTH_DEFAULT,this._sizeLimits.minH=this._sizeLimits.minH||this.MINIMUM_HEIGHT_DEFAULT,this._sizeLimits.maxW=this._sizeLimits.maxW||this.MAXIMUM_WIDTH_DEFAULT,this._sizeLimits.maxH=this._sizeLimits.maxH||this.MAXIMUM_HEIGHT_DEFAULT,this._originalSizeLimits=this._sizeLimits.clone()),this._$minHeight&&(this._sizeLimits.minH=this._$minHeight),this._sizeLimits}})}),define.experiment.Class("core.managers.component.ComponentManager.SyncWixify.New",function(e,t){var n=e;n.methods({getComponent:function(e,t){e=this.getNameOverride(e);if(this._componentMap[e])return t&&t(this._componentMap[e]),this._componentMap[e];var n=this.define.getDefinition("component"),r=nsUtil.getNameSpace(n,e),i=this._componentQue.hasQueue(e)===!1;return this._componentQue.add(e,t),i&&(r?this.registerNewComponent(e,r):this._classManager.getClass(e,function(){})),null}})}),define.experiment.Class("core.managers.ConfigurationManager.MobileFixes.New",function(e,t){var n=e,r=t;n.utilize(["core.managers.configuration.MobileConfigurationManager"]),n.methods({initialize:function(){this.mobileConfig=new this.imports.MobileConfigurationManager}})}),define.experiment.newClass("core.managers.configuration.MobileConfigurationManager.MobileFixes.New",function(e,t){var n=e,r=t;n.statics({MOBILE_MAX_WIDTH:600,TABLET_MAX_WIDTH:1100}),n.methods({_getScreenWidth:function(){var e=this._isAppleMobileDevice();return e?screen.width:screen.width/window.devicePixelRatio},_isAppleMobileDevice:function(){return/iphone|ipod|ipad/i.test(navigator.userAgent.toLowerCase())},isAndroidMobileDevice:function(){return/android/i.test(navigator.userAgent.toLowerCase())},isMobile:function(){if(typeof this._isMobile=="boolean")return this._isMobile;var e=this._getScreenWidth();return this._isMobile=e<this.MOBILE_MAX_WIDTH&&this.isTouchScreen(),this._isMobile},isTablet:function(){if(typeof this._isTablet=="boolean")return this._isTablet;var e=this._getScreenWidth();return this._isTablet=e>=this.MOBILE_MAX_WIDTH&&e<this.TABLET_MAX_WIDTH&&this.isTouchScreen(),this._isTablet},isMobileOrTablet:function(){return this.isMobile()||this.isTablet()},isTouchScreen:function(){return this._isTouch=this._isTouch||Modernizr.touch,this._isTouch}})}),define.experiment.Class("core.managers.css.CssManager.RichTextViewer.New",function(e,t){var n=e,r=t;n.methods({_updateThemeGlobalCssByPropertyName:function(e,t){var n=this.getThemeGlobalPropertyCssRules(e,t);n.forEach(function(e){this._themeStyleSheet.updateRule(e.selector,e.rules)},this);if(t=="font"){var r=this._themeManager.getProperty(e).getFontFamily(),i=this.getFontType(r);i=="custom"&&this.loadFont(r)}},getThemeGlobalPropertyCssRules:function(e,t,n){t=t||this._themeManager.getPropertyType(e);var r=this._themeManager.getProperty(e),i=[];switch(t){case"font":var s="."+e,o="";n?o="font: "+r.getCssValue():o=r.getCssRule(),i.push({selector:s,rules:o});break;case"color":var u="."+e,a="color:"+r.getHex(!1),f=".back"+e,l="background-color:"+r.getHex(!1);i.push({selector:u,rules:a}),i.push({selector:f,rules:l})}return i},getCustomUsedFontsUrl:function(){return!this._readyFonts||Object.keys(this._readyFonts).length==0?null:{missingFontsNames:this._readyFonts,missingFontsUrl:this._getFontsUrl(this._readyFonts)}},getFontUrl:function(e){if(this._customFontsNames.indexOf(e)<0)return null;var t={};return t[e]=1,this._getFontsUrl(t)},_getFontsUrl:function(e){return this.FONT_SERVICE_URL+this._getFontsQuery(e)},_loadFonts:function(){delete this._fontLoadCallLater;var e=this._getFontsUrl(this._loadedFonts);for(var t in this._loadedFonts)this._readyFonts[t]=t,delete this._loadedFonts[t];this._addFontsLoaderCssTag(e)}})}),define.experiment.Class("core.managers.css.CssManager.Staff.Wix",function(e){var t=e;t.methods({_configureSystemFonts:function(){Constants.CSS.SYSTEM_FONTS["sans-serif"].push(["Helvetica Neue"]),Constants.CSS.SYSTEM_FONTS["sans-serif"].push(["Helvetica Neue Italic"]),Constants.CSS.SYSTEM_FONTS["sans-serif"].push(["Helvetica Neue Thin"]),Constants.CSS.SYSTEM_FONTS["sans-serif"].push(["Helvetica Neue Medium"]),this._systemFontsCssDefinition={},this._systemFontsNames=[];var e=this.getHelveticaCssUrl();e&&this._addFontsLoaderCssTag(e);for(var t in Constants.CSS.SYSTEM_FONTS){var n=Constants.CSS.SYSTEM_FONTS[t];for(var r=0;r<n.length;++r){var i=n[r],s=typeOf(i)=="array"?i[0]:i;this._systemFontsNames.push(s);var o=typeOf(i)=="array"?i.concat().reverse():[i];o.push(t),this._addQuoteToArrayElementsIfContainSpaces(o),this._systemFontsCssDefinition[s]=o.join(",")}}}})}),define.experiment.Class("core.managers.data.DataItemBase.StylePerComponent.New",function(e,t){var n=e;n.methods({markDataAsClean:function(){var e=this.get("id");this._dataManager.clearDirtyObject(e)}})}),define.experiment.Class("core.managers.data.DataItemBase.SyncWixify.New",function(e,t){var n=e;n.methods({isReady:function(){return!0}})}),define.experiment.Class("core.managers.data.DataItemWithSchema.Dirtify.New",function(e,t){var n=e;n.methods({_isDirty:function(){var e=this._data.id,t=this._dataManager.getDirtyDataObjectsMap();return!!t[e]},_markObjectAsDirtyById:function(e){this._dataManager.getDataByQuery(e,function(e){e.markDataAsDirty()})},_markChildrenAsDirty:function(){for(key in this._schema){var e=this._data[key];if(this._schema[key]==="ref"&&e){var t=e;this._markObjectAsDirtyById(t)}else if(this._schema[key]==="refList"&&e){var n=e;n.forEach(function(e){this._markObjectAsDirtyById(e)},this)}}},markDataAsDirty:function(){this.getMeta("isPersistent")!==!1&&!this._isDirty()&&(this._dataManager.markDirtyObject(this),this._markChildrenAsDirty(),this._dataManager.flagDataChange())}})}),define.experiment.Class("core.managers.data.DataItemWithSchema.SyncWixify.New",function(e,t){var n=e;n.methods({isReady:function(){if(this._isReady)return!0;var e=this.getWaitingForReadyList();return e.length>0?this._isReady=!1:this._isReady=!0,this._isReady},getWaitingForReadyList:function(){var e=[],t=this.getData(),n=this.getDataManager();for(var r in t){var i=this.getFieldType(r),s,o;if(i=="ref")s=this.get(r),o=n.isDataAvailable(s),o||e.push(s);else if(i=="refList"){var u=this.get(r);for(var a=0;a<u.length;a++)s=u[a],o=n.isDataAvailable(s),o||e.push(s)}}return e}})}),define.experiment.Class("core.managers.data.DataManager.StylePerComponent.New",function(e,t){var n=e;n.methods({clearDirtyObject:function(e){delete this.dirtyDataObjectsMap[e]}})}),define.experiment.Class("core.managers.data.DataManager.SyncWixify.New",function(e,t){var n=e,r=t;n.methods({initialize:r.after(function(){this._notReadyDataMap={},this._waitingForReadyDataMap={}}),addDataItem:function(e,t){var n=this.createDataItem(t);n._data.id=e,this.markDirtyObject(n);var r=n.isReady();return r?this._setDataReady(n):this._addToWaitingForReady(n),n},_addToWaitingForReady:function(e){var t=e.get("id");this._notReadyDataMap[t]=e;var n=e.getWaitingForReadyList();for(var r=0;r<n.length;r++){var i=n[r];i.indexOf("#")===0&&(i=i.substr(1)),this._waitingForReadyDataMap[i]||(this._waitingForReadyDataMap[i]=[]),this._waitingForReadyDataMap[i].push(t)}},_setDataReady:function(e){var t=e.get("id");this.dataMap[t]=e,this._runCallbacks(t,e),this._updateDataWaitingList(e),this._notReadyDataMap[t]&&delete this._notReadyDataMap[t]},_updateDataWaitingList:function(e){var t=e.get("id"),n=this._waitingForReadyDataMap[t];if(n){delete this._waitingForReadyDataMap[t];for(var r=0;r<n.length;r++){var i=this._notReadyDataMap[n[r]];i&&i.isReady()&&this._setDataReady(i)}}},getDataByQuery:function(e,t){var n=null;if(e.indexOf("#")===0){var r=e.substr(1);n=this.dataMap[r],t=t||function(){};if(!!n)return t(n),n;this.callbackQueue.add(r,t);var i=this.define.getDefinition(this.DEFINE_NAMESPACE),s=nsUtil.getNameSpace(i,r);if(s)return this.addDataItem(r,s)}else LOG.reportError(wixErrors.DM_MALFORMED_QUERY,"DataManager","getDataByQuery",e),W.Utils.callLater(t,[null])},isReady:function(){return Object.getLength(this._notReadyDataMap)>0&&Object.getLength(this._waitingForReadyDataMap)>0?!1:!0}})}),define.experiment.Class("core.managers.data.DataManager.URM4.New",function(e,t){var n=e;n.methods({reportDataItemChangeEvent:function(e,t,n,r,i){this.fireEvent(Constants.DataEvents.DATA_CHANGED,[e,t,n,r]);if(!i&&t!==undefined&&n!==undefined&&e._data.id&&!this.injects().Utils.areObjectsEqual(t,n)){if(this.getOriginalClassName()==="core.managers.theme.ThemeManager"&&!r)return;this.fireEvent("undoDataChangedEvent",[e,t,n,r])}}})}),define.experiment.Class("core.managers.serverfacade.CorsRESTClient.ShowOneMnMessage.New",function(e,t){var n=e,r=t;n.methods({get:function(e,t,n){var r=this._createCorsXhr(e);r.onabort=function(e){this._onXhrEvent("abort",r,n)}.bind(this),r.ontimeout=function(e){this._onXhrEvent("timeout",r,n)}.bind(this),r.onerror=function(e){this._onXhrEvent("error",r,n)}.bind(this),r.onload=function(e){this._onXhrEvent("load",r,n)}.bind(this),r.onprogress=function(e){},t&&Object.each(t,function(e){e.key&&e.value&&r.setRequestHeader(e.key,e.value)}),r.send()}})}),define.experiment.Class("core.managers.skin.SkinManager.SyncWixify.New",function(e,t){var n=e;n.methods({getSkin:function(e,t){e=this.getNameOverride(e);if(this._skinClassMap[e])return t&&t(this._skinClassMap[e]),this._skinClassMap[e];var n=this._skinQue.hasQueue(e)===!1;this._skinQue.add(e,t);if(n){var r=this.define.getDefinition("skin"),i=nsUtil.getNameSpace(r,e);i?this.registerNewSkin(e,i):this._classManager.getClass(e,function(){})}return null}})}),define.experiment.Class("core.managers.skin.SkinRenderer.StyleRefactor.New",function(e,t){var n=e;n.methods({_getParamValue:function(e,t){var n=null;if(e.defaultParam){var r=e.defaultParam;return this._applyParamMutators(this._getParamValue(r,t),e)}if(t&&t.getProperty(e.id)){var i=t.getPropertySource(e.id);return n=t.getProperty(e.id),i=="theme"&&(n=this.injects().Theme.getProperty(n)),n=this._castToType(n,e),n=this._addExtraToParamByType(e,n,t),this._applyParamMutators(n,e)}if(e.defaultTheme){var s=e.defaultTheme,o=W.Theme.getProperty(s);return o=this._castToType(o,e),this._applyParamMutators(o,e)}if(e.sumParams){var u=e.sumParams;if(u&&typeOf(u)=="array"&&u.length>0){var a=this._getParamValue(u[0],t);if(a.add&&typeof a.add=="function")for(var f=1;f<u.length;f++)a.add(this._getParamValue(u[f],t));return this._applyParamMutators(a,e)}}return e.defaultValue?(n=this._castToType(e.defaultValue,e),this._applyParamMutators(n,e)):null}})}),define.experiment.Class("core.managers.theme.ThemeManager.StyleRefactor.New",function(e,t){var n=e;n.utilize(t.merge(["core.managers.style.SkinParamMapper","bootstrap.utils.Queue"])),n.methods({initialize:function(e){this.parent(),this.SkinParamMapperClass=this.imports.SkinParamMapper,this._placeHoldersMap={},this._isReady=!0,this._isDataReady=!1,this._styleQueue=new this.imports.Queue,this._styleCache={},this._stylesInProcess={},this._isOperating=!1,this.getDataByQuery("#THEME_DATA",this._onDataReady)},getStyle:function(e,t,n){if(this._styleCache[e])t(this._styleCache[e]);else{this._styleQueue.add(e,t);if(this._styleQueue.getQueue(e).length>1)return;var r=function(t){this._styleCache[e]=t,this._styleQueue.getQueue(e).forEach(function(e){e(t)}),this._styleQueue.removeKey(e)}.bind(this);this.isStyleAvailable(e)?this.getDataByQuery("#"+e,function(e){var t=e.get("style");W.Skins.getSkin(e.get("skin"),function(t){var n=new this.SkinParamMapperClass(e,e.get("style"),t);r(n)}.bind(this))}.bind(this)):this.createStyle(e,"",n,r)}},createStyle:function(e,t,n,r){this._styleCache[e]&&LOG.reportError(wixErrors.STYLE_ALREADY_EXISTS,"ThemeManager","createStyle",e)();var i=Object.clone(this.INIT_STYLE_RAW_DATA);i.skin=n;var s=this.addDataItem(e,i);W.Skins.getSkin(s.get("skin"),function(e){var t=new this.SkinParamMapperClass(s,s.get("style"),e),n=t.getId();this._styleCache[n]=t,r(t)}.bind(this))},createStyleFromData:function(e,t,n){var r=n||e.skin,i=Object.clone(e),s=t?t+"_":"",o=s+Date.now().toString(36),u=this.addDataItem(o,i),a=new this.SkinParamMapperClass(u,u.get("style"),r);return this._styleCache[u.get("id")]=a,a},cloneStyle:function(e,t){var n=e.getDataItem(),r=e.getSkinClass(),i=n.getData(),s=this.createStyleFromData(i,t,r);return s}})}),define.experiment.Class("core.utils.css.Background.MobileFixes.New",function(e,t){var n=e,r=t;n.methods({setWidth:r.after(function(){W.Config.mobileConfig.isMobileOrTablet()&&this._width=="contain"&&(this._width="cover")})})});